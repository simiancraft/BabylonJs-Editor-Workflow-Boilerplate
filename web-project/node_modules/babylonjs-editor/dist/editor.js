!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6))),{}):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return i(t,r),a(t,r,[]),t.module}function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function s(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module,"__useDefault"in u?u.__useDefault:u}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=s(r.deps,r.depLoads,n);if(!r.executingRequire)for(var i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}var f=t.module=new o(r.moduleObj);if(!r.setters)for(var i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a],{}));i(s);var v=u(e[0]);if(e.length>1)for(var a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["c","20","38","e","67","29","64","63","6d"],!0,function($__System){var require=this.require,exports=this.exports,module=this.module;$__System.registerDynamic("b",["c"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),Core=function(){function Core(){var _this=this;this.scenes=[],this.uiTextures=[],this.currentSelectedObject=null,this.disableObjectSelection=!1,this.updates=[],this.onSelectObject=new babylonjs_1.Observable,this.onSelectAsset=new babylonjs_1.Observable,this.onResize=new babylonjs_1.Observable,this.onAddObject=new babylonjs_1.Observable,this.onRemoveObject=new babylonjs_1.Observable,this.onModifyingObject=new babylonjs_1.Observable,this.onModifiedObject=new babylonjs_1.Observable,this.onDropFiles=new babylonjs_1.Observable,this.onSceneLoaded=new babylonjs_1.Observable,this.renderScenes=!0,this.onSelectObject.add(function(object){return _this.currentSelectedObject=object})}return Core.prototype.removeScene=function(scene,dispose){var index=this.scenes.findIndex(function(s){return s===scene});return-1!==index&&(dispose&&scene.dispose(),this.scenes.splice(index,1),!0)},Core.prototype.removeUI=function(ui,dispose){var index=this.uiTextures.findIndex(function(u){return u===ui});return-1!==index&&(dispose&&ui.dispose(),this.uiTextures.splice(index,1),!0)},Core.prototype.update=function(){this.renderScenes&&(this.updates.forEach(function(u){return u.onPreUpdate&&u.onPreUpdate()}),this.scenes.forEach(function(s){return s.render()}),this.updates.forEach(function(u){return u.onPostUpdate&&u.onPostUpdate()}))},Core}();exports.default=Core}),$__System.registerDynamic("d",["c","e","f","10","11"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),babylonjs_serializers_1=$__require("e"),tools_1=$__require("f"),window_1=$__require("10"),form_1=$__require("11"),SceneSerializer=function(){function SceneSerializer(scene){var _this=this,window=new window_1.default("Scene Serializer");window.buttons=["Ok","Cancel"],window.width=400,window.height=190,window.body='<div id="SCENE-SERIALIZER-WINDOW" style="width: 100%; height: 100%"></div>',window.open();var form=new form_1.default("SceneSerializer");form.fields=[{name:"name",type:"text",required:!0},{name:"format",type:"list",required:!0,options:{items:["GLB","GLTF","OBJ"]}},{name:"lights",type:"checkbox",html:{caption:"Lights (for GLTF)"}}],form.build("SCENE-SERIALIZER-WINDOW"),form.element.record.name="scene",form.element.record.format="GLB",form.element.refresh(),window.onButtonClick=function(id){return __awaiter(_this,void 0,void 0,function(){var name,format,_a,obj,file,e_1,lights,serializedScene,json,file;return __generator(this,function(_b){switch(_b.label){case 0:if(window.close(),"Cancel"===id)return[2,form.element.destroy()];if(!form.isValid())return[2];name=form.element.record.name,format=form.element.record.format.id,_b.label=1;case 1:switch(_b.trys.push([1,9,,10]),_a=format){case"GLB":return[3,2];case"GLTF":return[3,4];case"OBJ":return[3,6]}return[3,7];case 2:return[4,babylonjs_serializers_1.GLTF2Export.GLBAsync(scene,name,{})];case 3:return _b.sent().downloadFiles(),[3,8];case 4:return[4,babylonjs_serializers_1.GLTF2Export.GLTFAsync(scene,name,{})];case 5:return _b.sent().downloadFiles(),[3,8];case 6:return obj=babylonjs_serializers_1.OBJExport.OBJ(scene.meshes,!0),file=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(obj),"scene.obj"),babylonjs_1.Tools.Download(file,"scene.obj"),[3,8];case 7:return[2];case 8:return[3,10];case 9:return e_1=_b.sent(),window_1.default.CreateAlert(e_1.message,"Error when exporting the scene"),[3,10];case 10:return lights=form.element.record.lights,"GLB"!==format&&"GLTF"!==format||!lights||(serializedScene=babylonjs_1.SceneSerializer.Serialize(scene),json=JSON.stringify({lights:serializedScene.lights},null,"\t"),file=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(json),"lights.json"),babylonjs_1.Tools.Download(file,"lights.json")),form.element.destroy(),[2]}})})}}return SceneSerializer}();exports.default=SceneSerializer}),$__System.registerDynamic("12",["13","10","14","f","15","16","17","18","19","1a","1b","d","1c","1d","1e"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var toolbar_1=$__require("13"),window_1=$__require("10"),dialog_1=$__require("14"),tools_1=$__require("f"),undo_redo_1=$__require("15"),theme_1=$__require("16"),request_1=$__require("17"),scene_exporter_1=$__require("18"),scene_factory_1=$__require("19"),scene_importer_1=$__require("1a"),scene_manager_1=$__require("1b"),scene_serializer_1=$__require("d"),project_importer_1=$__require("1c"),project_exporter_1=$__require("1d"),project_code_editor_1=$__require("1e"),EditorToolbar=function(){function EditorToolbar(editor){var _this=this;this.editor=editor,this.main=new toolbar_1.default("MainToolBar"),this.main.items=[{type:"menu",id:"project",text:"Project",img:"icon-folder",items:[{id:"import-project",img:"icon-export",text:"Import Project..."},{type:"break"},{id:"reload-project",img:"icon-copy",text:"Reload..."},{id:"new-project",img:"icon-copy",text:"New Project..."},{type:"break"},{id:"export-project",img:"icon-files",text:"Save Project... <kbd>CTRL + S</kbd>"},{id:"export-project-as",img:"icon-files",text:"Save Project As... <kbd>ALT + CTRL + S</kbd>"},{type:"break"},{id:"export-template",img:"icon-files-project",text:"Export Project Template..."}]},{type:"menu",id:"scene",text:"Scene",img:"icon-scene",items:[{id:"import-meshes-from",img:"icon-add",text:"Import Meshes From..."},{type:"break"},{id:"download-scene",img:"icon-export",text:"Save Scene File..."},{id:"serialize-scene",img:"icon-export",text:"Save Scene File As..."},{type:"break"},{id:"export-final-scene",img:"icon-files-project",text:"Export Final Scene And Assets..."}]},{type:"break"},{type:"menu",id:"edit",text:"Edit",img:"icon-edit",items:[{id:"undo",img:"icon-undo",text:"Undo <kbd>CTRL + Z</kbd>"},{id:"redo",img:"icon-redo",text:"Redo <kbd>CTRL + Y</kbd>"},{type:"break"},{id:"clean-materials",img:"icon-recycle",text:"Clean Unused Materials"},{id:"clean-textures",img:"icon-recycle",text:"Clean Unused Textures"},{type:"break"},{id:"restore-removed-object",img:"icon-recycle",text:"Restore Removed Object..."},{type:"break"},{id:"set-theme-light",img:"icon-helpers",text:"Light Theme"},{id:"set-theme-dark",img:"icon-helpers",text:"Dark Theme"}]},{type:"break"},{type:"menu",id:"view",text:"View",img:"icon-helpers",items:[{id:"textures",img:"icon-dynamic-texture",text:"Textures Viewer..."},{id:"materials",img:"icon-effects",text:"Materials Viewer..."}]},{type:"break"},{type:"menu",id:"tools",text:"Tools",img:"icon-scenario",items:[{id:"animations",img:"icon-animators",text:"Animations Editor..."},{type:"break"},{id:"code-editor",img:"icon-behavior-editor",text:"Code Editor..."},{id:"graph-editor",img:"icon-graph",text:"Graph Editor..."},{type:"break"},{id:"material-editor",img:"icon-shaders",text:"Material Editor..."},{id:"post-process-editor",img:"icon-shaders",text:"Post-Process Editor..."},{id:"particles-creator",img:"icon-particles",text:"Particles Creator"},{type:"break"},{id:"path-finder",img:"icon-graph",text:"Path Finder..."},{type:"break"},{id:"metadatas",img:"icon-behavior-editor",text:"Metadatas Editor..."},{id:"notes",img:"icon-behavior-editor",text:"Notes..."},{id:"prefab-editor",img:"icon-mesh",text:"Prefab Editor..."}]},{type:"break"},{type:"menu",id:"add",text:"Add",img:"icon-add",items:[{id:"default-environment",img:"icon-add",text:"Default Environment"},{type:"break"},{id:"particle-system",img:"icon-particles",text:"Particle System"},{id:"particle-system-animated",img:"icon-particles",text:"Animated Particle System"},{type:"break;"},{id:"sky",img:"icon-shaders",text:"Sky Effect"},{id:"water",img:"icon-water",text:"Water Effect"},{type:"break"},{id:"dummy-node",img:"icon-clone",text:"Dummy"},{id:"ground",img:"icon-mesh",text:"Ground Mesh"},{id:"cube",img:"icon-box-mesh",text:"Cube Mesh"},{id:"sphere",img:"icon-sphere-mesh",text:"Sphere Mesh"},{id:"plane",img:"icon-mesh",text:"Plane Mesh"},{type:"break"},{id:"point-light",img:"icon-light",text:"Point Light"},{id:"directional-light",img:"icon-directional-light",text:"Directional Light"},{id:"spot-light",img:"icon-directional-light",text:"Spot Light"},{id:"hemispheric-light",img:"icon-light",text:"Hemispheric Light"},{type:"break"},{id:"sound",img:"icon-sound",text:"Sound"}]}],this.main.helpUrl="http://doc.babylonjs.com/resources/",this.main.onClick=function(target){return _this.onMainClick(target)},this.main.build("MAIN-TOOLBAR"),this.tools=new toolbar_1.default("ToolsToolBar"),this.tools.items=[{type:"button",id:"test",text:"Play",img:"icon-play-game-windowed"},{type:"button",id:"test-debug",text:"Play And Debug...",img:"icon-play-game-windowed"}],this.tools.onClick=function(target){return _this.onToolsClick(target)},this.tools.build("TOOLS-TOOLBAR")}return EditorToolbar.prototype.notifyRightMessage=function(message){this.tools.element.right=message,this.tools.element.render()},EditorToolbar.prototype.onMainClick=function(target){return __awaiter(this,void 0,void 0,function(){var _a,openedProject,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:switch(_a=target){case"project:import-project":return[3,1];case"project:reload-project":return[3,5];case"project:new-project":return[3,6];case"project:export-project":return[3,10];case"project:export-project-as":return[3,12];case"project:export-template":return[3,14];case"scene:import-meshes-from":return[3,16];case"scene:download-scene":return[3,17];case"scene:serialize-scene":return[3,18];case"scene:export-final-scene":return[3,19];case"edit:undo":return[3,21];case"edit:redo":return[3,22];case"edit:clean-materials":return[3,23];case"edit:clean-textures":return[3,24];case"edit:restore-removed-object":return[3,25];case"edit:set-theme-light":return[3,26];case"edit:set-theme-dark":return[3,27];case"view:textures":return[3,28];case"view:materials":return[3,30];case"tools:animations":return[3,32];case"tools:code-editor":return[3,34];case"tools:graph-editor":return[3,36];case"tools:material-editor":return[3,38];case"tools:post-process-editor":return[3,40];case"tools:particles-creator":return[3,42];case"tools:path-finder":return[3,44];case"tools:metadatas":return[3,46];case"tools:notes":return[3,48];case"tools:prefab-editor":return[3,50];case"add:default-environment":return[3,52];case"add:particle-system":return[3,53];case"add:particle-system-animated":return[3,54];case"add:sky":return[3,55];case"add:water":return[3,56];case"add:dummy-node":return[3,57];case"add:ground":return[3,58];case"add:cube":return[3,59];case"add:sphere":return[3,60];case"add:plane":return[3,61];case"add:point-light":return[3,62];case"add:directional-light":return[3,63];case"add:spot-light":return[3,64];case"add:hemispheric-light":return[3,65];case"add:sound":return[3,66];case"gui:add-advanced-texture":return[3,67];case"gui:add-image":return[3,68]}return[3,69];case 1:return[4,project_importer_1.default.ImportProject(this.editor)];case 2:return openedProject=_b.sent(),openedProject||!tools_1.default.IsElectron()?[3,4]:[4,request_1.default.Post("/openedFile",{value:null})];case 3:_b.sent(),_b.label=4;case 4:return[3,70];case 5:return dialog_1.default.Create("Reload scene","Are you sure to reload the entire scene?",function(result){"No"!==result&&(project_code_editor_1.default.CloseAll(),_this.editor._showReloadDialog=!1,tools_1.default.IsElectron()?_this.editor.checkOpenedFile():_this.editor.filesInput._processReload())}),[3,70];case 6:return project_exporter_1.default.ProjectPath=null,[4,this.editor.createDefaultScene(!0,!0)];case 7:return _b.sent(),tools_1.default.IsElectron()?[4,request_1.default.Post("/openedFile",JSON.stringify({value:null}))]:[3,9];case 8:_b.sent(),_b.label=9;case 9:return[3,70];case 10:return[4,project_exporter_1.default.ExportProject(this.editor)];case 11:return _b.sent(),[3,70];case 12:return[4,project_exporter_1.default.ExportProject(this.editor,!0)];case 13:return _b.sent(),[3,70];case 14:return[4,project_exporter_1.default.ExportTemplate(this.editor,!1)];case 15:return _b.sent(),[3,70];case 16:return scene_importer_1.default.ImportMeshesFromFile(this.editor),[3,70];case 17:return scene_exporter_1.default.DownloadBabylonFile(this.editor),[3,70];case 18:return new scene_serializer_1.default(this.editor.core.scene),[3,70];case 19:return[4,project_exporter_1.default.ExportTemplate(this.editor,!0)];case 20:return _b.sent(),[3,70];case 21:return undo_redo_1.default.Undo(),[3,70];case 22:return undo_redo_1.default.Redo(),[3,70];case 23:return window_1.default.CreateAlert("Cleared "+scene_manager_1.default.CleanUnusedMaterials(this.editor.core.scene)+" materials","Report"),[3,70];case 24:return window_1.default.CreateAlert("Cleared "+scene_manager_1.default.CleanUnusedTextures(this.editor.core.scene)+" textures","Report"),[3,70];case 25:return scene_manager_1.default.RestoreRemovedObjects(this.editor),[3,70];case 26:return theme_1.default.ThemeName="Light",[3,70];case 27:return theme_1.default.ThemeName="Dark",[3,70];case 28:return[4,this.loadTool("texture-viewer","Textures Viewer")];case 29:return _b.sent(),[3,70];case 30:return[4,this.loadTool("material-viewer","Materials Viewer")];case 31:return _b.sent(),[3,70];case 32:return[4,this.loadTool("animation-editor","Animations Editor")];case 33:return _b.sent(),[3,70];case 34:return[4,this.loadTool("behavior-editor","Code Editor")];case 35:return _b.sent(),[3,70];case 36:return[4,this.loadTool("graph-editor","Graph Editor")];case 37:return _b.sent(),[3,70];case 38:return[4,this.loadTool("material-editor","Material Editor")];case 39:return _b.sent(),[3,70];case 40:return[4,this.loadTool("post-process-editor","Post-Process Editor")];case 41:return _b.sent(),[3,70];case 42:return[4,this.loadTool("particles-creator","Particles Creator")];case 43:return _b.sent(),[3,70];case 44:return[4,this.loadTool("path-finder","Path Finder")];case 45:return _b.sent(),[3,70];case 46:return[4,this.loadTool("metadatas","Metadatas Editor")];case 47:return _b.sent(),[3,70];case 48:return[4,this.loadTool("notes","Notes")];case 49:return _b.sent(),[3,70];case 50:return[4,this.loadTool("prefab-editor","Prefab Editor")];case 51:return _b.sent(),[3,70];case 52:return scene_factory_1.default.CreateDefaultEnvironment(this.editor),[3,70];case 53:return scene_factory_1.default.CreateDefaultParticleSystem(this.editor,!1),[3,70];case 54:return scene_factory_1.default.CreateDefaultParticleSystem(this.editor,!0),[3,70];case 55:return scene_factory_1.default.CreateSkyEffect(this.editor),[3,70];case 56:return scene_factory_1.default.CreateWaterEffect(this.editor),[3,70];case 57:return scene_factory_1.default.CreateDummyNode(this.editor),[3,70];case 58:return scene_factory_1.default.CreateGroundMesh(this.editor),[3,70];case 59:return scene_factory_1.default.CreateCube(this.editor),[3,70];case 60:return scene_factory_1.default.CreateSphere(this.editor),[3,70];case 61:return scene_factory_1.default.CreatePlane(this.editor),[3,70];case 62:return scene_factory_1.default.CreateLight(this.editor,"point"),[3,70];case 63:return scene_factory_1.default.CreateLight(this.editor,"directional"),[3,70];case 64:return scene_factory_1.default.CreateLight(this.editor,"spot"),[3,70];case 65:return scene_factory_1.default.CreateLight(this.editor,"hemispheric"),[3,70];case 66:return scene_factory_1.default.AddSound(this.editor),[3,70];case 67:return scene_factory_1.default.AddGui(this.editor),[3,70];case 68:return scene_factory_1.default.AddGuiImage(this.editor),[3,70];case 69:return[3,70];case 70:return[2]}})})},EditorToolbar.prototype.onToolsClick=function(target){switch(target){case"test":scene_exporter_1.default.CreateFiles(this.editor),this.editor.addEditPanelPlugin("play-game",!1,"Game");break;case"test-debug":scene_exporter_1.default.CreateFiles(this.editor),tools_1.default.OpenPopup("./preview.html","Preview",1280,800)}},EditorToolbar.prototype.loadTool=function(url,name){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.editor.addEditPanelPlugin(url,!1,name)];case 1:return result=_a.sent(),[2,result]}})})},EditorToolbar}();exports.default=EditorToolbar}),$__System.registerDynamic("1f",["c","20","f","21","15","22","1b"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),babylonjs_gui_1=$__require("20"),tools_1=$__require("f"),tree_1=$__require("21"),undo_redo_1=$__require("15"),scene_picker_1=$__require("22"),scene_manager_1=$__require("1b"),EditorGraph=function(){function EditorGraph(editor){var _this=this;this.editor=editor,this.root="ROOT",this.gui="GUI",this.currentObject=this.editor.core.scene,this.tree=new tree_1.default("SceneTree"),this.tree.multipleSelection=!0,this.tree.wholerow=!0,this.tree.build("SCENE-GRAPH"),this.tree.onClick=function(id,data){_this.currentObject=data,_this.editor.scenePicker.setGizmoAttachedMesh(data),_this.editor.core.onSelectObject.notifyObservers(data,void 0,_this)},this.tree.onDblClick=function(id,data){(data.globalPosition||data.getAbsolutePosition)&&scene_picker_1.default.CreateAndPlayFocusAnimation(_this.editor.camera.getTarget(),data.globalPosition||data.getAbsolutePosition(),_this.editor.camera)},this.tree.onRename=function(id,name,data){if(!data.name)return!1;var oldName=data.name;return data.name=name,_this.editor.inspector.updateDisplay(),undo_redo_1.default.Push({object:data,property:"name",from:oldName,to:name,fn:function(type){_this.tree.rename(data.id,"from"===type?oldName:name),_this.editor.inspector.updateDisplay()}}),!0},this.tree.onContextMenu=function(id,data){if(!data.clone||data===_this.editor.camera||data===_this.editor.core.scene)return[];var result=[];return 1===_this.tree.getAllSelected().length&&((data.globalPosition||data.getAbsolutePosition)&&result.push({id:"focus",text:"Focus",img:"icon-focus",separatorAfter:!0,callback:function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("focus")];case 1:return[2,_a.sent()]}})})}}),data instanceof babylonjs_1.Mesh&&result.push({id:"create-prefab",text:"Create Prefab",img:"icon-add",multiple:!0,separatorBefore:!0,callback:function(node){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("create-prefab",node)];case 1:return[2,_a.sent()]}})})}}),data instanceof babylonjs_1.AbstractMesh&&result.push({id:"set-material",text:"Set Material...",img:"icon-shaders",separatorAfter:!0,callback:function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("set-material")];case 1:return[2,_a.sent()]}})})}}),(data instanceof babylonjs_1.Node||data instanceof babylonjs_1.Scene||data instanceof babylonjs_1.ParticleSystem)&&(result.push({id:"attach-script",text:"Attach Existing Script...",img:"icon-behavior-editor",callback:function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("attach-script")];case 1:return[2,_a.sent()]}})})}}),result.push({id:"add-script",text:"Add Script...",img:"icon-behavior-editor",separatorAfter:!0,callback:function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("add-script")];case 1:return[2,_a.sent()]}})})}})),data.clone&&result.push({id:"clone",text:"Clone",img:"icon-clone",multiple:!0,callback:function(node){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("clone",node)];case 1:return[2,_a.sent()]}})})}})),result.push.apply(result,[{id:"delete",text:"Delete",img:"icon-error",multiple:!0,callback:function(node){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.onMenuClick("remove",node)];case 1:return[2,_a.sent()]}})})}}]),result},this.tree.onCanDrag=function(id,data){return!(data instanceof babylonjs_1.Scene)},this.tree.onDrag=function(node,parent){if(babylonjs_1.Tags.AddTagsTo(node,"modified"),node instanceof babylonjs_1.ParticleSystem){if(!(parent instanceof babylonjs_1.AbstractMesh))return!1;var oldEmitter_1=node.emitter,newEmitter_1=parent;return undo_redo_1.default.Push({object:node,property:"emitter",from:oldEmitter_1,to:newEmitter_1,fn:function(type){"from"===type?_this.tree.setParent(node.id,oldEmitter_1.id):_this.tree.setParent(node.id,newEmitter_1.id)}}),node.emitter=parent,!0}if(node instanceof babylonjs_1.Node){if(!(parent instanceof babylonjs_1.Node||parent instanceof babylonjs_1.Scene))return!1;var oldParent_1=node.parent,newParent_1=parent instanceof babylonjs_1.Scene?null:parent;return undo_redo_1.default.Push({object:node,property:"parent",from:oldParent_1,to:newParent_1,fn:function(type){"from"===type?_this.tree.setParent(node.id,oldParent_1?oldParent_1.id:_this.root):_this.tree.setParent(node.id,newParent_1?newParent_1.id:_this.root)}}),node.parent=newParent_1,!0}if(node instanceof babylonjs_1.Sound){if(parent instanceof babylonjs_1.Scene)return node.spatialSound=!1,node.detachFromMesh(),!0;if(parent instanceof babylonjs_1.AbstractMesh)return node.spatialSound=!0,node.attachToMesh(parent),!0}return babylonjs_1.Tags.RemoveTagsFrom(node,"modified"),!1},this.tree.onCopy=function(source,target,parent){return source.data.clone?(target.data=source.data.clone(),target.data.name=source.data.name,target.data.id=babylonjs_1.Tools.RandomId(),parent instanceof babylonjs_1.Node&&(target.data.parent=parent),target.data):null};var search=$("#SCENE-GRAPH-SEARCH");search.keyup(function(){_this.tree.search(search.val())}),this.editor.core.onSelectObject.add(function(node,ev){return ev.target!==_this&&node&&_this.tree.select(node.id)})}return EditorGraph.prototype.renameNode=function(id,name){this.tree.rename(id,name)},EditorGraph.prototype.setParent=function(id,parentId){this.tree.setParent(id,parentId)},EditorGraph.prototype.add=function(node,parentId){this.tree.add(node,parentId)},EditorGraph.prototype.select=function(id){this.tree.select(id)},EditorGraph.prototype.getSelected=function(){return this.tree.getSelected()},EditorGraph.prototype.getAllSelected=function(){return this.tree.getAllSelected()},EditorGraph.prototype.getByData=function(data){return this.tree.get(data.id||data.name)},EditorGraph.prototype.clear=function(){this.tree.clear()},EditorGraph.prototype.fill=function(scene,root){var _this=this;void 0===scene&&(scene=this.editor.core.scene);var nodes=root?root.getChildren():[];root?tools_1.default.SortAlphabetically(nodes,"name"):(this.tree.add({id:this.root,text:"Scene",img:"icon-scene",data:scene}),this.tree.select(this.root),this.editor.inspector.setObject(scene),tools_1.default.SortAlphabetically(scene.cameras,"name"),tools_1.default.SortAlphabetically(scene.lights,"name"),tools_1.default.SortAlphabetically(scene.meshes,"name"),scene.cameras.forEach(function(c){return!c.parent&&nodes.push(c)}),scene.lights.forEach(function(l){return!l.parent&&nodes.push(l)}),scene.meshes.forEach(function(m){return!m.parent&&nodes.push(m)}),scene.transformNodes.forEach(function(t){return!t.parent&&nodes.push(t)}),this.fillSounds(scene,scene)),nodes.forEach(function(n){if(!babylonjs_1.Tags.MatchesQuery(n,"prefab")){n.id&&!_this.tree.get(n.id)||(n.id=babylonjs_1.Tools.RandomId(),n.metadata&&n.metadata.original&&(n.metadata.original.id=n.id)),n.id=n.id.replace(/ /g,"");var parent=root?root.id:_this.root;_this.tree.add({id:n.id,text:n.name,img:_this.getIcon(n),data:n},parent)&&(n instanceof babylonjs_1.AbstractMesh&&(n.subMeshes&&n.subMeshes.length>1&&n.subMeshes.forEach(function(sm,index){var smMaterial=sm.getMaterial();_this.tree.add({id:n.id+"submesh_"+index,text:smMaterial?smMaterial.name:sm.getMesh().name+" (Unnamed submesh)",img:_this.getIcon(n),data:sm},n.id)}),n.skeleton&&_this.tree.add({id:n.skeleton.id||babylonjs_1.Tools.RandomId(),text:n.skeleton.name,img:_this.getIcon(n.skeleton),data:n.skeleton},n.id)),scene.particleSystems.forEach(function(ps){ps.emitter===n&&_this.tree.add({id:ps.id,text:ps.name,img:_this.getIcon(ps),data:ps},n.id)}),scene.lensFlareSystems&&scene.lensFlareSystems.forEach(function(lf){lf.getEmitter()===n&&_this.tree.add({id:lf.id,text:lf.name,img:_this.getIcon(lf),data:lf},n.id)}),n instanceof babylonjs_1.Camera&&scene.postProcesses.forEach(function(p){p.getCamera()===n&&_this.tree.add({id:p.name+babylonjs_1.Tools.RandomId(),text:p.name,img:_this.getIcon(p),data:p},n.id)}),_this.fillSounds(scene,n),_this.fill(scene,n))}}),root||(this.tree.expand(this.root),this.configure())},EditorGraph.prototype.updateObjectMark=function(obj){var added=babylonjs_1.Tags.MatchesQuery(obj,"added"),modified=babylonjs_1.Tags.MatchesQuery(obj,"modified");this.tree.markNode(obj.id,modified&&!added)},EditorGraph.prototype.configure=function(){var _this=this,scene=this.editor.core.scene,configure=function(n){var type="default";babylonjs_1.Tags.HasTags(n)&&(babylonjs_1.Tags.MatchesQuery(n,"prefab")||babylonjs_1.Tags.MatchesQuery(n,"prefab-master"))&&(type="italic"),n.metadata&&(n.metadata.behavior&&n.metadata.behavior.metadatas.length>0||n.metadata.behaviorGraph&&n.metadata.behaviorGraph.metadatas.length>0)&&(type="italic"===type?"boldItalic":"bold"),_this.tree.setType(n.id,type),_this.updateObjectMark(n)};scene.meshes.forEach(function(n){return configure(n)}),scene.cameras.forEach(function(n){return configure(n)}),scene.lights.forEach(function(n){return configure(n)})},EditorGraph.prototype.getIcon=function(obj){return obj instanceof babylonjs_1.AbstractMesh?"icon-mesh":obj instanceof babylonjs_1.Light?"icon-light":obj instanceof babylonjs_1.Camera?"icon-camera":obj instanceof babylonjs_1.ParticleSystem||obj instanceof babylonjs_1.GPUParticleSystem?"icon-particles":obj instanceof babylonjs_1.Skeleton?"icon-animated-mesh":obj instanceof babylonjs_1.PostProcess?"icon-helpers":obj instanceof babylonjs_1.Sound?"icon-sound":obj instanceof babylonjs_1.TransformNode?"icon-position":obj instanceof babylonjs_gui_1.AdvancedDynamicTexture?"icon-ground":obj instanceof babylonjs_gui_1.Image?"icon-dynamic-texture":null},EditorGraph.prototype.fillSounds=function(scene,root){var _this=this;if(scene.soundTracks&&0!==scene.soundTracks.length){var count=0;return scene.soundTracks.forEach(function(st){st.soundCollection.forEach(function(s){s.id=s.id||babylonjs_1.Tools.RandomId(),root!==scene||s._connectedTransformNode?s._connectedTransformNode===root&&(_this.tree.add({id:s.id,text:s.name,img:_this.getIcon(s),data:s},root.id),count++):_this.tree.add({id:s.id,text:s.name,img:_this.getIcon(s),data:s},_this.root)})}),count}},EditorGraph.prototype.fillGuiTextures=function(root){var _this=this;return root?this.editor.core.uiTextures.forEach(function(ut){}):this.editor.core.uiTextures.forEach(function(ut){_this.tree.add({id:ut.name,text:ut.name,img:_this.getIcon(ut),data:ut},_this.gui)}),0},EditorGraph.prototype.onMenuClick=function(id,node){return __awaiter(this,void 0,void 0,function(){var _a,clone,parent_1,scene_1,descendants_1,ui,index,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:if(!(node=node||this.getSelected()))return[2];switch(_a=id){case"focus":return[3,1];case"create-prefab":return[3,2];case"set-material":return[3,4];case"attach-script":return[3,6];case"add-script":return[3,8];case"clone":return[3,10];case"remove":return[3,11]}return[3,12];case 1:return scene_picker_1.default.CreateAndPlayFocusAnimation(this.editor.camera.getTarget(),node.data.globalPosition||node.data.getAbsolutePosition(),this.editor.camera),[3,13];case 2:return[4,this.editor.assets.prefabs.createPrefab(node.data)];case 3:return _b.sent(),[3,13];case 4:return[4,this.editor.addEditPanelPlugin("material-viewer",!1,"Materials Viewer",node.data,!0)];case 5:return _b.sent(),[3,13];case 6:return[4,this.editor.addEditPanelPlugin("behavior-editor",!1,"Code Editor",node.data,!1,!0)];case 7:return _b.sent(),[3,13];case 8:return[4,this.editor.addEditPanelPlugin("behavior-editor",!1,"Code Editor",node.data,!0)];case 9:return _b.sent(),[3,13];case 10:return node&&node.data instanceof babylonjs_1.Node&&node.data.clone?(clone=node.data.clone(),clone.position&&(clone.position.y+=2),clone.name=node.data.name+" Cloned",clone.id=babylonjs_1.Tools.RandomId(),node.data.skeleton&&(clone.skeleton=node.data.skeleton.clone(),clone.skeleton.name=node.data.skeleton.name,clone.skeleton.id=node.data.skeleton.id),parent_1=clone.parent?clone.parent.id:this.root,this.tree.add({id:clone.id,text:clone.name,img:this.getIcon(clone),data:clone},parent_1),this.currentObject=clone,this.editor.core.onSelectObject.notifyObservers(clone),this.configure(),[3,13]):[2];case 11:return node.data===this.editor.camera||node.data===this.editor.core.scene?[2]:(scene_1=this.editor.core.scene,descendants_1=(node.data.getDescendants?[node.data].concat(node.data.getDescendants()):[node.data]).map(function(n){var array=n instanceof babylonjs_1.AbstractMesh?scene_1.meshes:n instanceof babylonjs_1.Light?scene_1.lights:n instanceof babylonjs_1.Camera?scene_1.cameras:n instanceof babylonjs_1.TransformNode?scene_1.transformNodes:n instanceof babylonjs_1.Sound?scene_1.mainSoundTrack.soundCollection:n instanceof babylonjs_1.ParticleSystem?scene_1.particleSystems:[],particleSystems=scene_1.particleSystems.filter(function(p){return p.emitter===n}),sounds=[];return scene_1.soundTracks.forEach(function(st){return st.soundCollection.forEach(function(s){return s._connectedTransformNode===n&&sounds.push(s)})}),{node:n,array:array,instancedMeshIndex:n instanceof babylonjs_1.InstancedMesh?n.sourceMesh.instances.indexOf(n):null,sounds:sounds.map(function(s){return{soundTrackId:s.soundTrackId,isPlaying:s.isPlaying,treeNode:_this.getByData(s),sound:s}}),particleSystems:particleSystems.map(function(p){return{system:p,treeNode:_this.getByData(p)}})}}),undo_redo_1.default.Push({scope:node.id,undo:function(){_this.tree.add(Object.assign({},node,{img:_this.getIcon(node.data)}),node.parent),descendants_1.forEach(function(d){if(scene_1.getNodeByID(d.node.id))return babylonjs_1.Tags.RemoveTagsFrom(d.node,"removed");for(var _i=0,_a=scene_1.soundTracks;_i<_a.length;_i++){if(_a[_i].soundCollection.find(function(s){return s.name===d.node.name}))return babylonjs_1.Tags.RemoveTagsFrom(d.node,"removed")}d.node instanceof babylonjs_1.Node&&d.node.setEnabled(!0),null!==d.instancedMeshIndex&&d.node.sourceMesh.instances.splice(d.instancedMeshIndex,0,d.node),d.array.push(d.node),d.particleSystems.forEach(function(p){scene_1.particleSystems.push(p.system),_this.tree.add(Object.assign({},p.treeNode,{img:_this.getIcon(p.system)}),node.id),babylonjs_1.Tags.RemoveTagsFrom(p.system,"removed")}),d.sounds.forEach(function(s){scene_1.soundTracks[s.soundTrackId].soundCollection.push(s.sound),s.isPlaying&&s.sound.play(),_this.tree.add(Object.assign({},s.treeNode,{img:_this.getIcon(s.sound)}),node.id),babylonjs_1.Tags.RemoveTagsFrom(s.sound,"removed")}),babylonjs_1.Tags.RemoveTagsFrom(d.node,"removed"),d.node.metadata&&d.node.metadata.original&&delete scene_manager_1.default.RemovedObjects[d.node instanceof babylonjs_1.Sound?d.node.name:d.node.id]}),node.data instanceof babylonjs_1.Node&&_this.fill(scene_1,node.data),setTimeout(function(){_this.tree.select(node.id),_this.tree.onClick(node.id,node.data),_this.currentObject=node.data,_this.configure()},1)},redo:function(){descendants_1.forEach(function(d){if(d.node instanceof babylonjs_1.Sound&&d.node.stop(),d.node instanceof babylonjs_1.Node&&d.node.setEnabled(!1),null!==d.instancedMeshIndex&&d.node.sourceMesh.instances.splice(d.instancedMeshIndex,1),d.array.splice(d.array.indexOf(d.node),1),d.particleSystems.forEach(function(p){scene_1.particleSystems.splice(scene_1.particleSystems.indexOf(p.system),1),babylonjs_1.Tags.AddTagsTo(p.system,"removed")}),d.sounds.forEach(function(s){if(scene_1.soundTracks[s.soundTrackId].soundCollection.splice(scene_1.soundTracks[s.soundTrackId].soundCollection.indexOf(s.sound),1),babylonjs_1.Tags.AddTagsTo(s.sound,"removed"),s.sound.metadata&&s.sound.metadata.original){var savedRemovedObject={reference:s.sound,type:tools_1.default.GetConstructorName(s.sound),serializationObject:tools_1.default.Assign({},s.sound.metadata.original),name:s.sound.name};savedRemovedObject.serializationObject.metadata=tools_1.default.Assign({},savedRemovedObject.serializationObject.metadata,{original:void 0}),scene_manager_1.default.RemovedObjects[s.sound.name]=savedRemovedObject}}),babylonjs_1.Tags.AddTagsTo(d.node,"removed"),d.node.metadata&&d.node.metadata.original){var savedRemovedObject={reference:d.node,type:tools_1.default.GetConstructorName(d.node),serializationObject:tools_1.default.Assign({},d.node.metadata.original,{sourceMesh:d.node instanceof babylonjs_1.InstancedMesh?d.node.sourceMesh.id:void 0}),name:d.node.name};savedRemovedObject.serializationObject.metadata=tools_1.default.Assign({},savedRemovedObject.serializationObject.metadata,{original:void 0}),scene_manager_1.default.RemovedObjects[d.node instanceof babylonjs_1.Sound?d.node.name:d.node.id]=savedRemovedObject}}),_this.tree.remove(node.id),_this.editor.scenePicker.setGizmoAttachedMesh(null),_this.currentObject=null,_this.configure()}}),node.data instanceof babylonjs_gui_1.AdvancedDynamicTexture&&(ui=this.editor.core.uiTextures.find(function(ut){return ut===node.data}),-1!==(index=this.editor.core.uiTextures.indexOf(ui))&&this.editor.core.uiTextures.splice(index,1)),[3,13]);case 12:return[3,13];case 13:return[2]}})})},EditorGraph}();exports.default=EditorGraph}),$__System.registerDynamic("23",["c","24","13","25","22"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),layout_1=$__require("24"),toolbar_1=$__require("13"),context_menu_1=$__require("25"),scene_picker_1=$__require("22"),EditorPreview=function(){function EditorPreview(editor){var _this=this;this.editor=editor,this.layout=new layout_1.default("PREVIEW"),this.layout.panels=[{type:"top",size:30,resizable:!1,content:'<div id="PREVIEW-TOOLBAR" style="width: 100%; height: 100%;"></div>'},{type:"main",resizable:!1,content:'<canvas id="renderCanvasEditor" class="ctxmenu"></canvas>'}],this.layout.build("PREVIEW"),this.toolbar=new toolbar_1.default("PREVIEW-TOOLBAR"),this.toolbar.onClick=function(id){return _this.onToolbarClicked(id)},this.toolbar.items=[{type:"break"},{type:"menu",id:"camera",text:"Camera",img:"icon-camera",items:[{id:"free",text:"Free Camera",img:"icon-camera"},{id:"arc",text:"Arc Rotate Camera",img:"icon-camera"}]},{type:"break"},{type:"button",id:"position",text:"",img:"icon-position",checked:!1},{type:"button",id:"rotation",text:"",img:"icon-rotation",checked:!1},{type:"button",id:"scaling",text:"",img:"icon-scaling",checked:!1},{type:"button",id:"bounding-box",text:"",img:"icon-bounding-box",checked:!1},{type:"break"},{type:"button",id:"bounding-boxes",checked:!1,img:"icon-bounding-box",text:""},{type:"button",id:"wireframe",checked:!1,img:"icon-wireframe",text:""},{type:"break"},{type:"button",id:"post-processes",checked:!0,img:"icon-helpers",text:""},{type:"break"},{type:"button",id:"textures",checked:!0,img:"icon-dynamic-texture",text:""},{type:"button",id:"lights",checked:!0,img:"icon-light",text:""}],this.toolbar.build("PREVIEW-TOOLBAR");var canvas=$("#renderCanvasEditor")[0],lastPosition=babylonjs_1.Vector2.Zero();canvas.addEventListener("pointerdown",function(ev){lastPosition.set(ev.offsetX,ev.offsetY)}),canvas.addEventListener("contextmenu",function(ev){Math.abs(ev.offsetX-lastPosition.x)>10||Math.abs(ev.offsetY-lastPosition.y)>10||(_this.editor.scenePicker.onCanvasClick(ev),context_menu_1.default.Show(ev,{focus:{name:"Focus",callback:function(){return _this.editor.graph.onMenuClick("focus",_this.editor.graph.getSelected())}},clone:{name:"Clone",callback:function(){return _this.editor.graph.onMenuClick("clone",_this.editor.graph.getSelected())}},remove:{name:"Remove",callback:function(){return _this.editor.graph.onMenuClick("remove",_this.editor.graph.getSelected())}}}))})}return EditorPreview.prototype.resize=function(){this.layout.element.resize(),this.editor.core.engine.resize()},EditorPreview.prototype.setToolClicked=function(id){this.onToolbarClicked(id)},EditorPreview.prototype.reset=function(){this.toolbar.setChecked("bounding-boxes",!1),this.toolbar.setChecked("wireframe",!1),this.toolbar.setChecked("post-processes",!0),this.toolbar.setChecked("textures",!0),this.toolbar.setChecked("lights",!0)},EditorPreview.prototype.onToolbarClicked=function(id){switch(id){case"camera:free":this.editor.createEditorCamera("free");break;case"camera:arc":this.editor.createEditorCamera("arc");break;case"bounding-box":case"position":case"rotation":case"scaling":var active=this.toolbar.isChecked(id,!0);if(this.toolbar.setChecked("bounding-box",!1),this.toolbar.setChecked("position",!1),this.toolbar.setChecked("rotation",!1),this.toolbar.setChecked("scaling",!1),this.toolbar.setChecked(id,active),this.editor.scenePicker.gizmosLayer.shouldRender=active,!active){this.editor.scenePicker.gizmoType=scene_picker_1.GizmoType.NONE;break}switch(id){case"bounding-box":this.editor.scenePicker.gizmoType=scene_picker_1.GizmoType.BOUNDING_BOX;break;case"position":this.editor.scenePicker.gizmoType=scene_picker_1.GizmoType.POSITION;break;case"rotation":this.editor.scenePicker.gizmoType=scene_picker_1.GizmoType.ROTATION;break;case"scaling":this.editor.scenePicker.gizmoType=scene_picker_1.GizmoType.SCALING}break;case"bounding-boxes":case"wireframe":case"post-processes":case"textures":case"lights":switch(id){case"bounding-boxes":this.editor.core.scene.forceShowBoundingBoxes=!this.editor.core.scene.forceShowBoundingBoxes;break;case"wireframe":this.editor.core.scene.forceWireframe=!this.editor.core.scene.forceWireframe;break;case"post-processes":this.editor.core.scene.postProcessesEnabled=!this.editor.core.scene.postProcessesEnabled;break;case"textures":this.editor.core.scene.texturesEnabled=!this.editor.core.scene.texturesEnabled;break;case"lights":this.editor.core.scene.lightsEnabled=!this.editor.core.scene.lightsEnabled}this.toolbar.setChecked(id,!this.toolbar.isChecked(id))}},EditorPreview}();exports.default=EditorPreview}),$__System.registerDynamic("26",["c","27","f","1b"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),scene_manager_1=$__require("1b"),SceneTool=function(_super){function SceneTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="SCENE-TOOL",_this.tabName="Properties",_this._physicsEnabled=!1,_this._fogMode="",_this._glowEnabled=!1,_this._hightlightEnabled=!1,_this}return __extends(SceneTool,_super),SceneTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Scene},SceneTool.prototype.update=function(scene){var _this=this;_super.prototype.update.call(this,scene),this._physicsEnabled=scene.isPhysicsEnabled(),this._glowEnabled=null!==scene_manager_1.default.GlowLayer,this._hightlightEnabled=null!==scene_manager_1.default.HighLightLayer;var colors=this.tool.addFolder("Colors");colors.open(),this.tool.addColor(colors,"Ambient",scene.ambientColor).open(),this.tool.addColor(colors,"Clear",scene.clearColor).open();var imageProcessing=this.tool.addFolder("Image Processing");imageProcessing.open(),imageProcessing.add(scene.imageProcessingConfiguration,"exposure").step(.01).name("Exposure"),imageProcessing.add(scene.imageProcessingConfiguration,"contrast").step(.01).name("Contrast"),imageProcessing.add(scene.imageProcessingConfiguration,"toneMappingEnabled").name("Tone Mapping Enabled");var glow=this.tool.addFolder("Glow Layer");glow.open(),glow.add(this,"_glowEnabled").name("Enable Glow Layer").onFinishChange(function(r){r?scene_manager_1.default.GlowLayer=new babylonjs_1.GlowLayer("GlowLayer",scene):(scene_manager_1.default.GlowLayer.dispose(),scene_manager_1.default.GlowLayer=null),_this.update(scene)}),this._glowEnabled&&(glow.add(scene_manager_1.default.GlowLayer,"intensity").min(0).step(.01).name("Intensity"),glow.add(scene_manager_1.default.GlowLayer,"blurKernelSize").min(0).max(512).step(1).name("Blur Size").onChange(function(r){scene_manager_1.default.GlowLayer._options.blurKernelSize=2*r}));var highlight=this.tool.addFolder("HighLight");highlight.open(),highlight.add(this,"_hightlightEnabled").name("Enable HightLight Layer").onFinishChange(function(r){r?scene_manager_1.default.HighLightLayer=new babylonjs_1.HighlightLayer("HightLight Layer",scene):(scene_manager_1.default.HighLightLayer.dispose(),scene_manager_1.default.HighLightLayer=null),_this.update(scene)}),this._hightlightEnabled&&(highlight.add(scene_manager_1.default.HighLightLayer,"blurHorizontalSize").min(0).max(128).step(1).name("Horizontal Blur Size"),highlight.add(scene_manager_1.default.HighLightLayer,"blurVerticalSize").min(0).max(128).step(1).name("Horizontal Blur Size"),highlight.add(scene_manager_1.default.HighLightLayer,"innerGlow").name("Inner Glow"),highlight.add(scene_manager_1.default.HighLightLayer,"outerGlow").name("Outer Glow"),this.tool.addColor(highlight,"Neutral Color",scene_manager_1.default.HighLightLayer.neutralColor).open());var environment=this.tool.addFolder("Environment Texture");environment.open(),this.tool.addTexture(environment,this.editor,this.editor.core.scene,"environmentTexture",scene,!0,!0).name("Environment Texture");var collisions=this.tool.addFolder("Collisions");collisions.open(),collisions.add(scene,"collisionsEnabled").name("Collisions Enabled"),this.tool.addVector(collisions,"Gravity",scene.gravity,function(){var physics=scene.getPhysicsEngine();physics&&physics.setGravity(scene.gravity.clone())});var physics=this.tool.addFolder("Physics");physics.open(),physics.add(this,"_physicsEnabled").name("Physics Enabled").onFinishChange(function(r){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return r?(this.editor.layout.lockPanel("main","Enabling Physics...",!0),[4,tools_1.default.ImportScript("cannon")]):[3,2];case 1:return _a.sent(),scene.enablePhysics(scene.gravity.clone(),new babylonjs_1.CannonJSPlugin(!0)),scene.getPhysicsEngine().setTimeStep(tools_1.default.Epsilon),this.editor.layout.unlockPanel("main"),[3,3];case 2:scene.disablePhysicsEngine(),_a.label=3;case 3:return[2]}})})});var audio=this.tool.addFolder("Audio");audio.open(),audio.add(scene,"audioEnabled").name("Enable Audio");var fog=this.tool.addFolder("Fog");fog.open(),fog.add(scene,"fogEnabled").name("Enable Fog"),fog.add(scene,"fogStart").name("Fog Start"),fog.add(scene,"fogEnd").name("Fog End"),fog.add(scene,"fogDensity").name("Fog Density");var fogModes=["FOGMODE_NONE","FOGMODE_LINEAR","FOGMODE_EXP","FOGMODE_EXP2"];this._fogMode=fogModes[0];for(var _i=0,fogModes_1=fogModes;_i<fogModes_1.length;_i++){var mode=fogModes_1[_i];if(scene.fogMode===babylonjs_1.Scene[mode]){this._fogMode=mode;break}}fog.add(this,"_fogMode",fogModes).name("Fog Mode").onFinishChange(function(r){scene.fogMode=babylonjs_1.Scene[r]}),this.tool.addColor(fog,"Color",scene.fogColor).open()},SceneTool}(edition_tool_1.default);exports.default=SceneTool}),$__System.registerDynamic("28",["c","27","1b","f","29"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),scene_manager_1=$__require("1b"),tools_1=$__require("f"),extensions_1=$__require("29"),NodeTool=function(_super){function NodeTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="NODE-TOOL",_this.tabName="Properties",_this._parentId="",_this._enabled=!0,_this._currentMaterial="",_this._currentCamera=!1,_this._highlightEnabled=!1,_this._currentObject=null,_this}return __extends(NodeTool,_super),NodeTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Node||object instanceof babylonjs_1.SubMesh},NodeTool.prototype.update=function(object){var _this=this,node=object instanceof babylonjs_1.SubMesh?object.getMesh():object;_super.prototype.update.call(this,node);var scene=node.getScene();this._enabled=node.isEnabled(),(object instanceof babylonjs_1.Mesh||object instanceof babylonjs_1.InstancedMesh||object instanceof babylonjs_1.Camera)&&object.metadata&&object.metadata.original&&(this._currentObject=object,this.tool.add(this,"resetToOriginal").name("Reset to original"));var common=this.tool.addFolder("Common");if(common.open(),common.add(node,"name").name("Name").onFinishChange(function(r){return _this.editor.graph.renameNode(node.id,r)}),common.add(this,"_enabled").name("Enabled").onFinishChange(function(r){return node.setEnabled(r)}),node instanceof babylonjs_1.AbstractMesh&&common.add(node,"isVisible").name("Is Visible"),object instanceof babylonjs_1.Mesh){var materials=["None"].concat(this.editor.core.scene.materials.map(function(m){return m.name}));this._currentMaterial=object.material?object.material.name:"None",common.add(this,"_currentMaterial",materials).name("Material").onFinishChange(function(r){if("None"===r)return object.material=null;var material=_this.editor.core.scene.getMaterialByName(r);object.material=material})}void 0!==node.state&&common.add(node,"state").name("State");var parenting=this.tool.addFolder("Parenting");parenting.open();var parents=["None"];scene.meshes.forEach(function(m){return m.name!==node.name&&parents.push(m.name)}),scene.lights.forEach(function(l){return l.name!==node.name&&parents.push(l.name)}),scene.cameras.forEach(function(c){return c.name!==node.name&&parents.push(c.name)}),this._parentId=node.parent?node.parent.id:parents[0],parenting.add(this,"_parentId",parents).name("Parent").onChange(function(n){node.parent=scene.getNodeByName(n),_this.editor.graph.setParent(node.id,node.parent?node.parent.id:_this.editor.graph.root)});var transforms=this.tool.addFolder("Transfroms");if(transforms.open(),node.position&&this.tool.addVector(transforms,"Position",node.position).open(),node.rotation&&this.tool.addVector(transforms,"Rotation",node.rotation).open(),node.scaling&&this.tool.addVector(transforms,"Scaling",node.scaling).open(),node.direction&&this.tool.addVector(transforms,"Direction",node.direction).open(),node instanceof babylonjs_1.AbstractMesh){var options=this.tool.addFolder("Options");if(options.open(),node.metadata=node.metadata||{},node.metadata.baseConfiguration=node.metadata.baseConfiguration||{},node.metadata.baseConfiguration.isPickable=node.metadata.baseConfiguration.isPickable||!1,options.add(node.metadata.baseConfiguration,"isPickable").name("Is Pickable"),options.add(node,"isBlocker").name("Is Blocker"),!(node instanceof babylonjs_1.InstancedMesh)){var instances=this.tool.addFolder("Instances");instances.open(),instances.add(this,"createInstance").name("Create Instance...")}if(node instanceof babylonjs_1.Mesh&&scene_manager_1.default.HighLightLayer){var highlight=this.tool.addFolder("Highlight Layer");if(highlight.open(),this._highlightEnabled=scene_manager_1.default.HighLightLayer.hasMesh(node),highlight.add(this,"_highlightEnabled").name("Highlight Enabled").onFinishChange(function(r){r?scene_manager_1.default.HighLightLayer.addMesh(node,babylonjs_1.Color3.White()):scene_manager_1.default.HighLightLayer.removeMesh(node),_this.update(node)}),this._highlightEnabled)for(var m in scene_manager_1.default.HighLightLayer._meshes){var mesh=scene_manager_1.default.HighLightLayer._meshes[m];mesh.mesh===node&&(this.tool.addColor(highlight,"HighLight Color",mesh.color).open(),highlight.add(mesh,"glowEmissiveOnly").name("Glow Emissive Only"))}}}else if(node instanceof babylonjs_1.Camera){this._currentCamera=scene.activeCamera===node;var camera=this.tool.addFolder("Camera");camera.open(),camera.add(this,"_currentCamera").name("Active Camera").onFinishChange(function(r){scene.activeCamera=r?node:_this.editor.camera}),node instanceof babylonjs_1.ArcRotateCamera&&(camera.add(node,"panningSensibility").step(1).name("Panning Sensibility"),camera.add(node.inputs.attached.mousewheel,"wheelPrecision").step(.01).name("Zoom Factor")),void 0!==node.speed&&camera.add(node,"speed").step(.01).name("Speed"),camera.add(node,"minZ").step(.01).name("Min Z"),camera.add(node,"maxZ").step(.01).name("Max Z"),camera.add(node,"fov").step(.01).name("Fov")}if(node.animations&&node.animations.length>0||node instanceof babylonjs_1.Mesh&&node.skeleton){var animations=this.tool.addFolder("Animations");animations.open(),animations.add(this,"playAnimations").name("Play Animations")}this.addScriptsConfiguration(node)},NodeTool.prototype.resetToOriginal=function(){var _this=this,m=this._currentObject.metadata.original;babylonjs_1.SerializationHelper.Parse(function(){return _this._currentObject},m,this._currentObject.getScene(),"file:"),!m.parentId||this._currentObject.parent&&this._currentObject.parent.id===m.parentId?this._currentObject.parent&&(this._currentObject.parent=null,this.editor.graph.setParent(this._currentObject.id,this.editor.graph.root)):(this._currentObject.parent=this._currentObject.getScene().getMeshByID(m.parentId),this.editor.graph.setParent(this._currentObject.id,m.parentId)),this._currentObject instanceof babylonjs_1.AbstractMesh&&void 0===m.rotationQuaternion&&(this._currentObject.rotationQuaternion=null),setTimeout(function(){babylonjs_1.Tags.RemoveTagsFrom(_this.object,"modified"),_this.editor.graph.updateObjectMark(_this.object)},1),this.editor.inspector.updateDisplay()},NodeTool.prototype.createInstance=function(){var instance=this.object.createInstance("New instance "+babylonjs_1.Tools.RandomId());instance.id=babylonjs_1.Tools.RandomId(),babylonjs_1.Tags.AddTagsTo(instance,"added"),this.editor.graph.add({id:instance.id,img:this.editor.graph.getIcon(instance),text:instance.name,data:instance},this.editor.graph.root),this.editor.inspector.setObject(instance),this.editor.graph.select(instance.id)},NodeTool.prototype.playAnimations=function(){var scene=this.editor.core.scene;if(this.object.animations&&this.object.animations.length>0){var bounds=scene_manager_1.default.GetAnimationFrameBounds([this.object]);scene.stopAnimation(this.object),scene.beginAnimation(this.object,bounds.min,bounds.max,!1,1)}if(this.object instanceof babylonjs_1.Mesh&&this.object.skeleton){var bounds=scene_manager_1.default.GetAnimationFrameBounds(this.object.skeleton.bones);scene.stopAnimation(this.object.skeleton),scene.beginAnimation(this.object.skeleton,bounds.min,bounds.max,!1,1)}},NodeTool.prototype.addScriptsConfiguration=function(node){var _this=this,scripts=null,behaviorExtension=extensions_1.default.RequestExtension(this.editor.core.scene,"BehaviorExtension");if(behaviorExtension&&node.metadata&&node.metadata.behavior){node.metadata.behavior.metadatas.forEach(function(m){var code=_this.editor.core.scene.metadata.behaviorScripts.find(function(s){return s.id===m.codeId}),params=null;try{if(params=behaviorExtension.getConstructor(code,node,!0),!params.ctor)return}catch(e){return}scripts||(scripts=_this.tool.addFolder("Scripts"),scripts.open()),m.params=m.params||{};var script=scripts.addFolder(code.name);script.open();for(var p in params)if("ctor"!==p)switch(m.params[p]=void 0===m.params[p]?params[p]:m.params[p],typeof m.params[p]!=typeof params[p]&&(m.params[p]=params[p]),tools_1.default.GetConstructorName(params[p])){case"Number":case"String":script.add(m.params,p);break;case"Vector2":case"Vector3":case"Vector4":_this.tool.addVector(script,p,m.params[p]).open();break;case"Color3":case"Color4":_this.tool.addColor(script,p,m.params[p]).open();break;default:console.info("Not supported data type")}})}},NodeTool}(edition_tool_1.default);exports.default=NodeTool}),$__System.registerDynamic("2a",["c","27","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),LightTool=function(_super){function LightTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="LIGHT-TOOL",_this.tabName="Light",_this._generatesShadows=!1,_this._shadowMapSize="512",_this._darkness=0,_this._intensityMode="",_this}return __extends(LightTool,_super),LightTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Light},LightTool.prototype.update=function(light){var _this=this;_super.prototype.update.call(this,light),_super.prototype.setTabName.call(this,tools_1.default.GetConstructorName(light).replace("Light","")),light.metadata&&light.metadata.original&&this.tool.add(this,"resetToOriginal").name("Reset to original");var common=this.tool.addFolder("Common");common.open(),common.add(light,"intensity").min(0).step(.01).name("Intensity"),common.add(light,"range").min(0).step(.01).name("Range"),common.add(light,"radius").min(0).step(.01).name("Radius");var colors=this.tool.addFolder("Colors");colors.open(),this.tool.addColor(colors,"Diffuse",light.diffuse).open(),this.tool.addColor(colors,"Specular",light.specular).open();var mode=this.tool.addFolder("Mode");mode.open();for(var modes=["INTENSITYMODE_AUTOMATIC","INTENSITYMODE_LUMINOUSPOWER","INTENSITYMODE_LUMINOUSINTENSITY","INTENSITYMODE_ILLUMINANCE","INTENSITYMODE_LUMINANCE"],_i=0,modes_1=modes;_i<modes_1.length;_i++){var m=modes_1[_i];if(light.intensityMode===babylonjs_1.Light[m]){this._intensityMode=m;break}}if(mode.add(this,"_intensityMode",modes).name("Intensity").onChange(function(r){return light.intensityMode=babylonjs_1.Light[r]}),light instanceof babylonjs_1.SpotLight){var spot=this.tool.addFolder("Spot Light");spot.open(),spot.add(light,"angle").step(.01).name("Angle"),spot.add(light,"exponent").step(.01).name("Exponent")}if(light instanceof babylonjs_1.DirectionalLight||light instanceof babylonjs_1.PointLight||light instanceof babylonjs_1.SpotLight){var shadowGenerator_1=light.getShadowGenerator();this._generatesShadows=!!shadowGenerator_1;var shadows=this.tool.addFolder("Shadows");shadows.open(),shadows.add(this,"_generatesShadows").name("Generate Shadows").onFinishChange(function(r){if(r){var size=parseInt(_this._shadowMapSize),sg=new babylonjs_1.ShadowGenerator(size,light);babylonjs_1.Tags.AddTagsTo(sg,"added")}else light.getShadowGenerator().dispose();_this.editor.inspector.setObject(light)}),shadows.add(light,"shadowEnabled").name("Enable Shadows");for(var sizes=[],max=this.editor.core.engine.getCaps().maxTextureSize,current=8;current<max;)current<<=1,sizes.push(current.toString());shadows.add(this,"_shadowMapSize",sizes).name("Shadow Map Size").onFinishChange(function(r){return shadowGenerator_1&&shadowGenerator_1.getShadowMap().resize(parseInt(r))}),shadowGenerator_1&&(this._darkness=shadowGenerator_1.getDarkness(),shadows.add(this,"_darkness").min(0).max(1).step(.01).name("Darkness").onChange(function(r){return shadowGenerator_1.setDarkness(r)}),shadows.add(shadowGenerator_1,"bias").min(0).max(1).step(1e-7).name("Bias"),shadows.add(shadowGenerator_1,"blurBoxOffset").min(0).max(10).step(1).name("Blur Box Offset"),shadows.add(shadowGenerator_1,"blurScale").min(0).max(16).step(1).name("Blur Scale"),shadows.add(shadowGenerator_1,"useKernelBlur").name("Use Kernel Blur"),shadows.add(shadowGenerator_1,"blurKernel").min(0).max(512).step(1).name("Blur Kernel"),shadows.add(shadowGenerator_1,"usePoissonSampling").name("Use Poisson Sampling"),shadows.add(shadowGenerator_1,"useExponentialShadowMap").name("Use Exponential Shadow Map"),shadows.add(shadowGenerator_1,"useBlurExponentialShadowMap").name("Use Blur Exponential Shadow Map"),shadows.add(shadowGenerator_1,"useCloseExponentialShadowMap").name("Use Close Exponential Shadow Map"),shadows.add(shadowGenerator_1,"useBlurCloseExponentialShadowMap").name("Use Blur Close Exponential Shadow Map"))}},LightTool.prototype.resetToOriginal=function(){var _this=this;babylonjs_1.SerializationHelper.Parse(function(){return _this.object},this.object.metadata.original,this.object.getScene(),"file:"),setTimeout(function(){babylonjs_1.Tags.RemoveTagsFrom(_this.object,"modified"),_this.editor.graph.updateObjectMark(_this.object)},1),this.editor.inspector.updateDisplay()},LightTool}(edition_tool_1.default);exports.default=LightTool}),$__System.registerDynamic("2b",["c","27","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),PhysicsTool=function(_super){function PhysicsTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="PHYSICS-TOOL",_this.tabName="Physics",_this._currentImpostor="",_this._lastMass=null,_this._lastFriction=null,_this._lastRestitution=null,_this}return __extends(PhysicsTool,_super),PhysicsTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.AbstractMesh||object instanceof babylonjs_1.FreeCamera},PhysicsTool.prototype.update=function(node){var _this=this;_super.prototype.update.call(this,node);var collisions=this.tool.addFolder("Collisions");if(collisions.open(),collisions.add(node,"checkCollisions").name("Check Collisions"),collisions.add(node,"collisionMask").step(.01).name("Collision Mask"),node instanceof babylonjs_1.AbstractMesh?collisions.add(node,"useOctreeForCollisions").name("Use Octree For Collisions"):this.tool.addVector(collisions,"Ellipsoid",node.ellipsoid).open(),node instanceof babylonjs_1.AbstractMesh&&node.getScene().isPhysicsEnabled()){var physics=this.tool.addFolder("Physics");physics.open();var impostors=["NoImpostor","SphereImpostor","BoxImpostor","PlaneImpostor","MeshImpostor","CylinderImpostor","HeightmapImpostor"],impostor=node.getPhysicsImpostor();if(impostor){this._currentImpostor="NoImpostor";for(var i in babylonjs_1.PhysicsImpostor)if(-1!==i.indexOf("Impostor")&&babylonjs_1.PhysicsImpostor[i]===impostor.type){this._currentImpostor=i;break}}else this._currentImpostor="NoImpostor";physics.add(this,"_currentImpostor",impostors).name("Impostor").onFinishChange(function(r){"NoImpostor"===r?(_this._lastMass=null,_this._lastFriction=null,_this._lastRestitution=null):node.physicsImpostor&&(_this._lastMass=node.physicsImpostor.mass,_this._lastFriction=node.physicsImpostor.friction,_this._lastRestitution=node.physicsImpostor.restitution),node.physicsImpostor&&node.physicsImpostor.dispose(),node.physicsImpostor=new babylonjs_1.PhysicsImpostor(node,babylonjs_1.PhysicsImpostor[r],{mass:0}),node.physicsImpostor.mass=_this._lastMass||node.physicsImpostor.mass,node.physicsImpostor.friction=_this._lastFriction||node.physicsImpostor.friction,node.physicsImpostor.restitution=_this._lastRestitution||node.physicsImpostor.restitution,_this.editor.core.scene.getPhysicsEngine().setTimeStep(tools_1.default.Epsilon),_this.update(node)}),impostor&&impostor.type!==babylonjs_1.PhysicsImpostor.NoImpostor&&(physics.add(impostor,"mass").step(.01).name("Mass"),physics.add(impostor,"friction").step(.01).name("Friction"),physics.add(impostor,"restitution").step(.01).name("Restitution"))}},PhysicsTool}(edition_tool_1.default);exports.default=PhysicsTool}),$__System.registerDynamic("2c",["c","27","2d"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),picker_1=$__require("2d"),RenderTargetTool=function(_super){function RenderTargetTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="RENDER-TARGET-TOOL",_this.tabName="Render Target",_this._renderTarget=null,_this}return __extends(RenderTargetTool,_super),RenderTargetTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Light&&!!object.getShadowGenerator()||object instanceof babylonjs_1.RenderTargetTexture||object instanceof babylonjs_1.ReflectionProbe},RenderTargetTool.prototype.update=function(node){_super.prototype.update.call(this,node),this._renderTarget=node instanceof babylonjs_1.Light?node.getShadowGenerator().getShadowMap():node instanceof babylonjs_1.ReflectionProbe?node.cubeTexture:node;var common=this.tool.addFolder("Common");common.open(),common.add(node instanceof babylonjs_1.ReflectionProbe?node:this._renderTarget,"name").name("Name"),common.add(this._renderTarget,"refreshRate").min(0).step(1).name("Refresh Rate");var renderList=this.tool.addFolder("Render List");if(renderList.open(),renderList.add(this._renderTarget,"renderParticles").name("Render Particles"),renderList.add(this._renderTarget,"renderSprites").name("Render Sprites"),renderList.add(this,"_setRenderList").name("Configure Render List..."),node instanceof babylonjs_1.ReflectionProbe){var reflectionProbe=this.tool.addFolder("Reflection Probe");reflectionProbe.open(),this.tool.addVector(reflectionProbe,"Position",node.position).open(),reflectionProbe.add(this,"_attachToMesh").name("Attach To Mesh...")}},RenderTargetTool.prototype._setRenderList=function(){var _this=this,picker=new picker_1.default("Render List");picker.addItems(this.object.getScene().meshes),picker.addSelected(this._renderTarget.renderList),picker.open(function(selected){var scene=_this._renderTarget.getScene();_this._renderTarget.renderList=[],selected.forEach(function(s){return _this._renderTarget.renderList.push(scene.getMeshByName(s.name))})})},RenderTargetTool.prototype._attachToMesh=function(){var _this=this,picker=new picker_1.default("Render List");picker.addItems(this.object.getScene().meshes),this.object._attachedMesh&&picker.addSelected([this.object._attachedMesh]),picker.open(function(selected){var scene=_this._renderTarget.getScene();_this.object.attachToMesh(scene.getMeshByName(selected[0].name))})},RenderTargetTool}(edition_tool_1.default);exports.default=RenderTargetTool}),$__System.registerDynamic("2e",["c","27","f","15","14"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),undo_redo_1=$__require("15"),dialog_1=$__require("14"),ParticleSystemTool=function(_super){function ParticleSystemTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="PARTICLE-SYSTEM-TOOL",_this.tabName="Particle System",_this._currentEmitter="",_this._currentBillboard="",_this._currentBlendMode="",_this._currentEmiterType="",_this._currentTexture="",_this._isFromScene=!0,_this}return __extends(ParticleSystemTool,_super),ParticleSystemTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.ParticleSystem},ParticleSystemTool.prototype.update=function(ps){var _this=this;_super.prototype.update.call(this,ps);var scene=this.editor.core.scene;this._isFromScene=null!==scene.getParticleSystemByID(ps.id);var presets=this.tool.addFolder("Presets");presets.open(),presets.add(this,"_saveSet").name("Save..."),presets.add(this,"_loadSet").name("Load...");var emitter=this.tool.addFolder("Emitter");if(emitter.open(),emitter.add(ps,"name").name("Name"),this._isFromScene)if(emitter.add(ps,"id").name("Id"),ps.emitter instanceof babylonjs_1.Vector3)this.tool.addVector(emitter,"Emitter",ps.emitter);else{this._currentEmitter=ps.emitter.name;var nodes=scene.meshes.map(function(m){return m.name});emitter.add(this,"_currentEmitter",nodes).name("Emitter").onFinishChange(function(r){var mesh=scene.getMeshByName(r);mesh&&(ps.emitter=mesh)})}else this.tool.addVector(emitter,"Emitter",ps.emitter);var emiterType=this.tool.addFolder("Emiter Type");emiterType.open(),this._currentEmiterType=this._getEmiterTypeString(ps);var emiterTypes=["Box","Sphere","Sphere Directed","Cone"];emiterType.add(this,"_currentEmiterType",emiterTypes).name("Emiter Type").onFinishChange(function(r){switch(r){case"Box":ps.createBoxEmitter(ps.direction1,ps.direction2,ps.minEmitBox,ps.maxEmitBox);break;case"Sphere":ps.createSphereEmitter(10);break;case"Sphere Directed":ps.createDirectedSphereEmitter(10,ps.direction1,ps.direction2);break;case"Cone":ps.createConeEmitter(10,0)}_this.update(ps)}),ps.particleEmitterType instanceof babylonjs_1.SphereParticleEmitter?emiterType.add(ps.particleEmitterType,"radius").step(.01).name("Radius"):ps.particleEmitterType instanceof babylonjs_1.ConeParticleEmitter&&(emiterType.add(ps.particleEmitterType,"radius").step(.01).name("Radius"),emiterType.add(ps.particleEmitterType,"angle").step(.01).name("Angle")),ps.particleEmitterType instanceof babylonjs_1.BoxParticleEmitter||emiterType.add(ps.particleEmitterType,"directionRandomizer").min(0).max(1).step(.001).name("Direction Randomizer");var texture=this.tool.addFolder("Texture");if(texture.open(),this._isFromScene)this.tool.addTexture(texture,this.editor,this.editor.core.scene,"particleTexture",ps,!1,!1).name("Particle Texture");else{var exts_1=["png","jpg","jpeg","bmp"],files=["None"].concat(Object.keys(babylonjs_1.FilesInputStore.FilesToLoad).filter(function(k){return-1!==exts_1.indexOf(tools_1.default.GetFileExtension(k))}));this._currentTexture=ps.particleTexture?files[files.indexOf(ps.particleTexture.name)]||"None":"None",texture.add(this,"_currentTexture",files).name("Particle Texture").onChange(function(r){if(babylonjs_1.FilesInputStore.FilesToLoad[r]){var texture=new babylonjs_1.Texture("file:"+r,ps.getScene());texture.name=texture.url=texture.name.replace("file:",""),ps.particleTexture=texture}})}var blendModes=["BLENDMODE_ONEONE","BLENDMODE_STANDARD"];this._currentBlendMode=blendModes[ps.blendMode]||"BLENDMODE_ONEONE",texture.add(this,"_currentBlendMode",blendModes).name("Blend Mode").onChange(function(r){return ps.blendMode=babylonjs_1.ParticleSystem[r]});var actions=this.tool.addFolder("Actions");actions.open(),actions.add(ps,"preventAutoStart").name("Prevent Auto Start"),actions.add(ps,"rebuild").name("Rebuild"),actions.add(ps,"start").name("Start"),actions.add(ps,"stop").name("Stop");var modes=["BILLBOARDMODE_ALL","BILLBOARDMODE_Y","BILLBOARDMODE_STRETCHED"];switch(this._currentBillboard="None",ps.billboardMode){case babylonjs_1.ParticleSystem.BILLBOARDMODE_ALL:this._currentBillboard="BILLBOARDMODE_ALL";break;case babylonjs_1.ParticleSystem.BILLBOARDMODE_Y:this._currentBillboard="BILLBOARDMODE_Y";break;case babylonjs_1.ParticleSystem.BILLBOARDMODE_STRETCHED:this._currentBillboard="BILLBOARDMODE_STRETCHED"}var billboard=this.tool.addFolder("Billboarding");billboard.open(),billboard.add(ps,"isBillboardBased").name("Is Billboard Based"),billboard.add(this,"_currentBillboard",modes).name("Billboard Type").onChange(function(r){var from=ps.billboardMode,to=babylonjs_1.ParticleSystem[r];undo_redo_1.default.Push({baseObject:ps,property:"billboardMode",from:from,to:to})});var emit=this.tool.addFolder("Emit");emit.open(),emit.add(ps,"emitRate").min(0).step(.01).name("Emit Rate"),emit.add(ps,"minEmitPower").min(0).step(.01).name("Min Emit Power"),emit.add(ps,"maxEmitPower").min(0).step(.01).name("Max Emit Power");var update=this.tool.addFolder("Update");update.open(),update.add(ps,"updateSpeed").min(0).step(.01).name("Update Speed"),update.add(ps,"startDelay").min(0).name("Start Delay (ms)"),update.add(ps,"targetStopDuration").min(0).name("Stop Duration (seconds)");var life=this.tool.addFolder("Life Time");life.open(),life.add(ps,"minLifeTime").min(0).step(.01).name("Min Life Time"),life.add(ps,"maxLifeTime").min(0).step(.01).name("Max Life Time");var size=this.tool.addFolder("Size");size.open(),size.add(ps,"minSize").min(0).step(.01).name("Min Size"),size.add(ps,"maxSize").min(0).step(.01).name("Max Size");var angular=this.tool.addFolder("Angular Speed");if(angular.open(),angular.add(ps,"minAngularSpeed").min(0).step(.01).name("Min Angular Speed"),angular.add(ps,"maxAngularSpeed").min(0).step(.01).name("Max Angular Speed"),ps.isAnimationSheetEnabled){var sprite=this.tool.addFolder("Sprite");sprite.open(),sprite.add(ps,"startSpriteCellID").min(0).step(1).name("Start Sprite Cell ID"),sprite.add(ps,"endSpriteCellID").min(0).step(1).name("End Sprite Cell ID"),sprite.add(ps,"spriteCellWidth").min(0).step(1).name("Sprite Cell Width"),sprite.add(ps,"spriteCellHeight").min(0).step(1).name("Sprite Cell Height"),sprite.add(ps,"spriteCellChangeSpeed").min(0).step(1).name("Sprite Cell Change Speed"),sprite.add(ps,"spriteRandomStartCell").name("Sprite Random Start Cell")}if(this.tool.addVector(this.tool.element,"Gravity",ps.gravity).open(),(ps.particleEmitterType instanceof babylonjs_1.BoxParticleEmitter||ps.particleEmitterType instanceof babylonjs_1.SphereDirectedParticleEmitter)&&(this.tool.addVector(this.tool.element,"Direction 1",ps.direction1).open(),this.tool.addVector(this.tool.element,"Direction 2",ps.direction2).open(),ps.particleEmitterType instanceof babylonjs_1.BoxParticleEmitter&&(this.tool.addVector(this.tool.element,"Min Emit Box",ps.minEmitBox).open(),this.tool.addVector(this.tool.element,"Max Emit Box",ps.maxEmitBox).open())),this.tool.addColor(this.tool.element,"Color 1",ps.color1).open(),this.tool.addColor(this.tool.element,"Color 2",ps.color2).open(),this.tool.addColor(this.tool.element,"Color Dead",ps.colorDead).open(),!this._isFromScene){var animations=this.tool.addFolder("Animations");animations.open(),ps.beginAnimationOnStart=ps.beginAnimationOnStart||!1,animations.add(ps,"beginAnimationOnStart").name("Begin Animations On Start"),ps.beginAnimationFrom=ps.beginAnimationFrom||0,animations.add(ps,"beginAnimationFrom").min(0).step(1).name("Begin Animation From"),ps.beginAnimationTo=ps.beginAnimationTo||60,animations.add(ps,"beginAnimationTo").min(0).step(1).name("Begin Animation To"),ps.beginAnimationLoop=ps.beginAnimationLoop||!1,animations.add(ps,"beginAnimationLoop").name("Begin Animation Loop")}},ParticleSystemTool.prototype._getEmiterTypeString=function(ps){return ps.particleEmitterType instanceof babylonjs_1.BoxParticleEmitter?"Box":ps.particleEmitterType instanceof babylonjs_1.SphereDirectedParticleEmitter?"Sphere Directed":ps.particleEmitterType instanceof babylonjs_1.SphereParticleEmitter?"Sphere":ps.particleEmitterType instanceof babylonjs_1.ConeParticleEmitter?"Cone":"None"},ParticleSystemTool.prototype._saveSet=function(){return __awaiter(this,void 0,void 0,function(){var set,serializationObject,embed,_i,_a,s,file_1,_b,json,file;return __generator(this,function(_c){switch(_c.label){case 0:return set=babylonjs_1.ParticleHelper.ExportSet([this.object]),serializationObject=set.serialize(),[4,dialog_1.default.Create("Embed textures?","Do you want to embed textures in the set?")];case 1:if("Yes"!==(embed=_c.sent()))return[3,5];_i=0,_a=serializationObject.systems,_c.label=2;case 2:return _i<_a.length?(s=_a[_i],(file_1=babylonjs_1.FilesInputStore.FilesToLoad[s.textureName.toLowerCase()])?(_b=s,[4,tools_1.default.ReadFileAsBase64(file_1)]):[3,4]):[3,5];case 3:_b.textureName=_c.sent(),_c.label=4;case 4:return _i++,[3,2];case 5:return json=JSON.stringify(serializationObject,null,"\t"),file=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(json),this.object.name+".json"),babylonjs_1.Tools.Download(file,file.name),[2]}})})},ParticleSystemTool.prototype._loadSet=function(){return __awaiter(this,void 0,void 0,function(){var files,content,_a,_b,savedEmitter,rootUrl;return __generator(this,function(_c){switch(_c.label){case 0:return[4,tools_1.default.OpenFileDialog()];case 1:return files=_c.sent(),_b=(_a=JSON).parse,[4,tools_1.default.ReadFileAsText(files[0])];case 2:return content=_b.apply(_a,[_c.sent()]),content.systems&&0!==content.systems.length?(savedEmitter=this.object.emitter,rootUrl=0===content.systems[0].textureName.indexOf("data:")?"":"file:",babylonjs_1.ParticleSystem._Parse(content.systems[0],this.object,this.object.getScene(),rootUrl),this.object.emitter=savedEmitter,[2]):[2]}})})},ParticleSystemTool}(edition_tool_1.default);exports.default=ParticleSystemTool}),$__System.registerDynamic("2f",["c","27","2d"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),picker_1=$__require("2d"),SoundTool=function(_super){function SoundTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="SOUND-TOOL",_this.tabName="Sound",_this._volume=0,_this._playbackRate=0,_this._rolloffFactor=0,_this._position=babylonjs_1.Vector3.Zero(),_this._time=0,_this}return __extends(SoundTool,_super),SoundTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Sound},SoundTool.prototype.update=function(sound){var _this=this;_super.prototype.update.call(this,sound),sound.metadata&&sound.metadata.original&&this.tool.add(this,"resetToOriginal").name("Reset to original");var common=this.tool.addFolder("Sound");common.open(),common.add(this,"_playSound").name("Play Sound"),common.add(this,"_pauseSound").name("Pause Sound"),common.add(this,"_stopSound").name("Stop Sound"),this._volume=sound.getVolume(),this._playbackRate=sound._playbackRate,this._rolloffFactor=sound.rolloffFactor,common.add(this,"_volume").min(0).max(1).step(.01).name("Volume").onChange(function(result){return sound.setVolume(result)}),common.add(this,"_playbackRate").min(0).max(1).step(.01).name("Playback Rate").onChange(function(result){return sound.setPlaybackRate(result)}),common.add(this,"_rolloffFactor").min(0).max(1).step(.01).name("Rolloff Factor").onChange(function(result){return sound.updateOptions({rolloffFactor:result})}),common.add(sound,"loop").name("Loop").onChange(function(result){return sound.updateOptions({loop:result})});var player=this.tool.addFolder("Player");player.open(),this._time=0;var buffer=this.object.getAudioBuffer();buffer&&player.add(this,"_time").min(0).max(buffer.duration).name("Time (seconds)").onChange(function(r){_this.object.stop(),_this.object.play(0,_this._time)});var spatial=this.tool.addFolder("Spatial");spatial.open(),sound.spatialSound&&(spatial.add(sound,"distanceModel",["linear","exponential","inverse"]).name("Distance Model").onFinishChange(function(result){return sound.updateOptions({distanceModel:result})}),spatial.add(sound,"maxDistance").min(0).name("Max Distance").onChange(function(result){return sound.updateOptions({maxDistance:result})}),this._position=sound._position,this.tool.addVector(spatial,"Position",this._position,function(){return sound.setPosition(_this._position)}).open()),spatial.add(this,"_attachToMesh").name("Attach to mesh...")},SoundTool.prototype.resetToOriginal=function(){var _this=this,m=this.object.metadata.original;if(this.object.loop=m.loop,this.object.setVolume(m.volume),this.object.rolloffFactor=m.rolloffFactor,this.object.setPlaybackRate(m.playbackRate),this.object.spatialSound=m.spatialSound,m.connectedMeshId){var mesh=this.editor.core.scene.getMeshByID(m.connectedMeshId);mesh&&(this.object.attachToMesh(mesh),this.object.setPosition(babylonjs_1.Vector3.FromArray(m.position)),this.editor.graph.setParent(this.object.id,mesh.id))}else this.object.detachFromMesh(),this.object.setPosition(babylonjs_1.Vector3.Zero()),this.editor.graph.setParent(this.object.id,this.editor.graph.root);setTimeout(function(){babylonjs_1.Tags.RemoveTagsFrom(_this.object,"modified"),_this.editor.graph.updateObjectMark(_this.object)},1),this.editor.inspector.updateDisplay(),this.update(this.object)},SoundTool.prototype._pauseSound=function(){this.object.pause()},SoundTool.prototype._playSound=function(){this.object.isPlaying||this.object.play()},SoundTool.prototype._stopSound=function(){this.object.stop()},SoundTool.prototype._attachToMesh=function(){var _this=this,picker=new picker_1.default("Select mesh to attach");picker.addItems(this.editor.core.scene.meshes),this.object._connectedMesh&&picker.addSelected([this.object._connectedMesh]),picker.open(function(items){if(0===items.length)_this.object.detachFromMesh(),_this.editor.graph.setParent(_this.object.id,_this.editor.graph.root);else{var mesh=_this.editor.core.scene.getMeshByName(items[0].name);mesh&&(_this.object.attachToMesh(mesh),_this.editor.graph.setParent(_this.object.id,mesh.id))}_this.update(_this.object)})},SoundTool}(edition_tool_1.default);exports.default=SoundTool}),$__System.registerDynamic("30",["c","27","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var BABYLON=$__require("c"),babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),AnimationTool=function(_super){function AnimationTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="ANIMATION-TOOL",_this.tabName="Animation",_this._easingFunction="",_this._easingMode="",_this}return __extends(AnimationTool,_super),AnimationTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Animation},AnimationTool.prototype.update=function(animation){var _this=this;_super.prototype.update.call(this,animation);var common=this.tool.addFolder("Common");common.open(),common.add(animation,"name").name("Name"),common.add(animation,"framePerSecond").step(.1).name("Frame Per Second");var blending=this.tool.addFolder("Blending");blending.open(),void 0!==animation.enableBlending&&(blending.add(animation,"enableBlending").name("Enable Blending"),blending.add(animation,"blendingSpeed").name("Blending Speed"));var easing=this.tool.addFolder("Easing");easing.open();var easingFunction=animation.getEasingFunction(),easingFunctions=["None","CircleEase","BackEase","BounceEase","CubicEase","ElasticEase","ExponentialEase","PowerEase","QuadraticEase","QuarticEase","QuinticEase","SineEase","BezierCurveEase"];if(this._easingFunction=easingFunction?tools_1.default.GetConstructorName(easingFunction):"None",easing.add(this,"_easingFunction",easingFunctions).name("Easing Function").onFinishChange(function(r){var easingFunction=new BABYLON[r];animation.setEasingFunction(easingFunction),_this.update(animation)}),easingFunction){var easingModes=["EASINGMODE_EASEIN","EASINGMODE_EASEOUT","EASINGMODE_EASEINOUT"];switch(this._easingMode=easingModes[easingFunction.getEasingMode()],easing.add(this,"_easingMode",easingModes).name("Easing Mode").onFinishChange(function(r){easingFunction.setEasingMode(babylonjs_1.EasingFunction[r])}),this._easingFunction){case"BackEase":easing.add(easingFunction,"amplitude").name("Amplitude");break;case"BounceEase":easing.add(easingFunction,"bounces").name("Bounces"),easing.add(easingFunction,"bounciness").name("Bounciness");break;case"ElasticEase":easing.add(easingFunction,"oscillations").name("Oscillations"),easing.add(easingFunction,"springiness").name("Springiness");break;case"ExponentialEase":easing.add(easingFunction,"exponent").name("Exponent");break;case"PowerEase":easing.add(easingFunction,"power").name("Power");break;case"BezierCurveEase":easing.add(easingFunction,"x1").name("x1"),easing.add(easingFunction,"y1").name("y1"),easing.add(easingFunction,"x2").name("x2"),easing.add(easingFunction,"y2").name("y2")}}},AnimationTool}(edition_tool_1.default);exports.default=AnimationTool}),$__System.registerDynamic("31",["c","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),SkeletonTool=function(_super){function SkeletonTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="SKELETON-TOOL",_this.tabName="Skeleton",_this._skeleton=null,_this}return __extends(SkeletonTool,_super),SkeletonTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Skeleton||object.skeleton&&object instanceof babylonjs_1.AbstractMesh},SkeletonTool.prototype.update=function(object){var _this=this;object instanceof babylonjs_1.Skeleton?this._skeleton=object:this._skeleton=object.skeleton,_super.prototype.update.call(this,this._skeleton),this._skeleton.metadata&&this._skeleton.metadata.original&&this.tool.add(this,"resetToOriginal").name("Reset to original");var common=this.tool.addFolder("Common");common.open(),common.add(this._skeleton,"name").name("Name").onFinishChange(function(r){return _this.editor.graph.renameNode(_this._skeleton.id,r)}),void 0!==this._skeleton.needInitialSkinMatrix&&common.add(this._skeleton,"needInitialSkinMatrix").name("Need Initial Skin Matrix"),this._skeleton.dimensionsAtRest&&this.tool.addVector(common,"Dimensions At Rest",this._skeleton.dimensionsAtRest).open()},SkeletonTool.prototype.resetToOriginal=function(){var _this=this,m=this._skeleton.metadata.original;this._skeleton.name=m.name,this._skeleton.needInitialSkinMatrix=m.needInitialSkinMatrix,m.dimensionsAtRest&&(this._skeleton.dimensionsAtRest=babylonjs_1.Vector3.FromArray(m.dimensionsAtRest)),setTimeout(function(){babylonjs_1.Tags.RemoveTagsFrom(_this.object,"modified"),_this.editor.graph.updateObjectMark(_this._skeleton)},1),this.editor.inspector.updateDisplay()},SkeletonTool}(edition_tool_1.default);exports.default=SkeletonTool}),$__System.registerDynamic("32",["c","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),material_tool_1=$__require("33"),StandardMaterialTool=function(_super){function StandardMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="STANDARD-MATERIAL-TOOL",_this.tabName="Standard Material",_this}return __extends(StandardMaterialTool,_super),StandardMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_1.StandardMaterial},StandardMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var diffuse=this.tool.addFolder("Diffuse");diffuse.open(),diffuse.add(this.object,"linkEmissiveWithDiffuse").name("Link Emissive With Diffuse"),diffuse.add(this.object,"useAlphaFromDiffuseTexture").name("Use Alpha From Diffuse Texture"),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture",this.object).name("Diffuse Texture"),this.tool.addColor(diffuse,"Color",this.object.diffuseColor).open();var bump=this.tool.addFolder("Bump");this.tool.addTexture(bump,this.editor,this.editor.core.scene,"bumpTexture",this.object).name("Bump Texture"),bump.add(this.object,"invertNormalMapX").name("Invert Normal Map X"),bump.add(this.object,"invertNormalMapY").name("Invert Normal Map Y"),bump.add(this.object,"useParallax").name("Use Parallax"),bump.add(this.object,"useParallaxOcclusion").name("Use Parallax Occlusion"),bump.add(this.object,"parallaxScaleBias").step(.001).name("Parallax Scale Bias");var specular=this.tool.addFolder("Specular");specular.open(),specular.add(this.object,"specularPower").step(.01).name("Specular Power"),specular.add(this.object,"useGlossinessFromSpecularMapAlpha").name("Use Glossiness From Specular Map Alpha"),specular.add(this.object,"useReflectionFresnelFromSpecular").name("Use Reflection Fresnel From Specular"),specular.add(this.object,"useSpecularOverAlpha").name("Use Specular Over Alpha"),this.tool.addTexture(specular,this.editor,this.editor.core.scene,"specularTexture",this.object).name("Specular Texture"),this.tool.addColor(specular,"Color",this.object.specularColor).open();var opacity=this.tool.addFolder("Opacity");this.tool.addTexture(opacity,this.editor,this.editor.core.scene,"opacityTexture",this.object).name("Opacity Texture");var emissive=this.tool.addFolder("Emissive");this.tool.addColor(emissive,"Emissive",this.object.emissiveColor).open(),emissive.add(this.object,"useEmissiveAsIllumination").name("Use Emissive As Illumination"),this.tool.addTexture(emissive,this.editor,this.editor.core.scene,"emissiveTexture",this.object).name("Emissive Texture");var ambient=this.tool.addFolder("Ambient");this.tool.addColor(ambient,"Ambient",this.object.ambientColor).open(),this.tool.addTexture(ambient,this.editor,this.editor.core.scene,"ambientTexture",this.object).name("Ambient Texture");var lightmap=this.tool.addFolder("Lightmap");lightmap.add(this.object,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),this.tool.addTexture(lightmap,this.editor,this.editor.core.scene,"lightmapTexture",this.object).name("Lightmap Texture");var reflection=this.tool.addFolder("Reflection");this.tool.addTexture(reflection,this.editor,this.editor.core.scene,"reflectionTexture",this.object,!0).name("Reflection Texture");var refraction=this.tool.addFolder("Refraction");refraction.add(this.object,"indexOfRefraction").name("Index of Refraction"),refraction.add(this.object,"invertRefractionY").name("Invert Y"),this.tool.addTexture(refraction,this.editor,this.editor.core.scene,"refractionTexture",this.object,!0).name("Refraction Texture"),_super.prototype.addOptions.call(this).add(this,"_convertToPbr").name("Convert to PBR...")},StandardMaterialTool.prototype._convertToPbr=function(){var _this=this,pbr=new babylonjs_1.PBRMaterial(this.object.name+"_pbr",this.object.getScene());pbr.albedoColor=this.object.diffuseColor,pbr.albedoTexture=this.object.diffuseTexture,pbr.useAlphaFromAlbedoTexture=this.object.useAlphaFromDiffuseTexture,pbr.bumpTexture=this.object.bumpTexture,pbr.parallaxScaleBias=this.object.parallaxScaleBias,pbr.useParallax=this.object.useParallax,pbr.useParallaxOcclusion=this.object.useParallaxOcclusion,pbr.reflectivityColor=this.object.specularColor,pbr.reflectivityTexture=this.object.specularTexture,pbr.reflectionTexture=this.object.reflectionTexture,pbr.emissiveColor=this.object.emissiveColor,pbr.emissiveTexture=this.object.emissiveTexture,pbr.ambientColor=this.object.ambientColor,pbr.ambientTexture=this.object.ambientTexture,babylonjs_1.Tags.AddTagsTo(pbr,"added"),this.object.getBindedMeshes().forEach(function(m){return m.material=pbr}),this.editor.core.scene.meshes.forEach(function(m){if(m.material&&m.material instanceof babylonjs_1.MultiMaterial){var multiMaterial=m.material;m.material.subMaterials.forEach(function(sm,index){sm===_this.object&&(multiMaterial.subMaterials[index]=pbr)})}}),this.editor.inspector.refresh()},StandardMaterialTool}(material_tool_1.default);exports.default=StandardMaterialTool}),$__System.registerDynamic("34",["c","33","15"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),material_tool_1=$__require("33"),undo_redo_1=$__require("15"),PBRMaterialTool=function(_super){function PBRMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="PBR-TOOL",_this.tabName="PBR Material",_this._metallic=0,_this._metallicEnabled=!1,_this._roughness=0,_this._roughnessEnabled=!1,_this}return __extends(PBRMaterialTool,_super),PBRMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_1.PBRMaterial},PBRMaterialTool.prototype.update=function(object){var _this=this;_super.prototype.update.call(this,object);var pbrOptions=this.tool.addFolder("PBR Options");pbrOptions.open(),pbrOptions.add(this.object,"forceIrradianceInFragment").name("Force Irradiance In Fragment"),pbrOptions.add(this.object,"forceNormalForward").name("Force Normal Forward"),pbrOptions.add(this.object,"enableSpecularAntiAliasing").name("Force Specular Anti-Aliasing"),pbrOptions.add(this.object,"usePhysicalLightFalloff").name("Use Physical Light Falloff"),pbrOptions.add(this.object,"directIntensity").min(0).step(.01).name("Direct Intensity");var albedo=this.tool.addFolder("Albedo");albedo.open(),this.tool.addTexture(albedo,this.editor,this.editor.core.scene,"albedoTexture",this.object).name("Albedo Texture"),this.tool.addColor(albedo,"Color",this.object.albedoColor).open();var bump=this.tool.addFolder("Bump");this.tool.addTexture(bump,this.editor,this.editor.core.scene,"bumpTexture",this.object).name("Bump Texture"),bump.add(this.object,"invertNormalMapX").name("Invert Normal Map X"),bump.add(this.object,"invertNormalMapY").name("Invert Normal Map Y"),bump.add(this.object,"useParallax").name("Use Parallax"),bump.add(this.object,"useParallaxOcclusion").name("Use Parallax Occlusion"),bump.add(this.object,"parallaxScaleBias").step(.001).name("Parallax Scale Bias");var reflectivity=this.tool.addFolder("Reflectivity");reflectivity.open(),this.tool.addTexture(reflectivity,this.editor,this.editor.core.scene,"reflectivityTexture",this.object).name("Reflectivity Texture"),this.tool.addColor(reflectivity,"Color",this.object.reflectivityColor).open();var reflection=this.tool.addFolder("Reflection");reflection.open(),this.tool.addTexture(reflection,this.editor,this.editor.core.scene,"reflectionTexture",this.object,!0,!1).name("Reflection Texture"),this.tool.addColor(reflection,"Color",this.object.reflectionColor).open(),reflection.add(this.object,"environmentIntensity").step(.01).name("Environment Intensity");var micro=this.tool.addFolder("Micro Surface");this.tool.addTexture(micro,this.editor,this.editor.core.scene,"microSurfaceTexture",this.object,!1).name("Micro Surface Texture"),micro.add(this.object,"microSurface").min(0).max(1).name("Micro Surface"),micro.add(this.object,"useAutoMicroSurfaceFromReflectivityMap").name("Use Auto Micro Surface From Reflectivity Map"),micro.add(this.object,"useMicroSurfaceFromReflectivityMapAlpha").name("Use Micro Surface From Reflectivity Map Alpha");var metallic=this.tool.addFolder("Metallic / Roughness");metallic.add(this.object,"useMetallnessFromMetallicTextureBlue").name("Metallness From Metallic Texture Blue"),metallic.add(this.object,"useRoughnessFromMetallicTextureAlpha").name("Use Roughness From Metallic Texture Alpha"),metallic.add(this.object,"useRoughnessFromMetallicTextureGreen").name("Use Roughness From Metallic Texture Green"),this.tool.addTexture(metallic,this.editor,this.editor.core.scene,"metallicTexture",this.object,!1,!1,function(t){return _this.update(_this.object)}).name("Metallic Texture");var metallicWorkflow=metallic.addFolder("Metallic Workflow");metallicWorkflow.open(),this._metallic=this.object.metallic||this._metallic,this._metallicEnabled=null!==this.object.metallic&&void 0!==this.object.metallic,metallicWorkflow.add(this,"_metallicEnabled").name("Metallic Enabled").onFinishChange(function(r,i){undo_redo_1.default.Push({undo:function(){_this.object.metallic=r?null:_this._metallic,_this._metallicEnabled=i},redo:function(){_this.object.metallic=r?_this._metallic:null,_this._metallicEnabled=r}})});var metallicValue=metallicWorkflow.add(this,"_metallic").min(0).step(.01).name("Metallic");metallicValue.onChange(function(r){return _this._metallicEnabled&&(_this.object.metallic=r)}),metallicValue.onFinishChange(function(r,i){return _this._metallicEnabled&&undo_redo_1.default.Push({object:_this.object,property:"metallic",from:i,to:r})});var roughnessWorkflow=metallic.addFolder("Roughness Workflow");roughnessWorkflow.open(),this._roughnessEnabled=null!==this.object.roughness&&void 0!==this.object.roughness,this._roughness=this.object.roughness||this._roughness,roughnessWorkflow.add(this,"_roughnessEnabled").name("Roughness Enabled").onFinishChange(function(r,i){undo_redo_1.default.Push({undo:function(){_this.object.roughness=r?null:_this._roughness,_this._roughnessEnabled=i},redo:function(){_this.object.roughness=r?_this._roughness:null,_this._roughnessEnabled=r}})});var roughnessValue=roughnessWorkflow.add(this,"_roughness").min(0).step(.01).name("Roughness");roughnessValue.onChange(function(r){return _this._roughnessEnabled&&(_this.object.roughness=r)}),roughnessValue.onFinishChange(function(r,i){return _this._roughnessEnabled&&undo_redo_1.default.Push({object:_this.object,property:"roughness",from:i,to:r})});var subSurface=this.tool.addFolder("Sub Surface");this.tool.addColor(subSurface,"Tint Color",this.object.subSurface.tintColor).open(),this.tool.addTexture(subSurface.addFolder("Thickness Texture"),this.editor,this.editor.core.scene,"thicknessTexture",this.object.subSurface,!1),subSurface.add(this.object.subSurface,"useMaskFromThicknessTexture").name("Use Mask From Thickness Texture");var subSurfaceRefraction=this.tool.addFolder("Sub Surface (Refraction)");subSurfaceRefraction.add(this.object.subSurface,"isRefractionEnabled").name("Refraction Enabled"),subSurfaceRefraction.add(this.object.subSurface,"refractionIntensity").name("Refraction Intensity"),subSurfaceRefraction.add(this.object.subSurface,"indexOfRefraction").name("Index Of Refraction"),subSurfaceRefraction.add(this.object.subSurface,"minimumThickness").name("Index Of Refraction"),subSurfaceRefraction.add(this.object.subSurface,"minimumThickness").name("Index Of Refraction");var subSurfaceTranslucency=this.tool.addFolder("Sub Surface (Translucency)");subSurfaceTranslucency.add(this.object.subSurface,"isTranslucencyEnabled").name("Translucency Enabled"),subSurfaceTranslucency.add(this.object.subSurface,"translucencyIntensity").name("Translucency Intensity");var clearCoat=this.tool.addFolder("Clear Coat");clearCoat.add(this.object.clearCoat,"isEnabled").name("Clear Coat Enabled"),clearCoat.add(this.object.clearCoat,"roughness").min(0).step(.01).name("Roughness"),clearCoat.add(this.object.clearCoat,"indiceOfRefraction").min(0).step(.01).name("Indice Of Refraction"),this.tool.addTexture(clearCoat.addFolder("Bump Texture"),this.editor,this.editor.core.scene,"bumpTexture",this.object.clearCoat,!1,!1),clearCoat.add(this.object.clearCoat,"isTintEnabled").name("Tint Enabled"),clearCoat.add(this.object.clearCoat,"tintColorAtDistance").min(0).step(.01).name("Tint Color At Distance"),clearCoat.add(this.object.clearCoat,"tintThickness").min(0).step(.01).name("Tint Thickness");var anisotropy=this.tool.addFolder("Anisotropy");anisotropy.add(this.object.anisotropy,"isEnabled").name("Anisotropy Enabled"),anisotropy.add(this.object.anisotropy,"intensity").min(0).step(.01).name("Intensity"),this.tool.addVector(anisotropy,"Direction",this.object.anisotropy.direction),this.tool.addTexture(anisotropy.addFolder("Texture"),this.editor,this.editor.core.scene,"texture",this.object.anisotropy,!1,!1);var sheen=this.tool.addFolder("Sheen");sheen.add(this.object.sheen,"isEnabled").name("Sheen Enabled"),sheen.add(this.object.sheen,"intensity").min(0).step(.01).name("Intensity"),this.tool.addColor(sheen,"Color",this.object.sheen.color),this.tool.addTexture(sheen.addFolder("Texture"),this.editor,this.editor.core.scene,"texture",this.object.sheen,!1,!1);var opacity=this.tool.addFolder("Opacity");opacity.add(this.object,"useRadianceOverAlpha").name("Use Radiance Over Alpha"),opacity.add(this.object,"useSpecularOverAlpha").name("Use Specular Over Alpha");var emissive=this.tool.addFolder("Emissive");this.tool.addColor(emissive,"Emissive",this.object.emissiveColor).open(),emissive.add(this.object,"emissiveIntensity").step(.01).name("Emissive Intensity"),this.tool.addTexture(emissive,this.editor,this.editor.core.scene,"emissiveTexture",this.object).name("Emissive Texture");var ambient=this.tool.addFolder("Ambient");this.tool.addColor(ambient,"Ambient",this.object.ambientColor).open(),this.tool.addTexture(ambient,this.editor,this.editor.core.scene,"ambientTexture",this.object).name("Ambient Texture"),ambient.add(this.object,"ambientTextureStrength").step(.01).name("Ambient Texture Strength");var lightmap=this.tool.addFolder("Lightmap");lightmap.add(this.object,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),this.tool.addTexture(lightmap,this.editor,this.editor.core.scene,"lightmapTexture",this.object).name("Lightmap Texture");var refraction=this.tool.addFolder("Refraction (backward compatibility)");refraction.add(this.object,"indexOfRefraction").step(.01).name("Index of Refraction"),refraction.add(this.object,"invertRefractionY").name("Invert Y"),refraction.add(this.object,"linkRefractionWithTransparency").name("Link Refraction With Transparency"),this.tool.addTexture(refraction,this.editor,this.editor.core.scene,"refractionTexture",this.object,!0).name("Refraction Texture"),_super.prototype.addOptions.call(this)},PBRMaterialTool}(material_tool_1.default);exports.default=PBRMaterialTool}),$__System.registerDynamic("35",["c","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),material_tool_1=$__require("33"),PBRMetallicRoughnessMaterialTool=function(_super){function PBRMetallicRoughnessMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="PBR-METALLIC-ROUGHNESS-MATERIAL-TOOL",_this.tabName="PBR Metallic Roughness",_this}return __extends(PBRMetallicRoughnessMaterialTool,_super),PBRMetallicRoughnessMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_1.PBRMetallicRoughnessMaterial},PBRMetallicRoughnessMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var baseColor=this.tool.addFolder("Base");baseColor.open(),this.tool.addColor(baseColor,"Base Color",this.object.baseColor).open(),this.tool.addTexture(baseColor,this.editor,this.editor.core.scene,"baseTexture",this.object,!1).name("Texture");var normal=this.tool.addFolder("Normal");normal.open(),this.tool.addTexture(normal,this.editor,this.editor.core.scene,"normalTexture",this.object).name("Normal Texture"),normal.add(this.object,"invertNormalMapX").name("Invert Normal Map X"),normal.add(this.object,"invertNormalMapY").name("Invert Normal Map Y");var reflection=this.tool.addFolder("Reflection");reflection.open(),this.tool.addTexture(reflection,this.editor,this.editor.core.scene,"environmentTexture",this.object,!0,!1).name("Environment Texture");var metallic=this.tool.addFolder("Metallic Roughness");metallic.open(),metallic.add(this.object,"roughness").step(.01).name("Roughness"),metallic.add(this.object,"metallic").step(.01).name("Metallic"),this.tool.addTexture(metallic,this.editor,this.editor.core.scene,"metallicRoughnessTexture",this.object).name("Metallic Roughness Texture");var emissive=this.tool.addFolder("Emissive");emissive.open(),this.tool.addColor(emissive,"Color",this.object.emissiveColor).open(),this.tool.addTexture(emissive,this.editor,this.editor.core.scene,"emissiveTexture",this.object).name("Emissive Texture");var lightmap=this.tool.addFolder("Lightmap");lightmap.open(),lightmap.add(this.object,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),this.tool.addTexture(lightmap,this.editor,this.editor.core.scene,"lightmapTexture",this.object).name("Lightmap Texture");var occlusion=this.tool.addFolder("Occlusion");occlusion.open(),occlusion.add(this.object,"occlusionStrength").name("Occlusion Strength"),this.tool.addTexture(occlusion,this.editor,this.editor.core.scene,"occlusionTexture",this.object).name("Occlusion Texture"),_super.prototype.addOptions.call(this)},PBRMetallicRoughnessMaterialTool}(material_tool_1.default);exports.default=PBRMetallicRoughnessMaterialTool}),$__System.registerDynamic("36",["c","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),material_tool_1=$__require("33"),PBRSpecularGlossinessMaterialTool=function(_super){function PBRSpecularGlossinessMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="PBR-SPECULAR-GLOSSINESS-MATERIAL-TOOL",_this.tabName="PBR Specular Glossiness",_this}return __extends(PBRSpecularGlossinessMaterialTool,_super),PBRSpecularGlossinessMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_1.PBRSpecularGlossinessMaterial},PBRSpecularGlossinessMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var diffuseColor=this.tool.addFolder("Diffuse");diffuseColor.open(),this.tool.addColor(diffuseColor,"Color",this.object.diffuseColor).open(),this.tool.addTexture(diffuseColor,this.editor,this.editor.core.scene,"diffuseTexture",this.object,!1).name("Texture");var normal=this.tool.addFolder("Normal");normal.open(),this.tool.addTexture(normal,this.editor,this.editor.core.scene,"normalTexture",this.object).name("Normal Texture"),normal.add(this.object,"invertNormalMapX").name("Invert Normal Map X"),normal.add(this.object,"invertNormalMapY").name("Invert Normal Map Y");var reflection=this.tool.addFolder("Reflection");reflection.open(),this.tool.addTexture(reflection,this.editor,this.editor.core.scene,"environmentTexture",this.object,!0,!1).name("Environment Texture");var glossiness=this.tool.addFolder("Glossiness");glossiness.open(),glossiness.add(this.object,"glossiness").step(.01).name("Glossiness"),this.tool.addTexture(glossiness,this.editor,this.editor.core.scene,"specularGlossinessTexture",this.object).name("Specular Glossiness Texture");var emissive=this.tool.addFolder("Emissive");emissive.open(),this.tool.addColor(emissive,"Color",this.object.emissiveColor).open(),this.tool.addTexture(emissive,this.editor,this.editor.core.scene,"emissiveTexture",this.object).name("Emissive Texture");var lightmap=this.tool.addFolder("Lightmap");lightmap.open(),lightmap.add(this.object,"useLightmapAsShadowmap").name("Use Lightmap As Shadowmap"),this.tool.addTexture(lightmap,this.editor,this.editor.core.scene,"lightmapTexture",this.object).name("Lightmap Texture");var occlusion=this.tool.addFolder("Occlusion");occlusion.open(),occlusion.add(this.object,"occlusionStrength").name("Occlusion Strength"),this.tool.addTexture(occlusion,this.editor,this.editor.core.scene,"occlusionTexture",this.object).name("Occlusion Texture"),_super.prototype.addOptions.call(this)},PBRSpecularGlossinessMaterialTool}(material_tool_1.default);exports.default=PBRSpecularGlossinessMaterialTool}),$__System.registerDynamic("37",["38","33","2d"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),picker_1=$__require("2d"),WaterMaterialTool=function(_super){function WaterMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="WATER-MATERIAL-TOOL",_this.tabName="Water Material",_this}return __extends(WaterMaterialTool,_super),WaterMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.WaterMaterial},WaterMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object),this.tool.addColor(this.tool.element,"Diffuse",this.object.diffuseColor);var specular=this.tool.addFolder("Specular");specular.open(),this.tool.addColor(specular,"Specular",this.object.specularColor).open(),specular.add(this.object,"specularPower").step(.1).name("Specular Power");var renderList=this.tool.addFolder("Reflection & Refraction");renderList.open(),renderList.add(this,"_setRenderList").name("Set Render List...");var bump=this.tool.addFolder("Bump");bump.open(),this.tool.addTexture(bump,this.editor,this.editor.core.scene,"bumpTexture",this.object,!1),bump.add(this.object,"bumpHeight").min(0).max(10).step(.001).name("Bump Height");var wind=this.tool.addFolder("Wind");wind.open(),wind.add(this.object,"windForce").min(0).step(.01).name("Wind Force"),this.tool.addVector(wind,"Wind Direction",this.object.windDirection).open();var waves=this.tool.addFolder("Waves");waves.open(),waves.add(this.object,"waveHeight").min(0).step(.01).name("Wave Height"),waves.add(this.object,"waveLength").min(0).step(.01).name("Wave Length"),waves.add(this.object,"waveSpeed").min(0).step(.01).name("Wave Speed");var colors=this.tool.addFolder("Colors");this.tool.addColor(colors,"Water Color 1",this.object.waterColor).open(),colors.add(this.object,"colorBlendFactor").min(0).max(1).step(.01).name("Blend Factor 1"),this.tool.addColor(colors,"Water Color 2",this.object.waterColor2).open(),colors.add(this.object,"colorBlendFactor2").min(0).max(1).step(.01).name("Blend Factor 2");var advanced=this.tool.addFolder("Advanced");advanced.open(),advanced.add(this.object,"bumpSuperimpose").name("Bump Super Impose"),advanced.add(this.object,"bumpAffectsReflection").name("Bump Affects Reflection"),advanced.add(this.object,"fresnelSeparate").name("Fresnel Separate"),_super.prototype.addOptions.call(this)},WaterMaterialTool.prototype._setRenderList=function(){var _this=this,picker=new picker_1.default("Reflection & Refraction");picker.addSelected(this.object.getRenderList().map(function(m){return{id:m.id}})),picker.addItems(this.editor.core.scene.meshes),picker.open(function(items){_this.object._reflectionRTT.renderList=[],_this.object._refractionRTT.renderList=[],items.forEach(function(i){var mesh=_this.editor.core.scene.getMeshByID(i.name);mesh&&_this.object.addToRenderList(mesh)})})},WaterMaterialTool}(material_tool_1.default);exports.default=WaterMaterialTool}),$__System.registerDynamic("39",["c","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),material_tool_1=$__require("33"),CustomMaterialTool=function(_super){function CustomMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="CUSTOM-MATERIAL-TOOL",_this.tabName="Custom Material",_this}return __extends(CustomMaterialTool,_super),CustomMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object.getClassName&&"CustomMaterial"===this.object.getClassName()},CustomMaterialTool.prototype.update=function(object){var _this=this;_super.prototype.update.call(this,object),this.setTabName("Custom Material");var config=this.object.config;this.tool.addColor(this.tool.element,"Base Color",this.object.baseColor).open();var floats=this.tool.addFolder("Floats");floats.open(),config.floats.forEach(function(f){void 0===_this.object.userConfig[f]&&(_this.object.userConfig[f]=1),floats.add(_this.object.userConfig,f).step(.01).name(f).onChange(function(){return _this.object.markAsDirty(babylonjs_1.Material.MiscDirtyFlag)})});var vectors=this.tool.addFolder("Vectors");vectors.open(),config.vectors2.forEach(function(v){_this.object.userConfig[v]&&_this.object.userConfig[v]instanceof babylonjs_1.Vector2||(_this.object.userConfig[v]=babylonjs_1.Vector2.Zero()),_this.tool.addVector(vectors,v,_this.object.userConfig[v],function(){return _this.object.markAsDirty(babylonjs_1.Material.MiscDirtyFlag)}).open()}),config.vectors3.forEach(function(v){_this.object.userConfig[v]&&_this.object.userConfig[v]instanceof babylonjs_1.Vector3||(_this.object.userConfig[v]=babylonjs_1.Vector3.Zero()),_this.tool.addVector(vectors,v,_this.object.userConfig[v],function(){return _this.object.markAsDirty(babylonjs_1.Material.MiscDirtyFlag)}).open()});var samplers=this.tool.addFolder("Samplers");samplers.open(),config.textures.forEach(function(t){_this.tool.addTexture(samplers,_this.editor,_this.editor.core.scene,t.name,_this.object.userConfig,!1,!1,function(){return _this.object.markAsDirty(babylonjs_1.Material.TextureDirtyFlag)}).name(t.name)}),_super.prototype.addOptions.call(this)},CustomMaterialTool}(material_tool_1.default);exports.default=CustomMaterialTool}),$__System.registerDynamic("3a",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),SkyMaterialTool=function(_super){function SkyMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="SKY-MATERIAL-TOOL",_this.tabName="Sky Material",_this}return __extends(SkyMaterialTool,_super),SkyMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.SkyMaterial},SkyMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object),this.tool.add(this.object,"inclination").step(.01).name("Inclination"),this.tool.add(this.object,"azimuth").step(.01).name("Azimuth"),this.tool.add(this.object,"luminance").step(.01).name("Luminance"),this.tool.add(this.object,"turbidity").step(.01).name("Turbidity"),this.tool.add(this.object,"mieCoefficient").step(1e-4).name("Mie Coefficient"),this.tool.add(this.object,"mieDirectionalG").step(.01).name("Mie Coefficient G"),this.tool.add(this.object,"rayleigh").step(.01).name("Reileigh Coefficient"),_super.prototype.addOptions.call(this)},SkyMaterialTool}(material_tool_1.default);exports.default=SkyMaterialTool}),$__System.registerDynamic("3b",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),FireMaterialTool=function(_super){function FireMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="FIRE-MATERIAL-TOOL",_this.tabName="Fire Material",_this}return __extends(FireMaterialTool,_super),FireMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.FireMaterial},FireMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var diffuse=this.tool.addFolder("Diffuse");diffuse.open(),this.tool.addColor(diffuse,"Color",this.object.diffuseColor).open(),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture",this.object,!1).name("Texture");var fire=this.tool.addFolder("Fire");fire.open(),fire.add(this.object,"speed").min(0).step(.01).name("Speed"),this.tool.addTexture(fire,this.editor,this.editor.core.scene,"distortionTexture",this.object,!1).name("Distortion"),this.tool.addTexture(fire,this.editor,this.editor.core.scene,"opacityTexture",this.object,!1).name("Opacity"),_super.prototype.addOptions.call(this)},FireMaterialTool}(material_tool_1.default);exports.default=FireMaterialTool}),$__System.registerDynamic("3c",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),CellMaterialTool=function(_super){function CellMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="CELL-MATERIAL-TOOL",_this.tabName="Cell Material",_this}return __extends(CellMaterialTool,_super),CellMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.CellMaterial},CellMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var diffuse=this.tool.addFolder("Diffuse");diffuse.open(),this.tool.addColor(diffuse,"Color",this.object.diffuseColor).open(),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture",this.object,!1).name("Texture");var cell=this.tool.addFolder("Fire");cell.open(),cell.add(this.object,"computeHighLevel").name("Compute High Level"),_super.prototype.addOptions.call(this)},CellMaterialTool}(material_tool_1.default);exports.default=CellMaterialTool}),$__System.registerDynamic("3d",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),CellMaterialTool=function(_super){function CellMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="GRID-MATERIAL-TOOL",_this.tabName="Grid Material",_this}return __extends(CellMaterialTool,_super),CellMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.GridMaterial},CellMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var grid=this.tool.addFolder("Fire");grid.open(),this.tool.addColor(grid,"Main Color",this.object.mainColor).open(),this.tool.addColor(grid,"Line Color",this.object.lineColor).open(),grid.add(this.object,"gridRatio").step(.1).name("Grid Ratio"),grid.add(this.object,"opacity").min(0).step(.01).name("Opacity"),grid.add(this.object,"majorUnitFrequency").name("Major Unit Frequency"),grid.add(this.object,"minorUnitVisibility").name("Minor Unit Visibility"),_super.prototype.addOptions.call(this)},CellMaterialTool}(material_tool_1.default);exports.default=CellMaterialTool}),$__System.registerDynamic("3e",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),TriPlanarMaterialTool=function(_super){function TriPlanarMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="TRI-PLANAR-MATERIAL-TOOL",_this.tabName="Tri Planar Material",_this}return __extends(TriPlanarMaterialTool,_super),TriPlanarMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.TriPlanarMaterial},TriPlanarMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var triplanar=this.tool.addFolder("Tri Planar");triplanar.open(),triplanar.add(this.object,"tileSize").min(0).step(.01).name("Tile Size");var diffuse=triplanar.addFolder("Diffuse");diffuse.open(),this.tool.addColor(diffuse,"Color",this.object.diffuseColor).open(),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTextureX",this.object,!1).name("Diffuse Texture X"),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTextureY",this.object,!1).name("Diffuse Texture Y"),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTextureZ",this.object,!1).name("Diffuse Texture Z"),triplanar.addFolder("Bump").open(),this.tool.addTexture(triplanar,this.editor,this.editor.core.scene,"normalTextureX",this.object,!1).name("Normal Texture X"),this.tool.addTexture(triplanar,this.editor,this.editor.core.scene,"normalTextureY",this.object,!1).name("Normal Texture Y"),this.tool.addTexture(triplanar,this.editor,this.editor.core.scene,"normalTextureZ",this.object,!1).name("Normal Texture Z");var specular=triplanar.addFolder("Specular");specular.open(),this.tool.addColor(specular,"Color",this.object.specularColor).open(),specular.add(this.object,"specularPower").min(0).step(.5).name("Specular Power"),_super.prototype.addOptions.call(this)},TriPlanarMaterialTool}(material_tool_1.default);exports.default=TriPlanarMaterialTool}),$__System.registerDynamic("3f",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),TerrainMaterialTool=function(_super){function TerrainMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="TERRAIN-MATERIAL-TOOL",_this.tabName="Terrain Material",_this}return __extends(TerrainMaterialTool,_super),TerrainMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.TerrainMaterial},TerrainMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var terrain=this.tool.addFolder("Terrain");terrain.open(),this.tool.addTexture(terrain,this.editor,this.editor.core.scene,"mixTexture",this.object,!1).name("Mix Texture");var diffuse=terrain.addFolder("Diffuse");diffuse.open(),this.tool.addColor(diffuse,"Color",this.object.diffuseColor).open(),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture1",this.object,!1).name("Diffuse Texture R"),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture2",this.object,!1).name("Diffuse Texture G"),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture3",this.object,!1).name("Diffuse Texture B");var bump=terrain.addFolder("Bump");bump.open(),this.tool.addTexture(bump,this.editor,this.editor.core.scene,"bumpTexture1",this.object,!1).name("Bump Texture R"),this.tool.addTexture(bump,this.editor,this.editor.core.scene,"bumpTexture2",this.object,!1).name("Bump Texture G"),this.tool.addTexture(bump,this.editor,this.editor.core.scene,"bumpTexture3",this.object,!1).name("Bump Texture B");var specular=terrain.addFolder("Specular");specular.open(),this.tool.addColor(specular,"Color",this.object.specularColor).open(),specular.add(this.object,"specularPower").min(0).step(.5).name("Specular Power"),_super.prototype.addOptions.call(this)},TerrainMaterialTool}(material_tool_1.default);exports.default=TerrainMaterialTool}),$__System.registerDynamic("40",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),LavaMaterialTool=function(_super){function LavaMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="LAVA-MATERIAL-TOOL",_this.tabName="Lava Material",_this}return __extends(LavaMaterialTool,_super),LavaMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.LavaMaterial},LavaMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var diffuse=this.tool.addFolder("Diffuse");diffuse.open(),this.tool.addColor(diffuse,"Color",this.object.diffuseColor).open(),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture",this.object,!1).name("Texture");var lava=this.tool.addFolder("Lava");lava.open(),this.tool.addTexture(lava,this.editor,this.editor.core.scene,"noiseTexture",this.object,!1).name("Noise"),lava.add(this.object,"movingSpeed").min(0).name("Moving Speed"),lava.add(this.object,"lowFrequencySpeed").min(0).name("Low Frequency Speed");var fog=this.tool.addFolder("Fog");fog.open(),this.tool.addColor(fog,"Fog Color",this.object.fogColor).open(),fog.add(this.object,"fogDensity").min(0).name("Fog Density"),_super.prototype.addOptions.call(this)},LavaMaterialTool}(material_tool_1.default);exports.default=LavaMaterialTool}),$__System.registerDynamic("41",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),FurMaterialTool=function(_super){function FurMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="FUR-MATERIAL-TOOL",_this.tabName="Fur Material",_this}return __extends(FurMaterialTool,_super),FurMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.FurMaterial},FurMaterialTool.prototype.update=function(object){var _this=this;_super.prototype.update.call(this,object);var diffuse=this.tool.addFolder("Diffuse");diffuse.open(),this.tool.addColor(diffuse,"Color",this.object.diffuseColor,function(){return _this.object.updateFur()}).open(),this.tool.addTexture(diffuse,this.editor,this.editor.core.scene,"diffuseTexture",this.object,!1,!1,function(){return _this.object.updateFur()}).name("Texture");var fur=this.tool.addFolder("Fur");fur.open(),this.tool.addColor(fur,"Fur Color",this.object.furColor,function(){return _this.object.updateFur()}).open(),fur.add(this.object,"furLength").min(0).step(.01).name("Fur Length").onChange(function(){return _this.object.updateFur()}),fur.add(this.object,"furAngle").min(0).step(.1).name("Fur Angle").onChange(function(){return _this.object.updateFur()});var highlevel=this.tool.addFolder("High Level Fur");highlevel.open(),highlevel.add(this.object,"highLevelFur").name("Compute High Level").onFinishChange(function(){return _this.object.updateFur()}),highlevel.add(this.object,"furDensity").min(0).step(.1).name("Fur Density").onChange(function(){return _this.object.updateFur()}),highlevel.add(this.object,"furSpacing").min(0).step(.01).name("Fur Spacing").onChange(function(){return _this.object.updateFur()}),highlevel.add(this.object,"furSpeed").min(1).max(1e3).step(.01).name("Fur Speed").onChange(function(){return _this.object.updateFur()}),this.tool.addVector(highlevel,"Gravity",this.object.furGravity,function(){return _this.object.updateFur()}).open(),_super.prototype.addOptions.call(this)},FurMaterialTool}(material_tool_1.default);exports.default=FurMaterialTool}),$__System.registerDynamic("33",["c","27","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),BABYLON=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),MaterialTool=function(_super){function MaterialTool(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(MaterialTool,_super),MaterialTool.prototype.isSupported=function(object){var supported=object instanceof babylonjs_1.Material||object instanceof babylonjs_1.AbstractMesh&&!!object.material||object instanceof babylonjs_1.SubMesh&&!!object.getMaterial();return supported&&(this.object=object instanceof babylonjs_1.Material?object:object instanceof babylonjs_1.AbstractMesh&&object.material?object.material:object instanceof babylonjs_1.SubMesh&&object.getMaterial()?object.getMaterial():null),supported},MaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object),object instanceof babylonjs_1.Material?this.object=object:this.object=object instanceof babylonjs_1.SubMesh?object.getMaterial():object.material,_super.prototype.setTabName.call(this,tools_1.default.GetConstructorName(this.object).replace("Material","")+" Material"),this.object.metadata&&this.object.metadata.original&&this.tool.add(this,"resetToOriginal").name("Reset to original");var common=this.tool.addFolder("Common");common.open(),common.add(this.object,"name").name("Name"),common.add(this.object,"alpha").min(0).max(1).name("Alpha"),object instanceof babylonjs_1.AbstractMesh&&(common.add(object,"receiveShadows").name("Receive Shadows"),common.add(object,"applyFog").name("Apply Fog"))},MaterialTool.prototype.resetToOriginal=function(){var _this=this,ctor=tools_1.default.GetConstructorName(this.object);if(BABYLON[ctor]){var copy={};for(var key in this.object.metadata.original)copy[key]=this.object.metadata.original[key];var textures={};for(var key in copy){var value=copy[key];-1!==key.toLowerCase().indexOf("texture")&&"object"==typeof value&&(textures[key]=copy[key],delete copy[key])}babylonjs_1.SerializationHelper.Parse(function(){return _this.object},copy,this.object.getScene(),"file:");var _loop_1=function(key){var value=textures[key],original=tools_1.default.GetTextureByName(this_1.object.getScene(),value.name);this_1.object[key]=original?babylonjs_1.SerializationHelper.Parse(function(){return original},textures[key],this_1.object.getScene(),"file:"):babylonjs_1.Texture.Parse(textures[key],this_1.object.getScene(),"file:")},this_1=this;for(var key in textures)_loop_1(key);setTimeout(function(){return babylonjs_1.Tags.RemoveTagsFrom(_this.object,"modified")},1),this.editor.inspector.updateDisplay(),this.editor.inspector.setObject(this.object)}},MaterialTool.prototype.addOptions=function(){var options=this.tool.addFolder("Options");return options.open(),options.add(this.object,"wireframe").name("Wire Frame"),options.add(this.object,"fogEnabled").name("Fog Enabled"),options.add(this.object,"backFaceCulling").name("Back Face Culling"),options.add(this.object,"checkReadyOnEveryCall").name("Check Ready On Every Call"),options.add(this.object,"checkReadyOnlyOnce").name("Check Ready Only Once"),options.add(this.object,"disableDepthWrite").name("Disable Depth Write"),options.add(this.object,"needDepthPrePass").name("Need Depth Pre Pass"),this.object.useLogarithmicDepth=this.object.useLogarithmicDepth||!1,options.add(this.object,"useLogarithmicDepth").name("Use Logarithmic Depth"),options},MaterialTool}(edition_tool_1.default);exports.default=MaterialTool}),$__System.registerDynamic("42",["38","33"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_materials_1=$__require("38"),material_tool_1=$__require("33"),MixMaterialTool=function(_super){function MixMaterialTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="MIX-MATERIAL-TOOL",_this.tabName="Mix Material",_this}return __extends(MixMaterialTool,_super),MixMaterialTool.prototype.isSupported=function(object){return _super.prototype.isSupported.call(this,object)&&this.object instanceof babylonjs_materials_1.MixMaterial},MixMaterialTool.prototype.update=function(object){_super.prototype.update.call(this,object);var mixmap1=this.tool.addFolder("Mix Map 1");mixmap1.open(),this.tool.addTexture(mixmap1,this.editor,this.editor.core.scene,"mixTexture1",this.object,!1).name("Mix Texture 1"),this.tool.addTexture(mixmap1,this.editor,this.editor.core.scene,"diffuseTexture1",this.object,!1).name("Diffuse Texture 1"),this.tool.addTexture(mixmap1,this.editor,this.editor.core.scene,"diffuseTexture2",this.object,!1).name("Diffuse Texture 2"),this.tool.addTexture(mixmap1,this.editor,this.editor.core.scene,"diffuseTexture3",this.object,!1).name("Diffuse Texture 3"),this.tool.addTexture(mixmap1,this.editor,this.editor.core.scene,"diffuseTexture4",this.object,!1).name("Diffuse Texture 4");var mixmap2=this.tool.addFolder("Mix Map 2");mixmap2.open(),this.tool.addTexture(mixmap2,this.editor,this.editor.core.scene,"mixTexture2",this.object,!1).name("Mix Texture 2"),this.tool.addTexture(mixmap2,this.editor,this.editor.core.scene,"diffuseTexture5",this.object,!1).name("Diffuse Texture 5"),this.tool.addTexture(mixmap2,this.editor,this.editor.core.scene,"diffuseTexture6",this.object,!1).name("Diffuse Texture 6"),this.tool.addTexture(mixmap2,this.editor,this.editor.core.scene,"diffuseTexture7",this.object,!1).name("Diffuse Texture 7"),this.tool.addTexture(mixmap2,this.editor,this.editor.core.scene,"diffuseTexture8",this.object,!1).name("Diffuse Texture 8"),_super.prototype.addOptions.call(this)},MixMaterialTool}(material_tool_1.default);exports.default=MixMaterialTool}),$__System.registerDynamic("43",["c","27","f","1b","2d","29"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),tools_1=$__require("f"),scene_manager_1=$__require("1b"),picker_1=$__require("2d"),extensions_1=$__require("29"),PostProcessesTool=function(_super){function PostProcessesTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="POST-PROCESSES-TOOL",_this.tabName="Post-Processes",_this._standardEnabled=!1,_this._defaultEnabled=!1,_this._ssaoEnabled=!1,_this._ssao2Enabled=!1,_this}return __extends(PostProcessesTool,_super),PostProcessesTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.Scene},PostProcessesTool.prototype.update=function(scene){var _this=this;_super.prototype.update.call(this,scene);var standardPipeline=this.tool.addFolder("Standard");if(standardPipeline.open(),this._standardEnabled=null!==scene_manager_1.default.StandardRenderingPipeline,standardPipeline.add(this,"_standardEnabled").name("Enable").onChange(function(r){return __awaiter(_this,void 0,void 0,function(){var pipeline,lensflaredirt,_a,_b,_c,_d,lensstar,_e,_f,_g,lenscolor,_h,_j,_k;return __generator(this,function(_l){switch(_l.label){case 0:return r?[3,1]:(scene_manager_1.default.StandardRenderingPipeline.dispose(),scene_manager_1.default.StandardRenderingPipeline=null,delete this.editor.core.scene.postProcessRenderPipelineManager._renderPipelines.Standard,[3,8]);case 1:return pipeline=new babylonjs_1.StandardRenderingPipeline("Standard",scene,1,null,scene.cameras),pipeline.depthOfFieldDistance=.05,[4,tools_1.default.GetFile("assets/textures/lensflaredirt.png")];case 2:return lensflaredirt=_l.sent(),_a=pipeline,_b=pipeline,_d=(_c=babylonjs_1.Texture).CreateFromBase64String,[4,tools_1.default.ReadFileAsBase64(lensflaredirt)];case 3:return _a.lensTexture=_b.lensFlareDirtTexture=_d.apply(_c,[_l.sent(),"lensflaredirt.png",scene]),[4,tools_1.default.GetFile("assets/textures/lensstar.png")];case 4:return lensstar=_l.sent(),_e=pipeline,_g=(_f=babylonjs_1.Texture).CreateFromBase64String,[4,tools_1.default.ReadFileAsBase64(lensstar)];case 5:return _e.lensStarTexture=_g.apply(_f,[_l.sent(),"lensstar.png",scene]),[4,tools_1.default.GetFile("assets/textures/lenscolor.png")];case 6:return lenscolor=_l.sent(),_h=pipeline,_k=(_j=babylonjs_1.Texture).CreateFromBase64String,[4,tools_1.default.ReadFileAsBase64(lenscolor)];case 7:_h.lensColorTexture=_k.apply(_j,[_l.sent(),"lenscolor.png",scene]),pipeline.lensTexture.url=pipeline.lensTexture.name=pipeline.lensTexture.url.replace("data:",""),pipeline.lensStarTexture.url=pipeline.lensStarTexture.name=pipeline.lensStarTexture.url.replace("data:",""),pipeline.lensColorTexture.url=pipeline.lensColorTexture.name=pipeline.lensColorTexture.url.replace("data:",""),scene_manager_1.default.StandardRenderingPipeline=pipeline,_l.label=8;case 8:return this.update(scene),this._checkExtension(),[2]}})})}),this._standardEnabled){standardPipeline.add(this,"_editStandardAnimations").name("Edit animations...");var antialiasing=standardPipeline.addFolder("Anti Aliasing");antialiasing.open(),antialiasing.add(scene_manager_1.default.StandardRenderingPipeline,"fxaaEnabled").name("Enable FXAA"),antialiasing.add(scene_manager_1.default.StandardRenderingPipeline,"samples").min(1).max(32).name("Multisample Anti-Aliasing");var bloom=standardPipeline.addFolder("Bloom");bloom.open(),bloom.add(scene_manager_1.default.StandardRenderingPipeline,"BloomEnabled").name("Bloom Enabled"),bloom.add(scene_manager_1.default.StandardRenderingPipeline,"exposure").min(0).max(10).step(.01).name("Exposure"),bloom.add(scene_manager_1.default.StandardRenderingPipeline,"brightThreshold").min(0).max(10).step(.01).name("Bright Threshold"),bloom.add(scene_manager_1.default.StandardRenderingPipeline,"blurWidth").min(0).max(512).step(.01).name("Blur Width"),bloom.add(scene_manager_1.default.StandardRenderingPipeline,"horizontalBlur").name("Horizontal Blur");var lensTexture=bloom.addFolder("Lens Dirt Texture");lensTexture.open(),this.tool.addTexture(lensTexture,this.editor,this.editor.core.scene,"lensTexture",scene_manager_1.default.StandardRenderingPipeline,!1,!1,function(texture){scene_manager_1.default.StandardRenderingPipeline.lensFlareDirtTexture=texture}).name("Texture");var motionBlur=standardPipeline.addFolder("Motion Blur");motionBlur.open(),motionBlur.add(scene_manager_1.default.StandardRenderingPipeline,"MotionBlurEnabled").name("Motion Blur Enabled"),motionBlur.add(scene_manager_1.default.StandardRenderingPipeline,"motionBlurSamples").min(1).max(64).step(1).name("Samples Count"),motionBlur.add(scene_manager_1.default.StandardRenderingPipeline,"motionStrength").min(0).step(.01).name("Strength");var lensFlare=standardPipeline.addFolder("Lens Flare");lensFlare.open(),lensFlare.add(scene_manager_1.default.StandardRenderingPipeline,"LensFlareEnabled").name("Lens Flare Enabled"),lensFlare.add(scene_manager_1.default.StandardRenderingPipeline,"lensFlareStrength").min(0).max(100).step(.01).name("Strength"),lensFlare.add(scene_manager_1.default.StandardRenderingPipeline,"lensFlareHaloWidth").min(0).max(2).step(.01).name("Halo Width"),lensFlare.add(scene_manager_1.default.StandardRenderingPipeline,"lensFlareGhostDispersal").min(0).max(10).step(.1).name("Ghost Dispersal"),lensFlare.add(scene_manager_1.default.StandardRenderingPipeline,"lensFlareDistortionStrength").min(0).max(500).step(.1).name("Distortion Strength");var dof=standardPipeline.addFolder("Depth-Of-Field");dof.open(),dof.add(scene_manager_1.default.StandardRenderingPipeline,"DepthOfFieldEnabled").name("Depth-Of-Field Enabled"),dof.add(scene_manager_1.default.StandardRenderingPipeline,"depthOfFieldDistance").min(0).max(1).step(.001).name("DOF Distance"),dof.add(scene_manager_1.default.StandardRenderingPipeline,"depthOfFieldBlurWidth").min(0).max(512).name("Blur Width");var hdr=standardPipeline.addFolder("HDR");hdr.open(),hdr.add(scene_manager_1.default.StandardRenderingPipeline,"HDREnabled").name("HDR Enabled"),hdr.add(scene_manager_1.default.StandardRenderingPipeline,"hdrMinimumLuminance").min(0).max(2).name("Minimum Luminance"),hdr.add(scene_manager_1.default.StandardRenderingPipeline,"hdrDecreaseRate").min(0).max(2).name("Decrease Rate"),hdr.add(scene_manager_1.default.StandardRenderingPipeline,"hdrIncreaseRate").min(0).max(2).name("Increase Rate"),hdr.add(scene_manager_1.default.StandardRenderingPipeline,"hdrAutoExposure").name("Auto Exposure");var vls=standardPipeline.addFolder("Volumetric Lights");vls.open(),vls.add(scene_manager_1.default.StandardRenderingPipeline,"VLSEnabled").name("Volumetric Lights Enabled").onChange(function(r){if(r){var lights=[];scene.lights.forEach(function(l){return(l instanceof babylonjs_1.SpotLight||l instanceof babylonjs_1.DirectionalLight)&&lights.push(l)});var picker=new picker_1.default("Select Light Emitter");picker.addItems(lights),scene_manager_1.default.StandardRenderingPipeline.sourceLight&&picker.addSelected([scene_manager_1.default.StandardRenderingPipeline.sourceLight]),picker.open(function(items){items.length>0&&(scene_manager_1.default.StandardRenderingPipeline.sourceLight=scene.getLightByName(items[0].name)),_this.update(scene)})}}),scene_manager_1.default.StandardRenderingPipeline.VLSEnabled&&(vls.add(scene_manager_1.default.StandardRenderingPipeline,"volumetricLightCoefficient").min(-2).max(2).step(.01).name("Scattering Coefficient"),vls.add(scene_manager_1.default.StandardRenderingPipeline,"volumetricLightPower").min(0).max(10).step(.01).name("Scattering Power"),vls.add(scene_manager_1.default.StandardRenderingPipeline,"volumetricLightBlurScale").min(0).max(64).step(1).name("Blur scale"),vls.add(scene_manager_1.default.StandardRenderingPipeline,"volumetricLightStepsCount").min(0).max(512).step(1).name("Steps count"))}var def=this.tool.addFolder("Default");if(def.open(),this._defaultEnabled=null!==scene_manager_1.default.DefaultRenderingPipeline,def.add(this,"_defaultEnabled").name("Enable").onChange(function(r){if(r){scene_manager_1.default.DefaultRenderingPipeline=new babylonjs_1.DefaultRenderingPipeline("Default",!0,scene,scene.cameras,!0);var curve=new babylonjs_1.ColorCurves;curve.globalHue=200,curve.globalDensity=80,curve.globalSaturation=80,curve.highlightsHue=20,curve.highlightsDensity=80,curve.highlightsSaturation=-80,curve.shadowsHue=2,curve.shadowsDensity=80,curve.shadowsSaturation=40,scene_manager_1.default.DefaultRenderingPipeline.imageProcessing.colorCurves=curve,scene_manager_1.default.DefaultRenderingPipeline.depthOfField.focalLength=150,scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration.direction.x=2*Math.PI,scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration.direction.y=2*Math.PI}else scene_manager_1.default.DefaultRenderingPipeline.dispose(),scene_manager_1.default.DefaultRenderingPipeline=null,delete _this.editor.core.scene.postProcessRenderPipelineManager._renderPipelines.Default;_this.update(scene),_this._checkExtension()}),this._defaultEnabled){var antialiasing=def.addFolder("Anti Aliasing");antialiasing.open(),antialiasing.add(scene_manager_1.default.DefaultRenderingPipeline,"samples").min(1).max(32).name("Multisample Anti-Aliasing"),antialiasing.add(scene_manager_1.default.DefaultRenderingPipeline,"fxaaEnabled").name("Fast Approximate Anti-Aliasing");var imageProcessing=def.addFolder("Image Processing");imageProcessing.open(),imageProcessing.add(scene_manager_1.default.DefaultRenderingPipeline.imageProcessing,"toneMappingEnabled").name("Tone Mapping"),imageProcessing.add(scene_manager_1.default.DefaultRenderingPipeline.imageProcessing,"contrast").min(0).max(4).name("Contrast"),imageProcessing.add(scene_manager_1.default.DefaultRenderingPipeline.imageProcessing,"exposure").min(0).max(10).name("Exposure");var bloom=def.addFolder("Bloom");bloom.open(),bloom.add(scene_manager_1.default.DefaultRenderingPipeline,"bloomEnabled").name("Enable Bloom"),bloom.add(scene_manager_1.default.DefaultRenderingPipeline,"bloomKernel").min(0).max(500).name("Kernel"),bloom.add(scene_manager_1.default.DefaultRenderingPipeline,"bloomWeight").min(0).max(10).name("Weight"),bloom.add(scene_manager_1.default.DefaultRenderingPipeline,"bloomThreshold").min(0).max(10).name("Threshold"),bloom.add(scene_manager_1.default.DefaultRenderingPipeline,"bloomScale").min(0).max(10).name("Scale");var chromatic=def.addFolder("Chromatic Aberration");chromatic.open(),chromatic.add(scene_manager_1.default.DefaultRenderingPipeline,"chromaticAberrationEnabled").name("Enable Chromatic Aberration"),chromatic.add(scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration,"aberrationAmount").min(-1e3).max(1e3).name("Amount"),chromatic.add(scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration,"radialIntensity").min(.1).max(15).step(.01).name("Radial Intensity"),chromatic.add(scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration.direction,"x").min(0).max(2*Math.PI).step(.01).name("Direction").onChange(function(r){scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration.direction.x=Math.sin(r),scene_manager_1.default.DefaultRenderingPipeline.chromaticAberration.direction.y=Math.cos(r)});var sharpen=def.addFolder("Sharpen");sharpen.open(),sharpen.add(scene_manager_1.default.DefaultRenderingPipeline,"sharpenEnabled").name("Enable Sharpen"),sharpen.add(scene_manager_1.default.DefaultRenderingPipeline.sharpen,"edgeAmount").min(0).max(4).step(.01).name("Edge Amount"),sharpen.add(scene_manager_1.default.DefaultRenderingPipeline.sharpen,"colorAmount").min(0).max(2).step(.01).name("Color Amount");var grain=def.addFolder("Grain");grain.open(),grain.add(scene_manager_1.default.DefaultRenderingPipeline,"grainEnabled").name("Enable Grain"),grain.add(scene_manager_1.default.DefaultRenderingPipeline.grain,"intensity").min(0).max(100).step(.1).name("Intensity"),grain.add(scene_manager_1.default.DefaultRenderingPipeline.grain,"animated").name("Animated")}var ssao=this.tool.addFolder("SSAO");ssao.open(),this._ssaoEnabled=null!==scene_manager_1.default.SSAORenderingPipeline,ssao.add(this,"_ssaoEnabled").name("Enable").onChange(function(r){return __awaiter(_this,void 0,void 0,function(){var pipeline;return __generator(this,function(_a){return r?(pipeline=new babylonjs_1.SSAORenderingPipeline("SSAO",scene,{ssaoRatio:.5,combineRatio:1},scene.cameras),pipeline.fallOff=1e-6,pipeline.area=1,pipeline.radius=4e-4,pipeline.totalStrength=2,pipeline.base=1.3,scene_manager_1.default.SSAORenderingPipeline=pipeline):(scene_manager_1.default.SSAORenderingPipeline.dispose(),scene_manager_1.default.SSAORenderingPipeline=null,delete this.editor.core.scene.postProcessRenderPipelineManager._renderPipelines.SSAO),this.update(scene),this._checkExtension(),[2]})})}),this._ssaoEnabled&&(ssao.add(scene_manager_1.default.SSAORenderingPipeline,"totalStrength").min(0).step(1e-4).name("Strength"),ssao.add(scene_manager_1.default.SSAORenderingPipeline,"radius").min(0).step(1e-4).name("Radius"),ssao.add(scene_manager_1.default.SSAORenderingPipeline,"area").min(0).step(1e-4).name("Area"),ssao.add(scene_manager_1.default.SSAORenderingPipeline,"fallOff").min(0).step(1e-4).name("Fall Off"),ssao.add(scene_manager_1.default.SSAORenderingPipeline,"base").min(0).step(1e-4).name("Base"));var ssao2=this.tool.addFolder("SSAO 2");ssao2.open(),this._ssao2Enabled=null!==scene_manager_1.default.SSAO2RenderingPipeline,ssao2.add(this,"_ssao2Enabled").name("Enable").onChange(function(r){if(r){var pipeline=new babylonjs_1.SSAO2RenderingPipeline("SSAO2",scene,{ssaoRatio:.5,blurRatio:.5},scene.cameras);pipeline.radius=3.5,pipeline.totalStrength=1.3,pipeline.expensiveBlur=!0,pipeline.samples=16,pipeline.maxZ=250,scene_manager_1.default.SSAO2RenderingPipeline=pipeline}else scene_manager_1.default.SSAO2RenderingPipeline.dispose(),scene_manager_1.default.SSAO2RenderingPipeline=null,delete _this.editor.core.scene.postProcessRenderPipelineManager._renderPipelines.SSAO2;_this.update(scene),_this._checkExtension()}),this._ssao2Enabled&&(ssao2.add(scene_manager_1.default.SSAO2RenderingPipeline,"totalStrength").min(0).step(1e-4).name("Strength"),ssao2.add(scene_manager_1.default.SSAO2RenderingPipeline,"radius").min(0).step(1e-4).name("Radius"),ssao2.add(scene_manager_1.default.SSAO2RenderingPipeline,"expensiveBlur").name("Expensive Blur"),ssao2.add(scene_manager_1.default.SSAO2RenderingPipeline,"maxZ").min(1).step(.01).name("Max Z"),ssao2.add(scene_manager_1.default.SSAO2RenderingPipeline,"samples").min(2).max(64).step(1).name("Samples"))},PostProcessesTool.prototype._checkExtension=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,tools_1.default.ImportScript("./build/src/extensions/post-process/post-processes.js")];case 1:return _a.sent(),scene_manager_1.default.PostProcessExtension=scene_manager_1.default.PostProcessExtension||extensions_1.default.RequestExtension(this.editor.core.scene,"PostProcess"),[2]}})})},PostProcessesTool.prototype._editStandardAnimations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.editor.addEditPanelPlugin("animation-editor",!1,"Animations Editor - Standard",scene_manager_1.default.StandardRenderingPipeline)];case 1:return _a.sent(),[2]}})})},PostProcessesTool}(edition_tool_1.default);exports.default=PostProcessesTool}),$__System.registerDynamic("44",["c","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),CustomPostProcessTool=function(_super){function CustomPostProcessTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="CUSTOM-POST-PROCESS-TOOL",_this.tabName="Custom Post-Process",_this}return __extends(CustomPostProcessTool,_super),CustomPostProcessTool.prototype.isSupported=function(object){return object.getClassName&&"PostProcessEditor"===object.getClassName()},CustomPostProcessTool.prototype.update=function(object){var _this=this;_super.prototype.update.call(this,object),this.setTabName("Custom Post-Process");var config=this.object.config,floats=this.tool.addFolder("Floats");floats.open(),config.floats.forEach(function(f){void 0===_this.object.userConfig[f]&&(_this.object.userConfig[f]=1),floats.add(_this.object.userConfig,f).step(.01).name(f)});var vectors=this.tool.addFolder("Vectors");vectors.open(),config.vectors2.forEach(function(v){_this.object.userConfig[v]&&_this.object.userConfig[v]instanceof babylonjs_1.Vector2||(_this.object.userConfig[v]=babylonjs_1.Vector2.Zero()),_this.tool.addVector(vectors,v,_this.object.userConfig[v]).open()}),config.vectors3.forEach(function(v){_this.object.userConfig[v]&&_this.object.userConfig[v]instanceof babylonjs_1.Vector3||(_this.object.userConfig[v]=babylonjs_1.Vector3.Zero()),_this.tool.addVector(vectors,v,_this.object.userConfig[v]).open()});var samplers=this.tool.addFolder("Samplers");samplers.open(),config.textures.forEach(function(t){_this.tool.addTexture(samplers,_this.editor,_this.editor.core.scene,t,_this.object.userConfig,!1,!1).name(t)})},CustomPostProcessTool}(edition_tool_1.default);exports.default=CustomPostProcessTool}),$__System.registerDynamic("45",["c","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),TextureTool=function(_super){function TextureTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="TEXTURE-TOOL",_this.tabName="Texture",_this._currentCoordinatesMode="",_this._textureSize="",_this}return __extends(TextureTool,_super),TextureTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.BaseTexture},TextureTool.prototype.update=function(texture){_super.prototype.update.call(this,texture),texture.metadata&&texture.metadata.original&&this.tool.add(this,"resetToOriginal").name("Reset to original");var common=this.tool.addFolder("Common");common.open(),texture instanceof babylonjs_1.ProceduralTexture&&common.add(texture,"name").name("Name"),common.add(texture,"invertZ").name("Invert Z"),common.add(texture,"hasAlpha").name("Has Alpha"),common.add(texture,"gammaSpace").name("Gamma Space"),common.add(texture,"getAlphaFromRGB").name("Get Alpha From RGB");var coordinates=["EXPLICIT_MODE","SPHERICAL_MODE","PLANAR_MODE","CUBIC_MODE","PROJECTION_MODE","SKYBOX_MODE","INVCUBIC_MODE","EQUIRECTANGULAR_MODE","FIXED_EQUIRECTANGULAR_MODE","FIXED_EQUIRECTANGULAR_MIRRORED_MODE"];if(this._currentCoordinatesMode=coordinates[texture.coordinatesMode],common.add(this,"_currentCoordinatesMode",coordinates).name("Coordinates Mode").onFinishChange(function(r){texture.coordinatesMode=babylonjs_1.Texture[r]}),texture instanceof babylonjs_1.Texture){var tex=this.tool.addFolder("Texture");tex.open(),tex.add(texture,"vScale").step(.01).name("V Scale"),tex.add(texture,"uScale").step(.01).name("U Scale")}else babylonjs_1.CubeTexture;if(texture instanceof babylonjs_1.MirrorTexture){var mirror=this.tool.addFolder("Mirror");mirror.open(),mirror.add(texture.mirrorPlane,"d").name("Distance"),this.tool.addVector(mirror,"Normal",texture.mirrorPlane.normal).open()}if(texture instanceof babylonjs_1.ProceduralTexture){var procedural=this.tool.addFolder("Procedural");procedural.open(),procedural.add(texture,"refreshRate").step(1).min(0).name("Refresh Rate")}if(texture.resize){var size=this.tool.addFolder("Size");size.open();for(var sizes=[],i=1;i<12;i++)sizes.push(Math.pow(2,i).toString());this._textureSize=texture._size.toString(),size.add(this,"_textureSize",sizes).name("Size").onFinishChange(function(r){texture.resize(parseInt(r),texture._generateMipMaps)})}},TextureTool.prototype.resetToOriginal=function(){var _this=this;babylonjs_1.SerializationHelper.Parse(function(){return _this.object},this.object.metadata.original,this.object.getScene(),"file:"),setTimeout(function(){return babylonjs_1.Tags.RemoveTagsFrom(_this.object,"modified")},1),this.editor.inspector.updateDisplay()},TextureTool}(edition_tool_1.default);exports.default=TextureTool}),$__System.registerDynamic("46",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),BrickProceduralTool=function(_super){function BrickProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="BRICK-PROCEDURAL-TOOL",_this.tabName="Brick",_this}return __extends(BrickProceduralTool,_super),BrickProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.BrickProceduralTexture},BrickProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var brick=this.tool.addFolder("Brick");brick.open(),brick.add(object,"numberOfBricksHeight").step(.01).name("Bricks Height"),brick.add(object,"numberOfBricksWidth").step(.01).name("Bricks Width"),this.tool.addColor(brick,"Joint Color",object.jointColor,function(){return object.updateShaderUniforms()}).open(),this.tool.addColor(brick,"Brick Color",object.brickColor,function(){return object.updateShaderUniforms()}).open()},BrickProceduralTool}(edition_tool_1.default);exports.default=BrickProceduralTool}),$__System.registerDynamic("48",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),CloudProceduralTool=function(_super){function CloudProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="CLOUD-PROCEDURAL-TOOL",_this.tabName="Cloud",_this}return __extends(CloudProceduralTool,_super),CloudProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.CloudProceduralTexture},CloudProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var cloud=this.tool.addFolder("Cloud");cloud.open(),this.tool.addColor(cloud,"Sky Color",object.skyColor,function(){return object.updateShaderUniforms()}).open(),this.tool.addColor(cloud,"Cloud Color",object.cloudColor,function(){return object.updateShaderUniforms()}).open()},CloudProceduralTool}(edition_tool_1.default);exports.default=CloudProceduralTool}),$__System.registerDynamic("49",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),FireProceduralTool=function(_super){function FireProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="FIRE-PROCEDURAL-TOOL",_this.tabName="Fire",_this}return __extends(FireProceduralTool,_super),FireProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.FireProceduralTexture},FireProceduralTool.prototype.update=function(object){var _this=this;_super.prototype.update.call(this,object);var fire=this.tool.addFolder("Fire");fire.open(),fire.add(object,"autoGenerateTime").name("Auto Generate Time"),fire.add(object,"alphaThreshold").min(0).max(1).name("Alpha Threshold"),this.tool.addVector(fire,"Speed",object.speed,function(){return object.updateShaderUniforms()}).open(),object.fireColors.forEach(function(c,index){_this.tool.addColor(fire,"Color "+index,c,function(){return object.updateShaderUniforms()}).open()})},FireProceduralTool}(edition_tool_1.default);exports.default=FireProceduralTool}),$__System.registerDynamic("4a",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),GrassProceduralTool=function(_super){function GrassProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="GRASS-PROCEDURAL-TOOL",_this.tabName="Grass",_this}return __extends(GrassProceduralTool,_super),GrassProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.GrassProceduralTexture},GrassProceduralTool.prototype.update=function(object){var _this=this;_super.prototype.update.call(this,object);var grass=this.tool.addFolder("Grass");grass.open(),object.grassColors.forEach(function(c,index){_this.tool.addColor(grass,"Grass Color "+index,c,function(){return object.updateShaderUniforms()}).open()}),this.tool.addColor(grass,"Ground Color",object.groundColor,function(){return object.updateShaderUniforms()}).open()},GrassProceduralTool}(edition_tool_1.default);exports.default=GrassProceduralTool}),$__System.registerDynamic("4b",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),MarbleProceduralTool=function(_super){function MarbleProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="MARBLE-PROCEDURAL-TOOL",_this.tabName="Marble",_this}return __extends(MarbleProceduralTool,_super),MarbleProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.MarbleProceduralTexture},MarbleProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var marble=this.tool.addFolder("Brick");marble.open(),marble.add(object,"numberOfTilesHeight").step(.01).name("Tiles Height"),marble.add(object,"numberOfTilesWidth").step(.01).name("Tiles Width"),marble.add(object,"amplitude").step(.01).name("Amplitude"),this.tool.addColor(marble,"Joint Color",object.jointColor,function(){return object.updateShaderUniforms()}).open()},MarbleProceduralTool}(edition_tool_1.default);exports.default=MarbleProceduralTool}),$__System.registerDynamic("4c",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),NormalProceduralTool=function(_super){function NormalProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="NORMAL-PROCEDURAL-TOOL",_this.tabName="Normal",_this}return __extends(NormalProceduralTool,_super),NormalProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.NormalMapProceduralTexture},NormalProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var normal=this.tool.addFolder("Normal");normal.open(),this.tool.addTexture(normal,this.editor,this.editor.core.scene,"baseTexture",object,!1,!1,function(){return object.updateShaderUniforms()})},NormalProceduralTool}(edition_tool_1.default);exports.default=NormalProceduralTool}),$__System.registerDynamic("4d",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),PerlinNoiseProceduralTool=function(_super){function PerlinNoiseProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="PERLIN-NOISE-PROCEDURAL-TOOL",_this.tabName="Perlin Noise",_this}return __extends(PerlinNoiseProceduralTool,_super),PerlinNoiseProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.PerlinNoiseProceduralTexture},PerlinNoiseProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var perlinNoise=this.tool.addFolder("Brick");perlinNoise.open(),perlinNoise.add(object,"timeScale").step(.01).name("Time Scale"),perlinNoise.add(object,"translationSpeed").step(.01).name("Translation Speed")},PerlinNoiseProceduralTool}(edition_tool_1.default);exports.default=PerlinNoiseProceduralTool}),$__System.registerDynamic("4e",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),RoadProceduralTool=function(_super){function RoadProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="ROAD-PROCEDURAL-TOOL",_this.tabName="Road",_this}return __extends(RoadProceduralTool,_super),RoadProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.RoadProceduralTexture},RoadProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var road=this.tool.addFolder("Road");road.open(),this.tool.addColor(road,"Road Color",object.roadColor,function(){return object.updateShaderUniforms()}).open()},RoadProceduralTool}(edition_tool_1.default);exports.default=RoadProceduralTool}),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("babylonjs")):$__System.registerDynamic("47",["c"],!1,function($__require,$__exports,$__module){return factory.call(this,$__require("c"))})}("undefined"!=typeof self?self:"undefined"!=typeof global&&global,function(__WEBPACK_EXTERNAL_MODULE_babylonjs_Misc_decorators__){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="./legacy/legacy.ts")}({"../../node_modules/tslib/tslib.es6.js":function(module,__webpack_exports__,__webpack_require__){"use strict";function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&(t[p[i]]=s[p[i]]);return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g}function __exportStar(m,exports){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}function __values(o){var m="function"==typeof Symbol&&o[Symbol.iterator],i=0;return m?m.call(o):{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}}}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i}function __asyncDelegator(o){function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i}function __asyncValues(o){function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){v=o[n](v),settle(resolve,reject,v.done,v.value)})}}function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i)}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"__extends",function(){return __extends}),__webpack_require__.d(__webpack_exports__,"__assign",function(){return __assign}),__webpack_require__.d(__webpack_exports__,"__rest",function(){return __rest}),__webpack_require__.d(__webpack_exports__,"__decorate",function(){return __decorate}),__webpack_require__.d(__webpack_exports__,"__param",function(){return __param}),__webpack_require__.d(__webpack_exports__,"__metadata",function(){return __metadata}),__webpack_require__.d(__webpack_exports__,"__awaiter",function(){return __awaiter}),__webpack_require__.d(__webpack_exports__,"__generator",function(){return __generator}),__webpack_require__.d(__webpack_exports__,"__exportStar",function(){return __exportStar}),__webpack_require__.d(__webpack_exports__,"__values",function(){return __values}),__webpack_require__.d(__webpack_exports__,"__read",function(){return __read}),__webpack_require__.d(__webpack_exports__,"__spread",function(){return __spread}),__webpack_require__.d(__webpack_exports__,"__await",function(){return __await}),__webpack_require__.d(__webpack_exports__,"__asyncGenerator",function(){return __asyncGenerator}),__webpack_require__.d(__webpack_exports__,"__asyncDelegator",function(){return __asyncDelegator}),__webpack_require__.d(__webpack_exports__,"__asyncValues",function(){return __asyncValues}),__webpack_require__.d(__webpack_exports__,"__makeTemplateObject",function(){return __makeTemplateObject}),__webpack_require__.d(__webpack_exports__,"__importStar",function(){return __importStar}),__webpack_require__.d(__webpack_exports__,"__importDefault",function(){return __importDefault});var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign.apply(this,arguments)}},"../../node_modules/webpack/buildin/global.js":function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},"./brick/brickProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"brickProceduralTexturePixelShader",function(){return brickProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="brickProceduralTexturePixelShader",shader="precision highp float;\nvarying vec2 vPosition;\nvarying vec2 vUV;\nuniform float numberOfBricksHeight;\nuniform float numberOfBricksWidth;\nuniform vec3 brickColor;\nuniform vec3 jointColor;\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat fbm(vec2 n) {\nfloat total=0.0,amplitude=1.0;\nfor (int i=0; i<4; i++) {\ntotal+=noise(n)*amplitude;\nn+=n;\namplitude*=0.5;\n}\nreturn total;\n}\nfloat roundF(float number){\nreturn sign(number)*floor(abs(number)+0.5);\n}\nvoid main(void)\n{\nfloat brickW=1.0/numberOfBricksWidth;\nfloat brickH=1.0/numberOfBricksHeight;\nfloat jointWPercentage=0.01;\nfloat jointHPercentage=0.05;\nvec3 color=brickColor;\nfloat yi=vUV.y/brickH;\nfloat nyi=roundF(yi);\nfloat xi=vUV.x/brickW;\nif (mod(floor(yi),2.0) == 0.0){\nxi=xi-0.5;\n}\nfloat nxi=roundF(xi);\nvec2 brickvUV=vec2((xi-floor(xi))/brickH,(yi-floor(yi))/brickW);\nif (yi<nyi+jointHPercentage && yi>nyi-jointHPercentage){\ncolor=mix(jointColor,vec3(0.37,0.25,0.25),(yi-nyi)/jointHPercentage+0.2);\n}\nelse if (xi<nxi+jointWPercentage && xi>nxi-jointWPercentage){\ncolor=mix(jointColor,vec3(0.44,0.44,0.44),(xi-nxi)/jointWPercentage+0.2);\n}\nelse {\nfloat brickColorSwitch=mod(floor(yi)+floor(xi),3.0);\nif (brickColorSwitch == 0.0)\ncolor=mix(color,vec3(0.33,0.33,0.33),0.3);\nelse if (brickColorSwitch == 2.0)\ncolor=mix(color,vec3(0.11,0.11,0.11),0.3);\n}\ngl_FragColor=vec4(color,1.0);\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var brickProceduralTexturePixelShader={name:name,shader:shader}},"./brick/brickProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"BrickProceduralTexture",function(){return BrickProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),BrickProceduralTexture=(__webpack_require__("./brick/brickProceduralTexture.fragment.ts"),function(_super){function BrickProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"brickProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._numberOfBricksHeight=15,_this._numberOfBricksWidth=5,_this._jointColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.72,.72,.72),_this._brickColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.77,.47,.4),_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(BrickProceduralTexture,_super),BrickProceduralTexture.prototype.updateShaderUniforms=function(){this.setFloat("numberOfBricksHeight",this._numberOfBricksHeight),this.setFloat("numberOfBricksWidth",this._numberOfBricksWidth),this.setColor3("brickColor",this._brickColor),this.setColor3("jointColor",this._jointColor)},Object.defineProperty(BrickProceduralTexture.prototype,"numberOfBricksHeight",{get:function(){return this._numberOfBricksHeight},set:function(value){this._numberOfBricksHeight=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(BrickProceduralTexture.prototype,"numberOfBricksWidth",{get:function(){return this._numberOfBricksWidth},set:function(value){this._numberOfBricksWidth=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(BrickProceduralTexture.prototype,"jointColor",{get:function(){return this._jointColor},set:function(value){this._jointColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(BrickProceduralTexture.prototype,"brickColor",{get:function(){return this._brickColor},set:function(value){this._brickColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),BrickProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.BrickProceduralTexture",serializationObject},BrickProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new BrickProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],BrickProceduralTexture.prototype,"numberOfBricksHeight",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],BrickProceduralTexture.prototype,"numberOfBricksWidth",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor3)()],BrickProceduralTexture.prototype,"jointColor",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor3)()],BrickProceduralTexture.prototype,"brickColor",null),BrickProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.BrickProceduralTexture"]=BrickProceduralTexture},"./brick/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _brickProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./brick/brickProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"BrickProceduralTexture",function(){return _brickProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.BrickProceduralTexture})},"./cloud/cloudProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"cloudProceduralTexturePixelShader",function(){return cloudProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="cloudProceduralTexturePixelShader",shader="precision highp float;\nvarying vec2 vUV;\nuniform vec4 skyColor;\nuniform vec4 cloudColor;\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat fbm(vec2 n) {\nfloat total=0.0,amplitude=1.0;\nfor (int i=0; i<4; i++) {\ntotal+=noise(n)*amplitude;\nn+=n;\namplitude*=0.5;\n}\nreturn total;\n}\nvoid main() {\nvec2 p=vUV*12.0;\nvec4 c=mix(skyColor,cloudColor,fbm(p));\ngl_FragColor=c;\n}\n";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var cloudProceduralTexturePixelShader={name:name,shader:shader}},"./cloud/cloudProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"CloudProceduralTexture",function(){return CloudProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),CloudProceduralTexture=(__webpack_require__("./cloud/cloudProceduralTexture.fragment.ts"),function(_super){function CloudProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"cloudProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._skyColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color4(.15,.68,1,1),_this._cloudColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color4(1,1,1,1),_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(CloudProceduralTexture,_super),CloudProceduralTexture.prototype.updateShaderUniforms=function(){this.setColor4("skyColor",this._skyColor),this.setColor4("cloudColor",this._cloudColor)},Object.defineProperty(CloudProceduralTexture.prototype,"skyColor",{get:function(){return this._skyColor},set:function(value){this._skyColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(CloudProceduralTexture.prototype,"cloudColor",{get:function(){return this._cloudColor},set:function(value){this._cloudColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),CloudProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.CloudProceduralTexture",serializationObject},CloudProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new CloudProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor4)()],CloudProceduralTexture.prototype,"skyColor",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor4)()],CloudProceduralTexture.prototype,"cloudColor",null),CloudProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.CloudProceduralTexture"]=CloudProceduralTexture},"./cloud/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _cloudProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./cloud/cloudProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"CloudProceduralTexture",function(){return _cloudProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.CloudProceduralTexture})},"./fire/fireProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"fireProceduralTexturePixelShader",function(){return fireProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="fireProceduralTexturePixelShader",shader="precision highp float;\nuniform float time;\nuniform vec3 c1;\nuniform vec3 c2;\nuniform vec3 c3;\nuniform vec3 c4;\nuniform vec3 c5;\nuniform vec3 c6;\nuniform vec2 speed;\nuniform float shift;\nuniform float alphaThreshold;\nvarying vec2 vUV;\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat fbm(vec2 n) {\nfloat total=0.0,amplitude=1.0;\nfor (int i=0; i<4; i++) {\ntotal+=noise(n)*amplitude;\nn+=n;\namplitude*=0.5;\n}\nreturn total;\n}\nvoid main() {\nvec2 p=vUV*8.0;\nfloat q=fbm(p-time*0.1);\nvec2 r=vec2(fbm(p+q+time*speed.x-p.x-p.y),fbm(p+q-time*speed.y));\nvec3 c=mix(c1,c2,fbm(p+r))+mix(c3,c4,r.x)-mix(c5,c6,r.y);\nvec3 color=c*cos(shift*vUV.y);\nfloat luminance=dot(color.rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(color,luminance*alphaThreshold+(1.0-alphaThreshold));\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var fireProceduralTexturePixelShader={name:name,shader:shader}},"./fire/fireProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"FireProceduralTexture",function(){return FireProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),FireProceduralTexture=(__webpack_require__("./fire/fireProceduralTexture.fragment.ts"),function(_super){function FireProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"fireProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._time=0,_this._speed=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Vector2(.5,.3),_this._autoGenerateTime=!0,_this._alphaThreshold=.5,_this._fireColors=FireProceduralTexture.RedFireColors,_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(FireProceduralTexture,_super),FireProceduralTexture.prototype.updateShaderUniforms=function(){this.setFloat("time",this._time),this.setVector2("speed",this._speed),this.setColor3("c1",this._fireColors[0]),this.setColor3("c2",this._fireColors[1]),this.setColor3("c3",this._fireColors[2]),this.setColor3("c4",this._fireColors[3]),this.setColor3("c5",this._fireColors[4]),this.setColor3("c6",this._fireColors[5]),this.setFloat("alphaThreshold",this._alphaThreshold)},FireProceduralTexture.prototype.render=function(useCameraPostProcess){var scene=this.getScene();this._autoGenerateTime&&scene&&(this._time+=.03*scene.getAnimationRatio(),this.updateShaderUniforms()),_super.prototype.render.call(this,useCameraPostProcess)},Object.defineProperty(FireProceduralTexture,"PurpleFireColors",{get:function(){return[new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.5,0,1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.9,0,1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.2,0,1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(1,.9,1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.1,.1,1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.9,.9,1)]},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture,"GreenFireColors",{get:function(){return[new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.5,1,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.5,1,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.3,.4,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.5,1,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.2,0,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.5,1,0)]},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture,"RedFireColors",{get:function(){return[new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.5,0,.1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.9,0,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.2,0,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(1,.9,0),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.1,.1,.1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.9,.9,.9)]},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture,"BlueFireColors",{get:function(){return[new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.1,0,.5),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(0,0,.5),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.1,0,.2),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(0,0,1),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.1,.2,.3),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(0,.2,.9)]},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture.prototype,"autoGenerateTime",{get:function(){return this._autoGenerateTime},set:function(value){this._autoGenerateTime=value},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture.prototype,"fireColors",{get:function(){return this._fireColors},set:function(value){this._fireColors=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture.prototype,"time",{get:function(){return this._time},set:function(value){this._time=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture.prototype,"speed",{get:function(){return this._speed},set:function(value){this._speed=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(FireProceduralTexture.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(value){this._alphaThreshold=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),FireProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));serializationObject.customType="BABYLON.FireProceduralTexture",serializationObject.fireColors=[];for(var i=0;i<this._fireColors.length;i++)serializationObject.fireColors.push(this._fireColors[i].asArray());return serializationObject},FireProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){for(var texture=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new FireProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl),colors=[],i=0;i<parsedTexture.fireColors.length;i++)colors.push(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3.FromArray(parsedTexture.fireColors[i]));return texture.fireColors=colors,texture},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],FireProceduralTexture.prototype,"autoGenerateTime",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],FireProceduralTexture.prototype,"time",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsVector2)()],FireProceduralTexture.prototype,"speed",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],FireProceduralTexture.prototype,"alphaThreshold",null),FireProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.FireProceduralTexture"]=FireProceduralTexture},"./fire/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _fireProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./fire/fireProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"FireProceduralTexture",function(){return _fireProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.FireProceduralTexture})},"./grass/grassProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"grassProceduralTexturePixelShader",function(){return grassProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="grassProceduralTexturePixelShader",shader="precision highp float;\nvarying vec2 vPosition;\nvarying vec2 vUV;\nuniform vec3 herb1Color;\nuniform vec3 herb2Color;\nuniform vec3 herb3Color;\nuniform vec3 groundColor;\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat fbm(vec2 n) {\nfloat total=0.0,amplitude=1.0;\nfor (int i=0; i<4; i++) {\ntotal+=noise(n)*amplitude;\nn+=n;\namplitude*=0.5;\n}\nreturn total;\n}\nvoid main(void) {\nvec3 color=mix(groundColor,herb1Color,rand(gl_FragCoord.xy*4.0));\ncolor=mix(color,herb2Color,rand(gl_FragCoord.xy*8.0));\ncolor=mix(color,herb3Color,rand(gl_FragCoord.xy));\ncolor=mix(color,herb1Color,fbm(gl_FragCoord.xy*16.0));\ngl_FragColor=vec4(color,1.0);\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var grassProceduralTexturePixelShader={name:name,shader:shader}},"./grass/grassProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"GrassProceduralTexture",function(){return GrassProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),GrassProceduralTexture=(__webpack_require__("./grass/grassProceduralTexture.fragment.ts"),function(_super){function GrassProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"grassProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._groundColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(1,1,1),_this._grassColors=[new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.29,.38,.02),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.36,.49,.09),new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.51,.6,.28)],_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(GrassProceduralTexture,_super),GrassProceduralTexture.prototype.updateShaderUniforms=function(){this.setColor3("herb1Color",this._grassColors[0]),this.setColor3("herb2Color",this._grassColors[1]),this.setColor3("herb3Color",this._grassColors[2]),this.setColor3("groundColor",this._groundColor)},Object.defineProperty(GrassProceduralTexture.prototype,"grassColors",{get:function(){return this._grassColors},set:function(value){this._grassColors=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(GrassProceduralTexture.prototype,"groundColor",{get:function(){return this._groundColor},set:function(value){this._groundColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),GrassProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));serializationObject.customType="BABYLON.GrassProceduralTexture",serializationObject.grassColors=[];for(var i=0;i<this._grassColors.length;i++)serializationObject.grassColors.push(this._grassColors[i].asArray());return serializationObject},GrassProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){for(var texture=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new GrassProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl),colors=[],i=0;i<parsedTexture.grassColors.length;i++)colors.push(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3.FromArray(parsedTexture.grassColors[i]));return texture.grassColors=colors,texture},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor3)()],GrassProceduralTexture.prototype,"groundColor",null),GrassProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.GrassProceduralTexture"]=GrassProceduralTexture},"./grass/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _grassProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./grass/grassProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"GrassProceduralTexture",function(){return _grassProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.GrassProceduralTexture})},"./index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _brick__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./brick/index.ts");__webpack_require__.d(__webpack_exports__,"BrickProceduralTexture",function(){return _brick__WEBPACK_IMPORTED_MODULE_0__.BrickProceduralTexture});var _cloud__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./cloud/index.ts");__webpack_require__.d(__webpack_exports__,"CloudProceduralTexture",function(){return _cloud__WEBPACK_IMPORTED_MODULE_1__.CloudProceduralTexture});var _fire__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./fire/index.ts");__webpack_require__.d(__webpack_exports__,"FireProceduralTexture",function(){return _fire__WEBPACK_IMPORTED_MODULE_2__.FireProceduralTexture});var _grass__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./grass/index.ts");__webpack_require__.d(__webpack_exports__,"GrassProceduralTexture",function(){return _grass__WEBPACK_IMPORTED_MODULE_3__.GrassProceduralTexture});var _marble__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./marble/index.ts");__webpack_require__.d(__webpack_exports__,"MarbleProceduralTexture",function(){return _marble__WEBPACK_IMPORTED_MODULE_4__.MarbleProceduralTexture});var _normalMap__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./normalMap/index.ts");__webpack_require__.d(__webpack_exports__,"NormalMapProceduralTexture",function(){return _normalMap__WEBPACK_IMPORTED_MODULE_5__.NormalMapProceduralTexture});var _perlinNoise__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./perlinNoise/index.ts");__webpack_require__.d(__webpack_exports__,"PerlinNoiseProceduralTexture",function(){return _perlinNoise__WEBPACK_IMPORTED_MODULE_6__.PerlinNoiseProceduralTexture});var _road__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./road/index.ts");__webpack_require__.d(__webpack_exports__,"RoadProceduralTexture",function(){return _road__WEBPACK_IMPORTED_MODULE_7__.RoadProceduralTexture});var _starfield__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./starfield/index.ts");__webpack_require__.d(__webpack_exports__,"StarfieldProceduralTexture",function(){return _starfield__WEBPACK_IMPORTED_MODULE_8__.StarfieldProceduralTexture});var _wood__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./wood/index.ts");__webpack_require__.d(__webpack_exports__,"WoodProceduralTexture",function(){return _wood__WEBPACK_IMPORTED_MODULE_9__.WoodProceduralTexture})},"./legacy/legacy.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(global){var _index__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./index.ts");__webpack_require__.d(__webpack_exports__,"BrickProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.BrickProceduralTexture}),__webpack_require__.d(__webpack_exports__,"CloudProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.CloudProceduralTexture}),__webpack_require__.d(__webpack_exports__,"FireProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.FireProceduralTexture}),__webpack_require__.d(__webpack_exports__,"GrassProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.GrassProceduralTexture}),__webpack_require__.d(__webpack_exports__,"MarbleProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.MarbleProceduralTexture}),__webpack_require__.d(__webpack_exports__,"NormalMapProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.NormalMapProceduralTexture}),__webpack_require__.d(__webpack_exports__,"PerlinNoiseProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.PerlinNoiseProceduralTexture}),__webpack_require__.d(__webpack_exports__,"RoadProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.RoadProceduralTexture}),__webpack_require__.d(__webpack_exports__,"StarfieldProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.StarfieldProceduralTexture}),__webpack_require__.d(__webpack_exports__,"WoodProceduralTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.WoodProceduralTexture});var globalObject=void 0!==global?global:"undefined"!=typeof window?window:void 0;if(void 0!==globalObject){globalObject.BABYLON=globalObject.BABYLON||{};for(var mat in _index__WEBPACK_IMPORTED_MODULE_0__)globalObject.BABYLON[mat]=_index__WEBPACK_IMPORTED_MODULE_0__[mat]}}.call(this,__webpack_require__("../../node_modules/webpack/buildin/global.js"))},"./marble/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _marbleProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./marble/marbleProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"MarbleProceduralTexture",function(){return _marbleProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.MarbleProceduralTexture})},"./marble/marbleProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"marbleProceduralTexturePixelShader",function(){return marbleProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="marbleProceduralTexturePixelShader",shader="precision highp float;\nvarying vec2 vPosition;\nvarying vec2 vUV;\nuniform float numberOfTilesHeight;\nuniform float numberOfTilesWidth;\nuniform float amplitude;\nuniform vec3 marbleColor;\nuniform vec3 jointColor;\nconst vec3 tileSize=vec3(1.1,1.0,1.1);\nconst vec3 tilePct=vec3(0.98,1.0,0.98);\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat turbulence(vec2 P)\n{\nfloat val=0.0;\nfloat freq=1.0;\nfor (int i=0; i<4; i++)\n{\nval+=abs(noise(P*freq)/freq);\nfreq*=2.07;\n}\nreturn val;\n}\nfloat roundF(float number){\nreturn sign(number)*floor(abs(number)+0.5);\n}\nvec3 marble_color(float x)\n{\nvec3 col;\nx=0.5*(x+1.);\nx=sqrt(x);\nx=sqrt(x);\nx=sqrt(x);\ncol=vec3(.2+.75*x);\ncol.b*=0.95;\nreturn col;\n}\nvoid main()\n{\nfloat brickW=1.0/numberOfTilesWidth;\nfloat brickH=1.0/numberOfTilesHeight;\nfloat jointWPercentage=0.01;\nfloat jointHPercentage=0.01;\nvec3 color=marbleColor;\nfloat yi=vUV.y/brickH;\nfloat nyi=roundF(yi);\nfloat xi=vUV.x/brickW;\nif (mod(floor(yi),2.0) == 0.0){\nxi=xi-0.5;\n}\nfloat nxi=roundF(xi);\nvec2 brickvUV=vec2((xi-floor(xi))/brickH,(yi-floor(yi))/brickW);\nif (yi<nyi+jointHPercentage && yi>nyi-jointHPercentage){\ncolor=mix(jointColor,vec3(0.37,0.25,0.25),(yi-nyi)/jointHPercentage+0.2);\n}\nelse if (xi<nxi+jointWPercentage && xi>nxi-jointWPercentage){\ncolor=mix(jointColor,vec3(0.44,0.44,0.44),(xi-nxi)/jointWPercentage+0.2);\n}\nelse {\nfloat t=6.28*brickvUV.x/(tileSize.x+noise(vec2(vUV)*6.0));\nt+=amplitude*turbulence(brickvUV.xy);\nt=sin(t);\ncolor=marble_color(t);\n}\ngl_FragColor=vec4(color,0.0);\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var marbleProceduralTexturePixelShader={name:name,shader:shader}},"./marble/marbleProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"MarbleProceduralTexture",function(){return MarbleProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),MarbleProceduralTexture=(__webpack_require__("./marble/marbleProceduralTexture.fragment.ts"),function(_super){function MarbleProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"marbleProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._numberOfTilesHeight=3,_this._numberOfTilesWidth=3,_this._amplitude=9,_this._jointColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.72,.72,.72),_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(MarbleProceduralTexture,_super),MarbleProceduralTexture.prototype.updateShaderUniforms=function(){this.setFloat("numberOfTilesHeight",this._numberOfTilesHeight),this.setFloat("numberOfTilesWidth",this._numberOfTilesWidth),this.setFloat("amplitude",this._amplitude),this.setColor3("jointColor",this._jointColor)},Object.defineProperty(MarbleProceduralTexture.prototype,"numberOfTilesHeight",{get:function(){return this._numberOfTilesHeight},set:function(value){this._numberOfTilesHeight=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(MarbleProceduralTexture.prototype,"amplitude",{get:function(){return this._amplitude},set:function(value){this._amplitude=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(MarbleProceduralTexture.prototype,"numberOfTilesWidth",{get:function(){return this._numberOfTilesWidth},set:function(value){this._numberOfTilesWidth=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(MarbleProceduralTexture.prototype,"jointColor",{get:function(){return this._jointColor},set:function(value){this._jointColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),MarbleProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.MarbleProceduralTexture",serializationObject},MarbleProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new MarbleProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],MarbleProceduralTexture.prototype,"numberOfTilesHeight",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],MarbleProceduralTexture.prototype,"amplitude",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],MarbleProceduralTexture.prototype,"numberOfTilesWidth",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],MarbleProceduralTexture.prototype,"jointColor",null),MarbleProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.MarbleProceduralTexture"]=MarbleProceduralTexture},"./normalMap/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _normalMapProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./normalMap/normalMapProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"NormalMapProceduralTexture",function(){return _normalMapProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.NormalMapProceduralTexture})},"./normalMap/normalMapProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"normalMapProceduralTexturePixelShader",function(){return normalMapProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="normalMapProceduralTexturePixelShader",shader="precision highp float;\n\nuniform sampler2D baseSampler;\nuniform float size;\n\nvarying vec2 vUV;\n\nconst vec3 LUMA_COEFFICIENT=vec3(0.2126,0.7152,0.0722);\nfloat lumaAtCoord(vec2 coord)\n{\nvec3 pixel=texture2D(baseSampler,coord).rgb;\nfloat luma=dot(pixel,LUMA_COEFFICIENT);\nreturn luma;\n}\nvoid main()\n{\nfloat lumaU0=lumaAtCoord(vUV+vec2(-1.0,0.0)/size);\nfloat lumaU1=lumaAtCoord(vUV+vec2( 1.0,0.0)/size);\nfloat lumaV0=lumaAtCoord(vUV+vec2( 0.0,-1.0)/size);\nfloat lumaV1=lumaAtCoord(vUV+vec2( 0.0,1.0)/size);\nvec2 slope=(vec2(lumaU0-lumaU1,lumaV0-lumaV1)+1.0)*0.5;\ngl_FragColor=vec4(slope,1.0,1.0);\n}\n";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var normalMapProceduralTexturePixelShader={name:name,shader:shader}},"./normalMap/normalMapProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"NormalMapProceduralTexture",function(){return NormalMapProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),NormalMapProceduralTexture=(__webpack_require__("./normalMap/normalMapProceduralTexture.fragment.ts"),function(_super){function NormalMapProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"normalMapProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(NormalMapProceduralTexture,_super),NormalMapProceduralTexture.prototype.updateShaderUniforms=function(){this.setTexture("baseSampler",this._baseTexture),this.setFloat("size",this.getRenderSize())},NormalMapProceduralTexture.prototype.render=function(useCameraPostProcess){_super.prototype.render.call(this,useCameraPostProcess)},NormalMapProceduralTexture.prototype.resize=function(size,generateMipMaps){_super.prototype.resize.call(this,size,generateMipMaps),this.updateShaderUniforms()},Object.defineProperty(NormalMapProceduralTexture.prototype,"baseTexture",{get:function(){return this._baseTexture},set:function(texture){this._baseTexture=texture,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),NormalMapProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.NormalMapProceduralTexture",serializationObject},NormalMapProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new NormalMapProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsTexture)()],NormalMapProceduralTexture.prototype,"baseTexture",null),NormalMapProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.NormalMapProceduralTexture"]=NormalMapProceduralTexture},"./perlinNoise/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _perlinNoiseProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./perlinNoise/perlinNoiseProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"PerlinNoiseProceduralTexture",function(){return _perlinNoiseProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.PerlinNoiseProceduralTexture})},"./perlinNoise/perlinNoiseProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"perlinNoiseProceduralTexturePixelShader",function(){return perlinNoiseProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="perlinNoiseProceduralTexturePixelShader",shader="\nprecision highp float;\n\nuniform float size;\nuniform float time;\nuniform float translationSpeed;\n\nvarying vec2 vUV;\n\nfloat r(float n)\n{\nreturn fract(cos(n*89.42)*343.42);\n}\nvec2 r(vec2 n)\n{\nreturn vec2(r(n.x*23.62-300.0+n.y*34.35),r(n.x*45.13+256.0+n.y*38.89));\n}\nfloat worley(vec2 n,float s)\n{\nfloat dis=1.0;\nfor(int x=-1; x<=1; x++)\n{\nfor(int y=-1; y<=1; y++)\n{\nvec2 p=floor(n/s)+vec2(x,y);\nfloat d=length(r(p)+vec2(x,y)-fract(n/s));\nif (dis>d)\ndis=d;\n}\n}\nreturn 1.0-dis;\n}\nvec3 hash33(vec3 p3)\n{\np3=fract(p3*vec3(0.1031,0.11369,0.13787));\np3+=dot(p3,p3.yxz+19.19);\nreturn -1.0+2.0*fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));\n}\nfloat perlinNoise(vec3 p)\n{\nvec3 pi=floor(p);\nvec3 pf=p-pi;\nvec3 w=pf*pf*(3.0-2.0*pf);\nreturn mix(\nmix(\nmix(\ndot(pf-vec3(0,0,0),hash33(pi+vec3(0,0,0))),\ndot(pf-vec3(1,0,0),hash33(pi+vec3(1,0,0))),\nw.x\n),\nmix(\ndot(pf-vec3(0,0,1),hash33(pi+vec3(0,0,1))),\ndot(pf-vec3(1,0,1),hash33(pi+vec3(1,0,1))),\nw.x\n),\nw.z\n),\nmix(\nmix(\ndot(pf-vec3(0,1,0),hash33(pi+vec3(0,1,0))),\ndot(pf-vec3(1,1,0),hash33(pi+vec3(1,1,0))),\nw.x\n),\nmix(\ndot(pf-vec3(0,1,1),hash33(pi+vec3(0,1,1))),\ndot(pf-vec3(1,1,1),hash33(pi+vec3(1,1,1))),\nw.x\n),\nw.z\n),\nw.y\n);\n}\n\nvoid main(void)\n{\nvec2 uv=gl_FragCoord.xy+translationSpeed;\nfloat dis=(\n1.0+perlinNoise(vec3(uv/vec2(size,size),time*0.05)*8.0))\n*(1.0+(worley(uv,32.0)+ 0.5*worley(2.0*uv,32.0)+0.25*worley(4.0*uv,32.0))\n);\ngl_FragColor=vec4(vec3(dis/4.0),1.0);\n}\n";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var perlinNoiseProceduralTexturePixelShader={name:name,shader:shader}},"./perlinNoise/perlinNoiseProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"PerlinNoiseProceduralTexture",function(){return PerlinNoiseProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),PerlinNoiseProceduralTexture=(__webpack_require__("./perlinNoise/perlinNoiseProceduralTexture.fragment.ts"),function(_super){function PerlinNoiseProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"perlinNoiseProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this.time=0,_this.timeScale=1,_this.translationSpeed=1,_this._currentTranslation=0,_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(PerlinNoiseProceduralTexture,_super),PerlinNoiseProceduralTexture.prototype.updateShaderUniforms=function(){this.setFloat("size",this.getRenderSize());var scene=this.getScene();if(scene){var deltaTime=scene.getEngine().getDeltaTime();this.time+=deltaTime,this.setFloat("time",this.time*this.timeScale/1e3),this._currentTranslation+=deltaTime*this.translationSpeed/1e3,this.setFloat("translationSpeed",this._currentTranslation)}},PerlinNoiseProceduralTexture.prototype.render=function(useCameraPostProcess){this.updateShaderUniforms(),_super.prototype.render.call(this,useCameraPostProcess)},PerlinNoiseProceduralTexture.prototype.resize=function(size,generateMipMaps){_super.prototype.resize.call(this,size,generateMipMaps)},PerlinNoiseProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.PerlinNoiseProceduralTexture",serializationObject},PerlinNoiseProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new PerlinNoiseProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],PerlinNoiseProceduralTexture.prototype,"time",void 0),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],PerlinNoiseProceduralTexture.prototype,"timeScale",void 0),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],PerlinNoiseProceduralTexture.prototype,"translationSpeed",void 0),PerlinNoiseProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.PerlinNoiseProceduralTexture"]=PerlinNoiseProceduralTexture},"./road/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _roadProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./road/roadProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"RoadProceduralTexture",function(){return _roadProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.RoadProceduralTexture})},"./road/roadProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"roadProceduralTexturePixelShader",function(){return roadProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="roadProceduralTexturePixelShader",shader="precision highp float;\nvarying vec2 vUV;\nuniform vec3 roadColor;\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat fbm(vec2 n) {\nfloat total=0.0,amplitude=1.0;\nfor (int i=0; i<4; i++) {\ntotal+=noise(n)*amplitude;\nn+=n;\namplitude*=0.5;\n}\nreturn total;\n}\nvoid main(void) {\nfloat ratioy=mod(gl_FragCoord.y*100.0 ,fbm(vUV*2.0));\nvec3 color=roadColor*ratioy;\ngl_FragColor=vec4(color,1.0);\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var roadProceduralTexturePixelShader={name:name,shader:shader}},"./road/roadProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"RoadProceduralTexture",function(){return RoadProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),RoadProceduralTexture=(__webpack_require__("./road/roadProceduralTexture.fragment.ts"),function(_super){function RoadProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"roadProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._roadColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.53,.53,.53),_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(RoadProceduralTexture,_super),RoadProceduralTexture.prototype.updateShaderUniforms=function(){this.setColor3("roadColor",this._roadColor)},Object.defineProperty(RoadProceduralTexture.prototype,"roadColor",{get:function(){return this._roadColor},set:function(value){this._roadColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),RoadProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.RoadProceduralTexture",serializationObject},RoadProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new RoadProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor3)()],RoadProceduralTexture.prototype,"roadColor",null),RoadProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.RoadProceduralTexture"]=RoadProceduralTexture},"./starfield/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _starfieldProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./starfield/starfieldProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"StarfieldProceduralTexture",function(){return _starfieldProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.StarfieldProceduralTexture})},"./starfield/starfieldProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"starfieldProceduralTexturePixelShader",function(){return starfieldProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="starfieldProceduralTexturePixelShader",shader="precision highp float;\n\n#define volsteps 20\n#define iterations 15\nvarying vec2 vPosition;\nvarying vec2 vUV;\nuniform float time;\nuniform float alpha;\nuniform float beta;\nuniform float zoom;\nuniform float formuparam;\nuniform float stepsize;\nuniform float tile;\nuniform float brightness;\nuniform float darkmatter;\nuniform float distfading;\nuniform float saturation;\nvoid main()\n{\nvec3 dir=vec3(vUV*zoom,1.);\nfloat localTime=time*0.0001;\n\nmat2 rot1=mat2(cos(alpha),sin(alpha),-sin(alpha),cos(alpha));\nmat2 rot2=mat2(cos(beta),sin(beta),-sin(beta),cos(beta));\ndir.xz*=rot1;\ndir.xy*=rot2;\nvec3 from=vec3(1.,.5,0.5);\nfrom+=vec3(-2.,localTime*2.,localTime);\nfrom.xz*=rot1;\nfrom.xy*=rot2;\n\nfloat s=0.1,fade=1.;\nvec3 v=vec3(0.);\nfor (int r=0; r<volsteps; r++) {\nvec3 p=from+s*dir*.5;\np=abs(vec3(tile)-mod(p,vec3(tile*2.)));\nfloat pa,a=pa=0.;\nfor (int i=0; i<iterations; i++) {\np=abs(p)/dot(p,p)-formuparam;\na+=abs(length(p)-pa);\npa=length(p);\n}\nfloat dm=max(0.,darkmatter-a*a*.001);\na*=a*a;\nif (r>6) fade*=1.-dm;\n\nv+=fade;\nv+=vec3(s,s*s,s*s*s*s)*a*brightness*fade;\nfade*=distfading;\ns+=stepsize;\n}\nv=mix(vec3(length(v)),v,saturation);\ngl_FragColor=vec4(v*.01,1.);\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var starfieldProceduralTexturePixelShader={name:name,shader:shader}},"./starfield/starfieldProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"StarfieldProceduralTexture",function(){return StarfieldProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),StarfieldProceduralTexture=(__webpack_require__("./starfield/starfieldProceduralTexture.fragment.ts"),function(_super){function StarfieldProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"starfieldProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._time=1,_this._alpha=.5,_this._beta=.8,_this._zoom=.8,_this._formuparam=.53,_this._stepsize=.1,_this._tile=.85,_this._brightness=.0015,_this._darkmatter=.4,_this._distfading=.73,_this._saturation=.85,_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(StarfieldProceduralTexture,_super),StarfieldProceduralTexture.prototype.updateShaderUniforms=function(){this.setFloat("time",this._time),this.setFloat("alpha",this._alpha),this.setFloat("beta",this._beta),this.setFloat("zoom",this._zoom),this.setFloat("formuparam",this._formuparam),this.setFloat("stepsize",this._stepsize),this.setFloat("tile",this._tile),this.setFloat("brightness",this._brightness),this.setFloat("darkmatter",this._darkmatter),this.setFloat("distfading",this._distfading),this.setFloat("saturation",this._saturation)},Object.defineProperty(StarfieldProceduralTexture.prototype,"time",{get:function(){return this._time},set:function(value){this._time=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"alpha",{get:function(){return this._alpha},set:function(value){this._alpha=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"beta",{get:function(){return this._beta},set:function(value){this._beta=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"formuparam",{get:function(){return this._formuparam},set:function(value){this._formuparam=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"stepsize",{get:function(){return this._stepsize},set:function(value){this._stepsize=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"zoom",{get:function(){return this._zoom},set:function(value){this._zoom=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"tile",{get:function(){return this._tile},set:function(value){this._tile=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"brightness",{get:function(){return this._brightness},set:function(value){this._brightness=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"darkmatter",{get:function(){return this._darkmatter},set:function(value){this._darkmatter=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"distfading",{get:function(){return this._distfading},set:function(value){this._distfading=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(StarfieldProceduralTexture.prototype,"saturation",{get:function(){return this._saturation},set:function(value){this._saturation=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),StarfieldProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.StarfieldProceduralTexture",serializationObject},StarfieldProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new StarfieldProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"time",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"alpha",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"beta",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"formuparam",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"stepsize",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"zoom",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"tile",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"brightness",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"darkmatter",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"distfading",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],StarfieldProceduralTexture.prototype,"saturation",null),StarfieldProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.StarfieldProceduralTexture"]=StarfieldProceduralTexture},"./wood/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _woodProceduralTexture__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./wood/woodProceduralTexture.ts");__webpack_require__.d(__webpack_exports__,"WoodProceduralTexture",function(){return _woodProceduralTexture__WEBPACK_IMPORTED_MODULE_0__.WoodProceduralTexture})},"./wood/woodProceduralTexture.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"woodProceduralTexturePixelShader",function(){return woodProceduralTexturePixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="woodProceduralTexturePixelShader",shader="precision highp float;\nvarying vec2 vPosition;\nvarying vec2 vUV;\nuniform float ampScale;\nuniform vec3 woodColor;\nfloat rand(vec2 n) {\nreturn fract(cos(dot(n,vec2(12.9898,4.1414)))*43758.5453);\n}\nfloat noise(vec2 n) {\nconst vec2 d=vec2(0.0,1.0);\nvec2 b=floor(n),f=smoothstep(vec2(0.0),vec2(1.0),fract(n));\nreturn mix(mix(rand(b),rand(b+d.yx),f.x),mix(rand(b+d.xy),rand(b+d.yy),f.x),f.y);\n}\nfloat fbm(vec2 n) {\nfloat total=0.0,amplitude=1.0;\nfor (int i=0; i<4; i++) {\ntotal+=noise(n)*amplitude;\nn+=n;\namplitude*=0.5;\n}\nreturn total;\n}\nvoid main(void) {\nfloat ratioy=mod(vUV.x*ampScale,2.0+fbm(vUV*0.8));\nvec3 wood=woodColor*ratioy;\ngl_FragColor=vec4(wood,1.0);\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var woodProceduralTexturePixelShader={name:name,shader:shader}},"./wood/woodProceduralTexture.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"WoodProceduralTexture",function(){return WoodProceduralTexture});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),WoodProceduralTexture=(__webpack_require__("./wood/woodProceduralTexture.fragment.ts"),function(_super){function WoodProceduralTexture(name,size,scene,fallbackTexture,generateMipMaps){var _this=_super.call(this,name,size,"woodProceduralTexture",scene,fallbackTexture,generateMipMaps)||this;return _this._ampScale=100,_this._woodColor=new babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Color3(.32,.17,.09),_this.updateShaderUniforms(),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(WoodProceduralTexture,_super),WoodProceduralTexture.prototype.updateShaderUniforms=function(){this.setFloat("ampScale",this._ampScale),this.setColor3("woodColor",this._woodColor)},Object.defineProperty(WoodProceduralTexture.prototype,"ampScale",{get:function(){return this._ampScale},set:function(value){this._ampScale=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(WoodProceduralTexture.prototype,"woodColor",{get:function(){return this._woodColor},set:function(value){this._woodColor=value,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),WoodProceduralTexture.prototype.serialize=function(){var serializationObject=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Serialize(this,_super.prototype.serialize.call(this));return serializationObject.customType="BABYLON.WoodProceduralTexture",serializationObject},WoodProceduralTexture.Parse=function(parsedTexture,scene,rootUrl){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new WoodProceduralTexture(parsedTexture.name,parsedTexture._size,scene,void 0,parsedTexture._generateMipMaps)},parsedTexture,scene,rootUrl)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)()],WoodProceduralTexture.prototype,"ampScale",null),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serializeAsColor3)()],WoodProceduralTexture.prototype,"woodColor",null),WoodProceduralTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.ProceduralTexture));babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__._TypeStore.RegisteredTypes["BABYLON.WoodProceduralTexture"]=WoodProceduralTexture},"babylonjs/Misc/decorators":function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_babylonjs_Misc_decorators__}})}),$__System.registerDynamic("4f",["47","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_procedural_textures_1=$__require("47"),edition_tool_1=$__require("27"),WoodProceduralTool=function(_super){function WoodProceduralTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="WOOD-PROCEDURAL-TOOL",_this.tabName="Wood",_this}return __extends(WoodProceduralTool,_super),WoodProceduralTool.prototype.isSupported=function(object){return object instanceof babylonjs_procedural_textures_1.WoodProceduralTexture},WoodProceduralTool.prototype.update=function(object){_super.prototype.update.call(this,object);var wood=this.tool.addFolder("Wood");wood.open(),wood.add(object,"ampScale").step(.01).name("Amp Scale"),this.tool.addColor(wood,"Wood Color",object.woodColor,function(){return object.updateShaderUniforms()}).open()},WoodProceduralTool}(edition_tool_1.default);exports.default=WoodProceduralTool}),$__System.registerDynamic("50",["c","27"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),edition_tool_1=$__require("27"),GroundTool=function(_super){function GroundTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="GROUND-TOOL",_this.tabName="Ground",_this._subdivisions=0,_this._heightMapOptions={},_this._minHeight=0,_this._maxHeight=1,_this}return __extends(GroundTool,_super),GroundTool.prototype.isSupported=function(object){return object instanceof babylonjs_1.GroundMesh},GroundTool.prototype.update=function(ground){var _this=this;_super.prototype.update.call(this,ground),this._subdivisions=this.object._subdivisionsX,this.tool.element.add(this.object,"_width").min(.1).step(.1).name("Width").onChange(function(){return _this._propertyChanged()}),this.tool.element.add(this.object,"_height").min(.1).step(.1).name("Height").onChange(function(){return _this._propertyChanged()}),this.tool.element.add(this,"_subdivisions").min(1).max(1e3).step(1).name("Subdivisions").onChange(function(){return _this._propertyChanged()}),this.tool.element.add(this,"_createFromHeightMap").name("Create From Height Map...");var heightMapOptions=this._heightMapOptions[this.object.id];if(heightMapOptions){var heightmap=this.tool.element.addFolder("Height Map");heightmap.open(),heightmap.add(heightMapOptions,"minHeight").step(.01).name("Min Height").onChange(function(){return _this._heightMapTexture=heightMapOptions.texture}),heightmap.add(heightMapOptions,"maxHeight").step(.01).name("Max Height").onChange(function(){return _this._heightMapTexture=heightMapOptions.texture}),this.tool.addColor(heightmap,"Color Filter",heightMapOptions.colorFilter,function(){return _this._heightMapTexture=heightMapOptions.texture}).open(),heightmap.add(this,"_removeHeightMap").name("Remove Height Map")}},GroundTool.prototype._propertyChanged=function(){var options=this._heightMapOptions[this.object.id];options?this._heightMapTexture=options.texture:this.object.geometry.setAllVerticesData(babylonjs_1.VertexData.CreateGround({width:this.object._width,height:this.object._height,subdivisions:this._subdivisions})),this.object._subdivisionsX=this.object._subdivisionsY=this._subdivisions},GroundTool.prototype._createFromHeightMap=function(){this.editor.addEditPanelPlugin("texture-viewer",!0,"Texture Viewer",this,"_heightMapTexture",!1)},GroundTool.prototype._removeHeightMap=function(){delete this._heightMapOptions[this.object.id],this._propertyChanged(),this.update(this.object)},Object.defineProperty(GroundTool.prototype,"_heightMapTexture",{set:function(texture){var bufferWidth=texture.getSize().width,bufferHeight=texture.getSize().height,buffer=new Uint8Array(texture.readPixels().buffer),options=this._heightMapOptions[this.object.id],update=!1;options||(update=!0,options={texture:texture,minHeight:0,maxHeight:1,colorFilter:new babylonjs_1.Color3(.3,.59,.11)}),this.object.geometry.setAllVerticesData(babylonjs_1.VertexData.CreateGroundFromHeightMap({width:this.object._width,height:this.object._height,subdivisions:this._subdivisions,minHeight:options.minHeight,maxHeight:options.maxHeight,colorFilter:options.colorFilter,buffer:buffer,bufferWidth:bufferWidth,bufferHeight:bufferHeight,alphaFilter:0})),options.texture=texture,this._heightMapOptions[this.object.id]=options,this.object._subdivisionsX=this.object._subdivisionsY=this._subdivisions,update&&this.update(this.object)},enumerable:!0,configurable:!0}),GroundTool}(edition_tool_1.default);exports.default=GroundTool}),$__System.registerDynamic("51",["27","1b"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var edition_tool_1=$__require("27"),scene_manager_1=$__require("1b"),EnvironmentHelperTool=function(_super){function EnvironmentHelperTool(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.divId="ENVIRONMENT-HELPER-TOOL",_this.tabName="Environment Helper",_this}return __extends(EnvironmentHelperTool,_super),EnvironmentHelperTool.prototype.isSupported=function(object){return scene_manager_1.default.EnvironmentHelper&&scene_manager_1.default.EnvironmentHelper.rootMesh===object},EnvironmentHelperTool.prototype.update=function(mesh){_super.prototype.update.call(this,mesh);var helper=scene_manager_1.default.EnvironmentHelper,ground=this.tool.addFolder("Ground");ground.open(),ground.add(helper._options,"enableGroundMirror").onChange(function(r){return scene_manager_1.default.EnvironmentHelper.updateOptions({enableGroundMirror:helper._options.enableGroundMirror})}),this.tool.addColor(ground,"Color",helper._options.groundColor,function(){return scene_manager_1.default.EnvironmentHelper.updateOptions({groundColor:helper._options.groundColor})}).open();var skybox=this.tool.addFolder("Skybox");skybox.open(),this.tool.addColor(skybox,"Color",helper._options.skyboxColor,function(){return scene_manager_1.default.EnvironmentHelper.updateOptions({skyboxColor:helper._options.skyboxColor})}).open()},EnvironmentHelperTool}(edition_tool_1.default);exports.default=EnvironmentHelperTool}),$__System.registerDynamic("52",["c","26","28","2a","2b","2c","2e","2f","30","31","32","34","35","36","37","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","48","49","4a","4b","4c","4d","4e","4f","50","51","15"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),scene_tool_1=$__require("26"),node_tool_1=$__require("28"),light_tool_1=$__require("2a"),physics_tool_1=$__require("2b"),render_target_tool_1=$__require("2c"),particle_system_tool_1=$__require("2e"),sound_tool_1=$__require("2f"),animation_tool_1=$__require("30"),skeleton_tool_1=$__require("31"),standard_tool_1=$__require("32"),pbr_tool_1=$__require("34"),pbr_metallic_roughness_tool_1=$__require("35"),pbr_specular_glossiness_tool_1=$__require("36"),water_tool_1=$__require("37"),custom_tool_1=$__require("39"),sky_tool_1=$__require("3a"),fire_tool_1=$__require("3b"),cell_tool_1=$__require("3c"),grid_tool_1=$__require("3d"),tri_planar_tool_1=$__require("3e"),terrain_tool_1=$__require("3f"),lava_tool_1=$__require("40"),fur_tool_1=$__require("41"),mix_tool_1=$__require("42"),post_processes_tool_1=$__require("43"),custom_tool_2=$__require("44"),texture_tool_1=$__require("45"),brick_tool_1=$__require("46"),cloud_tool_1=$__require("48"),fire_tool_2=$__require("49"),grass_tool_1=$__require("4a"),marble_tool_1=$__require("4b"),normal_tool_1=$__require("4c"),perlin_tool_1=$__require("4d"),road_tool_1=$__require("4e"),wood_tool_1=$__require("4f"),ground_tool_1=$__require("50"),environment_helper_tool_1=$__require("51"),undo_redo_1=$__require("15"),EditorInspector=function(){function EditorInspector(editor,rootDiv){var _this=this;this.editor=editor,this.tools=[],this.currentTools=[],this.currentObject=null,this.lastTabName=null,this.root=rootDiv||"EDITION",this.tabs=$("#"+this.root).w2tabs({name:"EDITION"}),this.addTool(new environment_helper_tool_1.default),this.addTool(new scene_tool_1.default),this.addTool(new node_tool_1.default),this.addTool(new physics_tool_1.default),this.addTool(new light_tool_1.default),this.addTool(new render_target_tool_1.default),this.addTool(new particle_system_tool_1.default),this.addTool(new sound_tool_1.default),this.addTool(new animation_tool_1.default),this.addTool(new skeleton_tool_1.default),this.addTool(new standard_tool_1.default),this.addTool(new pbr_tool_1.default),this.addTool(new pbr_metallic_roughness_tool_1.default),this.addTool(new pbr_specular_glossiness_tool_1.default),this.addTool(new water_tool_1.default),this.addTool(new custom_tool_1.default),this.addTool(new sky_tool_1.default),this.addTool(new fire_tool_1.default),this.addTool(new cell_tool_1.default),this.addTool(new grid_tool_1.default),this.addTool(new tri_planar_tool_1.default),this.addTool(new terrain_tool_1.default),this.addTool(new lava_tool_1.default),this.addTool(new fur_tool_1.default),this.addTool(new mix_tool_1.default),this.addTool(new post_processes_tool_1.default),this.addTool(new custom_tool_2.default),this.addTool(new texture_tool_1.default),this.addTool(new brick_tool_1.default),this.addTool(new cloud_tool_1.default),this.addTool(new fire_tool_2.default),this.addTool(new grass_tool_1.default),this.addTool(new marble_tool_1.default),this.addTool(new normal_tool_1.default),this.addTool(new perlin_tool_1.default),this.addTool(new road_tool_1.default),this.addTool(new wood_tool_1.default),this.addTool(new ground_tool_1.default),this.editor.core.onSelectObject.add(function(node){return _this.setObject(node)})}return EditorInspector.prototype.resize=function(width){this.tools.forEach(function(t){t.tool&&t.tool.element&&(t.tool.element.width=width)})},EditorInspector.prototype.addTool=function(tool){var _this=this,current=this.root;$("#"+current).append('<div id="'+tool.divId+'"></div>'),$("#"+tool.divId).hide(),this.tabs.add({id:tool.divId,caption:tool.tabName,closable:!1,onClick:function(event){return _this.changeTab(event.target)}}),this.tabs.hide(tool.divId),tool.editor=this.editor,this.tools.push(tool),this.lastTabName||(this.lastTabName=tool.tabName)},EditorInspector.prototype.setObject=function(object){var _this=this;this.currentTools=[];var lastTool=null;this.tools.forEach(function(t){t.clear();var container=$("#"+t.divId);t.isSupported(object)?(container.show(),_this.tabs.show(t.divId),t.update(object),t.divId===_this.lastTabName&&(lastTool=t),t.tool.onChange(t.tool.element,function(property,result,object,initialValue){_this.editor.core.onModifyingObject.notifyObservers(_this.currentObject)}),t.tool.onFinishChange(t.tool.element,function(property,result,object,initialValue){undo_redo_1.default.Push({baseObject:t.object,property:property,to:result,from:initialValue,object:object}),babylonjs_1.Tags.AddTagsTo(t.object,"modified"),_this.editor.graph.updateObjectMark(t.object),t.onModified&&t.onModified(),_this.editor.core.onModifiedObject.notifyObservers(_this.currentObject)}),_this.currentTools.push(t)):(container.hide(),_this.tabs.hide(t.divId))}),lastTool=lastTool||this.currentTools[0],lastTool&&(this.changeTab(lastTool.divId),this.tabs.select(lastTool.divId)),this.currentObject=object},EditorInspector.prototype.refresh=function(){this.setObject(this.currentObject)},EditorInspector.prototype.updateDisplay=function(){this.currentTools.forEach(function(t){return t.tool.updateDisplay()})},EditorInspector.prototype.getToolsStates=function(){return this.tools.map(function(t){return{id:t.divId,state:t.state}})},EditorInspector.prototype.setToolsStates=function(states){var _this=this;states.forEach(function(s){var t=_this.tools.find(function(t){return t.divId===s.id});t&&(t.state=s.state)})},EditorInspector.prototype.changeTab=function(target){var _this=this;this.tools.forEach(function(t){var container=$("#"+t.divId);t.divId===target?(container.show(),_this.lastTabName=target,t.tool.element.open()):container.hide()})},EditorInspector}();exports.default=EditorInspector}),$__System.registerDynamic("53",[],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var EditorEditPanel=function(){function EditorEditPanel(editor){this.editor=editor,this.currentPlugin=null}return EditorEditPanel.prototype.addPlugin=function(pluginUrl){var _this=this,plugin=this.editor.plugins[pluginUrl];this.editor.resizableLayout.addPanelToStack("edit-panel",{type:"component",title:plugin.name,componentName:plugin.name,html:function(){return _this.editor.plugins[pluginUrl].divElement},onClose:function(){return __awaiter(_this,void 0,void 0,function(){var plugin,first,tabsCount;return __generator(this,function(_a){switch(_a.label){case 0:return plugin=this.editor.plugins[pluginUrl],[4,this.editor.removePlugin(plugin)];case 1:return _a.sent(),first=Object.keys(this.editor.plugins)[0],first?[4,this.showPlugin(this.editor.plugins[first])]:[3,3];case 2:return _a.sent(),[3,4];case 3:tabsCount=this.editor.resizableLayout.getTabsCount("edit-panel"),this.editor.resizableLayout.setPanelSize("edit-panel",0===tabsCount?0:15),_a.label=4;case 4:return[2]}})})},onClick:function(){var plugin=_this.editor.plugins[pluginUrl];_this._onChangeTab(plugin,!1)}}),this.editor.resizableLayout.setPanelSize("edit-panel",50)},EditorEditPanel.prototype.showPlugin=function(plugin){for(var params=[],_i=1;_i<arguments.length;_i++)params[_i-1]=arguments[_i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return plugin?(this.editor.resizableLayout.showPanelTab(plugin.name),[4,this._onChangeTab.apply(this,[plugin,!1].concat(params))]):[2];case 1:return _a.sent(),[2]}})})},EditorEditPanel.prototype._onChangeTab=function(plugin,firstShow){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return this.currentPlugin&&this.currentPlugin.onHide?[4,this.currentPlugin.onHide()]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return this.currentPlugin=plugin,firstShow||!plugin.onShow?[3,4]:[4,plugin.onShow.apply(plugin,params)];case 3:_a.sent(),_a.label=4;case 4:return[2]}})})},EditorEditPanel.PluginCount=0,EditorEditPanel}();exports.default=EditorEditPanel}),$__System.registerDynamic("54",["24"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var layout_1=$__require("24"),Stats=function(){function Stats(editor){this.frameInterval=10,this._frameCount=0,this.editor=editor,this.layout=new layout_1.default("STATS"),this.layout.panels=[{type:"left",size:"50%",content:'<div id="STATS-RENDERING" style="width: 100%; height: calc(100% - 100px);"></div>'},{type:"main",size:"50%",content:'<div id="SCENE-RENDERING" style="width: 100%; height: calc(100% - 100px);"></div>'}],this.layout.build("STATS"),this.renderingDiv=$("#STATS-RENDERING"),this.averageFPS=$('<h4 style="text-align: center;"></h4>'),this.instantaneousFPS=$('<h4 style="text-align: center;"></h4>'),this.averageFrameTime=$('<h4 style="text-align: center;"></h4>'),this.renderingDiv.append("<h1>Rendering</h1>"),this.renderingDiv.append(this.averageFPS),this.renderingDiv.append(this.instantaneousFPS),this.renderingDiv.append(this.averageFrameTime),this.sceneDiv=$("#SCENE-RENDERING"),this.texturesCount=$('<h4 style="text-align: center;"></h4>'),this.materialsCount=$('<h4 style="text-align: center;"></h4>'),this.compiledEffects=$('<h4 style="text-align: center;"></h4>'),this.sceneDiv.append("<h1>Scene</h1>"),this.sceneDiv.append(this.texturesCount),this.sceneDiv.append(this.materialsCount),this.sceneDiv.append(this.compiledEffects)}return Stats.prototype.updateStats=function(){var _this=this,engine=this.editor.core.engine,scene=this.editor.core.scene;scene.registerAfterRender(function(){++_this._frameCount<_this.frameInterval||(_this.averageFPS.text("Average FPS: "+engine.performanceMonitor.averageFPS.toFixed(0)),_this.instantaneousFPS.text("Instantanous FPS: "+engine.performanceMonitor.instantaneousFPS.toFixed(0)),_this.averageFrameTime.text("Average Frame Time: "+engine.performanceMonitor.averageFrameTime.toFixed(0)),_this.texturesCount.text("Textures Count: "+scene.textures.length),_this.materialsCount.text("Materials Count: "+scene.materials.length),_this.compiledEffects.text("Compiled Effects: "+Object.keys(engine._compiledEffects).length),_this._frameCount=0)}),engine.performanceMonitor},Stats}();exports.default=Stats}),$__System.registerDynamic("55",["c","f","15","25","24","13","56","57","a","58"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),tools_1=$__require("f"),undo_redo_1=$__require("15"),context_menu_1=$__require("25"),layout_1=$__require("24"),toolbar_1=$__require("13"),asset_component_1=$__require("56"),asset_component_2=$__require("57"),babylonjs_editor_1=$__require("a"),vscode_socket_1=$__require("58"),EditorAssets=function(){function EditorAssets(editor){var _this=this;this.editor=editor,this.components=[],this.assetPreviewDatas=[],this.currentComponent=null,this.emptyTextNode=null,this._search="",this.layout=new layout_1.default("ASSETS-LAYOUT"),this.layout.panels=[{type:"top",size:30,content:'<div id="ASSETS-TOOLBAR" style="width: 100%; height: 100%;"></div>',resizable:!1},{type:"main",content:'<div id="ASSETS-CONTENT" style="width: 100%; height: 100%;"></div>'}],this.layout.build("ASSETS"),this.toolbar=new toolbar_1.default("ASSETS-TOOLBAR"),this.toolbar.items=[{type:"button",id:"add",text:"Add",img:"icon-add"}],this.toolbar.right='\n            <div style="padding: 3px 10px;">\n                <input placeholder=Search size="25" id="ASSETS-SEARCH" style="height: 20px; padding: 3px; border-radius: 2px; border: 1px solid silver;" value="" />\n            </div>',this.toolbar.onClick=function(id){return _this.toolbarClicked(id)},this.toolbar.build("ASSETS-TOOLBAR");var search=$("#ASSETS-SEARCH");search.keyup(function(){_this._search=search.val(),_this.refresh()}),this.tabs=$("#ASSETS-CONTENT").w2tabs({name:"ASSETS-CONTENT"}),this.prefabs=new asset_component_1.default(editor),this.particles=new asset_component_2.default(editor),this.addDefaultComponents(),this.showTab(this.currentComponent.id),this.refresh()}return EditorAssets.prototype.clear=function(){var _this=this;this.components.forEach(function(c){$("#"+c.id).remove(),_this.tabs.remove(c.id)}),this.components=[],this.assetPreviewDatas=[],this.currentComponent=null,this.emptyTextNode&&(this.emptyTextNode.remove(),this.emptyTextNode=null),this.addDefaultComponents()},EditorAssets.prototype.addDefaultComponents=function(){this.addTab(this.prefabs),this.addTab(this.particles)},EditorAssets.prototype.refresh=function(id){return __awaiter(this,void 0,void 0,function(){var file,_a,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:return EditorAssets._DefaultImageSource?[3,3]:[4,tools_1.default.GetFile("assets/textures/waitlogo.png")];case 1:return file=_b.sent(),_a=EditorAssets,[4,tools_1.default.ReadFileAsBase64(file)];case 2:_a._DefaultImageSource=_b.sent(),_b.label=3;case 3:return 0===this.components.length?(this.emptyTextNode=tools_1.default.CreateElement("h1",babylonjs_1.Tools.RandomId(),{float:"left",left:"50%",top:"50%",transform:"translate(-50%, -50%)",overflow:"hidden",position:"relative","font-family":"Roboto,sans-serif !important",opacity:"0.5"}),this.emptyTextNode.textContent="Empty",$("#ASSETS-CONTENT").append(this.emptyTextNode),[2]):(this.emptyTextNode&&(this.emptyTextNode.remove(),this.emptyTextNode=null),this.components.forEach(function(c){return __awaiter(_this,void 0,void 0,function(){var assets,div,emptyTextNode,assetSize,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return id&&c.id!==id?[2]:[4,c.onGetAssets()];case 1:for(assets=_a.sent().filter(function(a){return a.name&&-1!==a.name.toLowerCase().indexOf(_this._search.toLowerCase())||a.separator}),div=$("#"+c.id);div[0].children.length>0;)div[0].children[0].remove();return 0===assets.length&&(emptyTextNode=tools_1.default.CreateElement("h1",babylonjs_1.Tools.RandomId(),{float:"left",left:"50%",top:"50%",transform:"translate(-50%, -50%)",overflow:"hidden",position:"relative","font-family":"Roboto,sans-serif !important",opacity:"0.5"}),emptyTextNode.textContent=""!==this._search?"No results found":"Empty",$("#"+c.id).append(emptyTextNode)),assetSize=(c.size||50)+"px",assets.forEach(function(a){if(a.separator){var separator=tools_1.default.CreateElement("hr",a.separator,{float:"left",margin:"10px",width:"100%"});return separator.setAttribute("hr-content",a.separator),void div.append(separator)}var parent=tools_1.default.CreateElement("div",c.id+a.name+"div",{position:"relative",width:assetSize,height:assetSize,float:"left",margin:"10px"}),title=tools_1.default.CreateElement("small",a.name+"text",{float:"left",width:assetSize,left:"50%",top:"8px",transform:"translate(-50%, -50%)","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden",position:"relative"}),img=tools_1.default.CreateElement("img",a.name,{width:assetSize,height:assetSize});if(img.classList.add("ctxmenu"),title.innerText=a.name,img.src=a.img||EditorAssets._DefaultImageSource,img.addEventListener("click",function(ev){_this.highlight(img),_this.editor.core.onSelectAsset.notifyObservers(a.data)}),c.onDoubleClickAsset&&img.addEventListener("dblclick",function(ev){c.onDoubleClickAsset(a)}),context_menu_1.default.ConfigureElement(img,_this.getContextMenuItems(c,a),function(){_this.highlight(img),_this.editor.core.onSelectAsset.notifyObservers(a.data)}),img.addEventListener("dblclick",function(ev){return __awaiter(_this,void 0,void 0,function(){var config;return __generator(this,function(_a){switch(_a.label){case 0:return config=System.getConfig(),config.paths[c.id]?[4,this.editor.addEditPanelPlugin(c.id,!1)]:[2];case 1:return _a.sent(),this.editor.core.onSelectAsset.notifyObservers(a.data),[2]}})})}),c.onDragAndDropAsset){var dropListener_1=_this.dragEnd(c,a);img.addEventListener("dragstart",function(){_this.editor.core.engine.getRenderingCanvas().addEventListener("drop",dropListener_1)}),img.addEventListener("dragend",function(){_this.editor.core.engine.getRenderingCanvas().removeEventListener("drop",dropListener_1)})}parent.appendChild(img),parent.appendChild(title),div.append(parent),_this.assetPreviewDatas.push({asset:a,img:img,title:title,parent:parent})}),[2]}})})}),vscode_socket_1.default.Refresh(),[2])}})})},EditorAssets.prototype.addTab=function(component){var _this=this;this.components.find(function(c){return c===component})||($("#ASSETS-CONTENT").append('<div id="'+component.id+'" style="width: 100%; height: 100%; overflow: auto;"></div>'),this.tabs.add({id:component.id,caption:component.assetsCaption,closable:!1,onClick:function(event){return _this.showTab(event.target)}}),this.currentComponent?$("#"+component.id).hide():this.currentComponent=component,this.components.push(component),this.refresh(component.id))},EditorAssets.prototype.showTab=function(id){this.currentComponent&&$("#"+this.currentComponent.id).hide(),this.currentComponent=this.components.find(function(c){return c.id===id}),$("#"+this.currentComponent.id).show(),this.tabs.select(id),this.currentComponent.onCreateAsset?this.toolbar.element.show("add"):this.toolbar.element.hide("add")},EditorAssets.prototype.getAssetPreviewData=function(asset){return this.assetPreviewDatas.find(function(apd){return apd.asset===asset})},EditorAssets.prototype.addAsset=function(component){return __awaiter(this,void 0,void 0,function(){var name_1,asset;return __generator(this,function(_a){switch(_a.label){case 0:return component||(component=this.currentComponent),component&&component.onCreateAsset?[4,babylonjs_editor_1.Dialog.CreateWithTextInput("New asset name")]:[3,3];case 1:return name_1=_a.sent(),[4,component.onCreateAsset(name_1)];case 2:return asset=_a.sent(),this.showTab(component.id),this.refresh(component.id),[2,asset];case 3:return[2,null]}})})},EditorAssets.prototype.dragEnd=function(component,asset){var _this=this;return function(ev){var scene=_this.editor.core.scene,pick=scene.pick(ev.offsetX,ev.offsetY);pick.pickedMesh&&(component.onDragAndDropAsset(pick.pickedMesh,asset,pick),_this.editor.core.onSelectObject.notifyObservers(pick.pickedMesh),_this.editor.graph.configure(),_this.refresh(component.id))}},EditorAssets.prototype.toolbarClicked=function(id){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(id){case"add":this.addAsset()}return[2]})})},EditorAssets.prototype.highlight=function(img){this.assetPreviewDatas.forEach(function(apd){apd.img&&(apd.img.style.backgroundColor="",apd.img.style.borderRadius="")}),img.style.backgroundColor="rgba(0, 0, 0, 0.25)",img.style.borderRadius="10px"},EditorAssets.prototype.getContextMenuItems=function(component,asset){var _this=this;if(component.onRemoveAsset){var items={};return(component.onContextMenu&&component.onContextMenu()||[]).forEach(function(i){return items[i.id]={name:i.text,callback:function(){return i.callback(asset)}}}),component.onRenameAsset&&(items.rename={name:"Rename...",callback:function(){return __awaiter(_this,void 0,void 0,function(){var oldName,newName,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return component.onRenameAsset?(oldName=asset.name,[4,babylonjs_editor_1.Dialog.CreateWithTextInput("New asset name")]):[2];case 1:return newName=_a.sent(),asset.name=newName,component.onRenameAsset(asset,newName),undo_redo_1.default.Push({fn:function(type){"from"===type?component.onRenameAsset(asset,oldName):component.onRenameAsset(asset,newName),_this.refresh(),_this.showTab(component.id)}}),this.refresh(),[2]}})})}}),component.onRemoveAsset&&(items.remove={name:"Remove",callback:function(){component.onAddAsset&&undo_redo_1.default.Push({fn:function(type){"from"===type?(component.onAddAsset(asset),_this.editor.core.onAddObject.notifyObservers(asset.data)):(component.onRemoveAsset(asset),_this.editor.core.onSelectAsset.notifyObservers(null),_this.editor.core.onRemoveObject.notifyObservers(asset.data)),_this.refresh(),_this.showTab(component.id),_this.editor.graph.configure()}}),component.onRemoveAsset(asset),_this.editor.core.onSelectAsset.notifyObservers(null),_this.editor.core.onRemoveObject.notifyObservers(asset.data),_this.refresh(),_this.editor.graph.configure()}}),items}},EditorAssets._DefaultImageSource=null,EditorAssets}();exports.default=EditorAssets}),$__System.registerDynamic("59",["c","24","13","f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),layout_1=$__require("24"),toolbar_1=$__require("13"),tools_1=$__require("f"),EditorFiles=function(){function EditorFiles(editor){var _this=this;this.editor=editor,this.divContent=null,this._tabId="all",this._search="",this.layout=new layout_1.default("FILES"),this.layout.panels=[{type:"top",size:30,content:'<div id="FILES-TOOLBAR" style="width: 100%; height: 100%;"></div>',resizable:!1},{type:"main",content:'<div id="FILES-TABS" style="width: 100%; height: 100%"></div>'}],this.layout.build("FILES"),this.toolbar=new toolbar_1.default("FILES-TOOLBAR"),this.toolbar.items=[],this.toolbar.right='\n            <div style="padding: 3px 10px;">\n                <input placeholder=Search size="25" id="FILES-SEARCH" style="height: 20px; padding: 3px; border-radius: 2px; border: 1px solid silver;" value="" />\n            </div>',this.toolbar.build("FILES-TOOLBAR");var search=$("#FILES-SEARCH");search.keyup(function(){_this._search=search.val(),_this.refresh()}),this.tabs=$("#FILES-TABS").w2tabs({name:"FILES-TABS"}),this.tabs.add({id:"all",caption:"All",closable:!1,onClick:function(event){return _this.showTab(event.target)}}),this.tabs.add({id:"textures",caption:"Textures",closable:!1,onClick:function(event){return _this.showTab(event.target)}}),this.tabs.add({id:"scenes",caption:"Scenes",closable:!1,onClick:function(event){return _this.showTab(event.target)}}),this.tabs.add({id:"sounds",caption:"Sounds",closable:!1,onClick:function(event){return _this.showTab(event.target)}}),$("#FILES-TABS").append('<div id="FILES-CONTENT" style="width: 100%; height: calc(100% - 25px); overflow: auto;"></div>'),this.divContent=$("#FILES-CONTENT")[0],tools_1.default.GetFile("assets/textures/waitlogo.png").then(function(f){return __awaiter(_this,void 0,void 0,function(){var _a;return __generator(this,function(_b){switch(_b.label){case 0:return _a=EditorFiles,[4,tools_1.default.ReadFileAsBase64(f)];case 1:return _a._FileImageSource=_b.sent(),this.refresh(),[2]}})})}),this.showTab("all")}return EditorFiles.prototype.showTab=function(id){this._tabId=id,this.tabs.select(id),this.refresh()},EditorFiles.prototype.refresh=function(){for(var _this=this,files=this.filter();this.divContent.children.length>0;)this.divContent.children[0].remove();files.forEach(function(f){var parent=tools_1.default.CreateElement("div",f.name+"div",{position:"relative",width:"100%",height:"50px"}),title=tools_1.default.CreateElement("small",f.name+"text",{position:"relative",width:"100%",left:"15px",top:"-50%",overflow:"hidden"}),img=tools_1.default.CreateElement("img",f.name,{width:"50px",height:"50px"});title.innerText=f.name,img.src=EditorFiles._FileImageSource,parent.addEventListener("click",function(){return _this.highlightItem(parent)}),parent.appendChild(img),parent.appendChild(title),_this.divContent.appendChild(parent)})},EditorFiles.prototype.filter=function(){var _this=this,files=Object.keys(babylonjs_1.FilesInputStore.FilesToLoad).map(function(f){return babylonjs_1.FilesInputStore.FilesToLoad[f]}).filter(function(f){return f.name&&-1!==f.name.toLowerCase().indexOf(_this._search.toLowerCase())}).filter(function(f){return f!==_this.editor.projectFile&&f!==_this.editor.sceneFile});switch(this._tabId){case"textures":return this.getFilteredArray(files,["jpg","jpeg","png","bmp","dds","hdr","env"]);case"scenes":return this.getFilteredArray(files,["babylon","obj","gltf","glb","stl"]);case"sounds":return this.getFilteredArray(files,["mp3","ogg","wav","wave"]);default:return files}},EditorFiles.prototype.getFilteredArray=function(files,extensions){return files.filter(function(f){var ext=tools_1.default.GetFileExtension(f.name).toLowerCase();return-1!==extensions.indexOf(ext)})},EditorFiles.prototype.highlightItem=function(parent){for(var i=0;i<this.divContent.children.length;i++){var c=this.divContent.children.item(i);c.style.backgroundColor="",c.style.borderRadius="",c.style.border=""}parent.style.backgroundColor="rgba(0, 0, 0, 0.25)",parent.style.borderRadius="10px",parent.style.border="2px solid grey"},EditorFiles._FileImageSource=null,EditorFiles}();exports.default=EditorFiles}),$__System.registerDynamic("5a",["c"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),SceneIcons=function(){function SceneIcons(editor){this.camerasPlanes=[],this.lightsPlanes=[],this.particleSystemsPlanes=[],this.soundsPlanes=[],this._lastCamerasCount=-1,this._lastLightsCount=-1,this._lastParticleSystemsCount=-1,this._lastSoundsCount=-1,this.editor=editor,this.editor.core.updates.push(this),this.scene=new babylonjs_1.Scene(editor.core.engine),this.scene.autoClear=!1,this.scene.postProcessesEnabled=!1,this.scene.preventDefaultOnPointerDown=!1,this.cameraTexture=this.createTexture("css/images/camera.png"),this.lightTexture=this.createTexture("css/images/light.png"),this.particleTexture=this.createTexture("css/images/particles.png"),this.soundTexture=this.createTexture("css/images/sound.png"),this.camerasMaterial=new babylonjs_1.StandardMaterial("CamerasMaterial",this.scene),this.camerasMaterial.diffuseTexture=this.cameraTexture,this.camerasMaterial.emissiveColor=babylonjs_1.Color3.White(),this.camerasMaterial.disableDepthWrite=!1,this.camerasMaterial.disableLighting=!0,this.lightsMaterial=this.camerasMaterial.clone("LightsMaterial"),this.lightsMaterial.diffuseTexture=this.lightTexture,this.particleSystemsMaterial=this.camerasMaterial.clone("ParticleSystemsMaterial"),this.particleSystemsMaterial.diffuseTexture=this.particleTexture,this.soundMaterial=this.camerasMaterial.clone("SoundMaterial"),this.soundMaterial.diffuseTexture=this.soundTexture}return SceneIcons.prototype.onPostUpdate=function(){var _this=this,scene=this.editor.core.scene;scene.cameras.length!==this._lastCamerasCount&&(this._lastCamerasCount=scene.cameras.length,this.createPlanes(this.camerasPlanes,this.camerasMaterial,this._lastCamerasCount)),scene.lights.length!==this._lastLightsCount&&(this._lastLightsCount=scene.lights.length,this.createPlanes(this.lightsPlanes,this.lightsMaterial,this._lastLightsCount)),scene.particleSystems.length!==this._lastParticleSystemsCount&&(this._lastParticleSystemsCount=scene.particleSystems.length,this.createPlanes(this.particleSystemsPlanes,this.particleSystemsMaterial,this._lastParticleSystemsCount));var sounds=[];scene.soundTracks&&scene.soundTracks.forEach(function(st){return st.soundCollection.forEach(function(s){return s.spatialSound&&sounds.push(s)})}),sounds.length!==this._lastSoundsCount&&(this._lastSoundsCount=sounds.length,this.createPlanes(this.soundsPlanes,this.soundMaterial,this._lastSoundsCount)),this.scene.activeCamera=this.editor.core.scene.activeCamera,this.scene.render(),scene.cameras.forEach(function(c,index){var plane=_this.camerasPlanes[index];if(plane.metadata.object=c,c===scene.activeCamera||!c.position)return plane.setEnabled(!1);plane.setEnabled(!0),_this.configurePlane(plane,c.position)}),scene.lights.forEach(function(l,index){var plane=_this.lightsPlanes[index];plane.metadata.object=l,_this.configurePlane(plane,l.getAbsolutePosition())}),scene.particleSystems.forEach(function(ps,index){var plane=_this.particleSystemsPlanes[index];plane.metadata.object=ps,ps.emitter instanceof babylonjs_1.Vector3?_this.configurePlane(plane,ps.emitter):ps.emitter&&_this.configurePlane(plane,ps.emitter.getAbsolutePosition())}),sounds.forEach(function(s,index){var plane=_this.soundsPlanes[index];plane.metadata.object=s,_this.configurePlane(plane,s._position)})},SceneIcons.prototype.pickIcon=function(offsetX,offsetY,getSourceObject){void 0===getSourceObject&&(getSourceObject=!0);var pick=this.scene.pick(offsetX,offsetY);return pick.hit?(getSourceObject&&(pick.pickedMesh=pick.pickedMesh.metadata.object),pick):null},SceneIcons.prototype.createPlanes=function(planes,material,count){planes.forEach(function(p){return p.dispose()}),planes.splice(0,planes.length);for(var i=0;i<count;i++){var plane=babylonjs_1.Mesh.CreatePlane("SceneIconsPlane",1,this.scene,!1);plane.billboardMode=babylonjs_1.Mesh.BILLBOARDMODE_ALL,plane.material=material,plane.isPickable=!0,plane.metadata={object:null},planes.push(plane)}},SceneIcons.prototype.configurePlane=function(plane,sourcePosition){var distance=.04*babylonjs_1.Vector3.Distance(this.editor.core.scene.activeCamera.position,sourcePosition);plane.scaling=new babylonjs_1.Vector3(distance,distance,distance),plane.position.copyFrom(sourcePosition),plane.computeWorldMatrix(!0)},SceneIcons.prototype.createTexture=function(url){var texture=new babylonjs_1.Texture(url,this.scene);return texture.hasAlpha=!0,this.scene.textures.pop(),texture},SceneIcons}();exports.default=SceneIcons}),$__System.registerDynamic("5b",["c","20","f","18","1a","1d"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),babylonjs_gui_1=$__require("20"),tools_1=$__require("f"),scene_exporter_1=$__require("18"),scene_importer_1=$__require("1a"),project_exporter_1=$__require("1d"),DefaultScene=function(){function DefaultScene(){}return DefaultScene.CreateLabel=function(gui,mesh,str,lines,width,height){var label=new babylonjs_gui_1.Rectangle(str);label.background="black",label.height=height,label.alpha=.5,label.width=width,label.cornerRadius=20,label.thickness=1,label.linkOffsetY=30,label.top="0%",label.zIndex=5,label.verticalAlignment=babylonjs_gui_1.Control.VERTICAL_ALIGNMENT_TOP,label.horizontalAlignment=babylonjs_gui_1.Control.HORIZONTAL_ALIGNMENT_RIGHT,gui.addControl(label);var text=new babylonjs_gui_1.TextBlock;if(text.text=str,text.color="white",label.addControl(text),!lines)return label.linkWithMesh(mesh),label;var line=new babylonjs_gui_1.Line;return line.alpha=.5,line.lineWidth=5,line.dash=[5,10],gui.addControl(line),line.linkWithMesh(mesh),line.connectedControl=label,label},DefaultScene.Create=function(editor){return __awaiter(this,void 0,void 0,function(){var project,_a,_b,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return editor.sceneFile&&delete babylonjs_1.FilesInputStore.FilesToLoad[editor.sceneFile.name.toLowerCase()],editor.projectFile&&delete babylonjs_1.FilesInputStore.FilesToLoad[editor.projectFile.name.toLowerCase()],_b=(_a=JSON).parse,[4,tools_1.default.LoadFile("assets/defaultScene/scene.editorproject")];case 1:return project=_b.apply(_a,[_c.sent()]),[4,scene_importer_1.default.LoadProjectFromFile(editor,"assets/defaultScene/scene.editorproject",project,!1)];case 2:return _c.sent(),project_exporter_1.default.ProjectPath=null,scene_exporter_1.default.CreateFiles(editor),editor.core.onSceneLoaded.addOnce(function(d){var gui=babylonjs_gui_1.AdvancedDynamicTexture.CreateFullscreenUI("ui");gui.layer.layerMask=2,editor.core.uiTextures.push(gui),_this.CreateLabel(gui,d.scene.getMeshByName("Sphere Animated"),"Animated\nView => Animations...",!1,"200px","60px"),_this.CreateLabel(gui,d.scene.getMeshByName("Sphere Standard"),"Standard Material",!1,"200px","30px"),_this.CreateLabel(gui,d.scene.getMeshByName("Sphere PBR"),"PBR Material",!1,"150px","30px"),_this.CreateLabel(gui,d.scene.getMeshByName("Documentation"),"Documentation (Double Click)",!1,"300px","30px"),_this.CreateLabel(gui,d.scene.getMeshByName("Rain Particles"),"Rain Particle System",!1,"300px","30px"),_this.CreateLabel(gui,d.scene.getMeshByName("Drop Particles"),"Drop Particle System",!1,"300px","30px");var documentation=d.scene.getMeshByName("Documentation");documentation.actionManager=new babylonjs_1.ActionManager(d.scene),documentation.actionManager.registerAction(new babylonjs_1.ExecuteCodeAction(babylonjs_1.ActionManager.OnDoublePickTrigger,function(evt){window.open("http://doc.babylonjs.com/resources")}))}),[2]}})})},DefaultScene.CreateEmpty=function(editor){return __awaiter(this,void 0,void 0,function(){var project,_a,_b;return __generator(this,function(_c){switch(_c.label){case 0:return editor.sceneFile&&delete babylonjs_1.FilesInputStore.FilesToLoad[editor.sceneFile.name.toLowerCase()],editor.projectFile&&delete babylonjs_1.FilesInputStore.FilesToLoad[editor.projectFile.name.toLowerCase()],babylonjs_1.FilesInputStore.FilesToLoad={},_b=(_a=JSON).parse,[4,tools_1.default.LoadFile("assets/emptyScene/scene.editorproject")];case 1:return project=_b.apply(_a,[_c.sent()]),[4,scene_importer_1.default.LoadProjectFromFile(editor,"assets/emptyScene/scene.editorproject",project,!1)];case 2:return _c.sent(),project_exporter_1.default.ProjectPath=null,scene_exporter_1.default.CreateFiles(editor),[2]}})})},DefaultScene}();exports.default=DefaultScene}),$__System.registerDynamic("5c",["c","29","b","24","14","5d","21","10","5e","25","12","1f","23","52","53","54","55","59","22","5f","5a","1a","60","1d","1e","f","5b","15","17","16","58"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),extensions_1=$__require("29"),core_1=$__require("b"),layout_1=$__require("24"),dialog_1=$__require("14"),resizable_layout_1=$__require("5d"),tree_1=$__require("21"),window_1=$__require("10"),code_1=$__require("5e"),context_menu_1=$__require("25"),toolbar_1=$__require("12"),graph_1=$__require("1f"),preview_1=$__require("23"),inspector_1=$__require("52"),edit_panel_1=$__require("53"),stats_1=$__require("54"),assets_1=$__require("55"),files_1=$__require("59"),scene_picker_1=$__require("22"),scene_preview_1=$__require("5f"),scene_icons_1=$__require("5a"),scene_importer_1=$__require("1a"),scene_loader_1=$__require("60"),project_exporter_1=$__require("1d"),project_code_editor_1=$__require("1e"),tools_1=$__require("f"),default_scene_1=$__require("5b"),undo_redo_1=$__require("15"),request_1=$__require("17"),theme_1=$__require("16"),vscode_socket_1=$__require("58"),Editor=function(){function Editor(scene){var _this=this;this.playCamera=null,this.plugins={},this.sceneFile=null,this.guiFiles=[],this.projectFile=null,this.projectFileName="scene.editorproject",this._showReloadDialog=!0,this._lastWaitingItems=0,this._canvasFocused=!0,tools_1.default.IsStandalone=!scene;var mainDiv=tools_1.default.CreateElement("div","BABYLON-EDITOR-MAIN",{overflow:"hidden",width:"100%",height:"100%",margin:"0",padding:"0",touchAction:"none",position:"fixed"});document.body.appendChild(mainDiv),this.layout=new layout_1.default("BABYLON-EDITOR-MAIN"),this.layout.panels=[{type:"top",size:55,content:'<a class="babylonjs-logo" href="http://babylonjs.com" target="_blank"></a> <div id="MAIN-TOOLBAR" style="width: 100%; height: 50%;"></div><div id="TOOLS-TOOLBAR" style="width: 100%; height: 50%;"></div>',resizable:!1},{type:"main",content:'<div id="MAIN-LAYOUT" style="width: 100%; height: 100%; overflow: hidden;"></div>',resizable:!0,tabs:[]},{type:"bottom",size:0,content:"",resizable:!1}],this.layout.build("BABYLON-EDITOR-MAIN");var layoutVersion=localStorage.getItem("babylonjs-editor-layout-version"),layoutStateItem=layoutVersion===Editor.LayoutVersion?localStorage.getItem("babylonjs-editor-layout-state")||"{ }":"{ }",layoutState=JSON.parse(layoutStateItem);if(this.resizableLayout=new resizable_layout_1.default("MAIN-LAYOUT"),this.resizableLayout.panels=layoutState.content||[{type:"row",content:[{type:"row",content:[{type:"component",componentName:"Inspector",width:20,isClosable:!1,html:'<div id="EDITION" style="width: 100%; height: 100%; overflow: auto;"></div>'},{type:"column",content:[{type:"component",componentName:"Preview",isClosable:!1,html:'<div id="PREVIEW" style="width: 100%; height: 100%;"></div>'},{type:"stack",id:"edit-panel",componentName:"Tools",isClosable:!1,height:20,content:[{type:"component",componentName:"Stats",width:20,isClosable:!1,html:'\n                                <div id="STATS" style="width: 100%; height: 100%"></div>'},{type:"component",componentName:"Files",width:20,isClosable:!1,html:'\n                                <div id="FILES" style="width: 100%; height: 100%"></div>'}]}]},{type:"component",componentName:"Assets",width:20,isClosable:!1,html:'\n                        <div id="ASSETS" style="width: 100%; height: 100%;"></div>'},{type:"component",componentName:"Graph",width:20,isClosable:!1,html:'\n                        <input id="SCENE-GRAPH-SEARCH" type="text" placeHolder="Search" style="width: 100%; height: 40px;" />\n                        <div id="SCENE-GRAPH" style="width: 100%; height: calc(100% - 40px); overflow: auto;"></div>'}]}]}],this.resizableLayout.build("MAIN-LAYOUT"),this.layout.element.on({execute:"after",type:"resize"},function(){return _this.resize()}),this.resizableLayout.onPanelResize=function(){return _this.resize()},window.addEventListener("resize",function(){_this.layout.element.resize(),_this.resizableLayout.element.updateSize(),_this.resize()}),this.core=new core_1.default,this.core.updates.push(this),this.preview=new preview_1.default(this),scene)scene.onAfterRenderObservable.addOnce(function(){var currentCanvas=document.getElementById("renderCanvasEditor"),newCanvas=scene.getEngine().getRenderingCanvas(),parent=currentCanvas.parentElement;currentCanvas.remove(),newCanvas.id=currentCanvas.id,parent.appendChild(scene.getEngine().getRenderingCanvas()),_this.graph.clear(),_this.graph.fill(),_this.createScenePicker(),_this.stats.updateStats(),_this.assets.refresh(),_this.files.refresh()}),this.core.engine=scene.getEngine(),this.core.scenes.push(scene),this.core.scene=scene,this.camera=scene.activeCamera;else{var canvas=document.getElementById("renderCanvasEditor");canvas.addEventListener("contextmenu",function(ev){return ev.preventDefault()}),this.core.engine=new babylonjs_1.Engine(canvas,!0,{antialias:!0,premultipliedAlpha:!1}),this.core.scene=new babylonjs_1.Scene(this.core.engine),this.core.scenes.push(this.core.scene)}if(this.toolbar=new toolbar_1.default(this),this.inspector=new inspector_1.default(this),this.graph=new graph_1.default(this),this.graph.currentObject=this.core.scene,this.editPanel=new edit_panel_1.default(this),this.stats=new stats_1.default(this),this.stats.updateStats(),this.assets=new assets_1.default(this),this.files=new files_1.default(this),tools_1.default.IsStandalone&&(this.createEditorCamera(),this._createFilesInput()),this.sceneIcons=new scene_icons_1.default(this),this.createScenePicker(),this._handleEvents(),tools_1.default.IsElectron()?(scene_preview_1.default.Create(this),this._checkUpdates(),this.checkOpenedFile(),vscode_socket_1.default.Create(this)):this.createDefaultScene(),tools_1.default.IsStandalone){var theme=localStorage.getItem("babylonjs-editor-theme-name");theme_1.default.ThemeName=theme||"Light"}context_menu_1.default.Init()}return Editor.prototype.run=function(){var _this=this;this.core.engine.runRenderLoop(function(){_this.core.update()})},Editor.prototype.resize=function(){return __awaiter(this,void 0,void 0,function(){var editionSize,tabsCount,_a,_b,_i,p,plugin,_c,e_1;return __generator(this,function(_d){switch(_d.label){case 0:editionSize=this.resizableLayout.getPanelSize("Inspector"),this.inspector.resize(editionSize.width),this.stats.layout.element.resize(),this.preview.resize(),tabsCount=this.resizableLayout.getTabsCount("edit-panel"),0===tabsCount&&this.resizableLayout.setPanelSize("edit-panel",0),this.assets.layout.element.resize(),this.files.layout.element.resize(),_a=[];for(_b in this.plugins)_a.push(_b);_i=0,_d.label=1;case 1:if(!(_i<_a.length))return[3,7];p=_a[_i],plugin=this.plugins[p],_d.label=2;case 2:return _d.trys.push([2,5,,6]),_c=plugin.onResize,_c?[4,plugin.onResize()]:[3,4];case 3:_c=_d.sent(),_d.label=4;case 4:return[3,6];case 5:return e_1=_d.sent(),console.info('Failed to resize plugin "'+p+'". The extension may be not ready.'),[3,6];case 6:return _i++,[3,1];case 7:return this.core.onResize.notifyObservers(null),[2]}})})},Editor.prototype.onPostUpdate=function(){var waiting=this.core.scene.getWaitingItemsCount()+tools_1.default.PendingFilesToLoad;this._lastWaitingItems!==waiting&&(this._lastWaitingItems=waiting,0===waiting?this.layout.unlockPanel("bottom"):this.layout.lockPanel("bottom","Waiting for "+waiting+" item(s)",!0))},Editor.prototype.getExtension=function(name){return extensions_1.default.Instances[name]},Editor.prototype.addEditPanelPlugin=function(url,restart,name){void 0===restart&&(restart=!1);for(var params=[],_i=3;_i<arguments.length;_i++)params[_i-3]=arguments[_i];return __awaiter(this,void 0,void 0,function(){var e_2,e_3,e_4,plugin,e_5;return __generator(this,function(_a){switch(_a.label){case 0:if(!tools_1.default.IsStandalone)return window_1.default.CreateAlert("Cannot run plugins when using the Editor as scene inspector","Error"),[2,null];if(!this.plugins[url])return[3,13];if(!restart)return[3,5];_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this.removePlugin(this.plugins[url])];case 2:return _a.sent(),[3,4];case 3:return e_2=_a.sent(),console.error('Error while removing plugin "'+url+'"',e_2),[3,4];case 4:return[3,13];case 5:if(!this.plugins[url].onReload)return[3,9];_a.label=6;case 6:return _a.trys.push([6,8,,9]),[4,this.plugins[url].onReload()];case 7:return _a.sent(),[3,9];case 8:return e_3=_a.sent(),console.error('Error while calling .onReload on plugin "'+url+'"',e_3),[3,9];case 9:return _a.trys.push([9,11,,12]),[4,this.editPanel.showPlugin.apply(this.editPanel,[this.plugins[url]].concat(params))];case 10:return _a.sent(),[3,12];case 11:return e_4=_a.sent(),console.error('Error while calling .showPlugin on plugin "'+url+'"',e_4),[3,12];case 12:return[2,this.plugins[url]];case 13:this.layout.lockPanel("main","Loading "+(name||url)+" ...",!0),_a.label=14;case 14:return _a.trys.push([14,17,,18]),[4,this._runPlugin.apply(this,[url].concat(params))];case 15:return plugin=_a.sent(),this.plugins[url]=plugin,this.editPanel.addPlugin(url),this.layout.unlockPanel("main"),[4,plugin.create()];case 16:return _a.sent(),this.resize(),[2,plugin];case 17:throw e_5=_a.sent(),delete this.plugins[url],console.error('Error while loading plugin "'+url+'"',e_5),e_5;case 18:return[2]}})})},Editor.prototype.removePlugin=function(plugin,removePanel){return void 0===removePanel&&(removePanel=!0),__awaiter(this,void 0,void 0,function(){var e_6,p;return __generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,2,,3]),[4,plugin.close()];case 1:return _a.sent(),[3,3];case 2:return e_6=_a.sent(),[3,3];case 3:removePanel&&plugin.divElement.remove();for(p in this.plugins)if(this.plugins[p]===plugin){delete this.plugins[p];break}return removePanel&&this.resizableLayout.removePanel(plugin.name),[2]}})})},Editor.prototype.restartPlugins=function(removePanels){return void 0===removePanels&&(removePanels=!1),__awaiter(this,void 0,void 0,function(){var _a,_b,_i,p,plugin;return __generator(this,function(_c){switch(_c.label){case 0:_a=[];for(_b in this.plugins)_a.push(_b);_i=0,_c.label=1;case 1:return _i<_a.length?(p=_a[_i],plugin=this.plugins[p],plugin?[4,this.removePlugin(plugin,removePanels)]:[3,3]):[3,6];case 2:_c.sent(),_c.label=3;case 3:return[4,this.addEditPanelPlugin(p,!1,plugin?plugin.name:p)];case 4:_c.sent(),_c.label=5;case 5:return _i++,[3,1];case 6:return[2]}})})},Editor.prototype.notifyMessage=function(message,spinner,timeout){var _this=this;if(!message)return this.layout.unlockPanel("bottom");this.layout.lockPanel("bottom",message,spinner),timeout&&setTimeout(function(){return _this.layout.unlockPanel("bottom")},timeout)},Editor.prototype.checkOpenedFile=function(){return __awaiter(this,void 0,void 0,function(){var hasOpenedFile,pluginsToLoad,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,scene_importer_1.default.CheckOpenedFile(this)];case 1:return hasOpenedFile=_a.sent(),hasOpenedFile?[3,3]:[4,this.createDefaultScene()];case 2:return[2,_a.sent()];case 3:return pluginsToLoad=JSON.parse(localStorage.getItem("babylonjs-editor-plugins")||"[]"),pluginsToLoad.forEach(function(p){return _this.plugins[p]=null}),[2]}})})},Editor.prototype.getProjectFileFromFilesInputStore=function(){for(var f in babylonjs_1.FilesInputStore.FilesToLoad){var file=babylonjs_1.FilesInputStore.FilesToLoad[f];if("editorproject"===tools_1.default.GetFileExtension(file.name))return file}return null},Editor.prototype.createScenePicker=function(){var _this=this;this.scenePicker&&this.scenePicker.remove(),this.scenePicker=new scene_picker_1.default(this,this.core.scene,this.core.engine.getRenderingCanvas()),this.scenePicker.onUpdateMesh=function(m){_this.inspector.updateDisplay(),babylonjs_1.Tags.AddTagsTo(m,"modified"),_this.graph.updateObjectMark(m)},this.scenePicker.onPickedMesh=function(m){_this.core.disableObjectSelection||_this.core.onSelectObject.notifyObservers(m)}},Editor.prototype.createDefaultScene=function(showNewSceneDialog,emptyScene){return void 0===showNewSceneDialog&&(showNewSceneDialog=!1),void 0===emptyScene&&(emptyScene=!1),__awaiter(this,void 0,void 0,function(){var callback,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return callback=function(){return __awaiter(_this,void 0,void 0,function(){var pluginsToLoad,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this.layout.lockPanel("main","Loading Preview Scene...",!0),[4,default_scene_1.default.Create(this)];case 1:return _a.sent(),this.graph.clear(),this.graph.fill(),this.layout.unlockPanel("main"),this.core.scene.executeWhenReady(function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){return showNewSceneDialog&&(this.createScenePicker(),this.stats.updateStats(),this.assets.refresh(),this.files.refresh()),this.resize(),[2]})})}),this.graph.clear(),this.graph.fill(),pluginsToLoad=JSON.parse(localStorage.getItem("babylonjs-editor-plugins")||"[]"),pluginsToLoad.forEach(function(p){return _this.plugins[p]=null}),[2]}})})},showNewSceneDialog?[3,2]:[4,callback()];case 1:return[2,_a.sent()];case 2:return dialog_1.default.Create("Create a new scene?","Remove current scene and create a new one?",function(result){return __awaiter(_this,void 0,void 0,function(){var scene;return __generator(this,function(_a){switch(_a.label){case 0:return"Yes"!==result?[3,3]:(undo_redo_1.default.Clear(),project_code_editor_1.default.CloseAll(),this.core.scene.dispose(),this.core.removeScene(this.core.scene),this.core.uiTextures.forEach(function(ui){return ui.dispose()}),scene=new babylonjs_1.Scene(this.core.engine),this.core.scene=scene,this.core.scenes.push(scene),this.createEditorCamera(),this.stats.updateStats(),this.assets.clear(),emptyScene?[4,default_scene_1.default.CreateEmpty(this)]:[3,2]);case 1:_a.sent(),_a.label=2;case 2:showNewSceneDialog?(this.graph.clear(),this.graph.fill(),this.assets.refresh(),this.files.refresh(),this.createScenePicker()):callback(),this.core.onSelectObject.notifyObservers(this.core.scene),_a.label=3;case 3:return[2]}})})}),[2]}})})},Editor.prototype.createEditorCamera=function(type){var _this=this;void 0===type&&(type="free");var graphNode=null;this.camera&&(graphNode=this.graph.getByData(this.camera));var position=this.core.scene.activeCamera?this.core.scene.activeCamera.position:new babylonjs_1.Vector3(0,5,25),target=this.core.scene.activeCamera?this.core.scene.activeCamera._currentTarget||new babylonjs_1.Vector3(0,5,24):new babylonjs_1.Vector3(0,5,24);return this.camera&&this.camera.dispose(),"free"===type?(this.camera=new babylonjs_1.FreeCamera("Editor Camera",position,this.core.scene),this.camera.speed=.5,this.camera.angularSensibility=3e3,this.camera.setTarget(target),this.camera.attachControl(this.core.engine.getRenderingCanvas(),!0),Object.defineProperty(this.camera,"target",{get:function(){return _this.camera.getTarget()},set:function(v){return _this.camera.setTarget(v)}}),this.camera.keysUp.push(87),this.camera.keysUp.push(90),this.camera.keysLeft.push(65),this.camera.keysLeft.push(81),this.camera.keysDown.push(83),this.camera.keysRight.push(68)):"arc"===type?(this.camera=new babylonjs_1.ArcRotateCamera("Editor Camera",Math.PI/2,Math.PI/2,15,target,this.core.scene),this.camera.panningSensibility=500,this.camera.attachControl(this.core.engine.getRenderingCanvas(),!0,!1)):this.camera=babylonjs_1.Camera.Parse(type,this.core.scene),this.camera.maxZ=1e4,this.core.scene.cameras.length>1&&(this.camera.doNotSerialize=!0),babylonjs_1.Tags.AddTagsTo(this.camera,"added"),graphNode&&(graphNode.data=this.camera),this.core.scene.activeCamera=this.camera,this.camera},Editor.prototype._handleEvents=function(){var _this=this;document.addEventListener("dragover",function(e){return e.preventDefault()}),document.addEventListener("drop",function(e){e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&_this.core.onDropFiles.notifyObservers({target:e.target,files:e.dataTransfer.files})}),document.addEventListener("contextmenu",function(e){return e.preventDefault()}),undo_redo_1.default.onUndo=function(e){return tools_1.default.SetWindowTitle(_this.projectFileName+" *")},document.addEventListener("keyup",function(ev){!code_1.default.HasOneFocused()&&ev.ctrlKey&&"z"===ev.key&&(undo_redo_1.default.Undo(),_this.inspector.updateDisplay(),ev.preventDefault(),ev.stopPropagation())}),undo_redo_1.default.onRedo=function(e){return tools_1.default.SetWindowTitle(_this.projectFileName+" *")},document.addEventListener("keyup",function(ev){!code_1.default.HasOneFocused()&&ev.ctrlKey&&"y"===ev.key&&(undo_redo_1.default.Redo(),_this.inspector.updateDisplay(),ev.preventDefault(),ev.stopPropagation())}),window.addEventListener("blur",function(){return _this.core.renderScenes=!1}),window.addEventListener("focus",function(){return _this.core.renderScenes=!0}),this.core.engine.getRenderingCanvas().addEventListener("focus",function(){return _this._canvasFocused=!0}),this.core.engine.getRenderingCanvas().addEventListener("blur",function(){return _this._canvasFocused=!1}),this.core.engine.getRenderingCanvas().addEventListener("mousemove",function(){return _this._canvasFocused=!0}),this.core.engine.getRenderingCanvas().addEventListener("mouseleave",function(){return _this._canvasFocused=!1});var shiftDown=!1;document.addEventListener("keydown",function(ev){return!shiftDown&&(shiftDown="Shift"===ev.key)}),document.addEventListener("keyup",function(ev){return"Shift"===ev.key&&(shiftDown=!1)}),document.addEventListener("keyup",function(ev){return _this._canvasFocused&&!code_1.default.HasOneFocused()&&"b"===ev.key&&_this.preview.setToolClicked("bounding-box")}),document.addEventListener("keyup",function(ev){return _this._canvasFocused&&!code_1.default.HasOneFocused()&&"t"===ev.key&&_this.preview.setToolClicked("position")}),document.addEventListener("keyup",function(ev){return _this._canvasFocused&&!code_1.default.HasOneFocused()&&"r"===ev.key&&_this.preview.setToolClicked("rotation")}),document.addEventListener("keyup",function(ev){if(_this._canvasFocused&&"f"===ev.key){var node=_this.core.currentSelectedObject;if(!node)return;scene_picker_1.default.CreateAndPlayFocusAnimation(_this.camera.getTarget(),node.globalPosition||node.getAbsolutePosition(),_this.camera)}}),document.addEventListener("keydown",function(ev){return(ev.ctrlKey||ev.metaKey)&&"s"===ev.key&&ev.preventDefault()}),document.addEventListener("keyup",function(ev){return(ev.ctrlKey||ev.metaKey)&&!shiftDown&&"s"===ev.key&&project_exporter_1.default.ExportProject(_this)}),document.addEventListener("keyup",function(ev){return(ev.ctrlKey||ev.metaKey)&&shiftDown&&"S"===ev.key&&project_exporter_1.default.ExportProject(_this,!0)}),document.addEventListener("keyup",function(ev){if(!tools_1.default.IsFocusingInputElement()&&(tree_1.default.HasOneFocused()||_this._canvasFocused))switch(ev.keyCode){case 46:_this.graph.getAllSelected().forEach(function(s){s&&_this.graph.onMenuClick("remove",s)})}}),window.addEventListener("beforeunload",function(){if(project_code_editor_1.default.CloseAll(),tools_1.default.IsStandalone){var state=JSON.stringify(_this.resizableLayout.element.toConfig());localStorage.setItem("babylonjs-editor-layout-state",state),localStorage.setItem("babylonjs-editor-plugins",JSON.stringify(Object.keys(_this.plugins))),localStorage.setItem("babylonjs-editor-theme-name",theme_1.default.ThemeName),localStorage.setItem("babylonjs-editor-layout-version",Editor.LayoutVersion)}})},Editor.prototype._runPlugin=function(url){for(var params=[],_i=1;_i<arguments.length;_i++)params[_i-1]=arguments[_i];return __awaiter(this,void 0,void 0,function(){var plugin,args,instance,id;return __generator(this,function(_a){switch(_a.label){case 0:return[4,tools_1.default.ImportScript(url)];case 1:return plugin=_a.sent(),args=[plugin.default,this].concat(params),plugin.default._Loaded||(plugin.default.OnLoaded(this),plugin.default._Loaded=!0),instance=new(Function.prototype.bind.apply(plugin.default,args)),id=instance.name.replace(/ /g,""),instance.divElement=document.getElementById(id)||tools_1.default.CreateElement("div",id,{width:"100%",height:"100%"}),[2,instance]}})})},Editor.prototype._createFilesInput=function(){var _this=this;this.filesInput=new babylonjs_1.FilesInput(this.core.engine,null,null,function(p){},null,function(remaining){},function(files){return scene_loader_1.default.OnStartingProcessingFiles(_this,files)},function(sceneFile){return scene_loader_1.default.OnReloadingScene(_this,sceneFile)},function(file,scene,message){return dialog_1.default.Create("Error when loading scene",message,null)}),this.filesInput.monitorElementForDragNDrop(document.getElementById("renderCanvasEditor"))},Editor.prototype._checkUpdates=function(){return __awaiter(this,void 0,void 0,function(){var _a,packageJson,newVersion,answer,saveDirectory,list,platform,path,lastProgress_1,data,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:return _a=Editor,[4,request_1.default.Get("/version")];case 1:return _a.EditorVersion=_b.sent(),tools_1.default.Version=Editor.EditorVersion,tools_1.default.SetWindowTitle("Untitled"),[4,tools_1.default.LoadFile("http://editor.babylonjs.com/package.json?"+Date.now())];case 2:return packageJson=_b.sent(),newVersion=JSON.parse(packageJson).version,Editor.EditorVersion<newVersion?[4,dialog_1.default.Create("Update available!","An update is available! (v"+newVersion+"). Would you like to download it?")]:[3,9];case 3:return answer=_b.sent(),"No"===answer?[2]:[4,request_1.default.Get("/files:/paths?type=openDirectory")];case 4:return saveDirectory=_b.sent(),[4,request_1.default.Get("http://editor.babylonjs.com/assets/update/versions.json?"+Date.now())];case 5:return list=_b.sent(),[4,request_1.default.Get("/osplatform")];case 6:return platform=_b.sent(),path=list[newVersion][platform],lastProgress_1="",[4,tools_1.default.LoadFile("http://editor.babylonjs.com/"+path,!0,function(data){var progress=(100*data.loaded/data.total).toFixed(1);progress!==lastProgress_1&&(_this.toolbar.notifyRightMessage("Downloading update... "+progress+"%"),lastProgress_1=progress)})];case 7:return data=_b.sent(),this.toolbar.notifyRightMessage(""),[4,request_1.default.Put("/files:/write?name="+tools_1.default.GetFilename(path)+"&folder="+saveDirectory[0],tools_1.default.CreateFile(new Uint8Array(data),path),{"Content-Type":"application/octet-stream"})];case 8:_b.sent(),window_1.default.CreateAlert("Update has been downloaded and available at: <h3>"+saveDirectory[0]+"</h3>","Update downloaded!"),_b.label=9;case 9:return[2]}})})},Editor.LayoutVersion="2.2.0",Editor.EditorVersion=null,Editor}();exports.default=Editor}),$__System.registerDynamic("24",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Layout=function(){function Layout(name){this.element=null,this.panels=[],this.name=name}return Layout.prototype.getPanelSize=function(type){var panel=this.getPanelFromType(type);return{width:panel.width,height:panel.height}},Layout.prototype.setPanelSize=function(type,size){this.element.sizeTo(type,size)},Layout.prototype.hidePanel=function(type){this.getPanelFromType(type).hidden||this.element.hide(type)},Layout.prototype.showPanel=function(type){this.getPanelFromType(type).hidden&&this.element.show(type)},Layout.prototype.lockPanel=function(type,message,showSpinner){this.element.lock(type,message,showSpinner)},Layout.prototype.unlockPanel=function(type){this.element.unlock(type)},Layout.prototype.getPanelFromType=function(type){return this.element.get(type)},Layout.prototype.build=function(parentId){this.element=$("#"+parentId).w2layout({name:this.name,panels:this.panels})},Layout}();exports.default=Layout}),$__System.registerDynamic("61",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var List=function(){function List(name){this.element=null,this.input=null,this.items=[],this.name=name}return List.prototype.setItems=function(items){this.items=items;var field=this.element.data("w2field");field.options.items=items.map(function(v){return{id:v,text:v}}),field.refresh()},List.prototype.setSelected=function(text){var field=this.element.data("w2field"),item=field.options.items.find(function(i){return i.text===text});item&&(field.options.selected=item,field.refresh())},List.prototype.getSelected=function(){return this.element.val()},List.prototype.build=function(parent,style){var _this=this;void 0===style&&(style=""),this.input=$('<input type="list" style="'+style+'" />'),$(parent).append(this.input),this.element=this.input.w2field("list",{items:this.items.map(function(v){return{id:v,text:v}}),selected:{id:this.items[0],text:this.items[0]},renderItem:function(item){return item.text},renderDrop:function(item){return item.text},compare:function(item,search){return-1!==item.text.indexOf(search)}}),this.element.change(function(ev){return _this.onChange&&_this.onChange(_this.element.val())})},List}();exports.default=List}),$__System.registerDynamic("62",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Graph=function(){function Graph(name){this.name=name}return Graph.prototype.clear=function(){var toRemove=[];this.element.nodes.forEach(function(n){return toRemove.push(n.id)}),this.element.remove.apply(this.element,toRemove),this.element.nodes=[],this.element.refresh()},Graph.prototype.add=function(node,parent){this.element.add(parent||this.element,node)},Graph.prototype.addMenu=function(menu){this.element.menu.push(menu)},Graph.prototype.setSelected=function(id){this.element.select(id)},Graph.prototype.getSelected=function(){return this.element.get(this.element.selected)},Graph.prototype.build=function(parent){var _this=this;this.element=("string"==typeof parent?$("#"+parent):$(parent)).w2sidebar({name:this.name,img:"icon-container",keyboard:!1,nodes:[],topHTML:this.topContent,bottomHTML:this.bottomContent,onClick:function(event){_this.onClick&&event.node&&_this.onClick(event.node.id,event.node.data)},dblClick:function(event){if(_this.onDbleClick){var node=_this.element.get(event);node&&_this.onDbleClick(event,node.data)}},onMenuClick:function(event){if(_this.onMenuClick){var node=_this.element.get(event.target);_this.onMenuClick(event.menuItem.id,node)}}})},Graph}();exports.default=Graph}),$__System.registerDynamic("16",["f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tools_1=$__require("f"),ThemeSwitcher=function(){function ThemeSwitcher(){}return Object.defineProperty(ThemeSwitcher,"ThemeName",{get:function(){return this._ThemeName},set:function(name){switch(this._ThemeName=name,name){case"Light":this.Apply(this.LightThemeUrls);break;case"Dark":this.Apply(this.DarkThemeUrls)}},enumerable:!0,configurable:!0}),ThemeSwitcher.Apply=function(urls){return __awaiter(this,void 0,void 0,function(){var _i,urls_1,url,i,s,href;return __generator(this,function(_a){switch(_a.label){case 0:if(!tools_1.default.IsStandalone)return[2];_i=0,urls_1=urls,_a.label=1;case 1:return _i<urls_1.length?(url=urls_1[_i],[4,tools_1.default.ImportScript("./"+url)]):[3,4];case 2:_a.sent(),_a.label=3;case 3:return _i++,[3,1];case 4:for(i=0;i<document.styleSheets.length;i++)s=document.styleSheets[i],(href=s.href)&&(this._IsInPath(href,this.LightThemeUrls)&&(s.disabled="Light"!==this._ThemeName),this._IsInPath(href,this.DarkThemeUrls)&&(s.disabled="Dark"!==this._ThemeName));return[2]}})})},ThemeSwitcher._IsInPath=function(url,urls){if(-1!==urls.indexOf(url))return!0;for(var _i=0,urls_2=urls;_i<urls_2.length;_i++){var u=urls_2[_i];if(-1!==url.indexOf(u))return!0}return!1},ThemeSwitcher.LightThemeUrls=["node_modules/w2ui/w2ui.css","node_modules/golden-layout/src/css/goldenlayout-light-theme.css"],ThemeSwitcher.DarkThemeUrls=["node_modules/golden-layout/src/css/goldenlayout-dark-theme.css","css/dark.css"],ThemeSwitcher._ThemeName="Light",ThemeSwitcher}();exports.default=ThemeSwitcher}),$__System.registerDynamic("5e",["f","16"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tools_1=$__require("f"),theme_1=$__require("16"),CodeEditor=function(){function CodeEditor(language,value){void 0===language&&(language="javascript"),void 0===value&&(value="// Some Code"),this.editor=null,this._language=language,this._defaultValue=value}return CodeEditor.RemoveExtraLib=function(caller){var lib=this.ExtraLibs.find(function(el){return el.caller===caller}),index=this.ExtraLibs.indexOf(lib);-1!==index&&this.ExtraLibs.splice(index,1)},CodeEditor.HasOneFocused=function(){for(var _i=0,_a=this.Instances;_i<_a.length;_i++){if(_a[_i].isFocused())return!0}return!1},CodeEditor.prototype.getValue=function(){return this.editor.getValue()},CodeEditor.prototype.setValue=function(value){this.editor.setValue(value)},CodeEditor.prototype.focus=function(){this.editor.focus()},CodeEditor.prototype.dispose=function(){this.editor.dispose();var index=CodeEditor.Instances.indexOf(this.editor);-1!==index&&CodeEditor.Instances.splice(index,1)},CodeEditor.prototype.build=function(parentId,caller){return void 0===caller&&(caller=window),__awaiter(this,void 0,void 0,function(){var promises,results,content_1,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return"string"==typeof parentId&&(parentId="#"+parentId),CodeEditor.ExternalLibraries?[3,2]:(promises=CodeEditor.Libs.map(function(l){return tools_1.default.LoadFile(l,!1)}),[4,Promise.all(promises)]);case 1:results=_a.sent(),content_1="",results.forEach(function(r){return content_1+=r+"\n"}),content_1+="\n                declare var scene: BABYLON.Scene;\n                declare var mesh: BABYLON.Mesh;\n                declare var pointlight: BABYLON.PointLight;\n                declare var camera: BABYLON.Camera;\n                declare var universalcamera: BABYLON.UniversalCamera;\n                declare var spotlight: BABYLON.SpotLight;\n                declare var dirlight: BABYLON.DirectionalLight;\n                declare var hemlight: BABYLON.HemisphericLight;\n                declare var groundmesh: BABYLON.GroundMesh;\n                declare var particleSystem: BABYLON.ParticleSystem;\n                declare var gpuParticleSystem: BABYLON.GPUParticleSystem;\n\n                declare var tools: BehaviorCodeTools;\n                declare var mobile: Mobile;\n            ",CodeEditor.ExternalLibraries=content_1,_a.label=2;case 2:return[4,tools_1.default.ImportScript("typescript")];case 3:return _a.sent(),this.editor=caller.monaco.editor.create($(parentId)[0],{value:this._defaultValue,language:this._language,automaticLayout:!0,selectionHighlight:!0,theme:caller!==window||"Dark"===theme_1.default.ThemeName?"vs-dark":void 0}),CodeEditor.ExtraLibs.find(function(el){return el.caller===caller})||(caller.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({experimentalDecorators:!0,target:5,allowNonTsExtensions:!0}),CodeEditor.ExtraLibs.push({lib:caller.monaco.languages.typescript.typescriptDefaults.addExtraLib(CodeEditor.ExternalLibraries,"CodeEditor"),caller:caller})),this.editor.onDidChangeModelContent(function(){_this.onChange&&_this.onChange(_this.editor.getValue())}),CodeEditor.Instances.push(this.editor),[2]}})})},CodeEditor.prototype.transpileTypeScript=function(source,moduleName,config){return ts.transpile(source,config||{module:"none",target:"es5",experimentalDecorators:!0},moduleName+".ts",void 0,moduleName+".ts")},CodeEditor.TranspileTypeScript=function(source,moduleName,config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,tools_1.default.ImportScript("typescript")];case 1:return _a.sent(),[2,ts.transpile(source,config||{module:"none",target:"es5",experimentalDecorators:!0},moduleName+".ts",void 0,moduleName+".ts")]}})})},CodeEditor.GetTypings=function(){return __awaiter(this,void 0,void 0,function(){var result,_i,_a,l,_b,_c,_d;return __generator(this,function(_e){switch(_e.label){case 0:result=[],_i=0,_a=this.Libs,_e.label=1;case 1:return _i<_a.length?(l=_a[_i],_c=(_b=result).push,_d={name:"typings/"+tools_1.default.GetFilename(l),id:l},[4,tools_1.default.LoadFile(l,!1)]):[3,4];case 2:_c.apply(_b,[(_d.content=_e.sent(),_d)]),_e.label=3;case 3:return _i++,[3,1];case 4:return[2,result]}})})},CodeEditor.CreateWindowedEditor=function(options){return __awaiter(this,void 0,void 0,function(){var popup,_this=this;return __generator(this,function(_a){return popup=tools_1.default.OpenPopup("./code-editor.html#"+name,name,1280,800),popup.document.title=name,popup.addEventListener("editorloaded",function(){return __awaiter(_this,void 0,void 0,function(){var code;return __generator(this,function(_a){switch(_a.label){case 0:return code=new CodeEditor("javascript"),[4,code.build(popup.document.getElementById("EDITOR-DIV"),popup)];case 1:return _a.sent(),code.onChange=function(value){options.data?(options.data[options.property]=code.getValue(),options.data===options.baseData&&options.baseEditor.setValue(options.data[options.property])):options.baseData&&(options.baseData[options.property]=options.baseEditor.getValue())},code.setValue(options.baseData[options.property]),[2]}})})}),popup.addEventListener("beforeunload",function(){CodeEditor.RemoveExtraLib(popup)}),[2]})})},CodeEditor.ExternalLibraries=null,CodeEditor.ExtraLibs=[],CodeEditor.CustomLibs={},CodeEditor.Instances=[],CodeEditor.Libs=["assets/typings/babylon.module.d.ts","assets/typings/babylon.gui.module.d.ts","assets/typings/babylonjs.materials.module.d.ts","assets/typings/babylonjs.proceduralTextures.module.d.ts","assets/typings/babylonjs.postProcess.module.d.ts","assets/templates/material-creator/custom-material.d.ts","assets/templates/post-process-creator/custom-post-process.d.ts","assets/templates/code/path-finder.d.ts","assets/templates/code/tools.d.ts","assets/templates/code/mobile.d.ts"],CodeEditor}();exports.default=CodeEditor}),$__System.registerDynamic("21",["63","25"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0}),$__require("63");var context_menu_1=$__require("25"),Tree=function(){function Tree(name){this.wholerow=!1,this.keyboard=!1,this.multipleSelection=!1,this.element=null,this.currentSelectedNode="",this.moving=!1,this.renaming=!1,this.selecting=!1,this.isFocused=!1,this.name=name}return Tree.HasOneFocused=function(){for(var _i=0,_a=this.Instances;_i<_a.length;_i++){if(_a[_i].isFocused)return!0}return!1},Tree.prototype.clear=function(root){this.element.jstree().delete_node(this.element.jstree().get_node(root||"#").children)},Tree.prototype.add=function(node,parent){var id=this.element.jstree().create_node(parent||"#",{id:node.id,text:node.text,data:node.data,icon:node.img?"w2ui-icon "+node.img:"w2ui-icon icon-error"});return this.element.jstree().get_node(id)},Tree.prototype.remove=function(id){this.element.jstree().delete_node(id)},Tree.prototype.select=function(id){id!==this.currentSelectedNode&&(this.currentSelectedNode=id,this.selecting=!0,this.element.jstree().deselect_all(!0),this.element.jstree().select_node(id),this.selecting=!1)},Tree.prototype.setType=function(id,type){void 0===type&&(type="default");var node=this.get(id);node&&this.element.jstree().set_type(node,type)},Tree.prototype.getType=function(id){var node=this.get(id);return node?this.element.jstree().get_type(node,!0).type:null},Tree.prototype.getSelected=function(){var id=this.element.jstree().get_selected()[0];return id?this.element.jstree().get_node(id):null},Tree.prototype.getAllSelected=function(){var _this=this;return this.element.jstree().get_selected().map(function(id){return _this.get(id)})},Tree.prototype.get=function(id){return this.element.jstree().get_node(id)},Tree.prototype.rename=function(id,name){this.renaming=!0,this.element.jstree("rename_node",id,name),this.renaming=!1},Tree.prototype.expand=function(id){this.element.jstree("open_node",id)},Tree.prototype.getNodesCount=function(){return this.element.jstree().get_json("#",{flat:!0}).length},Tree.prototype.setParent=function(id,parentId){var node=this.get(id);if(node){var parent=this.get(parentId);parent&&(this.moving=!0,this.element.jstree().move_node(node,parent),this.moving=!1,this.expand(parentId))}},Tree.prototype.markNode=function(id,marked){var dom=this.element.jstree().get_node(id,!0);if(dom){dom.children(".jstree-anchor").children(".jstree-themeicon").css("border",marked?"dotted":"")}},Tree.prototype.search=function(value){this.element.jstree().search(value)},Tree.prototype.destroy=function(){this.element.destroy(!1),this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onMenuClick=null,this.onCanDrag=null,this.onDrag=null},Tree.prototype.build=function(parentId){var _this=this,plugins=["contextmenu","dnd","search","state","types"];this.wholerow&&plugins.push("wholerow"),this.keyboard&&plugins.push("hotkeys"),this.element=$("#"+parentId).jstree({core:{check_callback:!0,multiple:this.multipleSelection},dnd:{use_html5:!0,is_draggable:function(nodes){var node=nodes[0];return _this.onCanDrag&&_this.onCanDrag(node.id,node.data)}},plugins:plugins,search:{show_only_matches:!0,show_only_matches_children:!0},types:{bold:{a_attr:{style:"font-weight: bold !important;"}},italic:{a_attr:{style:"font-style: italic !important;"}},boldItalic:{a_attr:{style:"font-weight: bold !important; font-style: italic !important;"}}},contextmenu:{items:function(){if(!_this.onContextMenu)return null;var lastSelected=_this.getSelected(),allSelected=_this.getAllSelected();if(!lastSelected)return null;var items=_this.onContextMenu(lastSelected.id,lastSelected.data),result={};if(items.forEach(function(i){i.separatorBefore&&(result[i.id+"before"]="---------"),result[i.id]={name:i.text,callback:function(){return allSelected.forEach(function(n){return i.callback(n)})}},i.separatorAfter&&(result[i.id+"after"]="---------")}),items.length>0){var domElement=$("#"+lastSelected.id)[0];domElement.classList.contains("ctxmenu")||domElement.classList.add("ctxmenu");var box=domElement.getBoundingClientRect();context_menu_1.default.Show({target:domElement,x:box.x,y:box.y+20},result)}return null}}}),this.element.on("changed.jstree",function(e,data){"select_node"===data.action&&_this.onClick&&!_this.selecting&&_this.onClick(data.node.id,data.node.data)}).on("rename_node.jstree",function(e,data){if(data.old!==data.text&&!_this.renaming&&_this.onRename){_this.onRename(data.node.id,data.text,data.node.data)||_this.rename(data.node.id,data.old)}}).on("copy_node.jstree",function(e,data){var parent=_this.get(data.node.parent);_this.onCopy&&_this.onCopy(data.original,data.node,parent.data)||_this.remove(data.node.id),_this.element.jstree().set_id(data.node,data.node.id)}).on("move_node.jstree",function(e,data){if(_this.onDrag&&!_this.moving){var node=data.node,parent=_this.get(data.parent);if(node&&parent){_this.onDrag(node.data,parent.data)||_this.setParent(node.id,data.old_parent)}}}).on("close_node.jstree",function(e,data){var node=data.node;node.onExpand&&node.children.slice().forEach(function(c){return _this.remove(c)})}).on("open_node.jstree",function(e,data){var node=data.node;node.onExpand&&(node.children.slice().forEach(function(c){return _this.remove(c)}),node.onExpand())}),this.element.dblclick(function(){if(_this.onDblClick){var node=_this.getSelected();node&&_this.onDblClick(node.id,node.data)}}),this.element.focusin(function(){return _this.isFocused=!0}),this.element.focusout(function(){return _this.isFocused=!1}),Tree.Instances.push(this)},Tree.Instances=[],Tree}();exports.default=Tree}),$__System.registerDynamic("25",[],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var ContextMenu=function(){function ContextMenu(){}return ContextMenu.Init=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,System.import("node_modules/jquery-contextmenu/dist/jquery.contextMenu.js")];case 1:return _a.sent(),[4,System.import("node_modules/jquery-contextmenu/dist/jquery.ui.position.js")];case 2:return _a.sent(),[4,System.import("node_modules/jquery-contextmenu/dist/jquery.contextMenu.min.css")];case 3:return _a.sent(),$.contextMenu({selector:".ctxmenu",trigger:"none",build:function($trigger,e){return e.preventDefault(),{callback:function(key){_this.Items[key].callback(key),_this.OnItemClicked&&_this.OnItemClicked(key)},items:_this.Items}}}),[2]}})})},ContextMenu.ConfigureElement=function(element,items,callback){var _this=this;element.addEventListener("contextmenu",function(ev){_this.Items=items,_this.Show(ev),callback&&callback(ev)})},ContextMenu.Show=function(mouseEvent,items){items&&(this.Items=items),$(mouseEvent.target).contextMenu({x:mouseEvent.x,y:mouseEvent.y})},ContextMenu.Items={},ContextMenu}();exports.default=ContextMenu}),$__System.registerDynamic("5d",["64","f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var GoldenLayout=$__require("64"),tools_1=$__require("f"),ResizableLayout=function(){function ResizableLayout(name){this.element=null,this.panels=[],this.showCloseIcon=!1,this.containers={},this.configs={},this.name=name}return ResizableLayout.prototype.getPanelSize=function(name){var panel=this.containers[name];return{width:panel.width,height:panel.height}},ResizableLayout.prototype.setPanelSize=function(name,value){var item=this.element.root.getItemsById(name)[0];item&&(item.config.height=value,this.element.updateSize())},ResizableLayout.prototype.showPanelTab=function(name){var container=this.containers[name];if(container&&container.parent){var tab=container.parent,stack=tab.parent;if(stack)try{stack.setActiveContentItem(tab)}catch(e){}}},ResizableLayout.prototype.removePanel=function(name){var container=this.containers[name];if(container&&container.parent){container.off("show"),container.off("resize"),container.off("destroy");try{container.close()}catch(e){}delete this.containers[name]}},ResizableLayout.prototype.addPanelToStack=function(stackId,config){this.configs[config.componentName]=config;try{var container=(this.element.getComponent(config.componentName),this.containers[config.componentName]);if(container)return this._configureContainer(container,config)}catch(e){this._registerComponents([config])}this.element.root.getItemsById(stackId)[0].addChild(config)},ResizableLayout.prototype.getTabsCount=function(stackId){var item=this.element.root.getItemsById(stackId)[0];return item&&item.config.content?item.config.content.length:-1},ResizableLayout.prototype.build=function(parentId){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this.element=new GoldenLayout({settings:{showPopoutIcon:!1,showCloseIcon:this.showCloseIcon,showMaximiseIcon:!0},dimensions:{minItemWidth:240,minItemHeight:180},labels:{close:"Close",maximise:"Maximize",minimise:"Minimize"},content:this.panels},$("#"+parentId)),this.panels.forEach(function(p){return _this._registerComponents(p.content)}),this.element.init(),tools_1.default.IsStandalone?[4,System.import("./node_modules/golden-layout/src/css/goldenlayout-base.css")]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2]}})})},ResizableLayout.prototype._registerComponents=function(content){var _this=this;content&&content.forEach(function(c){"component"===c.type&&_this.element.registerComponent(c.componentName,function(container){_this.containers[c.componentName]=container,_this._configureContainer(container,c)}),_this._registerComponents(c.content)})},ResizableLayout.prototype._configureContainer=function(container,lastConfig){var _this=this,config=this.configs[lastConfig.componentName]||lastConfig;config.html&&container.getElement().append("function"==typeof config.html?config.html():config.html),container.on("resize",function(){return _this.onPanelResize&&_this.onPanelResize()}),container.on("destroy",function(){return config.onClose&&config.onClose()});var firstShow=!0;container.on("show",function(){if(firstShow)return firstShow=!1;config.onClick&&config.onClick(),setTimeout(function(){return window.dispatchEvent(new Event("resize"))},0)})},ResizableLayout}();exports.default=ResizableLayout}),$__System.registerDynamic("65",["c","10","f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),window_1=$__require("10"),tools_1=$__require("f"),TexturePicker=function(){function TexturePicker(){}return TexturePicker.Show=function(scene,selectedTexture,allowCubes,onlyCubes){return void 0===selectedTexture&&(selectedTexture=null),void 0===allowCubes&&(allowCubes=!1),void 0===onlyCubes&&(onlyCubes=!1),__awaiter(this,void 0,void 0,function(){var file,_a,win,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:return this._SelectedTexture=selectedTexture,this._Images=[],this._DefaultImageSource?[3,3]:[4,tools_1.default.GetFile("assets/textures/waitlogo.png")];case 1:return file=_b.sent(),_a=this,[4,tools_1.default.ReadFileAsBase64(file)];case 2:_a._DefaultImageSource=_b.sent(),_b.label=3;case 3:return win=new window_1.default("TexturePicker"),win.body='\n            <input id="TEXTURE-PICKER-SEARCH" placeholder="Search..." style="width: 100%; height: 35px;" />\n            <div id="TEXTURE-PICKER" style="width: 100%; height: calc(100% - 35px);"></div>\n        ',win.title="Choose Texture...",win.buttons=["Ok","Cancel"],[4,win.open()];case 4:return _b.sent(),[2,new Promise(function(resolve,reject){_this._Fill(scene,selectedTexture,allowCubes,onlyCubes,function(texture){resolve(texture),win.close()}),win.onClose=function(){return reject("User decided to not select any texture.")},win.onButtonClick=function(id){if("Cancel"===id)return win.close(),reject("User decided to not select any texture.");_this._SelectedTexture&&(resolve(_this._SelectedTexture),win.close())}})]}})})},TexturePicker._Fill=function(scene,selectedTexture,allowCubes,onlyCubes,callback){var _this=this,rootDiv=$("#TEXTURE-PICKER")[0];scene.textures.forEach(function(texture){if((allowCubes||!(texture instanceof babylonjs_1.CubeTexture))&&(!onlyCubes||texture instanceof babylonjs_1.CubeTexture)){var parent=tools_1.default.CreateElement("div",texture.name+texture.uniqueId+"div",{position:"relative",width:"100px",height:"100px",float:"left",margin:"10px"}),title=tools_1.default.CreateElement("small",texture.name+"text",{float:"left",width:"100px",left:"50%",top:"8px",transform:"translate(-50%, -50%)","text-overflow":"ellipsis","white-space":"nowrap",overflow:"hidden",position:"relative"});title.innerText=texture.name;var img=tools_1.default.CreateElement("img",texture.name,{width:"100px",height:"100px"});if(_this._Images.push({element:img,texture:texture}),texture===selectedTexture&&_this._HighLight(img),texture instanceof babylonjs_1.CubeTexture||!texture.url)img.src=_this._DefaultImageSource;else if(texture instanceof babylonjs_1.Texture){var url=texture.url.replace("file:","").toLowerCase(),file=babylonjs_1.FilesInputStore.FilesToLoad[url];if(file){var url_1=URL.createObjectURL(file);img.src=url_1,img.onload=function(){URL.revokeObjectURL(url_1)}}else img.src=_this._DefaultImageSource}img.addEventListener("click",function(ev){_this._HighLight(img),_this._SelectedTexture=texture}),img.addEventListener("dblclick",function(ev){_this._SelectedTexture=texture,callback(texture)}),parent.appendChild(img),parent.appendChild(title),rootDiv.appendChild(parent)}});var search=$("#TEXTURE-PICKER-SEARCH");search.keyup(function(ev){var val=search.val().toLowerCase();_this._Images.forEach(function(img){-1===img.element.id.toLowerCase().indexOf(val)?$(img.element.parentElement).hide():$(img.element.parentElement).show()});var first=_this._Images.find(function(i){return!$(i.element).is(":hidden")});first&&(_this._SelectedTexture=first.texture,_this._HighLight(first.element)),13===ev.keyCode&&callback(_this._SelectedTexture)}),setTimeout(function(){return search.focus()},1)},TexturePicker._HighLight=function(image){this._Images.forEach(function(img){img.element.style.backgroundColor="",img.element.style.borderRadius="",img.element.style.border=""}),image.style.backgroundColor="rgba(0, 0, 0, 0.25)",image.style.borderRadius="10px",image.style.border="5px solid grey"},TexturePicker._DefaultImageSource=null,TexturePicker._SelectedTexture=null,TexturePicker._Images=[],TexturePicker}();exports.default=TexturePicker}),$__System.registerDynamic("66",["c","67","65","f","15"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),dat=$__require("67"),texture_picker_1=$__require("65"),tools_1=$__require("f"),undo_redo_1=$__require("15"),Edition=function(){function Edition(){}return Edition.prototype.addFolder=function(name){return this.element.addFolder(name)},Edition.prototype.add=function(target,propName,other){return this.element.add(target,propName,other)},Edition.prototype.remove=function(){this.element.destroy(),this.element.domElement.parentNode.removeChild(this.element.domElement),this.element=null},Edition.prototype.updateDisplay=function(folder){folder||(folder=this.element),folder.__controllers.forEach(function(c){return c.updateDisplay()});for(var f in folder.__folders)this.updateDisplay(folder.__folders[f])},Edition.prototype.onFinishChange=function(folder,callback){folder||(folder=this.element),folder.__controllers.forEach(function(c){var existingFn=c.__onFinishChange;c.onFinishChange(function(result){callback(c.property,result,c.object,c.initialValue),existingFn&&existingFn(result,c.initialValue)})});for(var f in folder.__folders)this.onFinishChange(folder.__folders[f],callback)},Edition.prototype.onChange=function(folder,callback){folder||(folder=this.element),folder.__controllers.forEach(function(c){var existingFn=c.__onChange;c.onChange(function(result){callback(c.property,result,c.object,c.initialValue),existingFn&&existingFn(result,c.initialValue)})});for(var f in folder.__folders)this.onChange(folder.__folders[f],callback)},Edition.prototype.getController=function(property,parent){return void 0===parent&&(parent=this.element),parent.__controllers.find(function(c){return c.property===property})},Edition.prototype.build=function(parentId){var parent=$("#"+parentId);this.element=new dat.GUI({autoPlace:!1,scrollable:!0}),parent[0].appendChild(this.element.domElement),this.element.useLocalStorage=!0,this.element.width=parent.width(),tools_1.default.IsStandalone&&tools_1.default.ImportScript("./css/dat.gui.css")},Edition.prototype.addHexColor=function(target,propName){return this.element.addColor(target,propName)},Edition.prototype.addColor=function(parent,name,color,callback){var _this=this,folder=parent.addFolder(name),picker={callback:function(){var input=document.createElement("input");input.type="color",input.value=color.toHexString(),input.addEventListener("change",function(ev){var result=babylonjs_1.Color3.FromHexString(input.value);color.r=result.r,color.g=result.g,color.b=result.b,_this.updateDisplay(),callback&&callback()},!1),input.select(),input.click()}};return folder.add(picker,"callback").name("Color Picker"),folder.add(color,"r").min(0).max(1).step(.01).onChange(function(){return callback&&callback()}),folder.add(color,"g").min(0).max(1).step(.01).onChange(function(){return callback&&callback()}),folder.add(color,"b").min(0).max(1).step(.01).onChange(function(){return callback&&callback()}),color instanceof babylonjs_1.Color4&&(color.a=color.a||0,folder.add(color,"a").min(0).max(1).step(.01).onChange(function(){return callback&&callback()})),folder},Edition.prototype.addVector=function(parent,name,vector,callback){var folder=parent.addFolder(name);return folder.add(vector,"x").step(.01).onChange(function(){return callback&&callback()}),folder.add(vector,"y").step(.01).onChange(function(){return callback&&callback()}),(vector instanceof babylonjs_1.Vector3||vector instanceof babylonjs_1.Vector4)&&folder.add(vector,"z").step(.01).onChange(function(){return callback&&callback()}),vector instanceof babylonjs_1.Vector4&&folder.add(vector,"w").step(.01).onChange(function(){return callback&&callback()}),folder},Edition.prototype.addTexture=function(parent,editor,scene,property,object,allowCubes,onlyCubes,callback){var _this=this;void 0===allowCubes&&(allowCubes=!1),void 0===onlyCubes&&(onlyCubes=!1);var textures=["None"];scene.textures.forEach(function(t){var isCube=t instanceof babylonjs_1.CubeTexture;isCube&&!allowCubes||!isCube&&onlyCubes||textures.push(t.name)});var target={texture:object[property]?object[property].name:"None",browse:function(){return __awaiter(_this,void 0,void 0,function(){var from,to;return __generator(this,function(_a){switch(_a.label){case 0:return from=object[property],[4,texture_picker_1.default.Show(scene,object[property],allowCubes,onlyCubes)];case 1:return to=_a.sent(),object[property]=to,undo_redo_1.default.Push({baseObject:object,object:object,property:property,from:from,to:to}),to&&(target.texture=to.name),editor.inspector.updateDisplay(),[2]}})})}},controller=parent.add(target,"texture",textures);return controller.onFinishChange(function(r){var currentTexture=object[property],texture=scene.textures.find(function(t){return t.name===r});object[property]=texture,callback&&callback(texture),undo_redo_1.default.Pop(),undo_redo_1.default.Push({object:object,from:currentTexture,to:texture,property:property})}),parent.add(target,"browse").name("Browse Texture..."),controller},Edition}();exports.default=Edition}),$__System.registerDynamic("27",["66"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var edition_1=$__require("66"),AbstractEditionTool=function(){function AbstractEditionTool(){this.editor=null,this.object=null,this.tool=null,this.state=null}return AbstractEditionTool.prototype.update=function(object){var _this=this;this.object=object;var lastScroll=0;this.tool&&(lastScroll=this.tool.element.domElement.scrollTop,this.state=this._saveState(),this.tool.remove()),this.tool=new edition_1.default,this.tool.build(this.divId),this.tool.element.onResize(),setTimeout(function(){_this.tool.element.domElement.scrollTop=lastScroll,_this._restoreState()},0)},AbstractEditionTool.prototype.clear=function(){},AbstractEditionTool.prototype.setTabName=function(name){this.editor.inspector.tabs.get(this.divId).caption=name,this.editor.inspector.tabs.refresh()},AbstractEditionTool.prototype._saveState=function(root){void 0===root&&(root=this.tool.element);var state={};for(var key in root.__folders){var f=root.__folders[key];state[key]={closed:f.closed,children:this._saveState(f)}}return state},AbstractEditionTool.prototype._restoreState=function(root,rootState){void 0===root&&(root=this.tool.element),void 0===rootState&&(rootState=this.state);for(var key in rootState){var f=root.__folders[key];if(f){var value=rootState[key];value.closed?f.close():f.open(),this._restoreState(f,value.children)}}},AbstractEditionTool}();exports.default=AbstractEditionTool}),$__System.registerDynamic("68",[],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var EditorPlugin=function(){function EditorPlugin(name){this._closed=!1,this.name=name}return EditorPlugin.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return $(this.divElement).html(""),this._closed=!0,[2]})})},Object.defineProperty(EditorPlugin.prototype,"closed",{get:function(){return this._closed},enumerable:!0,configurable:!0}),EditorPlugin.prototype.resizeLayout=function(layout,keep,hide){if(this.editor){var panelSize=this.editor.resizableLayout.getPanelSize(this.name);panelSize.width>panelSize.height?(keep.forEach(function(k){return layout.element.sizeTo(k,panelSize.width/2)}),hide.forEach(function(h){return layout.element.show(h)})):(keep.forEach(function(k){return layout.element.sizeTo(k,panelSize.width)}),hide.forEach(function(h){return layout.element.hide(h)}))}},EditorPlugin.OnLoaded=function(editor){},EditorPlugin._Loaded=!1,EditorPlugin}();exports.EditorPlugin=EditorPlugin}),$__System.registerDynamic("1e",["f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tools_1=$__require("f"),CodeProjectEditorFactory=function(){function CodeProjectEditorFactory(){}return CodeProjectEditorFactory.Create=function(editor,options){return __awaiter(this,void 0,void 0,function(){var url,popup,_this=this;return __generator(this,function(_a){return url=tools_1.default.IsElectron()?"./code-editor-debug.html":"./code-editor.html",popup=tools_1.default.OpenPopup(url,name,1280,800),popup.document.title=name,[2,new Promise(function(resolve){popup.addEventListener("editorloaded",function(){return __awaiter(_this,void 0,void 0,function(){var codeProjectEditor;return __generator(this,function(_a){switch(_a.label){case 0:return codeProjectEditor=new popup.CodeEditor(editor),[4,codeProjectEditor.create()];case 1:return _a.sent(),codeProjectEditor.scripts=options.scripts,codeProjectEditor.refresh(),options.scripts[0]&&codeProjectEditor.codeLayout.openCode(options.scripts[0]),options.onOpened&&options.onOpened(),this.Instances.push({instance:codeProjectEditor,popup:popup}),resolve(codeProjectEditor),[2]}})})}),popup.addEventListener("beforeunload",function(){options.onClose&&options.onClose();for(var i=0;i<_this.Instances.length;i++){if(_this.Instances[i].popup===popup){_this.Instances.splice(i,1);break}}})})]})})},CodeProjectEditorFactory.CloseAll=function(){for(var _i=0,_a=this.Instances;_i<_a.length;_i++){_a[_i].popup.close()}this.Instances=[]},CodeProjectEditorFactory.Instances=[],CodeProjectEditorFactory}();exports.default=CodeProjectEditorFactory}),$__System.registerDynamic("17",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Request=function(){function Request(){}return Request.Get=function(url,headers){var _this=this;return new Promise(function(resolve,reject){$.ajax({url:_this._NormalizeUrl(url),type:"GET",headers:headers,success:function(response){return resolve(response)},error:function(err){return reject(err)}})})},Request.Put=function(url,content,headers){var _this=this;return new Promise(function(resolve,reject){$.ajax({url:_this._NormalizeUrl(url),processData:!1,data:content,type:"PUT",headers:headers,success:function(){return resolve()},error:function(err){return reject(err)}})})},Request.Post=function(url,content,headers){var _this=this;return new Promise(function(resolve,reject){$.ajax({url:_this._NormalizeUrl(url),type:"POST",contentType:"application/json",data:content,headers:headers,success:function(){return resolve()},error:function(err){return reject(err)}})})},Request._NormalizeUrl=function(url){return"/"===url[0]?"http://localhost:1337"+url:url},Request}();exports.default=Request}),$__System.registerDynamic("1a",["c","f","17","69","10","2d","1d"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),tools_1=$__require("f"),request_1=$__require("17"),storage_1=$__require("69"),window_1=$__require("10"),picker_1=$__require("2d"),project_exporter_1=$__require("1d"),SceneImporter=function(){function SceneImporter(){}return SceneImporter.CheckOpenedFile=function(editor){return __awaiter(this,void 0,void 0,function(){var path,content,project;return __generator(this,function(_a){switch(_a.label){case 0:return[4,request_1.default.Get("/openedFile")];case 1:return path=_a.sent(),path?[4,tools_1.default.LoadFile(path)]:[2,!1];case 2:return""===(content=_a.sent())?[2,!1]:(project=JSON.parse(content),[4,this.LoadProjectFromFile(editor,path,project)]);case 3:return[2,_a.sent()]}})})},SceneImporter.LoadProjectFromFile=function(editor,path,project,fullLoad){return void 0===fullLoad&&(fullLoad=!0),__awaiter(this,void 0,void 0,function(){var promises,files,folder,failedToLoadList,newlyAddedList,storage,filesList,_i,filesList_1,v,filesList,scene,sceneFiles,lastFilesList_1,_loop_1,_a,_b,f,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return promises=[],files=[],folder=path.replace(tools_1.default.GetFilename(path),""),failedToLoadList=[],newlyAddedList=[],[4,storage_1.default.GetStorage(editor)];case 1:return storage=_c.sent(),project.filesList?[3,3]:[4,storage.getFiles(folder)];case 2:for(filesList=_c.sent(),project.filesList=[],_i=0,filesList_1=filesList;_i<filesList_1.length;_i++)v=filesList_1[_i],v.folder||project.filesList.push(v.name);_c.label=3;case 3:return fullLoad?[4,storage.getFiles(folder)]:[3,6];case 4:return filesList=_c.sent(),scene=filesList.find(function(v){return"scene"===v.name.toLowerCase()}),scene?[4,storage.getFiles(folder+"scene")]:[3,6];case 5:sceneFiles=_c.sent(),lastFilesList_1=project.filesList,project.filesList=sceneFiles.filter(function(v){return!v.folder}).map(function(v){var path="scene/"+v.name;return lastFilesList_1.find(function(f){return f.toLowerCase()===path.toLowerCase()})||newlyAddedList.push(path),path}),_c.label=6;case 6:for(project.filesList.push(tools_1.default.GetFilename(path)),_loop_1=function(f){promises.push(new Promise(function(resolve){return __awaiter(_this,void 0,void 0,function(){var ext,buffer,array;return __generator(this,function(_a){switch(_a.label){case 0:return ext=tools_1.default.GetFileExtension(f),"babylon"!==ext&&"glb"!==ext&&"gltf"!==ext||(babylonjs_1.FilesInputStore.FilesToLoad={}),[4,tools_1.default.LoadFile(folder+f,!0)];case 1:return(buffer=_a.sent())?(array=new Uint8Array(buffer),files.push(tools_1.default.CreateFile(array,tools_1.default.GetFilename(f))),resolve(),[2]):(failedToLoadList.push(f),[2,resolve()])}})})}))},_a=0,_b=project.filesList;_a<_b.length;_a++)f=_b[_a],_loop_1(f);return editor.layout.lockPanel("main","Loading project files...",!0),[4,Promise.all(promises)];case 7:return _c.sent(),editor._showReloadDialog=!1,editor.filesInput.loadFiles({target:{files:files}}),project_exporter_1.default.ProjectPath=folder,failedToLoadList.length>0?window_1.default.CreateAlert("<h3>Failed to load files:</h3></br>"+failedToLoadList.join("</br>")):newlyAddedList.length>0&&window_1.default.CreateAlert("<h3>Loaded new files:</h3></br>"+newlyAddedList.join("</br>")),[2,!0]}})})},SceneImporter.ImportMeshesFromFile=function(editor){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return tools_1.default.OpenFileDialog(function(files){return __awaiter(_this,void 0,void 0,function(){var sceneFile,extensions,_i,files_1,f,name_1,assetContainer_1,picker,e_1;return __generator(this,function(_a){switch(_a.label){case 0:for(sceneFile=null,extensions=["babylon","gltf","glb"],_i=0,files_1=files;_i<files_1.length;_i++)f=files_1[_i],name_1=f.name.toLowerCase(),-1!==extensions.indexOf(tools_1.default.GetFileExtension(f.name))&&(sceneFile=f),babylonjs_1.FilesInputStore.FilesToLoad[name_1]||(babylonjs_1.FilesInputStore.FilesToLoad[name_1]=f);return sceneFile?"babylon"===tools_1.default.GetFileExtension(sceneFile.name)?[3,2]:(editor.layout.lockPanel("main","Importing Loaders...",!0),[4,tools_1.default.ImportScript("babylonjs-loaders")]):[2,window_1.default.CreateAlert("No scene file where found. Available formats: .babylon, .gltf, .glb","Information")];case 1:_a.sent(),editor.layout.unlockPanel("main"),_a.label=2;case 2:return _a.trys.push([2,4,,5]),[4,babylonjs_1.SceneLoader.LoadAssetContainerAsync("file:",sceneFile.name,editor.core.scene)];case 3:return assetContainer_1=_a.sent(),picker=new picker_1.default("ImportMeshesFrom"),picker.addItems(assetContainer_1.meshes),picker.open(function(items){var names=items.map(function(i){return i.name});assetContainer_1.meshes.forEach(function(m){-1===names.indexOf(m.name)||editor.core.scene.getMeshByID(m.id)||(editor.core.scene.addMesh(m,!0),[m].concat(m.getChildMeshes()).forEach(function(c){babylonjs_1.Tags.AddTagsTo(c,"added"),c.material&&(babylonjs_1.Tags.AddTagsTo(c.material,"added"),c.material instanceof babylonjs_1.MultiMaterial&&c.material.subMaterials.forEach(function(m){return babylonjs_1.Tags.AddTagsTo(m,"added")}));var id=c.id;editor.core.scene.meshes.filter(function(m){return m.id===id}).length>1&&(c.id+=babylonjs_1.Tools.RandomId()),c.metadata=c.metadata||{},c.metadata.baseConfiguration={isPickable:c.isPickable},c.isPickable=!0}))}),editor.graph.clear(),editor.graph.fill()}),[3,5];case 4:return e_1=_a.sent(),window_1.default.CreateAlert(e_1.message,"Error"),[3,5];case 5:return[2]}})})}),[2]})})},SceneImporter}();exports.default=SceneImporter}),$__System.registerDynamic("1c",["c","f","17","29","1b","1a"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),tools_1=$__require("f"),request_1=$__require("17"),extensions_1=$__require("29"),scene_manager_1=$__require("1b"),scene_importer_1=$__require("1a"),ProjectImporter=function(){function ProjectImporter(){}return ProjectImporter.Import=function(editor,project){return __awaiter(this,void 0,void 0,function(){var scene,_loop_1,a,m,extension,ppExtension;return __generator(this,function(_a){scene=editor.core.scene,this.CleanProject(project),editor.inspector.setToolsStates(project.editionToolsStates),project.globalConfiguration.serializedCamera&&editor.createEditorCamera(project.globalConfiguration.serializedCamera),project.globalConfiguration.environmentTexture&&(scene.environmentTexture=babylonjs_1.Texture.Parse(project.globalConfiguration.environmentTexture,scene,"file:")),project.globalConfiguration.imageProcessingConfiguration&&babylonjs_1.SerializationHelper.Parse(function(){return scene.imageProcessingConfiguration},project.globalConfiguration.imageProcessingConfiguration,scene,"file:"),project.globalConfiguration.ambientColor&&(scene.ambientColor=babylonjs_1.Color3.FromArray(project.globalConfiguration.ambientColor)),project.globalConfiguration.clearColor&&(scene.clearColor=babylonjs_1.Color4.FromArray(project.globalConfiguration.clearColor)),project.globalConfiguration.fog&&(scene.fogEnabled=project.globalConfiguration.fog.enabled,scene.fogStart=project.globalConfiguration.fog.start,scene.fogEnd=project.globalConfiguration.fog.end,scene.fogDensity=project.globalConfiguration.fog.density,scene.fogColor=babylonjs_1.Color3.FromArray(project.globalConfiguration.fog.color),scene.fogMode=project.globalConfiguration.fog.mode),scene.isPhysicsEnabled()||scene.enablePhysics(scene.gravity,new babylonjs_1.CannonJSPlugin),scene._physicsEngine.setTimeStep(tools_1.default.Epsilon),project.nodes.forEach(function(n){var node=null;if("Scene"===n.name)node=scene;else if(n.serializationObject)switch(n.type){case"Light":var existingLight_1=scene.getLightByID(n.serializationObject.id);existingLight_1?(delete n.serializationObject.metadata,node=babylonjs_1.SerializationHelper.Parse(function(){return existingLight_1},n.serializationObject,scene,"file:"),babylonjs_1.Tags.AddTagsTo(node,"modified")):(void 0===n.added||n.added)&&(node=babylonjs_1.Light.Parse(n.serializationObject,scene),babylonjs_1.Tags.AddTagsTo(node,"added"));break;case"InstancedMesh":var existing_1=scene.getMeshByID(n.serializationObject.id);if(existing_1)node=babylonjs_1.SerializationHelper.Parse(function(){return existing_1},n.serializationObject,scene,"file:"),babylonjs_1.Tags.AddTagsTo(existing_1,"modified");else if(void 0===n.added||n.added){var source=scene.getMeshByID(n.serializationObject.sourceMesh);if(!source)break;node=source.createInstance(n.serializationObject.name),babylonjs_1.SerializationHelper.Parse(function(){return node},n.serializationObject,scene,"file:"),babylonjs_1.Tags.AddTagsTo(node,"added")}break;case"Mesh":if(n.serializationObject.geometries&&n.serializationObject.geometries.vertexData.forEach(function(v){babylonjs_1.Geometry.Parse(v,scene,"file:")}),n.skeleton){var existing_2=scene.getSkeletonById(n.skeleton.serializationObject.id);existing_2&&(tools_1.default.Assign(existing_2,n.skeleton.serializationObject),babylonjs_1.Tags.AddTagsTo(existing_2,"modified"))}n.serializationObject.meshes.forEach(function(m){var existingMesh=scene.getMeshByID(m.id);existingMesh?(delete m.metadata,node=babylonjs_1.SerializationHelper.Parse(function(){return existingMesh},m,scene,"file:"),babylonjs_1.Tags.AddTagsTo(node,"modified")):(void 0===n.added||n.added)&&(node=babylonjs_1.Mesh.Parse(m,scene,"file:"),babylonjs_1.Tags.AddTagsTo(node,"added")),m.parentId&&(node._waitingParentId=m.parentId)});break;case"Camera":var existingCamera_1=scene.getCameraByID(n.serializationObject.id);existingCamera_1?(delete n.serializationObject.metadata,node=babylonjs_1.SerializationHelper.Parse(function(){return existingCamera_1},n.serializationObject,scene,"file:"),babylonjs_1.Tags.AddTagsTo(node,"modified")):(void 0===n.added||n.added)&&(node=babylonjs_1.Camera.Parse(n.serializationObject,scene),babylonjs_1.Tags.AddTagsTo(node,"added"));break;default:throw new Error("Cannot parse node named: "+n.name)}else node=scene.getNodeByName(n.name);project.particleSystems.forEach(function(ps){if(!ps.hasEmitter&&n.id&&ps.serializationObject&&ps.serializationObject.emitterId===n.id){var emitter=new babylonjs_1.Mesh(n.name,scene,null,null,!0);emitter.id=ps.serializationObject.emitterId,babylonjs_1.Tags.AddTagsTo(emitter,"added_particlesystem")}}),node&&(n.serializationObject.parentId&&(node._waitingParentId=n.serializationObject.parentId),n.animations&&n.animations.forEach(function(a){var anim=babylonjs_1.Animation.Parse(a.serializationObject);babylonjs_1.Tags.AddTagsTo(anim,"added"),node.animations.push(anim)}),node instanceof babylonjs_1.AbstractMesh&&(n.actions&&(babylonjs_1.ActionManager.Parse(n.actions,node,scene),babylonjs_1.Tags.AddTagsTo(node.actionManager,"added")),n.physics&&(node.physicsImpostor=new babylonjs_1.PhysicsImpostor(node,n.physics.physicsImpostor,{mass:n.physics.physicsMass,friction:n.physics.physicsFriction,restitution:n.physics.physicsRestitution},scene))))}),project.particleSystems.forEach(function(ps){var system=babylonjs_1.ParticleSystem.Parse(ps.serializationObject,scene,"file:");ps.hasEmitter&&(system.emitter=scene.getNodeByID(ps.serializationObject.emitterId)),!ps.hasEmitter&&system.emitter&&ps.emitterPosition&&(system.emitter.position=babylonjs_1.Vector3.FromArray(ps.emitterPosition)),ps.serializationObject.base64Texture&&(system.particleTexture=babylonjs_1.Texture.CreateFromBase64String(ps.serializationObject.base64Texture,ps.serializationObject.base64TextureName,scene),system.particleTexture.name=system.particleTexture.name.replace("data:","")),babylonjs_1.Tags.AddTagsTo(system,"added")}),project.materials.forEach(function(m){var existing=scene.getMaterialByID(m.serializedValues.id),material=existing?babylonjs_1.SerializationHelper.Parse(function(){return existing},m.serializedValues,scene,"file:"):babylonjs_1.Material.Parse(m.serializedValues,scene,"file:");m.meshesNames.forEach(function(mn){var mesh=scene.getMeshByName(mn);!mesh||mesh instanceof babylonjs_1.InstancedMesh||(mesh.material=material)}),babylonjs_1.Tags.AddTagsTo(material,existing?"modified":"added")}),project.textures.forEach(function(t){if(t.newInstance){if(tools_1.default.GetTextureByName(scene,t.serializedValues.name))return;var texture_1=babylonjs_1.Texture.Parse(t.serializedValues,scene,"file:");babylonjs_1.Tags.AddTagsTo(texture_1,"added")}var existing=tools_1.default.GetTextureByName(scene,t.serializedValues.name),texture=existing?babylonjs_1.SerializationHelper.Parse(function(){return existing},t.serializedValues,scene,"file:"):babylonjs_1.Texture.Parse(t.serializedValues,scene,"file:");babylonjs_1.Tags.AddTagsTo(texture,existing?"modified":"added")}),project.shadowGenerators.forEach(function(sg){var generator=babylonjs_1.ShadowGenerator.Parse(sg,scene);babylonjs_1.Tags.EnableFor(generator),babylonjs_1.Tags.AddTagsTo(generator,"added")}),project.sounds.forEach(function(s){var existing=scene.getSoundByName(s.serializationObject.name);if(existing){if(void 0!==s.serializationObject.loop&&(existing.loop=s.serializationObject.loop),void 0!==s.serializationObject.volume&&existing.setVolume(s.serializationObject.volume),void 0!==s.serializationObject.rolloffFactor&&(existing.rolloffFactor=s.serializationObject.rolloffFactor),void 0!==s.serializationObject.playbackRate&&existing.setPlaybackRate(s.serializationObject.playbackRate),s.serializationObject.connectedMeshId){var mesh=editor.core.scene.getMeshByID(s.serializationObject.connectedMeshId);mesh&&(existing.attachToMesh(mesh),void 0!==s.serializationObject.position&&existing.setPosition(babylonjs_1.Vector3.FromArray(s.serializationObject.position)))}else existing.detachFromMesh(),existing.setPosition(babylonjs_1.Vector3.Zero());babylonjs_1.Tags.AddTagsTo(existing,"modified")}else{var sound=babylonjs_1.Sound.Parse(s.serializationObject,scene,"file:");babylonjs_1.Tags.AddTagsTo(sound,"added")}}),project.actions&&(babylonjs_1.ActionManager.Parse(project.actions,null,scene),babylonjs_1.Tags.AddTagsTo(scene.actionManager,"added")),project.effectLayers.forEach(function(el){return scene_manager_1.default[el.name]=babylonjs_1.EffectLayer.Parse(el.serializationObject,scene,"file:")}),project.renderTargets.forEach(function(rt){if(rt.isProbe){var probe=babylonjs_1.ReflectionProbe.Parse(rt.serializationObject,scene,"file:");babylonjs_1.Tags.AddTagsTo(probe,"added")}else{var texture=babylonjs_1.Texture.Parse(rt.serializationObject,scene,"file:");scene.customRenderTargets.push(texture)}}),project.environmentHelper&&(scene_manager_1.default.EnvironmentHelper=editor.core.scene.createDefaultEnvironment({groundColor:(new babylonjs_1.Color3).copyFrom(project.environmentHelper.groundColor),skyboxColor:(new babylonjs_1.Color3).copyFrom(project.environmentHelper.skyboxColor),enableGroundMirror:project.environmentHelper.enableGroundMirror})),editor.assets.clear(),_loop_1=function(a){var component=editor.assets.components.find(function(c){return c.id===a});if(!component)return"continue";component.onParseAssets&&component.onParseAssets(project.assets[a])};for(a in project.assets)_loop_1(a);extensions_1.default.ClearExtensions();for(m in project.customMetadatas)(extension=extensions_1.default.RequestExtension(scene,m))&&(extension.onLoad(project.customMetadatas[m]),extension.onGetAssets&&editor.assets.addTab(extension));return project.customMetadatas.notes&&(editor.core.scene.metadata=editor.core.scene.metadata||{},editor.core.scene.metadata.notes=project.customMetadatas.notes,editor.addEditPanelPlugin("notes",!0)),ppExtension=extensions_1.default.Instances.PostProcess,ppExtension&&(scene_manager_1.default.StandardRenderingPipeline=ppExtension.standard,scene_manager_1.default.SSAO2RenderingPipeline=ppExtension.ssao2),editor.assets.refresh(),editor.core.scene.meshes.forEach(function(m){m._waitingParentId&&(m.parent=editor.core.scene.getNodeByID(m._waitingParentId),m._waitingParentId=void 0)}),editor.core.scene.lights.forEach(function(l){l._waitingParentId&&(l.parent=editor.core.scene.getNodeByID(l._waitingParentId),l._waitingParentId=void 0)}),editor.core.scene.cameras.forEach(function(c){c._waitingParentId&&(c.parent=editor.core.scene.getNodeByID(c._waitingParentId),c._waitingParentId=void 0)}),[2]})})},ProjectImporter.CleanProject=function(project){project.renderTargets=project.renderTargets||[],project.sounds=project.sounds||[],project.customMetadatas=project.customMetadatas||{},project.physicsEnabled=project.physicsEnabled||!1,project.effectLayers=project.effectLayers||[],project.globalConfiguration=project.globalConfiguration||{},project.assets=project.assets||{},project.textures=project.textures||[],project.removedObjects=project.removedObjects||{},project.editionToolsStates=project.editionToolsStates||[],project.effectLayers.forEach(function(el){delete el.serializationObject.renderingGroupId})},ProjectImporter.ImportProject=function(editor){return __awaiter(this,void 0,void 0,function(){var files,_a,_b,_c,_d,_e;return __generator(this,function(_f){switch(_f.label){case 0:return[4,tools_1.default.OpenFileDialog()];case 1:return files=_f.sent(),1===files.length&&"editorproject"===tools_1.default.GetFileExtension(files[0].name)&&tools_1.default.IsElectron()?[4,request_1.default.Post("/openedFile",JSON.stringify({value:files[0].path.replace(/\\/g,"/")}))]:[3,5];case 2:return _f.sent(),_b=(_a=scene_importer_1.default).LoadProjectFromFile,_c=[editor,files[0].path],_e=(_d=JSON).parse,[4,tools_1.default.ReadFileAsText(files[0])];case 3:return[4,_b.apply(_a,_c.concat([_e.apply(_d,[_f.sent()])]))];case 4:return[2,_f.sent()];case 5:return editor.filesInput.loadFiles({target:{files:files}}),[2,!1]}})})},ProjectImporter}();exports.default=ProjectImporter}),$__System.registerDynamic("6a",["c"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),GraphicsTools=function(){function GraphicsTools(){}return GraphicsTools.TextureToFile=function(tex){return __awaiter(this,void 0,void 0,function(){var dimensions,pixels,canvas,imageData,context,blob;return __generator(this,function(_a){switch(_a.label){case 0:return dimensions=tex.getBaseSize(),tex.textureType,babylonjs_1.Engine.TEXTURETYPE_UNSIGNED_INT,pixels=tex.readPixels(),canvas=document.createElement("canvas"),canvas.width=dimensions.width,canvas.height=dimensions.height,imageData=new ImageData(new Uint8ClampedArray(pixels.buffer),tex.getBaseSize().width,tex.getBaseSize().height),context=canvas.getContext("2d"),context.putImageData(imageData,0,0),[4,this.CanvasToBlob(canvas)];case 1:return blob=_a.sent(),context.restore(),canvas.remove(),[2,blob]}})})},GraphicsTools.CanvasToBlob=function(canvas){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve){babylonjs_1.Tools.ToBlob(canvas,function(b){return resolve(b)})})]})})},GraphicsTools}();exports.default=GraphicsTools}),$__System.registerDynamic("6b",["c","f","6a"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),tools_1=$__require("f"),graphics_tools_1=$__require("6a"),GLTFTools=function(){function GLTFTools(){}return GLTFTools.ConfigureFromScene=function(editor,file){return __awaiter(this,void 0,void 0,function(){var ext,texturesPromises,_i,_a,tex;return __generator(this,function(_b){switch(_b.label){case 0:if("gltf"!==(ext=tools_1.default.GetFileExtension(file.name).toLowerCase())&&"glb"!==ext)return[2];for(texturesPromises=[],_i=0,_a=editor.core.scene.textures;_i<_a.length;_i++)tex=_a[_i],texturesPromises.push(this._ConfigureTexture(tex));return[4,Promise.all(texturesPromises)];case 1:return _b.sent(),[2]}})})},GLTFTools._ConfigureTexture=function(tex){return __awaiter(this,void 0,void 0,function(){var blob;return __generator(this,function(_a){switch(_a.label){case 0:return tex.metadata&&tex.metadata.gltf?(tex.url=tex.name=tex.name+".png",[4,graphics_tools_1.default.TextureToFile(tex)]):[2];case 1:return blob=_a.sent(),blob.name=tex.name,babylonjs_1.Tags.AddTagsTo(blob,"doNotExport"),babylonjs_1.FilesInputStore.FilesToLoad[tex.name.toLowerCase()]=blob,[2]}})})},GLTFTools}();exports.default=GLTFTools}),$__System.registerDynamic("60",["c","f","15","1d","10","14","1b","29","1e","1c","6b","58"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),tools_1=$__require("f"),undo_redo_1=$__require("15"),project_exporter_1=$__require("1d"),window_1=$__require("10"),dialog_1=$__require("14"),scene_manager_1=$__require("1b"),extensions_1=$__require("29"),project_code_editor_1=$__require("1e"),project_importer_1=$__require("1c"),gltf_tools_1=$__require("6b"),vscode_socket_1=$__require("58"),SceneLoader=function(){function SceneLoader(){}return SceneLoader.OnStartingProcessingFiles=function(editor,files){for(var _i=0,files_1=files;_i<files_1.length;_i++){var f=files_1[_i],ext=tools_1.default.GetFileExtension(f.name).toLowerCase();if(-1!==this._SceneExtensions.indexOf(ext))return this._CurrentFiles=files,project_exporter_1.default.ProjectPath=null,editor.projectFile=null,void(editor.sceneFile=null)}},SceneLoader.OnReloadingScene=function(editor,sceneFile){var _this=this;if(!sceneFile)return editor.notifyMessage("Files added.",!1,3e3);if(editor._showReloadDialog){var message="Scene file found ("+sceneFile.name+"). Append to existing one?";dialog_1.default.Create("Load scene",message,function(result){return _this._Prepare(editor,sceneFile,"Yes"===result)})}else this._Prepare(editor,sceneFile,!1);editor._showReloadDialog=!0},SceneLoader._Prepare=function(editor,sceneFile,append){return __awaiter(this,void 0,void 0,function(){var _i,_a,f,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:return undo_redo_1.default.Clear(),editor.layout.lockPanel("main","Importing Loaders...",!0),[4,tools_1.default.ImportScript("babylonjs-loaders")];case 1:return _b.sent(),editor.layout.lockPanel("main","Importing Physics...",!0),[4,tools_1.default.ImportScript("cannon")];case 2:return _b.sent(),editor.layout.lockPanel("main","Importing Materials...",!0),[4,tools_1.default.ImportScript("babylonjs-materials")];case 3:return _b.sent(),editor.layout.lockPanel("main","Importing Procedural Textures...",!0),[4,tools_1.default.ImportScript("babylonjs-procedural-textures")];case 4:return _b.sent(),editor.layout.lockPanel("main","Importing Post Processes...",!0),[4,tools_1.default.ImportScript("babylonjs-post-process")];case 5:return _b.sent(),editor.layout.lockPanel("main","Importing Extensions...",!0),[4,Promise.all([tools_1.default.ImportScript("behavior-editor"),tools_1.default.ImportScript("graph-editor"),tools_1.default.ImportScript("material-editor"),tools_1.default.ImportScript("post-process-editor"),tools_1.default.ImportScript("post-processes"),tools_1.default.ImportScript("path-finder"),tools_1.default.ImportScript("particles-creator")])];case 6:if(_b.sent(),editor.layout.unlockPanel("main"),editor.core.engine.stopRenderLoop(),append)babylonjs_1.SceneLoader.Append("file:",sceneFile.name,editor.core.scene,function(scene){return _this._OnSceneLoaded(editor,sceneFile,scene,!1)},null,function(scene,message){return _this._OnError("Error while loading scene",message)});else{for(babylonjs_1.FilesInputStore.FilesToLoad={},_i=0,_a=this._CurrentFiles;_i<_a.length;_i++)f=_a[_i],babylonjs_1.FilesInputStore.FilesToLoad[f.name.toLowerCase()]=f;babylonjs_1.SceneLoader.Load("file:",sceneFile.name,editor.core.engine,function(scene){return _this._OnSceneLoaded(editor,sceneFile,scene,!0)},null,function(scene,message){return _this._OnError("Error while loading scene",message)})}return editor.core.engine.hideLoadingUI(),editor.layout.lockPanel("main","Loading Scene...",!0),babylonjs_1.FilesInputStore.FilesToLoad[sceneFile.name]=sceneFile,[2]}})})},SceneLoader._OnSceneLoaded=function(editor,sceneFile,scene,loadingNewScene){return __awaiter(this,void 0,void 0,function(){var existingCamera,appendPromises,f,file,ext,projectFile,content,e_1;return __generator(this,function(_a){switch(_a.label){case 0:if(loadingNewScene?this.SceneFiles=[sceneFile]:this.SceneFiles.push(sceneFile),editor.core.removeScene(editor.core.scene,loadingNewScene),editor.core.uiTextures.forEach(function(ui){return ui.dispose()}),editor.core.uiTextures=[],editor.core.scene=scene,editor.core.scenes.push(scene),editor.playCamera=scene.activeCamera,existingCamera=scene.getCameraByName("Editor Camera"),existingCamera&&existingCamera.dispose(),editor.createEditorCamera(),scene_manager_1.default.Clear(),loadingNewScene&&(extensions_1.default.ClearExtensions(),project_code_editor_1.default.CloseAll()),!loadingNewScene)return[3,8];appendPromises=[];for(f in babylonjs_1.FilesInputStore.FilesToLoad)file=babylonjs_1.FilesInputStore.FilesToLoad[f],ext=tools_1.default.GetFileExtension(file.name).toLowerCase(),file!==sceneFile&&file!==editor.sceneFile&&-1!==this._SceneExtensions.indexOf(ext)&&(appendPromises.push(babylonjs_1.SceneLoader.AppendAsync("file:",file.name,scene)),editor.core.engine.hideLoadingUI(),this.SceneFiles.push(file));return[4,Promise.all(appendPromises)];case 1:return _a.sent(),(scene_manager_1.default.SaveOriginalObjects(editor.core.scene),projectFile=editor.getProjectFileFromFilesInputStore())?(editor.projectFileName=projectFile.name,tools_1.default.SetWindowTitle(projectFile.name),[4,tools_1.default.ReadFileAsText(projectFile)]):[3,7];case 2:content=_a.sent(),this._CurrentProject=JSON.parse(content),_a.label=3;case 3:return _a.trys.push([3,5,,6]),[4,project_importer_1.default.Import(editor,this._CurrentProject)];case 4:return _a.sent(),scene_manager_1.default.ApplyRemovedObjects(scene,this._CurrentProject.removedObjects),[3,6];case 5:return e_1=_a.sent(),this._OnError("Error while loading project",e_1.message),[3,6];case 6:delete babylonjs_1.FilesInputStore.FilesToLoad[projectFile.name.toLowerCase()],_a.label=7;case 7:0===scene.lights.length&&scene.createDefaultCameraOrLight(!1,!1,!1),_a.label=8;case 8:return[4,gltf_tools_1.default.ConfigureFromScene(editor,sceneFile)];case 9:return _a.sent(),editor.graph.clear(),editor.graph.fill(),loadingNewScene&&editor.preview.reset(),[4,editor.restartPlugins()];case 10:return _a.sent(),editor.createScenePicker(),scene_manager_1.default.Toggle(editor.core.scene),editor.run(),editor.layout.unlockPanel("main"),editor.core.onSelectObject.notifyObservers(editor.core.scene),vscode_socket_1.default.Refresh(),editor.filesInput._sceneFileToLoad=null,editor.core.onSceneLoaded.notifyObservers({file:sceneFile,project:this._CurrentProject,scene:editor.core.scene}),editor.stats.updateStats(),editor.assets.refresh(),editor.files.refresh(),this._CurrentProject=null,[2]}})})},SceneLoader._OnError=function(title,message){window_1.default.CreateAlert(message,title)},SceneLoader.SceneFiles=[],SceneLoader._CurrentProject=null,SceneLoader._SceneExtensions=["babylon","obj","stl","gltf","glb"],SceneLoader._CurrentFiles=[],SceneLoader}();exports.default=SceneLoader}),$__System.registerDynamic("6c",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("1d",["c","e","1b","18","60","10","11","f","69","6c","29"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),babylonjs_serializers_1=$__require("e"),scene_manager_1=$__require("1b"),scene_exporter_1=$__require("18"),scene_loader_1=$__require("60"),window_1=$__require("10"),form_1=$__require("11"),tools_1=$__require("f"),storage_1=$__require("69"),extension_1=$__require("6c"),extensions_1=$__require("29"),ProjectExporter=function(){function ProjectExporter(){}return ProjectExporter.ExportTemplate=function(editor,onlyScene){return __awaiter(this,void 0,void 0,function(){var window,form,_this=this;return __generator(this,function(_a){return window=new window_1.default("ExportTemplate"),window.buttons=["Ok"],window.width=400,window.height=125,window.body='<div id="EXPORT-TEMPLATE-FORMAT" style="width: 100%; height: 100%;"></div>',window.open(),form=new form_1.default("SceneFormatForm"),form.fields=[{name:"format",type:"list",required:!0,options:{items:["babylon","glb","gltf"]}}],form.build("EXPORT-TEMPLATE-FORMAT"),form.element.record.format=this.ProjectExportFormat,form.element.refresh(),window.onButtonClick=function(){return __awaiter(_this,void 0,void 0,function(){var sceneFiles,_a,_b,_c,data,_d,e_1,_e,_f,_i,f,file,_g,_h,_j,srcFiles,_k,storage,_l,_m,_o,_p,_q,_r,_s,_t,_u,_this=this;return __generator(this,function(_v){switch(_v.label){case 0:return this.ProjectExportFormat=form.element.record.format.id,(form.element.destroy(),window.close(),scene_exporter_1.default.CreateFiles(editor,this.ProjectExportFormat),sceneFiles=[{name:"project.editorproject",data:JSON.stringify(this.Export(editor).customMetadatas)}],"babylon"!==this.ProjectExportFormat)?[3,2]:(_b=(_a=sceneFiles).push,_c={name:"scene.babylon"},[4,tools_1.default.ReadFileAsArrayBuffer(editor.sceneFile)]);case 1:return _b.apply(_a,[(_c.data=_v.sent(),_c)]),[3,15];case 2:data=null,_v.label=3;case 3:switch(_v.trys.push([3,10,,11]),_d=this.ProjectExportFormat){case"glb":return[3,4];case"gltf":return[3,6]}return[3,8];case 4:return[4,babylonjs_serializers_1.GLTF2Export.GLBAsync(editor.core.scene,"scene",{})];case 5:return data=_v.sent(),[3,9];case 6:return[4,babylonjs_serializers_1.GLTF2Export.GLTFAsync(editor.core.scene,"scene",{})];case 7:return data=_v.sent(),[3,9];case 8:return[3,9];case 9:return[3,11];case 10:return e_1=_v.sent(),window_1.default.CreateAlert(e_1.message,"Error when exporting the scene"),[2];case 11:_e=[];for(_f in data.glTFFiles)_e.push(_f);_i=0,_v.label=12;case 12:return _i<_e.length?(f=_e[_i],file=data.glTFFiles[f],_h=(_g=sceneFiles).push,_j={name:f},[4,tools_1.default.ReadFileAsArrayBuffer(file)]):[3,15];case 13:_h.apply(_g,[(_j.data=_v.sent(),_j)]),_v.label=14;case 14:return _i++,[3,12];case 15:return Object.keys(babylonjs_1.FilesInputStore.FilesToLoad).forEach(function(k){return __awaiter(_this,void 0,void 0,function(){var file,_a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:return file=babylonjs_1.FilesInputStore.FilesToLoad[k],babylonjs_1.Tags.HasTags(file)&&babylonjs_1.Tags.MatchesQuery(file,"doNotExport")||file===editor.sceneFile||file===editor.projectFile||-1!==scene_loader_1.default.SceneFiles.indexOf(file)?[2]:(_b=(_a=sceneFiles).push,_c={name:k},[4,tools_1.default.ReadFileAsArrayBuffer(file)]);case 1:return _b.apply(_a,[(_c.data=_d.sent(),_c)]),[2]}})})}),_k={name:"game.ts",doNotOverride:!0},[4,tools_1.default.LoadFile("assets/templates/template/src/game.ts")];case 16:return srcFiles=[(_k.data=_v.sent().replace("{{scene_format}}",this.ProjectExportFormat),_k)],[4,storage_1.default.GetStorage(editor)];case 17:return storage=_v.sent(),(_m=(_l=storage).openPicker,_o=["Create Template..."],onlyScene)?(_p=sceneFiles,[3,23]):[3,18];case 18:return _q=[{name:"scene",folder:sceneFiles},{name:"src",folder:srcFiles}],_r={name:"README.md",doNotOverride:!0},[4,tools_1.default.LoadFile("assets/templates/template/README.md")];case 19:return _q=_q.concat([(_r.data=_v.sent(),_r)]),_s={name:"index.html",doNotOverride:!0},[4,tools_1.default.LoadFile("assets/templates/template/index.html")];case 20:return _q=_q.concat([(_s.data=_v.sent(),_s)]),_t={name:"package.json",doNotOverride:!0},[4,tools_1.default.LoadFile("assets/templates/template/package.json")];case 21:return _q=_q.concat([(_t.data=_v.sent(),_t)]),_u={name:"tsconfig.json",doNotOverride:!0},[4,tools_1.default.LoadFile("assets/templates/template/tsconfig.json")];case 22:_p=_q.concat([(_u.data=_v.sent(),_u)]),_v.label=23;case 23:return _m.apply(_l,_o.concat([_p])),[2]}})})},[2]})})},ProjectExporter.ExportProject=function(editor,exportAs){return void 0===exportAs&&(exportAs=!1),__awaiter(this,void 0,void 0,function(){var project,content,storage,sceneFolder,root,f,file,ext,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this._IsSaving?[2]:(this._IsSaving=!0,editor.layout.lockPanel("bottom","Saving...",!0),project=this.Export(editor),content=JSON.stringify(project,null,"\t"),[4,storage_1.default.GetStorage(editor)]);case 1:storage=_a.sent(),sceneFolder={name:"scene",folder:[]},root=[{name:editor.projectFileName,data:content},sceneFolder];for(f in babylonjs_1.FilesInputStore.FilesToLoad)file=babylonjs_1.FilesInputStore.FilesToLoad[f],babylonjs_1.Tags.HasTags(file)&&babylonjs_1.Tags.MatchesQuery(file,"doNotExport")||"editorproject"!==(ext=tools_1.default.GetFileExtension(file.name))&&file!==editor.projectFile&&file!==editor.sceneFile&&sceneFolder.folder.push({name:file.name,file:file,doNotOverride:!0});return storage.onCreateFiles=function(folder){return _this.ProjectPath=folder},[4,storage.openPicker("Export Editor Project...",root,exportAs?null:this.ProjectPath)];case 2:return _a.sent(),tools_1.default.SetWindowTitle(editor.projectFileName),editor.layout.lockPanel("bottom","Saved.",!1),setTimeout(function(){return editor.layout.unlockPanel("bottom")},1e3),this._IsSaving=!1,[2]}})})},ProjectExporter.DownloadProjectFile=function(editor){return __awaiter(this,void 0,void 0,function(){var content,files,storage,result,file,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return content=JSON.stringify(this.Export(editor)),files=[{name:editor.projectFileName,data:content}],tools_1.default.IsElectron()?[4,storage_1.default.GetStorage(editor)]:[3,3];case 1:return storage=_a.sent(),storage.onCreateFiles=function(folder){return _this.ProjectPath=folder},[4,storage.openPicker("Export Editor Project...",files,null,!0)];case 2:return result=_a.sent(),result&&(this.ProjectPath=result.path,editor.projectFileName=result.filename,tools_1.default.SetWindowTitle(result.filename)),[3,4];case 3:file=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(content),"scene.editorproject"),babylonjs_1.Tools.Download(file,editor.projectFileName),_a.label=4;case 4:return[2]}})})},ProjectExporter.Export=function(editor){scene_manager_1.default.Toggle(editor.core.scene);var project={actions:null,customMetadatas:this._SerializeCustomMetadatas(editor),globalConfiguration:this._SerializeGlobalConfiguration(editor),lensFlares:null,materials:this._SerializeMaterials(editor),textures:this._SerializeTextures(editor),nodes:this._SerializeNodes(editor),particleSystems:this._SerializeParticleSystems(editor),physicsEnabled:editor.core.scene.isPhysicsEnabled(),renderTargets:this._SerializeRenderTargets(editor),requestedMaterials:null,shadowGenerators:this._SerializeShadowGenerators(editor),sounds:this._SerializeSounds(editor),gui:editor.core.uiTextures.map(function(ut){return ut.serialize()}),effectLayers:this._SerializeEffectLayers(editor),environmentHelper:scene_manager_1.default.EnvironmentHelper?scene_manager_1.default.EnvironmentHelper._options:null,assets:this._SerializeAssets(editor),removedObjects:this._SerializeRemovedObjects(),filesList:[],editionToolsStates:editor.inspector.getToolsStates()};project.customMetadatas.AssetsExtension={},["prefabs","particles"].forEach(function(ua){var assets=project.assets[ua];assets&&(project.customMetadatas.AssetsExtension[ua]=assets.map(function(a){return{name:a.name,data:a.data}}))});for(var f in babylonjs_1.FilesInputStore.FilesToLoad){var file=babylonjs_1.FilesInputStore.FilesToLoad[f];if(!babylonjs_1.Tags.HasTags(file)||!babylonjs_1.Tags.MatchesQuery(file,"doNotExport")){"editorproject"!==tools_1.default.GetFileExtension(file.name)&&file!==editor.projectFile&&file!==editor.sceneFile&&project.filesList.push("scene/"+f)}}return scene_manager_1.default.Toggle(editor.core.scene),project},ProjectExporter._SerializeGlobalConfiguration=function(editor){var scene=editor.core.scene;return delete editor.camera.metadata,{serializedCamera:editor.camera.serialize(),environmentTexture:scene.environmentTexture?scene.environmentTexture.serialize():void 0,imageProcessingConfiguration:scene.imageProcessingConfiguration?scene.imageProcessingConfiguration.serialize():void 0,ambientColor:scene.ambientColor.asArray(),clearColor:scene.clearColor.asArray(),fog:{enabled:scene.fogEnabled,start:scene.fogStart,end:scene.fogEnd,density:scene.fogDensity,mode:scene.fogMode,color:scene.fogColor.asArray()}}},ProjectExporter._SerializeSounds=function(editor){var _this=this,result=[],scene=editor.core.scene;return scene.soundTracks?(scene.soundTracks.forEach(function(st){st.soundCollection.forEach(function(s){var added=babylonjs_1.Tags.MatchesQuery(s,"added"),modified=babylonjs_1.Tags.MatchesQuery(s,"modified");(added||modified)&&result.push({name:s.name,serializationObject:added?s.serialize():tools_1.default.Assign(_this._MergeModifedProperties(s,s.serialize()),{name:s.name})})})}),result):result},ProjectExporter._SerializeCustomMetadatas=function(editor){var result={};editor.core.scene.metadata&&editor.core.scene.metadata.notes&&(result.notes=editor.core.scene.metadata.notes);for(var e in extensions_1.default.Instances)result[e]=extensions_1.default.Instances[e].onSerialize();return result},ProjectExporter._SerializeAssets=function(editor){var result={};return editor.assets.components.forEach(function(c){c instanceof extension_1.default||c.onSerializeAssets&&(result[c.id]=c.onSerializeAssets())}),result},ProjectExporter._SerializeShadowGenerators=function(editor){var result=[];return editor.core.scene.lights.forEach(function(l){var sg=l.getShadowGenerator();sg&&babylonjs_1.Tags.HasTags(sg)&&babylonjs_1.Tags.MatchesQuery(sg,"added")&&result.push(sg.serialize())}),result},ProjectExporter._SerializeRenderTargets=function(editor){var renderTargets=[];return editor.core.scene.customRenderTargets.forEach(function(rt){babylonjs_1.Tags.HasTags(rt)&&babylonjs_1.Tags.MatchesQuery(rt,"added")&&renderTargets.push({isProbe:!1,serializationObject:rt.serialize()})}),editor.core.scene.reflectionProbes&&editor.core.scene.reflectionProbes.forEach(function(rp){babylonjs_1.Tags.HasTags(rp)&&babylonjs_1.Tags.MatchesQuery(rp,"added")&&renderTargets.push({isProbe:!0,serializationObject:rp.serialize()})}),renderTargets},ProjectExporter._SerializeMaterials=function(editor){var _this=this,scene=editor.core.scene,result=[];return scene.materials.forEach(function(m){var added=babylonjs_1.Tags.MatchesQuery(m,"added"),modifed=babylonjs_1.Tags.MatchesQuery(m,"modified");if(babylonjs_1.Tags.HasTags(m)&&(added||modifed)){if(!result.find(function(mat){return mat.serializedValues.name===m.name})){var names=[];scene.meshes.map(function(mesh){mesh.material===m&&names.push(mesh.name)}),result.push({meshesNames:names,newInstance:!0,serializedValues:modifed?_this._MergeModifedProperties(m,m.serialize()):m.serialize()})}}}),result},ProjectExporter._SerializeTextures=function(editor){var _this=this,scene=editor.core.scene,result=[];return scene.textures.forEach(function(t){var added=babylonjs_1.Tags.MatchesQuery(t,"added"),modified=babylonjs_1.Tags.MatchesQuery(t,"modified");if(added||modified){var serializedValues=modified?_this._MergeModifedProperties(t,t.serialize()):_this._ClearOriginalMetadata(t.serialize());serializedValues.name=t.name,result.push({serializedValues:serializedValues,newInstance:added})}}),result},ProjectExporter._SerializeParticleSystems=function(editor){var scene=editor.core.scene,result=[];return scene.particleSystems.forEach(function(ps){if(babylonjs_1.Tags.HasTags(ps)&&babylonjs_1.Tags.MatchesQuery(ps,"added")){var psObj={emitterPosition:ps.emitter&&ps.emitter instanceof babylonjs_1.Vector3?ps.emitter.asArray():ps.emitter&&ps.emitter instanceof babylonjs_1.Node?ps.emitter.position.asArray():null,hasEmitter:ps.emitter&&ps.emitter instanceof babylonjs_1.AbstractMesh&&!babylonjs_1.Tags.MatchesQuery(ps.emitter,"added_particlesystem"),serializationObject:ps.serialize()};ps instanceof babylonjs_1.ParticleSystem&&ps.particleTexture._buffer&&(psObj.serializationObject.base64TextureName=ps.particleTexture.name,psObj.serializationObject.base64Texture=ps.particleTexture._buffer,delete psObj.serializationObject.textureName),result.push(psObj)}}),result},ProjectExporter._SerializeEffectLayers=function(editor){var result=[];return scene_manager_1.default.GlowLayer&&result.push({name:"GlowLayer",serializationObject:scene_manager_1.default.GlowLayer.serialize()}),scene_manager_1.default.HighLightLayer&&result.push({name:"HighLightLayer",serializationObject:scene_manager_1.default.HighLightLayer.serialize()}),result},ProjectExporter._SerializeRemovedObjects=function(){var result={};for(var key in scene_manager_1.default.RemovedObjects){var value=scene_manager_1.default.RemovedObjects[key];result[key]={serializationObject:value.serializationObject,type:tools_1.default.GetConstructorName(value.reference),name:value.name}}return result},ProjectExporter._SerializeNodes=function(editor){var _this=this,scene=editor.core.scene,nodes=[].concat(scene.meshes).concat(scene.lights).concat(scene.cameras).filter(function(n){return n!==editor.camera}),result=[];return nodes.forEach(function(n){var prefab=babylonjs_1.Tags.MatchesQuery(n,"prefab")||babylonjs_1.Tags.MatchesQuery(n,"prefab-master");if(!prefab){var addNodeToProject=!1,node={actions:null,animations:[],id:n.id,name:n.name,serializationObject:null,physics:null,added:babylonjs_1.Tags.MatchesQuery(n,"added"),type:n instanceof babylonjs_1.InstancedMesh?"InstancedMesh":n instanceof babylonjs_1.AbstractMesh?"Mesh":n instanceof babylonjs_1.Light?"Light":n instanceof babylonjs_1.Camera?"Camera":"Unknown!"};babylonjs_1.Tags.MatchesQuery(n,"added_particlesystem")&&(addNodeToProject=!0);var modified=babylonjs_1.Tags.MatchesQuery(n,"modified");if(babylonjs_1.Tags.HasTags(n)&&(node.added||modified)&&!prefab&&(addNodeToProject=!0,n instanceof babylonjs_1.AbstractMesh?n instanceof babylonjs_1.InstancedMesh?node.added?(node.serializationObject=_this._ClearOriginalMetadata(n.serialize()),node.serializationObject.sourceMesh=n.sourceMesh.id):node.serializationObject=_this._MergeModifedProperties(n,n.serialize()):(node.serializationObject=babylonjs_1.SceneSerializer.SerializeMesh(n,!1,!1),node.added?node.serializationObject.meshes.forEach(function(m){return _this._ClearOriginalMetadata(m)}):(node.serializationObject.skeletons&&babylonjs_1.Tags.MatchesQuery(n.skeleton,"modified")&&(node.skeleton={serializationObject:_this._MergeModifedProperties(n.skeleton,n.skeleton.serialize())},delete node.skeleton.serializationObject.bones),delete node.serializationObject.geometries,delete node.serializationObject.materials,delete node.serializationObject.skeletons,delete node.serializationObject.multiMaterials,node.serializationObject.meshes.forEach(function(m,index){var merge=_this._MergeModifedProperties(n,m);delete merge.instances,delete merge.subMeshes,delete merge.materialId,node.serializationObject.meshes[index]=merge}))):node.serializationObject=modified?_this._MergeModifedProperties(n,n.serialize()):_this._ClearOriginalMetadata(n.serialize())),n.animations.forEach(function(a){babylonjs_1.Tags.HasTags(a)&&babylonjs_1.Tags.MatchesQuery(a,"added")&&(addNodeToProject=!0,node.animations.push({events:[],serializationObject:a.serialize(),targetName:name,targetType:"Node"}))}),n instanceof babylonjs_1.AbstractMesh){var impostor=n.getPhysicsImpostor();impostor&&babylonjs_1.Tags.HasTags(impostor)&&babylonjs_1.Tags.MatchesQuery(impostor,"added")&&(addNodeToProject=!0,node.physics={physicsMass:impostor.getParam("mass"),physicsFriction:impostor.getParam("friction"),physicsRestitution:impostor.getParam("restitution"),physicsImpostor:impostor.type})}var actionManager=n.actionManager;actionManager&&babylonjs_1.Tags.HasTags(actionManager)&&babylonjs_1.Tags.MatchesQuery(actionManager,"added")&&(addNodeToProject=!0,node.actions=actionManager.serialize(name)),addNodeToProject&&result.push(node)}}),result},ProjectExporter._ClearOriginalMetadata=function(n){return delete n.metadata,n},ProjectExporter._MergeModifedProperties=function(source,current){var original=source.metadata&&source.metadata.original;if(!original)return current;var result={},_loop_1=function(key){var value=current[key];if(void 0===original[key])return result[key]=value,"continue";switch((typeof value).toLowerCase()){case"number":case"boolean":case"string":return current[key]!==original[key]&&(result[key]=value),"continue";default:if(Array.isArray(value)){var o_1=original[key];if(!o_1)break;void 0!==value.find(function(v,i){return v!==o_1[i]})&&(result[key]=value)}else{var currentObject=source[key],originalValue=original[key];if(currentObject instanceof babylonjs_1.BaseTexture){(babylonjs_1.Tags.HasTags(originalValue)&&babylonjs_1.Tags.MatchesQuery(originalValue,"added")||originalValue.name!==value.name)&&(result[key]=value);break}result[key]=value}}};for(var key in current)_loop_1(key);return result.id=current.id,this._ClearOriginalMetadata(result)},ProjectExporter.ProjectPath=null,ProjectExporter.ProjectExportFormat="babylon",ProjectExporter._IsSaving=!1,ProjectExporter}();exports.default=ProjectExporter}),$__System.registerDynamic("18",["c","1d","f"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),project_exporter_1=$__require("1d"),tools_1=$__require("f"),SceneExporter=function(){function SceneExporter(){}return SceneExporter.CreateFiles=function(editor,format){void 0===format&&(format="babylon"),editor.sceneFile&&delete babylonjs_1.FilesInputStore.FilesToLoad[editor.sceneFile.name],editor.projectFile&&delete babylonjs_1.FilesInputStore.FilesToLoad[editor.projectFile.name],this._LastRandomId=babylonjs_1.Tools.RandomId(),editor.core.scene.materials.forEach(function(m){return m instanceof babylonjs_1.ShaderMaterial&&(m.doNotSerialize=!0)}),editor.assets.prefabs.setSerializable(!0);var serializedScene=babylonjs_1.SceneSerializer.Serialize(editor.core.scene);editor.assets.prefabs.setSerializable(!1),editor.playCamera&&(serializedScene.activeCameraID=editor.playCamera.id),this._ClearMetadatas(serializedScene.meshes),this._ClearMetadatas(serializedScene.lights),this._ClearMetadatas(serializedScene.cameras),this._ClearMetadatas(serializedScene.particleSystems),this._ClearMetadatas(serializedScene.materials),this._ClearMetadatas(serializedScene.skeletons),this._ClearMetadatas(serializedScene.sounds),this._ClearMetadatas([serializedScene]),"babylon"===format&&(editor.sceneFile=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(JSON.stringify(serializedScene)),"scene"+this._LastRandomId+".babylon"),babylonjs_1.FilesInputStore.FilesToLoad[editor.sceneFile.name]=editor.sceneFile),editor.guiFiles=[],editor.core.uiTextures.forEach(function(ut){var serializedGui=ut.serialize();editor.guiFiles.push(tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(JSON.stringify(serializedGui)),ut.name+".gui"))});var name="scene"+this._LastRandomId+".editorproject",project=project_exporter_1.default.Export(editor);editor.projectFile=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(JSON.stringify(project)),name),babylonjs_1.FilesInputStore.FilesToLoad[editor.projectFile.name]=editor.projectFile},SceneExporter.DownloadBabylonFile=function(editor){this.CreateFiles(editor),babylonjs_1.Tools.Download(editor.sceneFile,editor.sceneFile.name)},SceneExporter._ClearMetadatas=function(objects){objects&&objects.forEach(function(m){m.metadata?(delete m.metadata.original,m.metadata.baseConfiguration&&(m.pickable=m.metadata.baseConfiguration.isPickable),m.metadata.customMetadatas&&(m.metadata=m.metadata.customMetadatas)):delete m.metadata})},SceneExporter.ProjectExportFormat="babylon",SceneExporter._LastRandomId=babylonjs_1.Tools.RandomId(),SceneExporter}();exports.default=SceneExporter}),$__System.registerDynamic("5f",["6d","c","f","17","18"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var SocketIO=$__require("6d"),babylonjs_1=$__require("c"),tools_1=$__require("f"),request_1=$__require("17"),scene_exporter_1=$__require("18"),ScenePreview=function(){function ScenePreview(){}return ScenePreview.Create=function(editor){return __awaiter(this,void 0,void 0,function(){var address,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,request_1.default.Get("/address")];case 1:return address=_a.sent(),this.externSocket=SocketIO("http://"+address+":1337/"),this.localSocket=SocketIO("http://localhost:1337/"),this.externSocket.on("request-scene",function(){return _this.CreateFiles(editor,_this.externSocket)}),this.localSocket.on("request-scene",function(){return _this.CreateFiles(editor,_this.localSocket)}),[2]}})})},ScenePreview.CreateFiles=function(editor,socket){return __awaiter(this,void 0,void 0,function(){var datas,_a,_b,_i,name_1,file,data,_c,_d,_e,_f;return __generator(this,function(_g){switch(_g.label){case 0:datas={},_a=[];for(_b in babylonjs_1.FilesInputStore.FilesToLoad)_a.push(_b);_i=0,_g.label=1;case 1:return _i<_a.length?(name_1=_a[_i],"babylon"===tools_1.default.GetFileExtension(name_1)?[3,3]:(file=babylonjs_1.FilesInputStore.FilesToLoad[name_1],[4,tools_1.default.ReadFileAsArrayBuffer(file)])):[3,4];case 2:data=_g.sent(),datas[name_1]=data,_g.label=3;case 3:return _i++,[3,1];case 4:return scene_exporter_1.default.CreateFiles(editor),_c=datas,_d=editor.sceneFile.name,[4,tools_1.default.ReadFileAsArrayBuffer(editor.sceneFile)];case 5:return _c[_d]=_g.sent(),_e=datas,_f=editor.projectFile.name,[4,tools_1.default.ReadFileAsArrayBuffer(editor.projectFile)];case 6:return _e[_f]=_g.sent(),socket.emit("receive-scene",datas),[2]}})})},ScenePreview.externSocket=null,ScenePreview.localSocket=null,ScenePreview}();exports.default=ScenePreview}),$__System.registerDynamic("13",["f"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var tools_1=$__require("f"),Toolbar=function(){function Toolbar(name){this.items=[],this.right=void 0,this.helpUrl=void 0,this.name=name}return Toolbar.prototype.isChecked=function(id,justClicked){void 0===justClicked&&(justClicked=!1);var result=this.element.get(id);return justClicked?!result.checked:result.checked},Toolbar.prototype.setChecked=function(id,checked){checked?this.element.check(id):this.element.uncheck(id)},Toolbar.prototype.enable=function(id,enabled){enabled?this.element.enable(id):this.element.disable(id)},Toolbar.prototype.updateItem=function(id,data){var item=this.element.get(id);Object.assign(item,data),this.element.refresh(id)},Toolbar.prototype.notifyMessage=function(message){this.element.right=message,this.element.render()},Toolbar.prototype.build=function(parentId){var _this=this;this.helpUrl&&(this.items.push({type:"break"}),this.items.push({type:"button",id:"generated-help-button",img:"icon-help",caption:"Help...",text:"Help..."})),this.element=$("#"+parentId).w2toolbar({name:this.name,items:this.items,onClick:function(event){"generated-help-button"===event.target&&tools_1.default.OpenPopup(_this.helpUrl,"Documentation",1280,800),_this.onClick&&_this.onClick(event.target)},right:this.right})},Toolbar}();exports.default=Toolbar}),$__System.registerDynamic("22",["c","13","15"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var GizmoType,babylonjs_1=$__require("c"),toolbar_1=$__require("13"),undo_redo_1=$__require("15");!function(GizmoType){GizmoType[GizmoType.NONE=0]="NONE",GizmoType[GizmoType.BOUNDING_BOX=1]="BOUNDING_BOX",GizmoType[GizmoType.POSITION=2]="POSITION",GizmoType[GizmoType.ROTATION=3]="ROTATION",GizmoType[GizmoType.SCALING=4]="SCALING"}(GizmoType=exports.GizmoType||(exports.GizmoType={}));var ScenePicker=function(){function ScenePicker(editor,scene,canvas){var _this=this;this.currentMesh=null,this.lastMesh=null,this.lastClickedMesh=null,this.lastX=0,this.lastY=0,this.onCanvasPointer=null,this.onCanvasBlur=null,this.onCanvasFocus=null,this.currentGizmo=null,this._enabled=!0,this._gizmoType=GizmoType.NONE,this._gizmoDelta=0,this._gizmoScaleDelta=null,this._gizmoPositionDelta=null,this._gizmoRotationDelta=null,this.canvas=canvas,this.scene=scene,this.editor=editor,scene.cameras.forEach(function(c){c.detachControl(canvas),c.attachControl(canvas,!0)}),scene.meshes.forEach(function(m){return _this.configureMesh(m)}),this.gizmosLayer=new babylonjs_1.UtilityLayerRenderer(scene),this.gizmosLayer.utilityLayerScene.postProcessesEnabled=!1,this.gizmosLayer.shouldRender=!1,this.addEvents()}return ScenePicker.prototype.configureMesh=function(mesh){mesh.metadata=mesh.metadata||{},mesh.metadata.baseConfiguration={isPickable:mesh.isPickable},mesh.isPickable=!0},Object.defineProperty(ScenePicker.prototype,"enabled",{get:function(){return this._enabled},set:function(value){this._enabled=value,value||(this.gizmoType=GizmoType.NONE,this.lastMesh&&(this.lastMesh.showBoundingBox=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(ScenePicker.prototype,"gizmoType",{set:function(value){var _this=this;switch(this._gizmoType=value,this.boundingBoxGizmo&&this.boundingBoxGizmo.dispose(),this.positionGizmo&&this.positionGizmo.dispose(),this.rotationGizmo&&this.rotationGizmo.dispose(),this.scalingGizmo&&this.scalingGizmo.dispose(),this.boundingBoxGizmo=this.positionGizmo=this.rotationGizmo=this.scalingGizmo=null,value){case GizmoType.BOUNDING_BOX:this.currentGizmo=this.boundingBoxGizmo=new babylonjs_1.BoundingBoxGizmo(new babylonjs_1.Color3(1,1,1),this.gizmosLayer),this.boundingBoxGizmo.rotationSphereSize=1,this.boundingBoxGizmo.scaleBoxSize=1;break;case GizmoType.POSITION:this.currentGizmo=this.positionGizmo=new babylonjs_1.PositionGizmo(this.gizmosLayer);break;case GizmoType.ROTATION:this.currentGizmo=this.rotationGizmo=new babylonjs_1.RotationGizmo(this.gizmosLayer);break;case GizmoType.SCALING:this.currentGizmo=this.scalingGizmo=new babylonjs_1.ScaleGizmo(this.gizmosLayer);break;default:return}this.setGizmoAttachedMesh(this.editor.core.currentSelectedObject),this.currentGizmo.scaleRatio=2.5,this.currentGizmo instanceof babylonjs_1.BoundingBoxGizmo?(this.currentGizmo.onScaleBoxDragObservable.add(function(_){null===_this._gizmoScaleDelta&&(_this._gizmoScaleDelta=babylonjs_1.Vector3.Zero().copyFrom(_this.boundingBoxGizmo.attachedMesh.scaling),_this._gizmoPositionDelta=babylonjs_1.Vector3.Zero().copyFrom(_this.boundingBoxGizmo.attachedMesh.position))}),this.currentGizmo.onRotationSphereDragObservable.add(function(_){null===_this._gizmoRotationDelta&&(_this._gizmoRotationDelta=(new babylonjs_1.Quaternion).copyFrom(_this.boundingBoxGizmo.attachedMesh.rotationQuaternion))}),this.currentGizmo.onScaleBoxDragEndObservable.add(function(_){return _this.undoRedo("boundingbox")}),this.currentGizmo.onRotationSphereDragEndObservable.add(function(_){return _this.undoRedo("boundingbox")})):(this.currentGizmo.xGizmo.dragBehavior.onDragObservable.add(function(){return _this.onUpdateMesh&&_this.onUpdateMesh(_this.currentGizmo.attachedMesh)}),this.currentGizmo.yGizmo.dragBehavior.onDragObservable.add(function(){return _this.onUpdateMesh&&_this.onUpdateMesh(_this.currentGizmo.attachedMesh)}),this.currentGizmo.zGizmo.dragBehavior.onDragObservable.add(function(){return _this.onUpdateMesh&&_this.onUpdateMesh(_this.currentGizmo.attachedMesh)}),this.currentGizmo.xGizmo.dragBehavior.onDragObservable.add(function(g){return _this._gizmoDelta+=g.delta.x}),this.currentGizmo.yGizmo.dragBehavior.onDragObservable.add(function(g){return _this._gizmoDelta+=g.delta.y}),this.currentGizmo.zGizmo.dragBehavior.onDragObservable.add(function(g){return _this._gizmoDelta+=g.delta.z}),this.currentGizmo.xGizmo.dragBehavior.onDragEndObservable.add(function(_){return _this.undoRedo("x")}),this.currentGizmo.yGizmo.dragBehavior.onDragEndObservable.add(function(_){return _this.undoRedo("y")}),this.currentGizmo.zGizmo.dragBehavior.onDragEndObservable.add(function(_){return _this.undoRedo("z")}))},enumerable:!0,configurable:!0}),ScenePicker.prototype.setGizmoAttachedMesh=function(mesh){mesh&&mesh instanceof babylonjs_1.AbstractMesh&&(this.boundingBoxGizmo&&(this.boundingBoxGizmo.attachedMesh=mesh),this.positionGizmo&&(this.positionGizmo.attachedMesh=mesh),this.rotationGizmo&&(this.rotationGizmo.attachedMesh=mesh),this.scalingGizmo&&(this.scalingGizmo.attachedMesh=mesh))},ScenePicker.prototype.addEvents=function(){var _this=this;this.onCanvasPointer=this.scene.onPointerObservable.add(function(ev){if(_this.scene.activeCamera)switch(ev.type){case babylonjs_1.PointerEventTypes.POINTERDOWN:_this.onCanvasDown(ev.event);break;case babylonjs_1.PointerEventTypes.POINTERTAP:_this.onCanvasClick(ev.event);break;case babylonjs_1.PointerEventTypes.POINTERMOVE:_this.onCanvasMove(ev.event);break;case babylonjs_1.PointerEventTypes.POINTERDOUBLETAP:_this.onCanvasDblClick(ev.event)}}),this.onCanvasBlur=this.scene.getEngine().onCanvasPointerOutObservable.add(function(ev){_this.lastMesh&&(_this.lastMesh.showBoundingBox=!1),_this.lastClickedMesh&&(_this.lastClickedMesh.showBoundingBox=!0)}),this.onCanvasFocus=this.scene.getEngine().onCanvasBlurObservable.add(function(ev){_this.lastClickedMesh&&(_this.lastClickedMesh.showBoundingBox=!1),_this.lastMesh&&(_this.lastMesh.showBoundingBox=!0)})},ScenePicker.prototype.remove=function(){this.scene.onPointerObservable.remove(this.onCanvasPointer),this.scene.getEngine().onCanvasPointerOutObservable.remove(this.onCanvasBlur),this.scene.getEngine().onCanvasFocusObservable.remove(this.onCanvasFocus),this.gizmosLayer.dispose()},ScenePicker.prototype.createGizmosToolbar=function(divId){var _this=this,toolbar=new toolbar_1.default(divId);return toolbar.items=[{type:"button",id:"position",text:"",img:"icon-position",checked:!1},{type:"button",id:"rotation",text:"",img:"icon-rotation",checked:!1},{type:"button",id:"scaling",text:"",img:"icon-scaling",checked:!1},{type:"button",id:"bounding-box",text:"",img:"icon-bounding-box",checked:!1}],toolbar.build(divId),toolbar.onClick=function(id){switch(id){case"bounding-box":case"position":case"rotation":case"scaling":var active=toolbar.isChecked(id,!0);if(toolbar.setChecked("bounding-box",!1),toolbar.setChecked("position",!1),toolbar.setChecked("rotation",!1),toolbar.setChecked("scaling",!1),toolbar.setChecked(id,active),_this.gizmosLayer.shouldRender=active,!active){_this.gizmoType=GizmoType.NONE;break}switch(id){case"bounding-box":_this.gizmoType=GizmoType.BOUNDING_BOX;break;case"position":_this.gizmoType=GizmoType.POSITION;break;case"rotation":_this.gizmoType=GizmoType.ROTATION;break;case"scaling":_this.gizmoType=GizmoType.SCALING}_this.setGizmoAttachedMesh(_this.currentMesh)}},toolbar},ScenePicker.prototype.undoRedo=function(axis){var _this=this,vector=null;switch(this._gizmoType){case GizmoType.POSITION:if(!this.positionGizmo)return;vector=this.positionGizmo.xGizmo.attachedMesh.position;break;case GizmoType.ROTATION:if(!this.rotationGizmo)return;vector=this.rotationGizmo.xGizmo.attachedMesh.rotation;break;case GizmoType.SCALING:if(!this.scalingGizmo)return;vector=this.scalingGizmo.xGizmo.attachedMesh.scaling;break;default:if(!this.boundingBoxGizmo)return}switch(axis){case"x":undo_redo_1.default.Push({object:vector,property:"x",from:vector.x-this._gizmoDelta,to:vector.x});break;case"y":undo_redo_1.default.Push({object:vector,property:"y",from:vector.y-this._gizmoDelta,to:vector.y});break;case"z":undo_redo_1.default.Push({object:vector,property:"z",from:vector.z-this._gizmoDelta,to:vector.z});break;case"boundingbox":if(this._gizmoScaleDelta){var lastScale_1=this._gizmoScaleDelta.clone(),lastPosition_1=this._gizmoPositionDelta.clone(),newScale_1=this.boundingBoxGizmo.attachedMesh.scaling.clone(),newPosition_1=this.boundingBoxGizmo.attachedMesh.position.clone();undo_redo_1.default.Push({fn:function(type){"from"===type?(_this.boundingBoxGizmo.attachedMesh.scaling=lastScale_1,_this.boundingBoxGizmo.attachedMesh.position=lastPosition_1):(_this.boundingBoxGizmo.attachedMesh.scaling=newScale_1,_this.boundingBoxGizmo.attachedMesh.position=newPosition_1)}})}else{var lastRotation=this._gizmoRotationDelta.clone(),newRotation=this.boundingBoxGizmo.attachedMesh.rotationQuaternion.clone();undo_redo_1.default.Push({object:this.boundingBoxGizmo.attachedMesh,property:"rotationQuaternion",from:lastRotation,to:newRotation})}}this._gizmoDelta=0,this._gizmoScaleDelta=null,this._gizmoPositionDelta=null,this._gizmoRotationDelta=null},ScenePicker.prototype.onCanvasDown=function(ev){this.lastX=ev.offsetX,this.lastY=ev.offsetY},ScenePicker.prototype.onCanvasClick=function(ev){if(this._enabled&&!(Math.abs(this.lastX-ev.offsetX)>5||Math.abs(this.lastY-ev.offsetY)>5)){var pick=this.editor.sceneIcons.pickIcon(ev.offsetX,ev.offsetY)||this.scene.pick(ev.offsetX,ev.offsetY);pick.pickedMesh&&(this.currentMesh=pick.pickedMesh,this.onPickedMesh&&this.onPickedMesh(pick.pickedMesh),this.setGizmoAttachedMesh(pick.pickedMesh),this.lastClickedMesh=pick.pickedMesh)}},ScenePicker.prototype.onCanvasMove=function(ev){if(this._enabled){this.lastMesh&&(this.lastMesh.showBoundingBox=!1),this.lastClickedMesh&&(this.lastClickedMesh.showBoundingBox=!1);var pick=this.editor.sceneIcons.pickIcon(ev.offsetX,ev.offsetY,!1)||this.scene.pick(ev.offsetX,ev.offsetY);pick.pickedMesh&&(this.lastMesh=pick.pickedMesh,pick.pickedMesh.showBoundingBox=!0)}},ScenePicker.prototype.onCanvasDblClick=function(ev){if(this._enabled){var camera=this.scene.activeCamera;if(camera instanceof babylonjs_1.TargetCamera){var pick=this.editor.sceneIcons.pickIcon(ev.offsetX,ev.offsetY)||this.scene.pick(ev.offsetX,ev.offsetY);pick.pickedMesh&&(ScenePicker.CreateAndPlayFocusAnimation(camera.getTarget(),pick.pickedMesh.getAbsolutePosition(),camera),this.lastClickedMesh=pick.pickedMesh)}}},ScenePicker.CreateAndPlayFocusAnimation=function(start,end,camera){var anim=new babylonjs_1.Animation("LockedTargetAnimation","target",60,babylonjs_1.Animation.ANIMATIONTYPE_VECTOR3);anim.setKeys([{frame:0,value:start},{frame:24,value:end}]);var scene=camera.getScene();scene.stopAnimation(camera),scene.beginDirectAnimation(camera,[anim],0,24,!1,1)},ScenePicker}();exports.default=ScenePicker}),$__System.registerDynamic("11",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Form=function(){function Form(name){this.element=null,this.fields=[],this.name=name}return Form.prototype.isValid=function(){return 0===this.element.validate().length},Form.prototype.build=function(parentId){var _this=this;this.element=$("#"+parentId).w2form({name:this.name,fields:this.fields,onChange:function(event){event.onComplete=function(){return _this.onChange&&_this.onChange()}}})},Form}();exports.default=Form}),$__System.registerDynamic("14",["10","11"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var window_1=$__require("10"),form_1=$__require("11"),Dialog=function(){function Dialog(){}return Dialog.Create=function(title,body,callback,yes,no){return new Promise(function(resolve){w2confirm(body,title,function(result){resolve(result),callback&&callback(result)}).yes(function(){return yes&&yes()}).no(function(){return no&&no()})})},Dialog.CreateWithTextInput=function(title){var _this=this;return new Promise(function(resolve,reject){return __awaiter(_this,void 0,void 0,function(){var popin,form;return __generator(this,function(_a){switch(_a.label){case 0:return popin=new window_1.default("AskName"),popin.title=title,popin.body='<div id="ASK-NAME-CREATE-DIALOG" style="width: 100%; height: 100%"></div>',popin.buttons=["Ok"],popin.showClose=!1,popin.showMax=!1,popin.width=500,popin.height=160,[4,popin.open()];case 1:return _a.sent(),form=new form_1.default("ASK-NAME-CREATE-DIALOG"),form.fields.push({name:"Name",required:!0,type:"text",options:{}}),form.onChange=function(){return popin.onButtonClick("Ok")},form.build("ASK-NAME-CREATE-DIALOG"),popin.onClose=function(){form.element.destroy(),reject("User decided to not give an input")},popin.onButtonClick=function(id){form.isValid()&&(resolve(form.element.record.Name),popin.close())},[2]}})})})},Dialog}();exports.default=Dialog}),$__System.registerDynamic("6e",["c","f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),tools_1=$__require("f"),PrefabsHelpers=function(){function PrefabsHelpers(){}return PrefabsHelpers.CreatePreview=function(d,engine){return __awaiter(this,void 0,void 0,function(){var serialization,file,canvas,scene,camera,light;return __generator(this,function(_a){switch(_a.label){case 0:return serialization=babylonjs_1.SceneSerializer.SerializeMesh(d.data.sourceNode,!1,!0),file=tools_1.default.CreateFile(tools_1.default.ConvertStringToUInt8Array(JSON.stringify(serialization)),d.name.toLowerCase()+"_prefab.babylon"),canvas=engine.getRenderingCanvas(),scene=new babylonjs_1.Scene(engine),scene.clearColor.set(0,0,0,1),camera=new babylonjs_1.FreeCamera("PrefabAssetCamera",babylonjs_1.Vector3.Zero(),scene),light=new babylonjs_1.PointLight("PrefabAssetLight",babylonjs_1.Vector3.Zero(),scene),babylonjs_1.FilesInputStore.FilesToLoad[file.name]=file,[4,new Promise(function(resolve){babylonjs_1.SceneLoader.Append("file:",file.name,scene,function(){engine.runRenderLoop(function(){if(scene.render(),0===scene.getWaitingItemsCount()){if(d.data.sourceNode instanceof babylonjs_1.ParticleSystem)return;var minimum_1=new babylonjs_1.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),maximum_1=new babylonjs_1.Vector3(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);[d.data.sourceNode].concat(d.data.sourceNode.getDescendants(!1,function(n){return n instanceof babylonjs_1.Mesh})).forEach(function(d){if(d instanceof babylonjs_1.Mesh){var b=d._boundingInfo;maximum_1.x=Math.max(b.maximum.x,maximum_1.x),maximum_1.y=Math.max(b.maximum.y,maximum_1.y),maximum_1.z=Math.max(b.maximum.z,maximum_1.z),minimum_1.x=Math.min(b.minimum.x,minimum_1.x),minimum_1.y=Math.min(b.minimum.y,minimum_1.y),minimum_1.z=Math.min(b.minimum.z,minimum_1.z)}});var center=babylonjs_1.Vector3.Center(minimum_1,maximum_1),distance=.5*babylonjs_1.Vector3.Distance(minimum_1,maximum_1);camera.position=d.data.sourceNode.position.add(maximum_1).add(new babylonjs_1.Vector3(distance,distance,distance)),camera.setTarget(d.data.sourceNode.position.add(center)),light.position=camera.position.clone(),scene.render(),d.img=canvas.toDataURL("image/png"),engine.stopRenderLoop(),resolve()}})}),engine.hideLoadingUI()})];case 1:return _a.sent(),delete babylonjs_1.FilesInputStore.FilesToLoad[file.name],scene.dispose(),[2]}})})},PrefabsHelpers}();exports.default=PrefabsHelpers}),$__System.registerDynamic("56",["c","19","f","14","6e"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),scene_factory_1=$__require("19"),tools_1=$__require("f"),dialog_1=$__require("14"),helpers_1=$__require("6e"),PrefabAssetComponent=function(){function PrefabAssetComponent(editor){this.editor=editor,this.id="prefabs",this.assetsCaption="Prefabs",this.size=100,this.datas=[],this.previewCanvas=null,this.previewEngine=null}return PrefabAssetComponent.prototype.createPrefab=function(sourceNode){return __awaiter(this,void 0,void 0,function(){var descendants,sourceNodes,scene,_loop_1,_i,_a,ps,asset,_b;return __generator(this,function(_c){switch(_c.label){case 0:for(descendants=sourceNode.getDescendants(!1,function(n){return n instanceof babylonjs_1.Node}),sourceNodes=descendants.length>1||descendants[0]!==sourceNode?[sourceNode].concat(descendants):[sourceNode],scene=this.editor.core.scene,_loop_1=function(ps){sourceNodes.find(function(n){return n===ps.emitter})&&sourceNodes.push(ps)},_i=0,_a=scene.particleSystems;_i<_a.length;_i++)ps=_a[_i],_loop_1(ps);return _b={},[4,dialog_1.default.CreateWithTextInput("Prefab name?")];case 1:return _b.name=_c.sent(),_b.data={isPrefab:!0,nodes:sourceNodes.map(function(m){return m.name}),nodeIds:sourceNodes.map(function(m){return m.id}),instances:{},sourceNodes:sourceNodes,sourceNode:sourceNode,sourceInstances:{}},asset=_b,sourceNodes.forEach(function(m){asset.data.instances[m.id]=[],asset.data.sourceInstances[m.id]=[]}),this.onAddAsset(asset),this.editor.assets.refresh(this.id),[2,asset]}})})},PrefabAssetComponent.prototype.getAssetFromNode=function(node){for(var _i=0,_a=this.datas;_i<_a.length;_i++){var p=_a[_i];if(p.data.sourceNode===node)return p;if(-1!==p.data.sourceNodes.indexOf(node))return p;for(var si in p.data.sourceInstances)for(var instances=p.data.sourceInstances[si],_b=0,instances_1=instances;_b<instances_1.length;_b++){var i=instances_1[_b];if(node===i)return p}}return null},PrefabAssetComponent.prototype.onAddAsset=function(asset){this.datas.push(asset),this.buildInstances([asset])},PrefabAssetComponent.prototype.onRemoveAsset=function(asset){var saved=this.onSerializeAssets(),assetIndex=this.datas.indexOf(asset);-1!==assetIndex&&(asset.data.instances=saved[assetIndex].data.instances);var instancesDictionary=asset.data.sourceInstances;for(var key in instancesDictionary){instancesDictionary[key].forEach(function(i){return i.dispose()}),instancesDictionary[key]=[]}var index=this.datas.indexOf(asset);-1!==index&&this.datas.splice(index,1),this.editor.graph.clear(),this.editor.graph.fill(),this.editor.assets.refresh(this.id)},PrefabAssetComponent.prototype.onDoubleClickAsset=function(asset){this.editor.addEditPanelPlugin("prefab-editor",!1,"Prefab Editor...",asset.data)},PrefabAssetComponent.prototype.onDragAndDropAsset=function(targetMesh,asset,pickInfo){var _this=this,parent=asset.data.sourceNode instanceof babylonjs_1.Mesh?asset.data.sourceNode.createInstance(asset.data.sourceNode.name+" (Prefab)"):this._cloneNode(asset.data.sourceNode);parent.isPickable=!0,parent.id=babylonjs_1.Tools.RandomId(),parent.position&&parent.position.copyFrom(pickInfo.pickedPoint),parent.doNotSerialize=!0,babylonjs_1.Tags.AddTagsTo(parent,"prefab-master"),asset.data.sourceInstances[asset.data.sourceNode.id].push(parent),asset.data.sourceNodes.length>1&&asset.data.sourceNodes.forEach(function(m,index){if(0!==index){var instance=m instanceof babylonjs_1.Mesh?m.createInstance(m.name+"inst"):_this._cloneNode(m);instance.isPickable=!0,instance.id=babylonjs_1.Tools.RandomId(),instance.parent=instance.emitter=parent,instance.doNotSerialize=!0,babylonjs_1.Tags.AddTagsTo(instance,"prefab"),asset.data.sourceInstances[m.id].push(instance)}}),scene_factory_1.default.AddToGraph(this.editor,parent),babylonjs_1.Tags.RemoveTagsFrom(parent,"added"),this.editor.scenePicker.setGizmoAttachedMesh(parent),this.editor.core.onSelectObject.notifyObservers(parent)},PrefabAssetComponent.prototype.onSerializeAssets=function(){return this.datas.map(function(d){var instances={};return d.data.sourceNodes.forEach(function(m){instances[m.id]=[],m instanceof babylonjs_1.Mesh?m.instances.forEach(function(i){babylonjs_1.Tags.MatchesQuery(i,"removed")||(babylonjs_1.Tags.MatchesQuery(i,"prefab")||babylonjs_1.Tags.MatchesQuery(i,"prefab-master"))&&instances[m.id].push(i.serialize())}):d.data.sourceInstances[m.id].forEach(function(i){if(!babylonjs_1.Tags.MatchesQuery(i,"removed")&&(babylonjs_1.Tags.MatchesQuery(i,"prefab")||babylonjs_1.Tags.MatchesQuery(i,"prefab-master"))){var serializationObject=i.serialize();serializationObject.customType=tools_1.default.GetConstructorName(i),instances[m.id].push(serializationObject)}})}),{name:d.name,img:d.img,data:{isPrefab:!0,nodes:d.data.sourceNodes.map(function(m){return m.name}),nodeIds:d.data.sourceNodes.map(function(m){return m.id}),instances:instances}}})},PrefabAssetComponent.prototype.onParseAssets=function(data){this.datas=data,this.buildInstances(this.datas)&&(this.editor.graph.clear(),this.editor.graph.fill(),this.editor.graph.configure())},PrefabAssetComponent.prototype.onGetAssets=function(){return __awaiter(this,void 0,void 0,function(){var promises,_loop_2,this_1,_i,_a,d,_this=this;return __generator(this,function(_b){for(this.previewCanvas||(this.previewCanvas=tools_1.default.CreateElement("canvas","PrefabAssetComponentCanvas",{width:"100px",height:"100px",visibility:"hidden"}),document.body.appendChild(this.previewCanvas)),this.previewEngine||(this.previewEngine=new babylonjs_1.Engine(this.previewCanvas)),promises=[],_loop_2=function(d){d.img||(promises.push(helpers_1.default.CreatePreview(d,this_1.previewEngine).then(function(){var adp=_this.editor.assets.getAssetPreviewData(d);adp&&(adp.img.src=d.img,w2utils.unlock(adp.parent))})),setTimeout(function(){var adp=_this.editor.assets.getAssetPreviewData(d);adp&&(adp.img.src="",w2utils.lock(adp.parent,"",!0))},0))},this_1=this,_i=0,_a=this.datas;_i<_a.length;_i++)d=_a[_i],_loop_2(d);return[2,this.datas]})})},PrefabAssetComponent.prototype.onContextMenu=function(){var _this=this;return[{id:"rename",text:"Rename...",img:"icon-export",callback:function(asset){return __awaiter(_this,void 0,void 0,function(){var name,adp;return __generator(this,function(_a){switch(_a.label){case 0:return[4,dialog_1.default.CreateWithTextInput("Asset name...")];case 1:return name=_a.sent(),asset.name=name,adp=this.editor.assets.getAssetPreviewData(asset),adp.title.innerText=name,[2]}})})}}]},PrefabAssetComponent.prototype.buildInstances=function(data){var _this=this,count=0;return data.forEach(function(d){d.data.sourceNodes=[],d.data.sourceInstances={};var source=_this._getNode(d.data.nodeIds[0],d.data.nodes[0]);if(source){d.data.sourceNode=source,d.data.sourceNodes.push(source);var parents=d.data.instances[source.name]||d.data.instances[source.id];d.data.sourceInstances[source.id]=[],parents.forEach(function(p){var parent=source instanceof babylonjs_1.Mesh?source.createInstance(p.name):_this._cloneNode(source,p);parent.id=p.id,parent.doNotSerialize=!0,parent.isPickable=!0,(d.data.sourceInstances[source.name]||d.data.sourceInstances[source.id]).push(parent),babylonjs_1.Tags.AddTagsTo(parent,"prefab-master"),parent instanceof babylonjs_1.InstancedMesh&&_this._configureInstance(p,parent),count++});for(var _loop_3=function(i){var node=_this._getNode(d.data.nodeIds[i],d.data.nodes[i]);if(!node)return"continue";d.data.sourceNodes.push(node),d.data.sourceInstances[node.id]=[],(d.data.instances[node.name]||d.data.instances[node.id]).forEach(function(inst){var instance=node instanceof babylonjs_1.Mesh?node.createInstance(inst.name):_this._cloneNode(node,inst);instance.id=inst.id,instance.parent=instance.emitter=_this.editor.core.scene.getNodeByID(inst.parentId),instance.doNotSerialize=!0,instance.isPickable=!0,d.data.sourceInstances[node.id].push(instance),babylonjs_1.Tags.AddTagsTo(instance,"prefab"),instance instanceof babylonjs_1.InstancedMesh&&_this._configureInstance(inst,instance),count++})},i=1;i<d.data.nodeIds.length;i++)_loop_3(i);d.data.instances={}}}),count},PrefabAssetComponent.prototype.setSerializable=function(serializable){this.datas.forEach(function(d){for(var key in d.data.sourceInstances){d.data.sourceInstances[key].forEach(function(i){return i.doNotSerialize=!serializable})}})},PrefabAssetComponent.prototype._cloneNode=function(node,prefab){if(prefab&&prefab.customType){var clone=BABYLON[prefab.customType].Parse(prefab,this.editor.core.scene,"file:");return clone}if(node.clone){var clone=node.clone(node.name+" Cloned",node.parent);return clone instanceof babylonjs_1.ParticleSystem&&(clone.particleTexture&&clone.particleTexture.dispose(),clone.particleTexture=node.particleTexture),clone}return null},PrefabAssetComponent.prototype._getNode=function(id,name){var scene=this.editor.core.scene;return scene.getNodeByID(id)||scene.getNodeByName(name)||scene.getParticleSystemByID(id)},PrefabAssetComponent.prototype._configureInstance=function(data,instance){if(instance.id=instance.id||babylonjs_1.Tools.RandomId(),instance.position=babylonjs_1.Vector3.FromArray(data.position||data._position),instance.scaling=babylonjs_1.Vector3.FromArray(data.scaling||data._scaling),instance.checkCollisions=instance.sourceMesh.checkCollisions,data.rotationQuaternion||data._rotationQuaternion?instance.rotationQuaternion=babylonjs_1.Quaternion.FromArray(data.rotationQuaternion||data._rotationQuaternion):(data.rotation||data._rotation)&&(instance.rotation=babylonjs_1.Vector3.FromArray(data.rotation||data._rotation)),data.animations)for(var i=0;i<data.animations.length;i++){var parsedAnimation=data.animations[i];instance.animations.push(babylonjs_1.Animation.Parse(parsedAnimation))}},PrefabAssetComponent}();exports.default=PrefabAssetComponent}),$__System.registerDynamic("15",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var UndoRedo=function(){function UndoRedo(){}return UndoRedo.Push=function(element){var start=this.CurrentIndex===this.Stack.length-1?this.CurrentIndex+1:this.CurrentIndex;start<0&&(start=0);for(var i=start;i<this.Stack.length;i++)this.Stack.splice(i,1),i--;this.Stack.push(element),this.CurrentIndex=this.Stack.length-1,this.Stack.length>this.StackSize&&this.Stack.splice(0,1),element.redo&&element.redo(),this.onRedo&&this.onRedo(element)},UndoRedo.Pop=function(){this.Stack.pop(),this.CurrentIndex>0&&this.CurrentIndex--},UndoRedo.ClearScope=function(scope){for(var i=0;i<this.Stack.length;i++){this.Stack[i].scope===scope&&(this.Stack.splice(i,1),i--,this.CurrentIndex--)}},UndoRedo.Clear=function(){this.Stack=[],this.CurrentIndex=0},UndoRedo.Undo=function(){if(0===this.Stack.length||this.CurrentIndex<0)return null;var element=this.Stack[this.CurrentIndex];return this._SetEffectivePropertyValue(element.object,element.property,element.from),element.fn&&element.fn("from"),element.undo&&element.undo(),this.CurrentIndex--,this.onUndo&&this.onUndo(element),element},UndoRedo.Redo=function(){if(!(0===this.Stack.length||this.CurrentIndex>=this.Stack.length-1)){this.CurrentIndex<this.Stack.length&&this.CurrentIndex++;var element=this.Stack[this.CurrentIndex];return this._SetEffectivePropertyValue(element.object,element.property,element.to),element.fn&&element.fn("to"),element.redo&&element.redo(),this.onRedo&&this.onRedo(element),element}},UndoRedo._SetEffectivePropertyValue=function(object,property,value){if(property&&object){var split=property.split(".");if(split.length>1){property=split[split.length-1];for(var i=0;i<split.length-1;i++)object=object[split[i]]}object[property]=value}},UndoRedo.Stack=[],UndoRedo.CurrentIndex=0,UndoRedo.StackSize=2e3,UndoRedo}();exports.default=UndoRedo}),$__System.registerDynamic("1b",["c","15","2d","10"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),BABYLON=$__require("c"),undo_redo_1=$__require("15"),picker_1=$__require("2d"),window_1=$__require("10"),SceneManager=function(){function SceneManager(){}return SceneManager.Clear=function(){this.ActionManagers={},this.PostProcessExtension=null,this.GlowLayer=null,this.HighLightLayer=null,this.StandardRenderingPipeline=null,this.DefaultRenderingPipeline=null,this.SSAO2RenderingPipeline=null,this.SSAORenderingPipeline=null,this.EnvironmentHelper=null,this.RemovedObjects={}},SceneManager.Toggle=function(scene){var _this=this;scene.meshes.forEach(function(m){var savedActionManager=_this.ActionManagers[m.id]||null,currentActionManager=m.actionManager;_this.ActionManagers[m.id]=currentActionManager,m.actionManager=savedActionManager})},SceneManager.SaveOriginalObjects=function(scene){var set=function(orig,obj){orig.metadata=orig.metadata||{},orig.metadata.original=obj};scene.meshes.forEach(function(m){if(m instanceof babylonjs_1.InstancedMesh)return set(m,m.serialize());var s=babylonjs_1.SceneSerializer.SerializeMesh(m,!1,!1);delete s.geometries,delete s.materials,delete s.skeletons,delete s.multiMaterials,set(m,s.meshes[0])}),scene.skeletons.forEach(function(s){return set(s,s.serialize())}),scene.materials.forEach(function(m){return set(m,m.serialize())}),scene.lights.forEach(function(l){return set(l,l.serialize())}),scene.cameras.forEach(function(c){return set(c,c.serialize())}),scene.textures.forEach(function(t){return set(t,t.serialize())}),scene.transformNodes.forEach(function(t){return set(t,t.serialize())}),scene.soundTracks&&scene.soundTracks.forEach(function(st){st.soundCollection.forEach(function(s){return set(s,s.serialize())})})},SceneManager.GetAnimatables=function(scene){var animatables=[scene];return this.StandardRenderingPipeline&&animatables.push(this.StandardRenderingPipeline),scene.meshes.forEach(function(m){return animatables.push(m)}),scene.lights.forEach(function(l){return animatables.push(l)}),scene.cameras.forEach(function(c){return animatables.push(c)}),scene.transformNodes.forEach(function(t){return animatables.push(t)}),scene.particleSystems.forEach(function(ps){return animatables.push(ps)}),animatables},SceneManager.GetAnimationFrameBounds=function(animatables){var bounds={min:Number.MAX_VALUE,max:Number.MIN_VALUE};return animatables.forEach(function(a){a.animations.forEach(function(a){a.getKeys().forEach(function(k){k.frame<bounds.min&&(bounds.min=k.frame),k.frame>bounds.max&&(bounds.max=k.frame)})})}),bounds},SceneManager.PlayAllAnimatables=function(scene,animatables){var bounds=SceneManager.GetAnimationFrameBounds(animatables);animatables.forEach(function(a){return scene.beginAnimation(a,bounds.min,bounds.max,!1,1,null,null,!0)})},SceneManager.StopAllAnimatables=function(scene,animatables){var bounds=SceneManager.GetAnimationFrameBounds(animatables);animatables.forEach(function(a){var animatable=scene.getAnimatableByTarget(a);animatable||(animatable=new babylonjs_1.Animatable(scene,a,bounds.min,bounds.max,!1,1)),animatable.appendAnimations(a,a.animations),animatable.stop(),animatable.goToFrame(bounds.min)})},SceneManager.CleanUnusedMaterials=function(scene){var count=0,used=[];scene.meshes.forEach(function(m){return m.material&&-1===used.indexOf(m.material)&&used.push(m.material)});for(var i=0;i<scene.materials.length;i++){var m=scene.materials[i];"colorShader"!==m.name&&(-1===used.indexOf(m)&&(m.dispose(!0,!1),count++,i--))}return count},SceneManager.CleanUnusedTextures=function(scene){var count=0,used=[];scene.materials.concat(scene.particleSystems).concat(scene.postProcesses).forEach(function(m){for(var thing in m){m[thing]instanceof babylonjs_1.BaseTexture&&-1===used.indexOf(m[thing])&&used.push(m[thing])}});for(var i=0;i<scene.textures.length;i++){var t=scene.textures[i];t instanceof babylonjs_1.RenderTargetTexture||-1!==used.indexOf(t)||(t.dispose(),count++,i--)}return count},SceneManager.ApplyRemovedObjects=function(scene,removedObjects){this.RemovedObjects=removedObjects;var _loop_1=function(id){var value=this_1.RemovedObjects[id],n=scene.getNodeByID(id);if(n)return value.reference=n,n.dispose(!0,!1),"continue";var foundReference=!1;scene.soundTracks&&scene.soundTracks.forEach(function(st){var s=st.soundCollection.find(function(s){return s.name===id});s&&(s.stop(),value.reference=s,s.dispose(),foundReference=!0)}),foundReference||delete this_1.RemovedObjects[id]},this_1=this;for(var id in this.RemovedObjects)_loop_1(id)},SceneManager.RestoreRemovedObjects=function(editor){var _this=this,keys=Object.keys(this.RemovedObjects),picker=new picker_1.default("Restore Removed Objects...");picker.addItems(keys.map(function(i){return{name:_this.RemovedObjects[i].serializationObject.name}})),picker.open(function(items){var errors=[];items.forEach(function(i){var value=_this.RemovedObjects[keys[i.id]],parent=value.reference instanceof babylonjs_1.Node?value.reference.parent:value.reference._connectedTransformNode;if(parent&&!editor.core.scene.getNodeByID(parent.id))return errors.push("Can't restore node \""+i.name+'": the original parent does not exist in scene ("'+parent.name+'")');var result=null;if(value.reference instanceof babylonjs_1.InstancedMesh){var source=editor.core.scene.getMeshByID(value.serializationObject.sourceMesh);if(!source)return errors.push("Can't restore instanced mesh \""+i.name+"\". Source mesh wasn't found.");result=source.createInstance(value.serializationObject.name);try{babylonjs_1.SerializationHelper.Parse(function(){return result},value.serializationObject,editor.core.scene,"file:")}catch(e){return errors.push(e.message)}}else{var ctor=BABYLON[value.type];if(!ctor||!ctor.Parse)return errors.push("Can't restore node \""+i.name+"\": object can't be re-created as the .Parse function does not exist");try{result=ctor.Parse(value.serializationObject,editor.core.scene,"file:")}catch(e){return errors.push('Failed to parse object "'+i.name+'":\n '+e.message)}}result instanceof babylonjs_1.Node?(result instanceof babylonjs_1.AbstractMesh&&editor.scenePicker.configureMesh(result),result.parent=parent,editor.graph.add({data:result,id:result.id,img:editor.graph.getIcon(result),text:result.name},result.parent?result.parent.id:editor.graph.root)):result instanceof babylonjs_1.Sound&&(parent&&result.attachToMesh(parent),result.id=result.id||babylonjs_1.Tools.RandomId(),editor.graph.add({data:result,id:result.id,img:editor.graph.getIcon(result),text:result.name},result.spatialSound&&result._connectedTransformNode?result._connectedTransformNode.id:editor.graph.root)),undo_redo_1.default.ClearScope(result.id),result.metadata=result.metadata||{},result.metadata.original=value.serializationObject,delete _this.RemovedObjects[keys[i.id]],editor.graph.configure()}),errors.length>0&&setTimeout(function(){window_1.default.CreateAlert(errors.join("<br><br>"),"Errors found")},1e3)})},SceneManager.ActionManagers={},SceneManager.StandardRenderingPipeline=null,SceneManager.DefaultRenderingPipeline=null,SceneManager.SSAORenderingPipeline=null,SceneManager.SSAO2RenderingPipeline=null,SceneManager.GlowLayer=null,SceneManager.HighLightLayer=null,SceneManager.EnvironmentHelper=null,SceneManager.PostProcessExtension=null,SceneManager.RemovedObjects={},SceneManager}();exports.default=SceneManager}),$__System.registerDynamic("19",["c","20","38","1b","f","10","2d"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),babylonjs_gui_1=$__require("20"),babylonjs_materials_1=$__require("38"),scene_manager_1=$__require("1b"),tools_1=$__require("f"),window_1=$__require("10"),picker_1=$__require("2d"),SceneFactory=function(){function SceneFactory(){}return SceneFactory.AddToGraph=function(editor,node){babylonjs_1.Tags.AddTagsTo(node,"added"),node.id&&node.id!==node.name||(node.id=babylonjs_1.Tools.RandomId()),node instanceof babylonjs_gui_1.Control?(editor.graph.clear(),editor.graph.fill()):node instanceof babylonjs_1.Node?editor.graph.add({id:node.id,text:node.name,img:editor.graph.getIcon(node),data:node},node.parent?node.parent.id:editor.graph.root):(editor.graph.clear(),editor.graph.fill());var selected=editor.graph.getSelected();editor.graph.select(selected?selected.id:editor.graph.root),editor.graph.select(node.id),editor.graph.configure()},SceneFactory.CreateDefaultEnvironment=function(editor){return scene_manager_1.default.EnvironmentHelper&&scene_manager_1.default.EnvironmentHelper.dispose(),scene_manager_1.default.EnvironmentHelper=editor.core.scene.createDefaultEnvironment({}),this.AddToGraph(editor,scene_manager_1.default.EnvironmentHelper),scene_manager_1.default.EnvironmentHelper},SceneFactory.CreateDefaultParticleSystem=function(editor,spriteSheetEnabled,emitter){var _this=this,scene=editor.core.scene,system=new babylonjs_1.ParticleSystem("New Particle System",1e4,scene,null,spriteSheetEnabled);if(system.id=babylonjs_1.Tools.RandomId(),emitter||tools_1.default.GetFile("assets/textures/flare.png").then(function(f){return __awaiter(_this,void 0,void 0,function(){var b64;return __generator(this,function(_a){switch(_a.label){case 0:return[4,tools_1.default.ReadFileAsBase64(f)];case 1:return b64=_a.sent(),system.particleTexture=babylonjs_1.Texture.CreateFromBase64String(b64,"flare.png",scene),system.particleTexture.name=system.particleTexture.url="flare.png",[2]}})})}),system.minAngularSpeed=-.5,system.maxAngularSpeed=.5,system.minSize=.1,system.maxSize=.5,system.minLifeTime=.5,system.maxLifeTime=2,system.minEmitPower=.5,system.maxEmitPower=4,system.emitRate=400,system.blendMode=babylonjs_1.ParticleSystem.BLENDMODE_ONEONE,system.minEmitBox=new babylonjs_1.Vector3(0,0,0),system.maxEmitBox=new babylonjs_1.Vector3(0,0,0),system.direction1=new babylonjs_1.Vector3(-1,1,-1),system.direction2=new babylonjs_1.Vector3(1,1,1),system.color1=new babylonjs_1.Color4(1,0,0,1),system.color2=new babylonjs_1.Color4(0,1,1,1),system.gravity=new babylonjs_1.Vector3(0,-2,0),system.start(),babylonjs_1.Tags.AddTagsTo(system,"added"),emitter)return system.emitter=emitter,system;var picker=new picker_1.default("Choose Emitter");return picker.addItems(scene.meshes),picker.open(function(items){var emitter=items.length>0?scene.getNodeByName(items[0].name):null;emitter||(emitter=new babylonjs_1.Mesh("New Particle System Emitter",scene),emitter.id=babylonjs_1.Tools.RandomId(),babylonjs_1.Tags.AddTagsTo(emitter,"added_particlesystem")),system.emitter=emitter,_this.AddToGraph(editor,system)}),system},SceneFactory.CreateSkyEffect=function(editor){var skybox=babylonjs_1.Mesh.CreateBox("SkyBox",5e3,editor.core.scene,!1,babylonjs_1.Mesh.BACKSIDE);return skybox.material=new babylonjs_materials_1.SkyMaterial("Sky Material "+babylonjs_1.Tools.RandomId(),editor.core.scene),this.AddToGraph(editor,skybox),babylonjs_1.Tags.AddTagsTo(skybox.material,"added"),skybox},SceneFactory.CreateWaterEffect=function(editor,createGround){var _this=this;void 0===createGround&&(createGround=!0);var material=new babylonjs_materials_1.WaterMaterial("New Water Material",editor.core.scene);if(editor.core.scene.meshes.forEach(function(m){return material.addToRenderList(m)}),tools_1.default.GetFile("assets/textures/normal.png").then(function(file){return __awaiter(_this,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:return _a=material,_c=(_b=babylonjs_1.Texture).CreateFromBase64String,[4,tools_1.default.ReadFileAsBase64(file)];case 1:return _a.bumpTexture=_c.apply(_b,[_d.sent(),"normal.png",editor.core.scene]),material.bumpTexture.name=material.bumpTexture.url="normal.png",[2]}})})}),createGround){var mesh=babylonjs_1.Mesh.CreateGround("New Water Mesh",512,512,32,editor.core.scene);mesh.material=material,this.AddToGraph(editor,mesh)}return babylonjs_1.Tags.AddTagsTo(material,"added"),material},SceneFactory.CreateDummyNode=function(editor){var dummy=new babylonjs_1.Mesh("New Dummy Node",editor.core.scene);return dummy.id=babylonjs_1.Tools.RandomId(),this.AddToGraph(editor,dummy),dummy},SceneFactory.CreateGroundMesh=function(editor){var mesh=babylonjs_1.Mesh.CreateGround("New Ground",512,512,32,editor.core.scene,!0);return this.AddToGraph(editor,mesh),mesh},SceneFactory.CreateCube=function(editor){var mesh=babylonjs_1.Mesh.CreateBox("New Cube",5,editor.core.scene);return this.AddToGraph(editor,mesh),mesh},SceneFactory.CreateSphere=function(editor){var mesh=babylonjs_1.Mesh.CreateSphere("New Sphere",32,5,editor.core.scene);return this.AddToGraph(editor,mesh),mesh},SceneFactory.CreatePlane=function(editor){var mesh=babylonjs_1.Mesh.CreatePlane("New Plane",32,editor.core.scene);return mesh.rotation.x=Math.PI/2,this.AddToGraph(editor,mesh),mesh},SceneFactory.CreateLight=function(editor,type){var light=null;switch(type){case"point":light=new babylonjs_1.PointLight("New Point Light",new babylonjs_1.Vector3(10,10,10),editor.core.scene);break;case"directional":light=new babylonjs_1.DirectionalLight("New Directional Light",new babylonjs_1.Vector3(0,-1,0),editor.core.scene);break;case"spot":light=new babylonjs_1.SpotLight("New Spot Light",new babylonjs_1.Vector3(10,10,10),new babylonjs_1.Vector3(-1,-2,-1),Math.PI/2,Math.PI/2,editor.core.scene);break;case"hemispheric":light=new babylonjs_1.HemisphericLight("New Hemispheric Light",new babylonjs_1.Vector3(0,1,0),editor.core.scene)}return this.AddToGraph(editor,light),light},SceneFactory.AddSound=function(editor){var _this=this;tools_1.default.OpenFileDialog(function(files){var name=files[0].name.toLowerCase();if("mp3"!==tools_1.default.GetFileExtension(name))return window_1.default.CreateAlert("Supports only MP3 files","Cannot add sound");babylonjs_1.FilesInputStore.FilesToLoad[name]=files[0];var sound=new babylonjs_1.Sound(name,"file:"+name,editor.core.scene);sound.id=babylonjs_1.Tools.RandomId(),babylonjs_1.Tags.AddTagsTo(sound,"added"),_this.AddToGraph(editor,sound)})},SceneFactory.AddGui=function(editor){var gui=babylonjs_gui_1.AdvancedDynamicTexture.CreateFullscreenUI("new ui");return editor.core.uiTextures.push(gui),this.AddToGraph(editor,gui),gui},SceneFactory.AddGuiImage=function(editor){var img=new babylonjs_gui_1.Image("New Image");return this.AddToGraph(editor,img),img},SceneFactory}();exports.default=SceneFactory}),$__System.registerDynamic("57",["c","19"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),scene_factory_1=$__require("19"),ParticlesAssetComponent=function(){function ParticlesAssetComponent(editor){this.editor=editor,this.id="particles",this.assetsCaption="Particles",this.datas=[]}return ParticlesAssetComponent.prototype.onRenameAsset=function(asset,name){asset.data.name=name},ParticlesAssetComponent.prototype.onRemoveAsset=function(asset){var index=this.datas.indexOf(asset);-1!==index&&this.datas.splice(index,1),this.editor.assets.refresh(this.id)},ParticlesAssetComponent.prototype.onAddAsset=function(asset){this.datas.push(asset)},ParticlesAssetComponent.prototype.onCreateAsset=function(name){return __awaiter(this,void 0,void 0,function(){var set,asset;return __generator(this,function(_a){switch(_a.label){case 0:return[4,new Promise(function(resolve){babylonjs_1.Tools.LoadFile("./assets/templates/particles-creator/default-set.json",function(data){return resolve(data)})})];case 1:return set=_a.sent(),asset={name:name,data:{name:name,psData:JSON.parse(set)}},this.datas.push(asset),[2,asset]}})})},ParticlesAssetComponent.prototype.onGetAssets=function(){return this.datas},ParticlesAssetComponent.prototype.onDoubleClickAsset=function(asset){this.editor.addEditPanelPlugin("particles-creator",!1,"Particles System Creator...",asset.data)},ParticlesAssetComponent.prototype.onDragAndDropAsset=function(targetMesh,asset,pickInfo){var _this=this,m=new babylonjs_1.Mesh(asset.name,this.editor.core.scene);m.position=pickInfo.pickedPoint.clone(),scene_factory_1.default.AddToGraph(this.editor,m),asset.data.psData.systems.forEach(function(s){var rootUrl=s.textureName?0===s.textureName.indexOf("data:")?"":"file:":"",ps=babylonjs_1.ParticleSystem.Parse(s,_this.editor.core.scene,rootUrl,!0);ps.id=babylonjs_1.Tools.RandomId(),ps.emitter=m,ps.preventAutoStart=!1,ps.start(),babylonjs_1.Tags.AddTagsTo(ps,"added"),_this.editor.graph.add({id:ps.id,data:ps,img:"icon-particles",text:ps.name},m.id)})},ParticlesAssetComponent.prototype.onSerializeAssets=function(){return this.datas.map(function(d){return{name:d.name,data:d.data}})},ParticlesAssetComponent.prototype.onParseAssets=function(data){this.datas=data},ParticlesAssetComponent}();exports.default=ParticlesAssetComponent}),$__System.registerDynamic("10",[],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var Window=function(){function Window(name){this.element=null,this.title="",this.body="",this.buttons=[],this.width=800,this.height=600,this.showMax=!0,this.showClose=!0,this.name=name}return Window.prototype.close=function(){this.element.close()},Window.prototype.lock=function(message){w2popup.lock(message,!0)},Window.prototype.unlock=function(){w2popup.unlock()},Window.prototype.open=function(){return __awaiter(this,void 0,void 0,function(){var id,buttons,i,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:for(id="WindowButtons",buttons="",i=0;i<this.buttons.length;i++)buttons+='<button class="w2ui-btn" id="'+id+"-"+this.buttons[i]+'">'+this.buttons[i]+"</button>\n";return"closing"!==w2popup.status?[3,2]:[4,new Promise(function(resolve){setTimeout(function(){return resolve()},500)})];case 1:_a.sent(),_a.label=2;case 2:return this.element=w2popup.open({title:this.title,body:this.body,buttons:buttons,width:this.width,height:this.height,showClose:this.showClose,showMax:this.showMax,modal:!0}),this.buttons.forEach(function(b){$("#"+id+"-"+b).click(function(ev){return _this.onButtonClick&&_this.onButtonClick(ev.target.id.split("-")[1])})}),this.element.on("close",function(){_this.onClose&&_this.onClose(),_this.onToggle=null,_this.onMax=null,_this.onMin=null}),this.element.on("max",function(ev){ev.onComplete=function(){return _this.onMax&&_this.onMax()}}),this.element.on("min",function(ev){ev.onComplete=function(){return _this.onMin&&_this.onMin()}}),this.element.on("toggle",function(ev){ev.onComplete=function(){return _this.onToggle&&_this.onToggle()}}),[2]}})})},Window.CreateAlert=function(message,title){void 0===title&&(title="Notification"),w2alert(message,title)},Window}();exports.default=Window}),$__System.registerDynamic("6f",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Grid=function(){function Grid(name,options){void 0===options&&(options={}),this.element=null,this.options={toolbar:!0,footer:!0,toolbarEdit:!0,toolbarDelete:!0,toolbarAdd:!0,toolbarSearch:!0,toolbarColumns:!0,toolbarReload:!0,header:"",columnsHeaders:!0,multiSelect:!0},this.columns=[],this.contextMenuItems=[],this.name=name,this.options=Object.assign(this.options,options)}return Grid.prototype.setOptions=function(options){for(var thing in options)this.options[thing]=options[thing]},Grid.prototype.addRow=function(record){record.recid=this.element.records.length,this.element.add(record)},Grid.prototype.addRecord=function(record){record.recid=this.element.records.length,this.element.records.push(record)},Grid.prototype.getRow=function(selected){return this.element.get(selected.toString())},Grid.prototype.select=function(selected){this.element.select.apply(this.element,selected.map(function(s){return s.toString()}))},Grid.prototype.selectNone=function(){this.element.selectNone()},Grid.prototype.getSelected=function(){return this.element.getSelection()},Grid.prototype.build=function(parentId){var _this=this;this.element=$("#"+parentId).w2grid({name:this.name,columns:this.columns,menu:this.contextMenuItems,header:this.options.header,fixedBody:!0,keyboard:!1,multiSelect:this.options.multiSelect,show:{toolbar:this.options.toolbar,footer:this.options.footer,toolbarDelete:this.options.toolbarDelete,toolbarAdd:this.options.toolbarAdd,toolbarEdit:this.options.toolbarEdit,toolbarSearch:this.options.toolbarSearch,toolbarColumns:this.options.toolbarColumns,toolbarReload:this.options.toolbarReload,header:""!==this.options.header,columnHeaders:this.options.columnsHeaders},onClick:function(event){event.onComplete=function(){var selected=_this.element.getSelection();selected.length<1||_this.onClick&&_this.onClick(selected)}},onAdd:function(){_this.onAdd&&_this.onAdd()},onEdit:function(event){_this.onEdit&&_this.onEdit(event.recid)},onDelete:function(event){if(event.force){var selected_1=_this.element.getSelection();event.onComplete=function(){_this.onDelete&&_this.onDelete(selected_1);for(var i=0;i<_this.element.records.length;i++)_this.element.records[i].recid=i}}},onChange:function(event){"number"==typeof event.recid&&_this.onChange&&(event.onComplete=function(){_this.onChange(event.recid,event.value_new),_this.element.save()})},onMenuClick:function(event){_this.onContextMenu&&_this.onContextMenu(event.menuItem.id,event.recid)}})},Grid}();exports.default=Grid}),$__System.registerDynamic("2d",["c","10","6f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),window_1=$__require("10"),grid_1=$__require("6f"),Picker=function(){function Picker(title){this.items=[],this.selected=[],this.window=null,this.grid=null,this.search=!1,this.title=title}return Picker.prototype.addItems=function(items){var _this=this;items.forEach(function(i){return!babylonjs_1.Tags.MatchesQuery(i,"temp")&&_this.items.push(i.name||i.id)})},Picker.prototype.clear=function(){this.items=[],this.grid&&this.grid.element.clear()},Picker.prototype.addSelected=function(items){var _this=this;items.forEach(function(i){return _this.selected.push(i.name||i.id)})},Picker.prototype.close=function(){this.grid.element.destroy()},Picker.prototype.open=function(callback){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this.window=new window_1.default("Picker"),this.window.buttons=["Ok","Close"],this.window.title=this.title,this.window.body='<div id="PICKER-CONTAINER" style="width: 100%; height: 100%;"></div>',this.window.onClose=function(){return _this.close()},this.window.onToggle=function(){return _this.grid.element.resize()},this.window.onButtonClick=function(id){if("Ok"===id){var selected=_this.grid.getSelected();callback(selected.map(function(s){return{id:s,name:_this.items[s]}}),selected)}_this.close(),_this.window.close()},[4,this.window.open()];case 1:return _a.sent(),this.grid=new grid_1.default("PickerGrid"),this.grid.columns=[{field:"name",caption:"Name",size:"100%"}],this.grid.setOptions({toolbarAdd:!1,toolbarReload:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSearch:this.search}),this.grid.build("PICKER-CONTAINER"),this.refreshGrid(),[2]}})})},Picker.prototype.refreshGrid=function(){var _this=this;this.items.forEach(function(i,index){return _this.grid.addRecord({name:i,recid:index})}),this.grid.select(this.selected.map(function(s){return _this.items.indexOf(s)})),this.grid.element.refresh()},Picker}();exports.default=Picker}),$__System.registerDynamic("69",["2d","f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var picker_1=$__require("2d"),tools_1=$__require("f"),Storage=function(){function Storage(editor){this.picker=null,this.filesCount=0,this._uploadedCount=0,this.editor=editor}return Storage.GetStorage=function(editor){return __awaiter(this,void 0,void 0,function(){var storage,_a;return __generator(this,function(_b){switch(_b.label){case 0:return tools_1.default.IsElectron()?[4,tools_1.default.ImportScript("build/src/editor/storage/electron-storage.js")]:[3,2];case 1:return _a=_b.sent(),[3,4];case 2:return[4,tools_1.default.ImportScript("build/src/editor/storage/one-drive-storage.js")];case 3:_a=_b.sent(),_b.label=4;case 4:return storage=_a,[2,new storage.default(editor)]}})})},Storage.prototype.openPicker=function(title,filesToWrite,folder,overrideFilename){return __awaiter(this,void 0,void 0,function(){var files,current,previous,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return folder?[4,this.uploadFiles(folder,filesToWrite)]:[3,2];case 1:return _a.sent(),[2,folder];case 2:return[4,this.getFiles(folder)];case 3:return files=_a.sent(),current={folder:"root",name:"root"},previous=[],this.picker=new picker_1.default("Export..."),this.picker.addItems(files),[4,new Promise(function(resolve,reject){return __awaiter(_this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.picker.open(function(items){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.uploadFiles(current.folder,filesToWrite)];case 1:return _a.sent(),resolve(current.folder),[2]}})})})];case 1:return _a.sent(),this.picker.grid.onClick=function(ids){return __awaiter(_this,void 0,void 0,function(){var id,file,_a,_b;return __generator(this,function(_c){switch(_c.label){case 0:return id=ids[0],(file=0===id&&current?previous.pop():files[id],file===current&&(file=previous.pop()),file&&!file.folder)?[3,2]:(file&&previous.push(file),current=file,this.picker.window.lock("Loading "+(file?file.name:"Root")+"..."),_b=(_a=tools_1.default.IsElectron()?[]:[{name:"..",folder:null}]).concat,[4,this.getFiles(tools_1.default.IsElectron()?files[id].folder:file?file.folder:null)]);case 1:files=_b.apply(_a,[_c.sent()]),this.picker.window.unlock(),this.picker.clear(),this.picker.addItems(files),this.picker.refreshGrid(),_c.label=2;case 2:return[2]}})})},[2]}})})})];case 4:return[2,_a.sent()]}})})},Storage.prototype.uploadFiles=function(folder,filesToWrite){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return this._uploadedCount=0,this.filesCount=this.recursivelyGetFilesToUploadCount(filesToWrite),this.editor.toolbar.notifyRightMessage("Uploading... ("+this._uploadedCount+" / "+this.filesCount+")"),this.onCreateFiles&&this.onCreateFiles(folder),[4,this.recursivelyCreateFiles(folder,filesToWrite)];case 1:return _a.sent(),this.editor.toolbar.notifyRightMessage(""),[2]}})})},Storage.prototype.recursivelyCreateFiles=function(folder,files){return __awaiter(this,void 0,void 0,function(){var folders,promises,existingFiles,_loop_1,_i,files_1,f,_a,folders_1,f,newFiles,_loop_2,this_1,_b,folders_2,f,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return folders=[],promises=[],[4,this.getFiles(folder)];case 1:for(existingFiles=_c.sent(),_loop_1=function(f){if(f.folder)folders.push(f);else{if(f.doNotOverride&&existingFiles.find(function(ef){return ef.name===f.name}))return"continue";promises.push(new Promise(function(resolve){return __awaiter(_this,void 0,void 0,function(){var _a;return __generator(this,function(_b){switch(_b.label){case 0:return f.file?(_a=f,[4,tools_1.default.ReadFileAsArrayBuffer(f.file)]):[3,2];case 1:_a.data=_b.sent(),_b.label=2;case 2:return[4,this.createFiles(folder,[f])];case 3:return _b.sent(),this.uploadedCount++,resolve(),[2]}})})}))}},_i=0,files_1=files;_i<files_1.length;_i++)f=files_1[_i],_loop_1(f);return[4,Promise.all(promises)];case 2:for(_c.sent(),promises.splice(0,promises.length),_a=0,folders_1=folders;_a<folders_1.length;_a++)f=folders_1[_a],promises.push(this.createFolders(folder,[f.name]).then(function(){_this.uploadedCount++}));return[4,Promise.all(promises)];case 3:return _c.sent(),[4,this.getFiles(folder)];case 4:newFiles=_c.sent(),_loop_2=function(f){var newFolders;return __generator(this,function(_a){switch(_a.label){case 0:return newFolders=newFiles.filter(function(nf){return nf.name===f.name}),[4,this_1.recursivelyCreateFiles(newFolders[0].folder,f.folder)];case 1:return _a.sent(),[2]}})},this_1=this,_b=0,folders_2=folders,_c.label=5;case 5:return _b<folders_2.length?(f=folders_2[_b],[5,_loop_2(f)]):[3,8];case 6:_c.sent(),_c.label=7;case 7:return _b++,[3,5];case 8:return[2]}})})},Storage.prototype.recursivelyGetFilesToUploadCount=function(files){var _this=this,count=0;return files.forEach(function(f){f.folder?count+=_this.recursivelyGetFilesToUploadCount(f.folder):count++}),count},Object.defineProperty(Storage.prototype,"uploadedCount",{get:function(){return this._uploadedCount},set:function(value){this._uploadedCount=value,this.editor.toolbar.notifyRightMessage("Uploading... ("+this._uploadedCount+" / "+this.filesCount+")")},enumerable:!0,configurable:!0}),Storage}();exports.default=Storage}),$__System.registerDynamic("f",["c"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),Tools=function(){function Tools(){}return Tools.CreateElement=function(type,id,style){var div=document.createElement(type);if(div.id=id,style)for(var thing in style)div.style[thing]=style[thing];return div},Tools.IsElementChildOf=function(element,parent){for(;element.parentElement;){if(element===parent)return!0;element=element.parentElement}return!1},Tools.IsFocusingInputElement=function(){var e=document.activeElement;return!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName)},Tools.GetConstructorName=function(obj){var ctrName=void 0!==obj&&null!==obj&&obj.constructor?obj.constructor.name:"";return""===ctrName&&(ctrName=typeof obj),ctrName},Tools.IsElectron=function(){return-1!==navigator.userAgent.indexOf("Electron")},Tools.GetFileType=function(extension){switch(extension){case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"bmp":return"image/bmp";case"tga":return"image/targa";case"dds":return"image/vnd.ms-dds";case"wav":case"wave":return"audio/wav";case"mp3":return"audio/mpeg";case"mpg":case"mpeg":return"audio/mpeg";case"ogg":return"audio/ogg";default:return""}},Tools.OpenPopup=function(url,name,width,height){var features=["width="+width,"height="+height,"top="+window.screenY+Math.max(window.outerHeight-height,0)/2,"left="+window.screenX+Math.max(window.outerWidth-width,0)/2,"status=no","resizable=yes","toolbar=no","menubar=no","menubar=no","scrollbars=yes","dependent=yes","nodeIntegration=no"],popup=window.open(url,name,features.join(","));return popup.focus(),popup},Tools.SetWindowTitle=function(title){document.title="Babylon.js Editor "+this.Version+" - ("+title+")"},Tools.GetFileExtension=function(filename){var index=filename.lastIndexOf(".");return index<0?filename:filename.substring(index+1)},Tools.GetFilenameWithoutExtension=function(filename,withPath){var lastDot=filename.lastIndexOf("."),lastSlash=filename.lastIndexOf("/");return-1===lastSlash&&(lastSlash=filename.lastIndexOf("\\")),filename.substring(withPath?0:lastSlash+1,lastDot)},Tools.GetFilename=function(filename){return this.GetFilenameWithoutExtension(filename,!1)+"."+this.GetFileExtension(filename)},Tools.GetTextureByName=function(scene,name){for(var _i=0,_a=scene.textures;_i<_a.length;_i++){var t=_a[_i];if(t.name===name)return t}return null},Tools.OpenFileDialog=function(callback){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){var input=Tools.CreateElement("input","TextureViewerInput");input.type="file",input.multiple=!0,input.onchange=function(ev){callback&&callback(ev.target.files),input.remove(),resolve(ev.target.files)},input.click()})]})})},Tools.GetBaseURL=function(){var url=window.location.href;return url=url.replace(babylonjs_1.Tools.GetFilename(url),"")},Tools.SortAlphabetically=function(arr,property){arr.sort(function(a,b){return a=property?a[property]:a,b=property?b[property]:b,a=a.toUpperCase(),b=b.toUpperCase(),a<b?-1:a>b?1:0})},Tools.CreateFile=function(buffer,filename){var options={type:Tools.GetFileType(this.GetFileExtension(filename)),lastModified:new Date(Date.now())},blob=new Blob([buffer],options);return blob.name=babylonjs_1.Tools.GetFilename(filename),blob.lastModified=Date.now(),blob.lastModifiedDate=new Date(Date.now()),blob},Tools.LoadFile=function(url,arrayBuffer,onProgress){return void 0===arrayBuffer&&(arrayBuffer=!1),__awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){_this.PendingFilesToLoad++,babylonjs_1.Tools.LoadFile(url,function(data){_this.PendingFilesToLoad--,resolve(data)},function(data){onProgress&&onProgress(data)},null,arrayBuffer,function(r,e){_this.PendingFilesToLoad--,reject(e)})})]})})},Tools.CreateFileFromURL=function(url){return __awaiter(this,void 0,void 0,function(){var filename,data,file,e_1;return __generator(this,function(_a){switch(_a.label){case 0:if(filename=babylonjs_1.Tools.GetFilename(url).toLowerCase(),babylonjs_1.FilesInputStore.FilesToLoad[filename])return[2,babylonjs_1.FilesInputStore.FilesToLoad[filename]];_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this.LoadFile(url,!0)];case 2:return data=_a.sent(),file=this.CreateFile(new Uint8Array(data),filename),babylonjs_1.FilesInputStore.FilesToLoad[filename]=file,[2,file];case 3:return e_1=_a.sent(),[2,Promise.reject(e_1)];case 4:return[2]}})})},Tools.GetFile=function(url){return __awaiter(this,void 0,void 0,function(){var filename,data,file,e_2;return __generator(this,function(_a){switch(_a.label){case 0:filename=babylonjs_1.Tools.GetFilename(url).toLowerCase(),_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this.LoadFile(url,!0)];case 2:return data=_a.sent(),file=this.CreateFile(new Uint8Array(data),filename),babylonjs_1.FilesInputStore.FilesToLoad[filename]=file,[2,file];case 3:return e_2=_a.sent(),[2,Promise.reject(e_2)];case 4:return[2]}})})},Tools.GetFilePath=function(file){return file.path||""},Tools.ConvertStringToUInt8Array=function(str){for(var len=str.length,array=new Uint8Array(len),i=0;i<len;i++)array[i]=str.charCodeAt(i);return array},Tools.Assign=function(target){for(var sources=[],_i=1;_i<arguments.length;_i++)sources[_i-1]=arguments[_i];return sources.forEach(function(a){for(var key in a)target[key]=a[key]}),target},Tools.Clone=function(data){return JSON.parse(JSON.stringify(data))},Tools.ReadFile=function(file,arrayBuffer){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){babylonjs_1.Tools.ReadFile(file,function(data){resolve(data)},null,arrayBuffer)})]})})},Tools.ReadFileAsBase64=function(file){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){babylonjs_1.Tools.ReadFileAsDataURL(file,function(data){resolve(data)},null)})]})})},Tools.ReadFileAsText=function(file){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.ReadFile(file,!1)];case 1:return[2,_a.sent()]}})})},Tools.ReadFileAsArrayBuffer=function(file){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.ReadFile(file,!0)];case 1:return[2,_a.sent()]}})})},Tools.ImportScript=function(url){return System.import(url)},Tools.isFileApiSupported=function(showAlert){try{new File([""],"test.txt",{type:this.GetFileExtension("test.txt")});return!0}catch(e){return showAlert&&alert("Your navigator doesn't support full File API. Cannot load the scene. Please try with another navigator."),!1}},Tools.PendingFilesToLoad=0,Tools.IsStandalone=!0,Tools.Version="",Tools.Epsilon=2.220446049250313e-16,Tools}();exports.default=Tools}),$__System.registerDynamic("58",["6d","c","f"],!0,function($__require,exports,module){"use strict";var __awaiter=(this||self,exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}),__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var SocketIO=$__require("6d"),babylonjs_1=$__require("c"),tools_1=$__require("f"),VSCodeSocket=function(){function VSCodeSocket(){}return VSCodeSocket.Create=function(editor){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return this._Editor=editor,this.Socket?[2]:(this.Socket=SocketIO("http://localhost:1337/vscode"),this.Socket.on("connection",function(){return _this.RefreshProject()}),this.Socket.on("refresh",function(){_this.RefreshProject(),_this.Refresh()}),this.Socket.on("update-behavior-code",function(d){return _this.OnUpdateBehaviorCode&&_this.OnUpdateBehaviorCode(d)}),this.Socket.on("update-material-code",function(d){return _this.OnUpdateMaterialCode&&_this.OnUpdateMaterialCode(d)}),this.Socket.on("update-post-process-code",function(d){return _this.OnUpdatePostProcessCode&&_this.OnUpdatePostProcessCode(d)}),this.Socket.on("update-behavior-graph",function(d){return _this.OnUpdateBehaviorGraph&&_this.OnUpdateBehaviorGraph(d)}),editor.core.onSelectObject.add(function(o){return _this.RefreshSelectedObject(o)}),editor.core.onAddObject.add(function(o){return _this.RefreshSceneInfos()}),editor.core.onRemoveObject.add(function(o){return _this.RefreshSceneInfos()}),[2])})})},VSCodeSocket.Refresh=function(){if(this.Socket){var metadatas=this._Editor.core.scene.metadata;metadatas&&(this.Socket.emit("behavior-codes",metadatas.behaviorScripts||[]),this.Socket.emit("material-codes",metadatas.MaterialCreator||[]),this.Socket.emit("post-process-codes",metadatas.PostProcessCreator||[]),this.Socket.emit("behavior-graphs",metadatas.behaviorGraphs||[]),this.RefreshSceneInfos(),this.RefreshSelectedObject(this._Editor.core.currentSelectedObject))}},VSCodeSocket.RefreshProject=function(){return __awaiter(this,void 0,void 0,function(){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u;return __generator(this,function(_v){switch(_v.label){case 0:return(_a=this.Socket)?(_c=(_b=this.Socket).emit,_d=["project"],_e={},(_f=this._TsConfig)?[3,2]:(_g=this,[4,tools_1.default.LoadFile("assets/templates/vscode/tsconfig.json")])):[3,15];case 1:_f=_g._TsConfig=_v.sent(),_v.label=2;case 2:return _e.tsconfig=_f,(_h=this._BabylonJS)?[3,4]:(_j=this,[4,tools_1.default.LoadFile("assets/typings/babylon.module.d.ts")]);case 3:_h=_j._BabylonJS=_v.sent(),_v.label=4;case 4:return _e.babylonjs=_h,(_k=this._BabylonJSMaterials)?[3,6]:(_l=this,[4,tools_1.default.LoadFile("assets/typings/babylonjs.materials.module.d.ts")]);case 5:_k=_l._BabylonJSMaterials=_v.sent(),_v.label=6;case 6:return _e.babylonjs_materials=_k,(_m=this._BabylonJSPostProcess)?[3,8]:(_o=this,[4,tools_1.default.LoadFile("assets/typings/babylonjs.postProcess.module.d.ts")]);case 7:_m=_o._BabylonJSPostProcess=_v.sent(),_v.label=8;case 8:return _e.babylonjs_postProcess=_m,(_p=this._Tools)?[3,10]:(_q=this,[4,tools_1.default.LoadFile("assets/templates/code/tools.d.ts")]);case 9:_p=_q._Tools=_v.sent(),_v.label=10;case 10:return _e.tools=_p,(_r=this._Mobile)?[3,12]:(_s=this,[4,tools_1.default.LoadFile("assets/templates/code/mobile.d.ts")]);case 11:_r=_s._Mobile=_v.sent(),_v.label=12;case 12:return _e.mobile=_r,(_t=this._PathFinder)?[3,14]:(_u=this,[4,tools_1.default.LoadFile("assets/templates/code/path-finder.d.ts")]);case 13:_t=_u._PathFinder=_v.sent(),_v.label=14;case 14:_a=_c.apply(_b,_d.concat([(_e.pathFinder=_t,_e)])),_v.label=15;case 15:return[2]}})})},VSCodeSocket.RefreshBehavior=function(data){this.Socket&&this.Socket.emit("behavior-codes",data)},VSCodeSocket.RefreshMaterial=function(data){this.Socket&&this.Socket.emit("material-codes",data)},VSCodeSocket.RefreshPostProcess=function(data){this.Socket&&this.Socket.emit("post-process-codes",data)},VSCodeSocket.RefreshBehaviorGraph=function(data){this.Socket&&this.Socket.emit("behavior-graphs",data)},VSCodeSocket.RefreshSceneInfos=function(){if(this.Socket){var scene=babylonjs_1.SceneSerializer.Serialize(this._Editor.core.scene);this.Socket.emit("scene-infos",scene)}},VSCodeSocket.RefreshSelectedObject=function(object){if(this.Socket)return object instanceof babylonjs_1.Scene?void this.Socket.emit("set-selected-object","Scene"):void(object instanceof babylonjs_1.Node&&this.Socket.emit("set-selected-object",object.name))},VSCodeSocket.Socket=null,VSCodeSocket._Editor=null,VSCodeSocket._TsConfig=null,VSCodeSocket._BabylonJS=null,VSCodeSocket._BabylonJSMaterials=null,VSCodeSocket._BabylonJSPostProcess=null,VSCodeSocket._Tools=null,VSCodeSocket._Mobile=null,VSCodeSocket._PathFinder=null,VSCodeSocket}();exports.default=VSCodeSocket}),$__System.registerDynamic("a",["5c","f","17","15","16","6a","24","13","61","6f","2d","62","10","5e","11","66","21","14","25","5d","27","68","1e","1b","19","5f","22","56","57","69","58"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var editor_1=$__require("5c");exports.Editor=editor_1.default;var tools_1=$__require("f");exports.Tools=tools_1.default;var request_1=$__require("17");exports.Request=request_1.default;var undo_redo_1=$__require("15");exports.UndoRedo=undo_redo_1.default;var theme_1=$__require("16");exports.ThemeSwitcher=theme_1.default;var graphics_tools_1=$__require("6a");exports.GraphicsTools=graphics_tools_1.default;var layout_1=$__require("24");exports.Layout=layout_1.default;var toolbar_1=$__require("13");exports.Toolbar=toolbar_1.default;var list_1=$__require("61");exports.List=list_1.default;var grid_1=$__require("6f");exports.Grid=grid_1.default;var picker_1=$__require("2d");exports.Picker=picker_1.default;var graph_1=$__require("62");exports.Graph=graph_1.default;var window_1=$__require("10");exports.Window=window_1.default;var code_1=$__require("5e");exports.CodeEditor=code_1.default;var form_1=$__require("11");exports.Form=form_1.default;var edition_1=$__require("66");exports.Edition=edition_1.default;var tree_1=$__require("21");exports.Tree=tree_1.default;var dialog_1=$__require("14");exports.Dialog=dialog_1.default;var context_menu_1=$__require("25");exports.ContextMenu=context_menu_1.default;var resizable_layout_1=$__require("5d");exports.ResizableLayout=resizable_layout_1.default;var edition_tool_1=$__require("27");exports.AbstractEditionTool=edition_tool_1.default;var plugin_1=$__require("68");exports.EditorPlugin=plugin_1.EditorPlugin;var project_code_editor_1=$__require("1e");exports.CodeProjectEditorFactory=project_code_editor_1.default;var scene_manager_1=$__require("1b");exports.SceneManager=scene_manager_1.default;var scene_factory_1=$__require("19");exports.SceneFactory=scene_factory_1.default;var scene_preview_1=$__require("5f");exports.ScenePreview=scene_preview_1.default;var scene_picker_1=$__require("22");exports.ScenePicker=scene_picker_1.default;var asset_component_1=$__require("56");exports.PrefabAssetComponent=asset_component_1.default;var asset_component_2=$__require("57");exports.ParticlesCreatorExtension=asset_component_2.default;var storage_1=$__require("69");exports.Storage=storage_1.default;var vscode_socket_1=$__require("58");exports.VSCodeSocket=vscode_socket_1.default,exports.default=editor_1.default})})(function(factory){module.exports=factory(require("babylonjs"),require("babylonjs-gui"),require("babylonjs-materials"),require("babylonjs-serializers"),require("dat-gui"),require("extensions/extensions.js"),require("golden-layout"),require("jstree"),require("socket.io-client"))});