!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6))),{}):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return i(t,r),a(t,r,[]),t.module}function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function s(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module,"__useDefault"in u?u.__useDefault:u}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=s(r.deps,r.depLoads,n);if(!r.executingRequire)for(var i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}var f=t.module=new o(r.moduleObj);if(!r.setters)for(var i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a],{}));i(s);var v=u(e[0]);if(e.length>1)for(var a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["d","12","e"],!0,function($__System){this.require,this.exports,this.module;$__System.registerDynamic("b",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("c",["d","e"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),extensions_1=$__require("e"),Tools=function(){function Tools(){}return Tools.prototype.getCustomMaterial=function(name){var ext=extensions_1.default.Instances.MaterialCreatorExtension;return ext?ext.instances[name]:null},Tools.prototype.getCustomScript=function(object,name){var ext=extensions_1.default.Instances.BehaviorExtension;return ext?"string"===(typeof object).toLowerCase()?ext.instances[object+name]:object instanceof babylonjs_1.Scene?ext.instances["scene"+name]:object instanceof babylonjs_1.ParticleSystem?ext.instances[object.id+name]:ext.instances[object.name+name]:null},Tools.prototype.getConstructor=function(name){var ext=extensions_1.default.Instances.BehaviorExtension;return ext?ext.scriptsConstructors[name]:null},Tools.prototype.getCustomPostProcess=function(name){var ext=extensions_1.default.Instances.PostProcessCreatorExtension;return ext?ext.instances[name]:null},Tools.prototype.getFileByName=function(name){return babylonjs_1.FilesInputStore.FilesToLoad[name]},Tools.prototype.getFileUrl=function(filename,oneTimeOnly){return void 0===oneTimeOnly&&(oneTimeOnly=!0),extensions_1.default.RoolUrl&&"file:"!==extensions_1.default.RoolUrl?extensions_1.default.RoolUrl+filename:URL.createObjectURL(this.getFileByName(filename))},Tools.prototype.getPathFinder=function(name){var ext=extensions_1.default.Instances.PathFinderExtension;return ext?ext.instances[name]:null},Tools.prototype.instantiatePrefab=function(name){return extensions_1.default.Instances.AssetsExtension.instantiatePrefab(name)},Tools.prototype.instantiateParticleSystemSet=function(name,position){return extensions_1.default.Instances.AssetsExtension.instantiateParticleSystemsSet(name,position)},Tools.prototype.sendMessage=function(object,methodName){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var ext=extensions_1.default.Instances.BehaviorExtension;if(!ext)return null;var scripts=ext.objectsInstances[object instanceof babylonjs_1.Scene?"Scene":object.id];scripts&&scripts.forEach(function(s){return s[methodName]&&s[methodName].apply(s,params)})},Tools}();exports.default=Tools;var exportScriptBodyString="\n    if (!params) {\n        returnValue = value;\n    } else {\n        returnValue = {\n            ctor: value\n        };\n\n        var keys = Object.keys(params);\n        for (var i = 0; i < keys.length; i++) {\n            returnValue[keys[i]] = params[keys[i]];\n        }\n    }\n".replace(/\n/g,"").replace(/\t/g,"").replace(/  /g,""),exportScriptReturnString="\nif (returnValue) {return returnValue;}\nif (exports) {return exports;}\n".replace(/\n/g,"").replace(/\t/g,"").replace(/  /g,"");exports.exportScriptString="\nfunction exportScript (value, params) {"+exportScriptBodyString+"};\n"+exportScriptReturnString+"\n"}),$__System.registerDynamic("f",["d","e","b","c","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var EDITOR,babylonjs_1=$__require("d"),extensions_1=$__require("e"),extension_1=$__require("b"),tools_1=$__require("c"),post_process_1=$__require("10"),template="\nEDITOR.PostProcessCreator.Constructors['{{name}}'] = function (camera, tools, mobile) {\nvar returnValue = null;\nvar exports = { };\n\n{{code}}\n"+tools_1.exportScriptString+"\n}\n";!function(EDITOR){var PostProcessCreator=function(){function PostProcessCreator(){}return PostProcessCreator.Constructors={},PostProcessCreator}();EDITOR.PostProcessCreator=PostProcessCreator}(EDITOR=exports.EDITOR||(exports.EDITOR={})),window.EDITOR=window.EDITOR||{},window.EDITOR.PostProcessCreator=EDITOR.PostProcessCreator;var PostProcessEditorExtension=function(_super){function PostProcessEditorExtension(scene){var _this=_super.call(this,scene)||this;return _this.instances={},_this.datas=[],PostProcessEditorExtension.Instance=_this,_this}return __extends(PostProcessEditorExtension,_super),PostProcessEditorExtension.prototype.createPostProcess=function(data,rootUrl){var _this=this,id=data.name+babylonjs_1.Tools.RandomId();babylonjs_1.Effect.ShadersStore[id+"PixelShader"]=data.pixel;var url=window.location.href;url=url.replace(babylonjs_1.Tools.GetFilename(url),"")+"post-processes/"+data.name.replace(/ /g,"")+".js",extension_1.default.AddScript(template.replace("{{name}}",id).replace("{{code}}",data.compiledCode||data.code),url);var camera=this.scene.getCameraByName(data.cameraName)||this.scene.activeCamera,ctor=new EDITOR.PostProcessCreator.Constructors[id](camera,extensions_1.default.Tools,extensions_1.default.Mobile),code=new ctor(camera,this.scene),config=null;try{config=JSON.parse(data.config)}catch(e){}var postprocess=new post_process_1.default(data.name,id,data.preview?camera:null,this.scene.getEngine(),config,code);return data.userConfig.textures.forEach(function(t){return postprocess.userConfig[t.name]=babylonjs_1.Texture.Parse(t.value,_this.scene,rootUrl||"file:")}),data.userConfig.floats.forEach(function(f){return postprocess.userConfig[f.name]=f.value}),data.userConfig.vectors2.forEach(function(v){return postprocess.userConfig[v.name]=babylonjs_1.Vector2.FromArray(v.value)}),data.userConfig.vectors3.forEach(function(v){return postprocess.userConfig[v.name]=babylonjs_1.Vector3.FromArray(v.value)}),this.instances[data.name]={code:code,postprocess:postprocess},postprocess},PostProcessEditorExtension.prototype.onApply=function(data,rootUrl){var _this=this;this.datas=data,this.datas.forEach(function(d){return _this.createPostProcess(d,rootUrl)})},PostProcessEditorExtension.prototype.onSerialize=function(){var _this=this;if(!this.scene.metadata||!this.scene.metadata.PostProcessCreator)return null;var data=this.scene.metadata.PostProcessCreator;return data.forEach(function(d){_this.scene.postProcesses.forEach(function(p){p instanceof post_process_1.default&&p.config&&p.name===d.name&&(d.userConfig.textures=[],p.config.textures.forEach(function(t){return p.userConfig[t]&&d.userConfig.textures.push({value:p.userConfig[t].serialize(),name:t})}),d.userConfig.floats=[],p.config.floats.forEach(function(f){return d.userConfig.floats.push({value:p.userConfig[f],name:f})}),d.userConfig.vectors2=[],p.config.vectors2.forEach(function(v){return d.userConfig.vectors2.push({value:p.userConfig[v].asArray(),name:v})}),d.userConfig.vectors3=[],p.config.vectors3.forEach(function(v){return d.userConfig.vectors3.push({value:p.userConfig[v].asArray(),name:v})}))})}),data},PostProcessEditorExtension.prototype.onLoad=function(data){var _this=this;this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.PostProcessCreator=[],this.datas.forEach(function(d){d.id=d.id||babylonjs_1.Tools.RandomId(),_this.scene.metadata.PostProcessCreator.push(d)})},PostProcessEditorExtension.Instance=null,PostProcessEditorExtension}(extension_1.default);exports.default=PostProcessEditorExtension,extensions_1.default.Register("PostProcessCreatorExtension",PostProcessEditorExtension)}),$__System.registerDynamic("10",["d"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),AbstractPostProcessEditor=function(_super){function AbstractPostProcessEditor(name,fragmentUrl,camera,engine,config,customCode){var _this=_super.call(this,name,fragmentUrl,[],["textureSampler"],config.ratio,camera,babylonjs_1.Texture.BILINEAR_SAMPLINGMODE,engine)||this;return _this.userConfig={},_this.additionalUniforms=[],_this.additionalSamplers=[],_this.scene=camera?camera.getScene():engine.scenes[0],_this.customCode=customCode,_this.config=config,customCode&&customCode.init(),_this.setConfig(config),_this.setOnApply(),_this}return __extends(AbstractPostProcessEditor,_super),AbstractPostProcessEditor.prototype.setOnApply=function(){var _this=this;this.onApply=function(effect){_this.customCode&&_this.customCode.onApply(effect),_this.config.textures.forEach(function(t){return void 0!==_this.userConfig[t]&&effect.setTexture(t,_this.userConfig[t])}),_this.config.floats.forEach(function(f){return void 0!==_this.userConfig[f]&&effect.setFloat(f,_this.userConfig[f]||0)}),_this.config.vectors2.forEach(function(v){return void 0!==_this.userConfig[v]&&effect.setVector2(v,_this.userConfig[v])}),_this.config.vectors3.forEach(function(v){return void 0!==_this.userConfig[v]&&effect.setVector3(v,_this.userConfig[v])})}},AbstractPostProcessEditor.prototype.setConfig=function(config){var uniforms=["scale"].concat(config.floats).concat(config.vectors2).concat(config.vectors3),samplers=["textureSampler"].concat(config.textures);this.customCode&&this.customCode.setUniforms(uniforms,samplers);try{this.updateEffect("#define UPDATED"+babylonjs_1.Tools.RandomId()+"\n",uniforms,samplers),this.config=config,this.setOnApply()}catch(e){}},AbstractPostProcessEditor.prototype.dispose=function(){this.customCode&&this.customCode.dispose(),_super.prototype.dispose.call(this)},AbstractPostProcessEditor.prototype.getClassName=function(){return"PostProcessEditor"},AbstractPostProcessEditor}(babylonjs_1.PostProcess);exports.default=AbstractPostProcessEditor}),$__System.registerDynamic("11",["d","12","e"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),babylonjs_editor_1=$__require("12"),extensions_1=$__require("e"),Helpers=function(){function Helpers(){}return Helpers.UpdateMonacoTypings=function(editor,editedData,onlyNonAttached){void 0===editedData&&(editedData=null),void 0===onlyNonAttached&&(onlyNonAttached=!1);var scripts=editor.core.scene.metadata.behaviorScripts,extension=extensions_1.default.RequestExtension(editor.core.scene,"BehaviorExtension");if(scripts&&extension){var datas_1=extension.onSerialize();for(var k in babylonjs_editor_1.CodeEditor.CustomLibs){babylonjs_editor_1.CodeEditor.CustomLibs[k].dispose()}babylonjs_editor_1.CodeEditor.CustomLibs={},scripts.forEach(function(s){if(s!==editedData){if(onlyNonAttached){if(datas_1.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.codeId===s.id})}))return}var code='declare module "'+s.name+'" {'+s.code+"}";babylonjs_editor_1.CodeEditor.CustomLibs[s.name]=window.monaco.languages.typescript.typescriptDefaults.addExtraLib(code,s.name)}})}},Helpers.GetSceneMetadatas=function(scene){return scene.metadata=scene.metadata||{},scene.metadata},Helpers.CreatePreview=function(canvas){var engine=new babylonjs_1.Engine(canvas),scene=new babylonjs_1.Scene(engine),camera=new babylonjs_1.ArcRotateCamera("PreviewCamera",0,0,10,babylonjs_1.Vector3.Zero(),scene,!0);return camera.attachControl(canvas,!0,!1),{engine:engine,scene:scene,camera:camera}},Helpers}();exports.default=Helpers}),$__System.registerDynamic("a",["d","12","e","f","10","11"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),babylonjs_editor_1=$__require("12"),extensions_1=$__require("e");$__require("f");var post_process_1=$__require("10"),helpers_1=$__require("11"),PostProcessEditor=function(_super){function PostProcessEditor(editor){var _this=_super.call(this,"Post-Process Editor")||this;return _this.editor=editor,_this.layout=null,_this.toolbar=null,_this.grid=null,_this.currentTab="POST-PROCESS-CREATOR-EDITOR-CODE",_this.code=null,_this.pixel=null,_this.config=null,_this.datas=[],_this.data=null,_this.activeCamera=_this.editor.playCamera,_this}return __extends(PostProcessEditor,_super),PostProcessEditor.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return this.layout.element.destroy(),this.toolbar.element.destroy(),this.grid.element.destroy(),this.code.dispose(),this.pixel.dispose(),this.config.dispose(),[4,_super.prototype.close.call(this)];case 1:return _a.sent(),[2]}})})},PostProcessEditor.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){var _a,_b,_c,_d,_e,_f,_this=this;return __generator(this,function(_g){switch(_g.label){case 0:return(_a=!PostProcessEditor.DefaultCode)?(_b=PostProcessEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/post-process-creator/class.ts")]):[3,2];case 1:_a=_b.DefaultCode=_g.sent(),_g.label=2;case 2:return(_c=!PostProcessEditor.DefaultPixel)?(_d=PostProcessEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/post-process-creator/pixel.fx")]):[3,4];case 3:_c=_d.DefaultPixel=_g.sent(),_g.label=4;case 4:return(_e=!PostProcessEditor.DefaultConfig)?(_f=PostProcessEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/post-process-creator/config.json")]):[3,6];case 5:_e=_f.DefaultConfig=_g.sent(),_g.label=6;case 6:return extensions_1.default.RequestExtension(this.editor.core.scene,"PostProcessCreatorExtension"),this.editor.core.scene.metadata=this.editor.core.scene.metadata||{},this.editor.core.scene.metadata.PostProcessCreator||(this.editor.core.scene.metadata.PostProcessCreator=[]),this.datas=this.editor.core.scene.metadata.PostProcessCreator,this.data=this.datas[0],this.layout=new babylonjs_editor_1.Layout("PostProcessCreatorCode"),this.layout.panels=[{type:"top",content:'<div id="POST-PROCESS-CREATOR-TOOLBAR" style="width: 100%; height: 100%;"></div>',size:32,overflow:"auto",resizable:!0},{type:"left",content:'<div id="POST-PROCESS-CREATOR-LIST" style="width: 100%; height: 100%;"></div>',size:250,overflow:"auto",resizable:!0},{type:"main",content:'\n                    <div id="POST-PROCESS-CREATOR-EDITOR-CODE" style="width: 100%; height: 100%; overflow: hidden;"></div>\n                    <div id="POST-PROCESS-CREATOR-EDITOR-PIXEL" style="width: 100%; height: 100%; overflow: hidden; display: none;"></div>\n                    <div id="POST-PROCESS-CREATOR-EDITOR-CONFIG" style="width: 100%; height: 100%; overflow: hidden; display: none;"></div>\n                ',resizable:!0,tabs:[{id:"code",caption:"Code"},{id:"pixel",caption:"Pixel"},{id:"config",caption:"Config"}]}],this.layout.build(this.divElement.id),this.toolbar=new babylonjs_editor_1.Toolbar("PostProcessCreatorToolbar"),this.toolbar.items=[{id:"project",type:"menu",caption:"Project",img:"icon-folder",items:[{id:"add",caption:"Add Existing Project...",img:"icon-export"},{id:"download",caption:"Download Project...",img:"icon-export"}]},{id:"open-code-editor",text:"Open Code Editor",caption:"Open Code Editor",img:"icon-edit"}],this.toolbar.onClick=function(id){return _this.onToolbarClick(id)},this.toolbar.build("POST-PROCESS-CREATOR-TOOLBAR"),this.grid=new babylonjs_editor_1.Grid("PostProcessCreatorGrid",{toolbarReload:!1,toolbarEdit:!1,toolbarSearch:!1}),this.grid.columns=[{field:"name",caption:"Name",size:"80%",editable:{type:"string"}},{field:"preview",caption:"Preview",size:"20%",editable:{type:"checkbox"}}],this.grid.build("POST-PROCESS-CREATOR-LIST"),this.grid.onAdd=function(){return _this.addPostProcess()},this.grid.onDelete=function(selected){return _this.deletePostProcess(selected[0])},this.grid.onChange=function(selected,value){return _this.changePostProcess(selected,value)},this.grid.onClick=function(selected){return _this.selectPostProcess(selected[0])},this.datas.forEach(function(d,index){return _this.grid.addRecord({name:d.name,preview:d.preview,recid:index})}),this.grid.element.refresh(),this.grid.select([0]),[4,this.createEditors()];case 7:return _g.sent(),this.data?setTimeout(function(){return _this.selectPostProcess(0)},500):this.layout.lockPanel("main"),PostProcessEditor.CodeProjectEditor&&this.layout.lockPanel("main"),babylonjs_editor_1.VSCodeSocket.OnUpdatePostProcessCode=function(d){return __awaiter(_this,void 0,void 0,function(){var effective,compiledCode,_a;return __generator(this,function(_b){switch(_b.label){case 0:return effective=this.datas.find(function(s){return s.id===d.id}),d.code?[4,babylonjs_editor_1.CodeEditor.TranspileTypeScript(d.code,d.name.replace(/ /,""),{module:"cjs",target:"es5",experimentalDecorators:!0})]:[3,2];case 1:return _a=_b.sent(),[3,3];case 2:_a=null,_b.label=3;case 3:return compiledCode=_a,effective?(d.code&&(effective.code=d.code),d.pixel&&(effective.pixel=d.pixel),d.config&&(effective.config=d.config),compiledCode&&(effective.compiledCode=compiledCode),this.data&&this.data.id===d.id&&this.selectPostProcess(this.datas.indexOf(this.data)),[2]):(babylonjs_editor_1.VSCodeSocket.RefreshPostProcess(this.datas),[2])}})})},[2]}})})},PostProcessEditor.prototype.onShow=function(){this.grid.element.resize()},PostProcessEditor.prototype.onResize=function(){this.layout.element.resize()},PostProcessEditor.prototype.onToolbarClick=function(id){var _this=this;switch(id){case"project:add":babylonjs_editor_1.Tools.OpenFileDialog(function(files){return _this._addPostProcessesFromFiles(files[0])});break;case"project:download":var file=babylonjs_editor_1.Tools.CreateFile(babylonjs_editor_1.Tools.ConvertStringToUInt8Array(JSON.stringify(this.datas)),"post-processes.json");babylonjs_1.Tools.Download(file,file.name);break;case"open-code-editor":this.editCode()}},PostProcessEditor.prototype.deletePostProcess=function(id){this.datas.splice(id,1),this.data=this.datas[0],this.data?this.selectPostProcess(0):(this.code.setValue(""),this.pixel.setValue(""),this.config.setValue(""),this.layout.lockPanel("main")),babylonjs_editor_1.VSCodeSocket.RefreshPostProcess(this.datas)},PostProcessEditor.prototype.addPostProcess=function(){return __awaiter(this,void 0,void 0,function(){var name,data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,babylonjs_editor_1.Dialog.CreateWithTextInput("Post-Process Name")];case 1:return name=_a.sent(),data=this.data={preview:!0,cameraName:this.activeCamera?this.activeCamera.name:null,name:name,code:PostProcessEditor.DefaultCode,pixel:PostProcessEditor.DefaultPixel,config:PostProcessEditor.DefaultConfig,userConfig:{textures:[],floats:[],vectors2:[],vectors3:[]},id:babylonjs_1.Tools.RandomId()},this.datas.push(data),this.grid.addRow({name:data.name,preview:data.preview,recid:this.grid.element.records.length-1}),this.grid.selectNone(),this.grid.select([this.datas.length-1]),this.selectPostProcess(this.datas.length-1),this.layout.unlockPanel("main"),babylonjs_editor_1.VSCodeSocket.RefreshPostProcess(data),[2]}})})},PostProcessEditor.prototype.changePostProcess=function(id,value){var data=this.datas[id],postProcesses=this.editor.core.scene.postProcesses;if("string"!=typeof value){var camera=this.editor.core.scene.activeCamera;data.preview=value;for(var _a=0,postProcesses_2=postProcesses;_a<postProcesses_2.length;_a++){var p=postProcesses_2[_a];if(p instanceof post_process_1.default&&p.name===data.name)return void(value?camera.attachPostProcess(p,camera._postProcesses.length+id):camera.detachPostProcess(p))}babylonjs_editor_1.VSCodeSocket.RefreshMaterial(this.datas)}else{var lastName=data.name;data.name=value;for(var _i=0,postProcesses_1=postProcesses;_i<postProcesses_1.length;_i++){var p=postProcesses_1[_i];if(p instanceof post_process_1.default&&p.name===lastName){p.name=value;break}}}},PostProcessEditor.prototype.selectPostProcess=function(id){this.data=this.datas[id],this.code.setValue(this.data.code),this.pixel.setValue(this.data.pixel),this.config.setValue(this.data.config),helpers_1.default.UpdateMonacoTypings(this.editor,this.data),PostProcessEditor.CodeProjectEditor&&this.layout.lockPanel("main")},PostProcessEditor.prototype.createEditors=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this.code=new babylonjs_editor_1.CodeEditor("typescript",this.data?this.data.code:""),[4,this.code.build("POST-PROCESS-CREATOR-EDITOR-CODE")];case 1:return _a.sent(),this.pixel=new babylonjs_editor_1.CodeEditor("cpp",this.data?this.data.pixel:""),[4,this.pixel.build("POST-PROCESS-CREATOR-EDITOR-PIXEL")];case 2:return _a.sent(),this.config=new babylonjs_editor_1.CodeEditor("json",this.data?this.data.config:""),[4,this.config.build("POST-PROCESS-CREATOR-EDITOR-CONFIG")];case 3:return _a.sent(),this.layout.getPanelFromType("main").tabs.on("click",function(ev){$("#"+_this.currentTab).hide(),_this.currentTab="POST-PROCESS-CREATOR-EDITOR-"+ev.target.toUpperCase(),$("#"+_this.currentTab).show()}),this.code.onChange=function(value){_this.data&&(_this.data.code=value,_this.data.compiledCode=_this.code.transpileTypeScript(value,_this.data.name.replace(/ /,"")),babylonjs_editor_1.VSCodeSocket.RefreshPostProcess(_this.data))},this.pixel.onChange=function(value){_this.data&&(_this.data.pixel=value,babylonjs_editor_1.VSCodeSocket.RefreshPostProcess(_this.data))},this.config.onChange=function(value){_this.data&&(_this.data.config=value,babylonjs_editor_1.VSCodeSocket.RefreshPostProcess(_this.data))},[2]}})})},PostProcessEditor.prototype.editCode=function(){return __awaiter(this,void 0,void 0,function(){var editor,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return PostProcessEditor.CodeProjectEditor?[2]:[4,babylonjs_editor_1.CodeProjectEditorFactory.Create(this.editor,{name:"Code Editor - Post-Processes",scripts:this.editor.core.scene.metadata.PostProcessCreator,onOpened:function(){_this.layout.lockPanel("main")},onClose:function(){PostProcessEditor.CodeProjectEditor=null,_this.data&&_this.layout.unlockPanel("main")}})];case 1:return editor=_a.sent(),PostProcessEditor.CodeProjectEditor=editor,[2]}})})},PostProcessEditor.prototype._addPostProcessesFromFiles=function(file){return __awaiter(this,void 0,void 0,function(){var content,data,postProcesses,picker,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,babylonjs_editor_1.Tools.ReadFileAsText(file)];case 1:return content=_a.sent(),(data=JSON.parse(content),postProcesses=data.customMetadatas?data.customMetadatas.PostProcessCreatorExtension:data)?(babylonjs_editor_1.Tools.SortAlphabetically(postProcesses,"name"),picker=new babylonjs_editor_1.Picker("AddPostProcesses"),picker.addItems(postProcesses),picker.open(function(items,selected){selected.forEach(function(s){var data=postProcesses[s];_this.datas.push(data),_this.grid.addRow({name:data.name,preview:data.preview,recid:_this.grid.element.records.length-1})}),selected.length>0&&!PostProcessEditor.CodeProjectEditor&&(_this.layout.unlockPanel("main"),_this.data=_this.datas[_this.datas.length-1],_this.grid.select([_this.datas.length-1]),_this.selectPostProcess(_this.datas.length-1))}),[2]):[2]}})})},PostProcessEditor.DefaultCode="",PostProcessEditor.DefaultPixel="",PostProcessEditor.DefaultConfig="",PostProcessEditor.CodeProjectEditor=null,PostProcessEditor}(babylonjs_editor_1.EditorPlugin);exports.default=PostProcessEditor})})(function(factory){module.exports=factory(require("babylonjs"),require("babylonjs-editor"),require("extensions/extensions.js"))});