!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6))),{}):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return i(t,r),a(t,r,[]),t.module}function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function s(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module,"__useDefault"in u?u.__useDefault:u}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=s(r.deps,r.depLoads,n);if(!r.executingRequire)for(var i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}var f=t.module=new o(r.moduleObj);if(!r.setters)for(var i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a],{}));i(s);var v=u(e[0]);if(e.length>1)for(var a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["c","30","31"],!0,function($__System){var require=this.require,exports=this.exports,module=this.module;$__System.registerDynamic("b",["c","d","e"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),extensions_1=$__require("d"),extension_1=$__require("e"),AssetsExtension=function(_super){function AssetsExtension(scene){var _this=_super.call(this,scene)||this;return _this.prefabs=[],_this.particles=[],_this._particlesInstances={},_this}return __extends(AssetsExtension,_super),AssetsExtension.prototype.onApply=function(data){var _this=this;data.prefabs&&data.prefabs.forEach(function(p){return _this.prefabs.push(p)}),data.particles&&data.particles.forEach(function(p){return _this.particles.push(p)})},AssetsExtension.prototype.instantiatePrefab=function(name){for(var _this=this,_loop_1=function(p){var _a;if(p.name!==name)return"continue";var source=this_1.scene.getNodeByID(p.data.nodeIds[0]);if(!source)return{value:null};var master=this_1._createInstance(source);if(!master)return{value:null};var descendants=source.getDescendants(),parentingDict=(_a={},_a[source.id]=master,_a);return descendants.forEach(function(d){var child=_this._createInstance(d);child&&(child.parent=parentingDict[d.parent.id],parentingDict[d.id]=child)}),{value:master}},this_1=this,_i=0,_a=this.prefabs;_i<_a.length;_i++){var p=_a[_i],state_1=_loop_1(p);if("object"==typeof state_1)return state_1.value}return null},AssetsExtension.prototype.instantiateParticleSystemsSet=function(name,position){for(var _this=this,_loop_2=function(ps){if(ps.name!==name)return"continue";var set=this_2._particlesInstances[name];return set||(set=new babylonjs_1.ParticleSystemSet,ps.data.psData.systems.forEach(function(s){var ps=babylonjs_1.ParticleSystem.Parse(s,_this.scene,extensions_1.default.RoolUrl,!0);set.systems.push(ps)}),this_2._particlesInstances[name]=set),position&&set.systems.forEach(function(s){return s.emitter=position}),this_2._particlesInstances[name]=set,{value:set}},this_2=this,_i=0,_a=this.particles;_i<_a.length;_i++){var ps=_a[_i],state_2=_loop_2(ps);if("object"==typeof state_2)return state_2.value}return null},AssetsExtension.prototype._createInstance=function(node){return node instanceof babylonjs_1.Mesh?node.createInstance(node.name+"Inst"):node.clone?node.clone(node.name+"Inst",null):null},AssetsExtension.prototype.onSerialize=function(){return null},AssetsExtension.prototype.onLoad=function(data){},AssetsExtension}(extension_1.default);exports.default=AssetsExtension,extensions_1.default.Register("AssetsExtension",AssetsExtension)}),$__System.registerDynamic("f",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),GetPosition=function(_super){function GetPosition(){var _this=_super.call(this)||this;return _this.title="Get Position",_this.addOutput("vec3","vec3"),_this.addOutput("x","number"),_this.addOutput("y","number"),_this.addOutput("z","number"),_this._data=new Float32Array(3),_this}return __extends(GetPosition,_super),GetPosition.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject;data[0]=node.position.x,data[1]=node.position.y,data[2]=node.position.z,this.setOutputData(0,data),this.setOutputData(1,data[0]),this.setOutputData(2,data[1]),this.setOutputData(3,data[2])},GetPosition.Desc="Get Object Position by Vec3",GetPosition.Title="Get Position",GetPosition}(typings_1.LiteGraphNode);exports.GetPosition=GetPosition;var SetPosition=function(_super){function SetPosition(){var _this=_super.call(this,!0)||this;return _this.title="Set Position",_this.addInput("vec3","vec3"),_this.addInput("x","number"),_this.addInput("y","number"),_this.addInput("z","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetPosition,_super),SetPosition.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject,vec3=this.getInputData(1);vec3?(node.position.x=data[0]=vec3[0],node.position.y=data[1]=vec3[1],node.position.z=data[2]=vec3[2]):(node.position.x=data[0]=this.getInputData(2),node.position.y=data[1]=this.getInputData(3),node.position.z=data[2]=this.getInputData(4)),this.setOutputData(0,data)},SetPosition.Desc="Set Object Position by Vec3",SetPosition.Title="Set Position",SetPosition}(typings_1.LiteGraphNode);exports.SetPosition=SetPosition}),$__System.registerDynamic("11",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),GetRotation=function(_super){function GetRotation(){var _this=_super.call(this)||this;return _this.title="Get Rotation",_this.addOutput("vec3","vec3"),_this.addOutput("x","number"),_this.addOutput("y","number"),_this.addOutput("z","number"),_this._data=new Float32Array(3),_this}return __extends(GetRotation,_super),GetRotation.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject;data[0]=node.rotation.x,data[1]=node.rotation.y,data[2]=node.rotation.z,this.setOutputData(0,data),this.setOutputData(1,data[0]),this.setOutputData(2,data[1]),this.setOutputData(3,data[2])},GetRotation.Desc="Get Object Rotation by Vec3",GetRotation.Title="Get Rotation",GetRotation}(typings_1.LiteGraphNode);exports.GetRotation=GetRotation;var SetRotation=function(_super){function SetRotation(){var _this=_super.call(this,!0)||this;return _this.title="Set Rotation",_this.addInput("vec3","vec3"),_this.addInput("x","number"),_this.addInput("y","number"),_this.addInput("z","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetRotation,_super),SetRotation.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject,vec3=this.getInputData(1);vec3?(node.rotation.x=data[0]=vec3[0],node.rotation.y=data[1]=vec3[1],node.rotation.z=data[2]=vec3[2]):(node.rotation.x=data[0]=this.getInputData(2),node.rotation.y=data[1]=this.getInputData(3),node.rotation.z=data[2]=this.getInputData(4)),this.setOutputData(0,data)},SetRotation.Desc="Set Object Rotation by Vec3",SetRotation.Title="Set Rotation",SetRotation}(typings_1.LiteGraphNode);exports.SetRotation=SetRotation}),$__System.registerDynamic("12",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),GetScale=function(_super){function GetScale(){var _this=_super.call(this)||this;return _this.title="Get Scale",_this.addOutput("vec3","vec3"),_this.addOutput("x","number"),_this.addOutput("y","number"),_this.addOutput("z","number"),_this._data=new Float32Array(3),_this}return __extends(GetScale,_super),GetScale.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject;data[0]=node.scaling.x,data[1]=node.scaling.y,data[2]=node.scaling.z,this.setOutputData(0,data),this.setOutputData(1,data[0]),this.setOutputData(2,data[1]),this.setOutputData(3,data[2])},GetScale.Desc="Get Object Scale by Vec3",GetScale.Title="Get Scale",GetScale}(typings_1.LiteGraphNode);exports.GetScale=GetScale;var SetScale=function(_super){function SetScale(){var _this=_super.call(this,!0)||this;return _this.title="Set Scale",_this.addInput("vec3","vec3"),_this.addInput("x","number"),_this.addInput("y","number"),_this.addInput("z","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetScale,_super),SetScale.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject,vec3=this.getInputData(1);vec3?(node.scaling.x=data[0]=vec3[0],node.scaling.y=data[1]=vec3[1],node.scaling.z=data[2]=vec3[2]):(node.scaling.x=data[0]=this.getInputData(2),node.scaling.y=data[1]=this.getInputData(3),node.scaling.z=data[2]=this.getInputData(4)),this.setOutputData(0,data)},SetScale.Desc="Set Object Scale by Vec3",SetScale.Title="Set Scale",SetScale}(typings_1.LiteGraphNode);exports.SetScale=SetScale}),$__System.registerDynamic("13",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),GetAmbientColor=function(_super){function GetAmbientColor(){var _this=_super.call(this)||this;return _this.title="Get Ambient Color",_this.addOutput("color","vec3"),_this.addOutput("r","number"),_this.addOutput("g","number"),_this.addOutput("b","number"),_this._data=new Float32Array(3),_this}return __extends(GetAmbientColor,_super),GetAmbientColor.prototype.onExecute=function(){var node=this.graph.scriptObject;this._data[0]=node.ambientColor.r,this._data[1]=node.ambientColor.g,this._data[2]=node.ambientColor.b,this.setOutputData(0,this._data),this.setOutputData(1,this._data[0]),this.setOutputData(2,this._data[1]),this.setOutputData(3,this._data[2])},GetAmbientColor.Desc="Get Object Ambient Color",GetAmbientColor.Title="Get Ambient Color",GetAmbientColor}(typings_1.LiteGraphNode);exports.GetAmbientColor=GetAmbientColor;var SetAmbientColor=function(_super){function SetAmbientColor(){var _this=_super.call(this,!0)||this;return _this.title="Set Ambient Color",_this.addInput("color","vec3"),_this.addInput("r","number"),_this.addInput("g","number"),_this.addInput("b","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetAmbientColor,_super),SetAmbientColor.prototype.onExecute=function(){var node=this.graph.scriptObject,color=this.getInputData(1);color?(node.ambientColor.r=this._data[0]=color[0],node.ambientColor.g=this._data[1]=color[1],node.ambientColor.b=this._data[2]=color[2]):(node.ambientColor.r=this._data[0]=this.getInputData(2),node.ambientColor.g=this._data[1]=this.getInputData(3),node.ambientColor.b=this._data[2]=this.getInputData(4)),this.setOutputData(0,this._data)},SetAmbientColor.Desc="Set Object Ambient Color",SetAmbientColor.Title="Set Ambient Color",SetAmbientColor}(typings_1.LiteGraphNode);exports.SetAmbientColor=SetAmbientColor}),$__System.registerDynamic("14",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),GetClearColor=function(_super){function GetClearColor(){var _this=_super.call(this)||this;return _this.title="Get Clear Color",_this.addOutput("color","vec4"),_this.addOutput("r","number"),_this.addOutput("g","number"),_this.addOutput("b","number"),_this.addOutput("a","number"),_this._data=new Float32Array(4),_this}return __extends(GetClearColor,_super),GetClearColor.prototype.onExecute=function(){var node=this.graph.scriptObject;this._data[0]=node.clearColor.r,this._data[1]=node.clearColor.g,this._data[2]=node.clearColor.b,this._data[3]=node.clearColor.a,this.setOutputData(0,this._data),this.setOutputData(1,this._data[0]),this.setOutputData(2,this._data[1]),this.setOutputData(3,this._data[2]),this.setOutputData(4,this._data[3])},GetClearColor.Desc="Get Object Clear Color",GetClearColor}(typings_1.LiteGraphNode);exports.GetClearColor=GetClearColor;var SetClearColor=function(_super){function SetClearColor(){var _this=_super.call(this,!0)||this;return _this.title="Set Clear Color",_this.addInput("color","vec4"),_this.addInput("r","number"),_this.addInput("g","number"),_this.addInput("b","number"),_this.addInput("a","number"),_this.addOutput("color","vec4"),_this._data=new Float32Array(4),_this}return __extends(SetClearColor,_super),SetClearColor.prototype.onExecute=function(){var node=this.graph.scriptObject,color=this.getInputData(1);color?(node.clearColor.r=this._data[0]=color[0],node.clearColor.g=this._data[1]=color[1],node.clearColor.b=this._data[2]=color[2],node.clearColor.a=this._data[3]=color[3]):(node.clearColor.r=this._data[0]=this.getInputData(2),node.clearColor.g=this._data[1]=this.getInputData(3),node.clearColor.b=this._data[2]=this.getInputData(4),node.clearColor.a=this._data[3]=this.getInputData(5)),this.setOutputData(0,this._data)},SetClearColor.Desc="Set Object Clear Color",SetClearColor}(typings_1.LiteGraphNode);exports.SetClearColor=SetClearColor}),$__System.registerDynamic("15",["16","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("16"),typings_1=$__require("10"),RenderLoop=function(_super){function RenderLoop(){var _this=_super.call(this)||this;return _this.title="Render Loop",_this.mode=litegraph_js_1.LiteGraph.NEVER,_this.addOutput("Render",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(RenderLoop,_super),RenderLoop.prototype.onExecute=function(){this.triggerSlot(0)},RenderLoop.Desc="On Render Loop",RenderLoop.Title="On Render Loop",RenderLoop}(typings_1.LiteGraphNode);exports.RenderLoop=RenderLoop;var RenderStart=function(_super){function RenderStart(){var _this=_super.call(this)||this;return _this.started=!1,_this.title="Render Starts",_this.mode=litegraph_js_1.LiteGraph.NEVER,_this.addOutput("Render",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(RenderStart,_super),RenderStart.prototype.onExecute=function(){this.started||(this.started=!0,this.triggerSlot(0))},RenderStart.Desc="On rendering starts (called once)",RenderStart.Title="On Render Starts",RenderStart}(typings_1.LiteGraphNode);exports.RenderStart=RenderStart}),$__System.registerDynamic("17",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),GetProperty=function(_super){function GetProperty(){var _this=_super.call(this)||this;return _this._propertyValue=null,_this.title="Get Property",_this.addProperty("propertyPath","material.name"),_this.addProperty("nodePath","self"),_this.addOutput("Output","string,number,boolean"),_this}return __extends(GetProperty,_super),GetProperty.prototype.onDrawBackground=function(ctx,graph,canvas,text){this.title="Get "+this.properties.propertyPath,null!==this._propertyValue&&void 0!==this._propertyValue&&(_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this._propertyValue.toString()),this.graph.setDirtyCanvas(!0,!0))},GetProperty.prototype.onExecute=function(){for(var propertyPath=this.properties.propertyPath,nodePath=this.properties.nodePath,node=this.getTargetNode(nodePath),split=propertyPath.split("."),effectiveProperty=node[split[0]],i=1;i<split.length;i++)effectiveProperty=effectiveProperty[split[i]];this._propertyValue=effectiveProperty,this.setOutputData(0,effectiveProperty)},GetProperty.Desc="Gets the value of the given property",GetProperty.Title="Get Property",GetProperty}(typings_1.LiteGraphNode);exports.GetProperty=GetProperty;var SetProperty=function(_super){function SetProperty(){var _this=_super.call(this,!0)||this;return _this._propertyValue="",_this.title="Set Property",_this.addProperty("propertyPath","material.name"),_this.addProperty("nodePath","self"),_this.addProperty("propertyValue",""),_this.addInput("Output","number,string,boolean"),_this.addOutput("Input","string,number,boolean"),_this}return __extends(SetProperty,_super),SetProperty.prototype.onDrawBackground=function(ctx){this.title="Set "+this.properties.propertyPath},SetProperty.prototype.onExecute=function(){var propertyPath=this.properties.propertyPath,nodePath=this.properties.nodePath,node=this.getTargetNode(nodePath),split=propertyPath.split("."),length=split.length;if(1===length)this.setOutputData(0,this._setProperty(node,propertyPath));else{for(var effectiveProperty=node[split[0]],i=1;i<length-1;i++)effectiveProperty=effectiveProperty[split[i]];this.setOutputData(0,this._setProperty(effectiveProperty,split[length-1]))}},SetProperty.prototype._setProperty=function(object,path){var type=typeof object[path],value=this.properties.propertyValue;if(value){switch(type.toLowerCase()){case"boolean":object[path]="true"===value.toLowerCase();break;case"number":object[path]=parseFloat(value);break;case"string":object[path]=value}return value}return object[path]=this.getInputData(1)},SetProperty.Desc="Sets the value of the given property",SetProperty.Title="Set Property",SetProperty}(typings_1.LiteGraphNode);exports.SetProperty=SetProperty}),$__System.registerDynamic("18",["16","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("16"),typings_1=$__require("10"),Condition=function(_super){function Condition(){var _this=_super.call(this,!0)||this;return _this.title="Condition between A and B",_this.mode=litegraph_js_1.LiteGraph.ALWAYS,_this.addInput("A","number,string,boolean"),_this.addInput("B","number,string,boolean"),_this.addOutput("A == B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A != B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A > B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A < B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A <= B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A >= B",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(Condition,_super),Condition.prototype.onExecute=function(){var a=this.getInputData(1),b=this.getInputData(2);a===b&&this.triggerSlot(0),a!==b&&this.triggerSlot(1),a>b&&this.triggerSlot(2),a<b&&this.triggerSlot(3),a<=b&&this.triggerSlot(4),function(a){return b}&&this.triggerSlot(5)},Condition.Desc='If the condition result is "true", then the Execute output will be triggered',Condition.Title="Condition",Condition}(typings_1.LiteGraphNode);exports.Condition=Condition}),$__System.registerDynamic("19",["c","16","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),litegraph_js_1=$__require("16"),typings_1=$__require("10"),AbstractPointer=function(_super){function AbstractPointer(title,pointerEventType,resetState){var _this=_super.call(this)||this;return _this.isSuccess=!1,_this._observer=null,_this.title=title,_this._pointerEventType=pointerEventType,_this._resetState=resetState,_this.addOutput("Execute",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(AbstractPointer,_super),AbstractPointer.prototype.onExecute=function(){var _this=this,mesh=this.graph.scriptObject,scene=mesh.getScene();this._observer||(this._observer=scene.onPointerObservable.add(function(p){if(p.type===_this._pointerEventType){var pick=scene.pick(scene.pointerX,scene.pointerY);_this.isSuccess=_this.customCheck?_this.customCheck(mesh,pick.pickedMesh):pick.pickedMesh===mesh}})),this.isSuccess&&(this._resetState&&(this.isSuccess=!1),this.triggerSlot(0))},AbstractPointer}(typings_1.LiteGraphNode);exports.AbstractPointer=AbstractPointer;var PointerOver=function(_super){function PointerOver(){return _super.call(this,"Pointer Over",babylonjs_1.PointerEventTypes.POINTERMOVE,!1)||this}return __extends(PointerOver,_super),PointerOver.Desc="Triggers and action on the pointer is over the mesh (only meshes are supported)",PointerOver.Title="On Pointer Over",PointerOver}(AbstractPointer);exports.PointerOver=PointerOver;var PointerDown=function(_super){function PointerDown(){return _super.call(this,"Pointer Down",babylonjs_1.PointerEventTypes.POINTERDOWN,!0)||this}return __extends(PointerDown,_super),PointerDown.Desc="Triggers and action on the pointer is down on the mesh (only meshes are supported)",PointerDown.Title="On Pointer Down",PointerDown}(AbstractPointer);exports.PointerDown=PointerDown;var PointerOut=function(_super){function PointerOut(){var _this=_super.call(this,"Pointer Out",babylonjs_1.PointerEventTypes.POINTERMOVE,!0)||this;return _this._wasOver=!1,_this}return __extends(PointerOut,_super),PointerOut.prototype.customCheck=function(mesh,pickedMesh){return this._wasOver&&mesh!==pickedMesh?(this._wasOver=!1,!0):(this._wasOver=mesh===pickedMesh,!1)},PointerOut.Desc="Triggers and action on the pointer is out on the mesh (only meshes are supported)",PointerOut.Title="On Pointer Out",PointerOut}(AbstractPointer);exports.PointerOut=PointerOut}),$__System.registerDynamic("1a",["16","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("16"),typings_1=$__require("10"),SetTimeout=function(_super){function SetTimeout(){var _this=_super.call(this,!0)||this;return _this.timeoutId=null,_this.addOutput("Execute",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("Timeout Id","number"),_this.addProperty("ms",1e3),_this}return __extends(SetTimeout,_super),SetTimeout.prototype.onExecute=function(){var _this=this,id=setTimeout(function(){_this.triggerSlot(0)},this.properties.ms);this.setOutputData(1,id)},SetTimeout.Desc="Triggers output once the current time is out of the provided time (in ms)",SetTimeout.Title="Set Timeout",SetTimeout}(typings_1.LiteGraphNode);exports.SetTimeout=SetTimeout;var ClearTimeout=function(_super){function ClearTimeout(){var _this=_super.call(this,!0)||this;return _this.addInput("Timeout Id","number"),_this}return __extends(ClearTimeout,_super),ClearTimeout.prototype.onExecute=function(){var id=this.getInputData(1);clearTimeout(id)},ClearTimeout.Desc="Clears the given timeout id",ClearTimeout.Title="Clear Timeout",ClearTimeout}(typings_1.LiteGraphNode);exports.ClearTimeout=ClearTimeout}),$__System.registerDynamic("1b",["16","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("16"),typings_1=$__require("10"),PlayAnimations=function(_super){function PlayAnimations(){var _this=_super.call(this,!0)||this;return _this.title="Play Animations",_this.addOutput("On End",litegraph_js_1.LiteGraph.EVENT),_this.addProperty("from",0),_this.addProperty("to",60),_this.addProperty("loop",!1),_this.addProperty("speed",1),_this}return __extends(PlayAnimations,_super),PlayAnimations.prototype.onExecute=function(){var _this=this,node=this.graph.scriptObject;node.getScene().beginAnimation(node,this.properties.from,this.properties.to,this.properties.loop,this.properties.speed,function(){return _this.triggerSlot(0)})},PlayAnimations.Desc="Plays animations of the attached node",PlayAnimations.Title="Play Animations",PlayAnimations}(typings_1.LiteGraphNode);exports.PlayAnimations=PlayAnimations;var StopAnimations=function(_super){function StopAnimations(){var _this=_super.call(this,!0)||this;return _this.title="Stop Animations",_this.addOutput("On Stopped",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(StopAnimations,_super),StopAnimations.prototype.onExecute=function(){var node=this.graph.scriptObject;node.getScene().stopAnimation(node),this.triggerSlot(0)},StopAnimations.Desc="Stops animations of the attached node",StopAnimations.Title="Stop Animations",StopAnimations}(typings_1.LiteGraphNode);exports.StopAnimations=StopAnimations}),$__System.registerDynamic("1c",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),Number=function(_super){function Number(){var _this=_super.call(this)||this;return _this.title="Number",_this.addOutput("value","number"),_this.addProperty("value",1),_this}return __extends(Number,_super),Number.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.properties.value.toString()),this.graph.setDirtyCanvas(!0,!0)},Number.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},Number.Desc="Represents a constant number",Number}(typings_1.LiteGraphNode);exports.Number=Number;var String=function(_super){function String(){var _this=_super.call(this)||this;return _this.title="String",_this.addOutput("value","string"),_this.addProperty("value","New String"),_this}return __extends(String,_super),String.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.properties.value.toString()),this.graph.setDirtyCanvas(!0,!0)},String.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},String.Desc="Represents a constant string",String}(typings_1.LiteGraphNode);exports.String=String;var Boolean=function(_super){function Boolean(){var _this=_super.call(this)||this;return _this.title="Boolean",_this.addOutput("value","boolean"),_this.addProperty("value",!0),_this}return __extends(Boolean,_super),Boolean.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.properties.value.toString()),this.graph.setDirtyCanvas(!0,!0)},Boolean.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},Boolean.Desc="Represents a constant boolean",Boolean}(typings_1.LiteGraphNode);exports.Boolean=Boolean}),$__System.registerDynamic("1d",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),Color=function(_super){function Color(){var _this=_super.call(this)||this;return _this.title="Color",_this.addOutput("color3","vec3,vec4"),_this.addOutput("r","number"),_this.addOutput("g","number"),_this.addOutput("b","number"),_this.addProperty("r",1),_this.addProperty("g",1),_this.addProperty("b",1),_this.addProperty("a",1),_this._data=new Float32Array(4),_this}return __extends(Color,_super),Color.prototype.onExecute=function(){this._data[0]=this.properties.r,this._data[1]=this.properties.g,this._data[2]=this.properties.b,this._data[3]=this.properties.a,this.setOutputData(0,this._data),this.setOutputData(1,this.properties.r),this.setOutputData(2,this.properties.g),this.setOutputData(3,this.properties.b)},Color.Desc="Represents a constant color",Color}(typings_1.LiteGraphNode);exports.Color=Color}),$__System.registerDynamic("1e",["10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("10"),Time=function(_super){function Time(){var _this=_super.call(this)||this;return _this.title="Time",_this.addOutput("in ms","number"),_this.addOutput("in sec","number"),_this}return __extends(Time,_super),Time.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,(this.graph.globaltime>>0).toString()),this.graph.setDirtyCanvas(!0,!0)},Time.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},Time.Desc="Outputs the current time in ms or seconds",Time}(typings_1.LiteGraphNode);exports.Time=Time}),$__System.registerDynamic("16",[],!0,function($__require,exports,module){this||self;!function(global){function LGraph(o){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),o&&this.configure(o)}function LGraphNode(title){this._ctor(title)}function LGraphGroup(title){this._ctor(title)}function LGraphCanvas(canvas,graph,options){options=options||{},this.background_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",canvas&&canvas.constructor===String&&(canvas=document.querySelector(canvas)),this.max_zoom=10,this.min_zoom=.1,this.zoom_modify_alpha=!0,this.title_text_font="bold "+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#AAB",input_on:"#7F7",output_off:"#AAB",output_on:"#7F7"},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.render_shadows=!0,this.clear_background=!0,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.allow_searchbox=!0,this.allow_reconnect_links=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.always_render_background=!1,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!0,this.render_execution_order=!1,this.canvas_mouse=[0,0],this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.last_mouse_position=[0,0],this.visible_area=new Float32Array(4),graph&&graph.attachCanvas(this),this.setCanvas(canvas),this.clear(),options.skip_render||this.startRendering(),this.autoresize=options.autoresize}function compareObjects(a,b){for(var i in a)if(a[i]!=b[i])return!1;return!0}function distance(a,b){return Math.sqrt((b[0]-a[0])*(b[0]-a[0])+(b[1]-a[1])*(b[1]-a[1]))}function colorToString(c){return"rgba("+Math.round(255*c[0]).toFixed()+","+Math.round(255*c[1]).toFixed()+","+Math.round(255*c[2]).toFixed()+","+(4==c.length?c[3].toFixed(2):"1.0")+")"}function isInsideRectangle(x,y,left,top,width,height){return left<x&&left+width>x&&top<y&&top+height>y}function growBounding(bounding,x,y){x<bounding[0]?bounding[0]=x:x>bounding[2]&&(bounding[2]=x),y<bounding[1]?bounding[1]=y:y>bounding[3]&&(bounding[3]=y)}function isInsideBounding(p,bb){return!(p[0]<bb[0][0]||p[1]<bb[0][1]||p[0]>bb[1][0]||p[1]>bb[1][1])}function overlapBounding(a,b){var A_end_x=a[0]+a[2],A_end_y=a[1]+a[3],B_end_x=b[0]+b[2],B_end_y=b[1]+b[3];return!(a[0]>B_end_x||a[1]>B_end_y||A_end_x<b[0]||A_end_y<b[1])}function hex2num(hex){"#"==hex.charAt(0)&&(hex=hex.slice(1)),hex=hex.toUpperCase();for(var int1,int2,hex_alphabets="0123456789ABCDEF",value=new Array(3),k=0,i=0;i<6;i+=2)int1=hex_alphabets.indexOf(hex.charAt(i)),int2=hex_alphabets.indexOf(hex.charAt(i+1)),value[k]=16*int1+int2,k++;return value}function num2hex(triplet){for(var int1,int2,hex_alphabets="0123456789ABCDEF",hex="#",i=0;i<3;i++)int1=triplet[i]/16,int2=triplet[i]%16,hex+=hex_alphabets.charAt(int1)+hex_alphabets.charAt(int2);return hex}function ContextMenu(values,options){function on_mouse_wheel(e){var pos=parseInt(root.style.top);return root.style.top=(pos+.1*e.deltaY).toFixed()+"px",e.preventDefault(),!0}options=options||{},this.options=options;var that=this;options.parentMenu&&(options.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),options.parentMenu=null):(this.parentMenu=options.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this)),options.event&&options.event.constructor!==MouseEvent&&options.event.constructor!==CustomEvent&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),options.event=null);var root=document.createElement("div");if(root.className="litegraph litecontextmenu litemenubar-panel",options.className&&(root.className+=" "+options.className),root.style.minWidth=100,root.style.minHeight=100,root.style.pointerEvents="none",setTimeout(function(){root.style.pointerEvents="auto"},100),root.addEventListener("mouseup",function(e){return e.preventDefault(),!0},!0),root.addEventListener("contextmenu",function(e){return 2==e.button&&(e.preventDefault(),!1)},!0),root.addEventListener("mousedown",function(e){if(2==e.button)return that.close(),e.preventDefault(),!0},!0),root.addEventListener("wheel",on_mouse_wheel,!0),root.addEventListener("mousewheel",on_mouse_wheel,!0),this.root=root,options.title){var element=document.createElement("div");element.className="litemenu-title",element.innerHTML=options.title,root.appendChild(element)}var num=0;for(var i in values){var name=values.constructor==Array?values[i]:i;null!=name&&name.constructor!==String&&(name=void 0===name.content?String(name):name.content);var value=values[i];this.addItem(name,value,options),num++}root.addEventListener("mouseleave",function(e){that.lock||(root.closing_timer&&clearTimeout(root.closing_timer),root.closing_timer=setTimeout(that.close.bind(that,e),500))}),root.addEventListener("mouseenter",function(e){root.closing_timer&&clearTimeout(root.closing_timer)});var root_document=document;options.event&&(root_document=options.event.target.ownerDocument),root_document||(root_document=document),root_document.body.appendChild(root);var left=options.left||0,top=options.top||0;if(options.event){if(left=options.event.pageX-10,top=options.event.pageY-10,options.title&&(top-=20),options.parentMenu){var rect=options.parentMenu.root.getBoundingClientRect();left=rect.left+rect.width}var body_rect=document.body.getBoundingClientRect(),root_rect=root.getBoundingClientRect();left>body_rect.width-root_rect.width-10&&(left=body_rect.width-root_rect.width-10),top>body_rect.height-root_rect.height-10&&(top=body_rect.height-root_rect.height-10)}root.style.left=left+"px",root.style.top=top+"px"}var LiteGraph=global.LiteGraph={CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:20,NODE_SLOT_HEIGHT:15,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#444",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,LINK_COLOR:"#AAD",EVENT_LINK_COLOR:"#F85",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},searchbox_extras:{},registerNodeType:function(type,base_class){if(!base_class.prototype)throw"Cannot register a simple object, it must be a class with a prototype";base_class.type=type,LiteGraph.debug&&console.log("Node registered: "+type);var classname=(type.split("/"),base_class.name),pos=type.lastIndexOf("/");if(base_class.category=type.substr(0,pos),base_class.title||(base_class.title=classname),base_class.prototype)for(var i in LGraphNode.prototype)base_class.prototype[i]||(base_class.prototype[i]=LGraphNode.prototype[i]);if(Object.defineProperty(base_class.prototype,"shape",{set:function(v){switch(v){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=v}},get:function(v){return this._shape},enumerable:!0}),this.registered_node_types[type]=base_class,base_class.constructor.name&&(this.Nodes[classname]=base_class),base_class.prototype.onPropertyChange&&console.warn("LiteGraph node class "+type+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),base_class.supported_extensions)for(var i in base_class.supported_extensions)this.node_types_by_file_extension[base_class.supported_extensions[i].toLowerCase()]=base_class},wrapFunctionAsNode:function(name,func,param_types,return_type){for(var params=Array(func.length),code="",names=LiteGraph.getParameterNames(func),i=0;i<names.length;++i)code+="this.addInput('"+names[i]+"',"+(param_types&&param_types[i]?"'"+param_types[i]+"'":"0")+");\n";code+="this.addOutput('out',"+(return_type?"'"+return_type+"'":0)+");\n";var classobj=Function(code);classobj.title=name.split("/").pop(),classobj.desc="Generated from "+func.name,classobj.prototype.onExecute=function(){for(var i=0;i<params.length;++i)params[i]=this.getInputData(i);var r=func.apply(this,params);this.setOutputData(0,r)},this.registerNodeType(name,classobj)},addNodeMethod:function(name,func){LGraphNode.prototype[name]=func;for(var i in this.registered_node_types){var type=this.registered_node_types[i];type.prototype[name]&&(type.prototype["_"+name]=type.prototype[name]),type.prototype[name]=func}},createNode:function(type,title,options){var base_class=this.registered_node_types[type];if(!base_class)return LiteGraph.debug&&console.log('GraphNode type "'+type+'" not registered.'),null;base_class.prototype;title=title||base_class.title||type;var node=new base_class(title);if(node.type=type,!node.title&&title&&(node.title=title),node.properties||(node.properties={}),node.properties_info||(node.properties_info=[]),node.flags||(node.flags={}),node.size||(node.size=node.computeSize()),node.pos||(node.pos=LiteGraph.DEFAULT_POSITION.concat()),node.mode||(node.mode=LiteGraph.ALWAYS),options)for(var i in options)node[i]=options[i];return node},getNodeType:function(type){return this.registered_node_types[type]},getNodeTypesInCategory:function(category,filter){var r=[];for(var i in this.registered_node_types){var type=this.registered_node_types[i];filter&&type.filter&&type.filter!=filter||(""==category?null==type.category&&r.push(type):type.category==category&&r.push(type))}return r},getNodeTypesCategories:function(){var categories={"":1};for(var i in this.registered_node_types)this.registered_node_types[i].category&&!this.registered_node_types[i].skip_list&&(categories[this.registered_node_types[i].category]=1);var result=[];for(var i in categories)result.push(i);return result},reloadNodes:function(folder_wildcard){var tmp=document.getElementsByTagName("script"),script_files=[];for(var i in tmp)script_files.push(tmp[i]);var docHeadObj=document.getElementsByTagName("head")[0];folder_wildcard=document.location.href+folder_wildcard;for(var i in script_files){var src=script_files[i].src;if(src&&src.substr(0,folder_wildcard.length)==folder_wildcard)try{LiteGraph.debug&&console.log("Reloading: "+src);var dynamicScript=document.createElement("script");dynamicScript.type="text/javascript",dynamicScript.src=src,docHeadObj.appendChild(dynamicScript),docHeadObj.removeChild(script_files[i])}catch(err){if(LiteGraph.throw_errors)throw err;LiteGraph.debug&&console.log("Error while reloading "+src)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(obj,target){if(null==obj)return null;var r=JSON.parse(JSON.stringify(obj));if(!target)return r;for(var i in r)target[i]=r[i];return target},isValidConnection:function(type_a,type_b){if(!type_a||!type_b||type_a==type_b||type_a==LiteGraph.EVENT&&type_b==LiteGraph.ACTION)return!0;if(type_a=String(type_a),type_b=String(type_b),type_a=type_a.toLowerCase(),type_b=type_b.toLowerCase(),-1==type_a.indexOf(",")&&-1==type_b.indexOf(","))return type_a==type_b;for(var supported_types_a=type_a.split(","),supported_types_b=type_b.split(","),i=0;i<supported_types_a.length;++i)for(var j=0;j<supported_types_b.length;++j)if(supported_types_a[i]==supported_types_b[j])return!0;return!1},registerSearchboxExtra:function(node_type,description,data){this.searchbox_extras[description]={type:node_type,desc:description,data:data}}};"undefined"!=typeof performance?LiteGraph.getTime=performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?LiteGraph.getTime=Date.now.bind(Date):"undefined"!=typeof process?LiteGraph.getTime=function(){var t=process.hrtime();return.001*t[0]+1e-6*t[1]}:LiteGraph.getTime=function(){return(new Date).getTime()},global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=1,this.last_link_id=1,this._version=-1,this._nodes)for(var i=0;i<this._nodes.length;++i){var node=this._nodes[i];node.onRemoved&&node.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.global_inputs={},this.global_outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(graphcanvas){if(graphcanvas.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";graphcanvas.graph&&graphcanvas.graph!=this&&graphcanvas.graph.detachCanvas(graphcanvas),graphcanvas.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(graphcanvas)},LGraph.prototype.detachCanvas=function(graphcanvas){if(this.list_of_graphcanvas){var pos=this.list_of_graphcanvas.indexOf(graphcanvas);-1!=pos&&(graphcanvas.graph=null,this.list_of_graphcanvas.splice(pos,1))}},LGraph.prototype.start=function(interval){function on_frame(){-1==that.execution_timer_id&&(window.requestAnimationFrame(on_frame),that.runStep(1,!this.catch_errors))}if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,interval=interval||0;var that=this;0==interval&&"undefined"!=typeof window&&window.requestAnimationFrame?(this.execution_timer_id=-1,on_frame()):this.execution_timer_id=setInterval(function(){that.runStep(1,!this.catch_errors)},interval)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(num,do_not_catch_errors){num=num||1;var start=LiteGraph.getTime();this.globaltime=.001*(start-this.starttime);var nodes=this._nodes_executable?this._nodes_executable:this._nodes;if(nodes){if(do_not_catch_errors){for(var i=0;i<num;i++){for(var j=0,l=nodes.length;j<l;++j){var node=nodes[j];node.mode==LiteGraph.ALWAYS&&node.onExecute&&node.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var i=0;i<num;i++){for(var j=0,l=nodes.length;j<l;++j){var node=nodes[j];node.mode==LiteGraph.ALWAYS&&node.onExecute&&node.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(err){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw err;LiteGraph.debug&&console.log("Error during execution: "+err),this.stop()}var now=LiteGraph.getTime(),elapsed=now-start;0==elapsed&&(elapsed=1),this.execution_time=.001*elapsed,this.globaltime+=.001*elapsed,this.iteration+=1,this.elapsed_time=.001*(now-this.last_update_time),this.last_update_time=now}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var i=0;i<this._nodes_in_order.length;++i)this._nodes_in_order[i].onExecute&&this._nodes_executable.push(this._nodes_in_order[i])},LGraph.prototype.computeExecutionOrder=function(only_onExecute,set_level){for(var L=[],S=[],M={},visited_links={},remaining_links={},i=0,l=this._nodes.length;i<l;++i){var node=this._nodes[i];if(!only_onExecute||node.onExecute){M[node.id]=node;var num=0;if(node.inputs)for(var j=0,l2=node.inputs.length;j<l2;j++)node.inputs[j]&&null!=node.inputs[j].link&&(num+=1);0==num?(S.push(node),set_level&&(node._level=1)):(set_level&&(node._level=0),remaining_links[node.id]=num)}}for(;;){if(0==S.length)break;var node=S.shift();if(L.push(node),delete M[node.id],node.outputs)for(var i=0;i<node.outputs.length;i++){var output=node.outputs[i];if(null!=output&&null!=output.links&&0!=output.links.length)for(var j=0;j<output.links.length;j++){var link_id=output.links[j],link=this.links[link_id];if(link&&!visited_links[link.id]){var target_node=this.getNodeById(link.target_id);null!=target_node?(set_level&&(!target_node._level||target_node._level<=node._level)&&(target_node._level=node._level+1),visited_links[link.id]=!0,remaining_links[target_node.id]-=1,0==remaining_links[target_node.id]&&S.push(target_node)):visited_links[link.id]=!0}}}}for(var i in M)L.push(M[i]);L.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var l=L.length,i=0;i<l;++i)L[i].order=i;L=L.sort(function(A,B){var Ap=A.constructor.priority||A.priority||0,Bp=B.constructor.priority||B.priority||0;return Ap==Bp?A.order-B.order:Ap-Bp});for(var i=0;i<l;++i)L[i].order=i;return L},LGraph.prototype.getAncestors=function(node){for(var ancestors=[],pending=[node],visited={};pending.length;){var current=pending.shift();if(current.inputs){visited[current.id]||current==node||(visited[current.id]=!0,ancestors.push(current));for(var i=0;i<current.inputs.length;++i){var input=current.getInputNode(i);input&&-1==ancestors.indexOf(input)&&pending.push(input)}}}return ancestors.sort(function(a,b){return a.order-b.order}),ancestors},LGraph.prototype.arrange=function(margin){margin=margin||40;for(var nodes=this.computeExecutionOrder(!1,!0),columns=[],i=0;i<nodes.length;++i){var node=nodes[i],col=node._level||1;columns[col]||(columns[col]=[]),columns[col].push(node)}for(var x=margin,i=0;i<columns.length;++i){var column=columns[i];if(column){for(var max_size=100,y=margin,j=0;j<column.length;++j){var node=column[j];node.pos[0]=x,node.pos[1]=y,node.size[0]>max_size&&(max_size=node.size[0]),y+=node.size[1]+margin}x+=max_size+margin}}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(eventname,params,mode){mode=mode||LiteGraph.ALWAYS;var nodes=this._nodes_in_order?this._nodes_in_order:this._nodes;if(nodes)for(var j=0,l=nodes.length;j<l;++j){var node=nodes[j];node[eventname]&&node.mode==mode&&(void 0===params?node[eventname]():params&&params.constructor===Array?node[eventname].apply(node,params):node[eventname](params))}},LGraph.prototype.sendActionToCanvas=function(action,params){if(this.list_of_graphcanvas)for(var i=0;i<this.list_of_graphcanvas.length;++i){var c=this.list_of_graphcanvas[i];c[action]&&c[action].apply(c,params)}},LGraph.prototype.add=function(node,skip_compute_order){if(node){if(node.constructor===LGraphGroup)return this._groups.push(node),this.setDirtyCanvas(!0),this.change(),node.graph=this,void this._version++;if(-1!=node.id&&null!=this._nodes_by_id[node.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),node.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return null==node.id||-1==node.id?node.id=++this.last_node_id:this.last_node_id<node.id&&(this.last_node_id=node.id),node.graph=this,this._version++,this._nodes.push(node),this._nodes_by_id[node.id]=node,node.onAdded&&node.onAdded(this),this.config.align_to_grid&&node.alignToGrid(),skip_compute_order||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(node),this.setDirtyCanvas(!0),this.change(),node}},LGraph.prototype.remove=function(node){if(node.constructor===LiteGraph.LGraphGroup){var index=this._groups.indexOf(node);return-1!=index&&this._groups.splice(index,1),node.graph=null,this._version++,this.setDirtyCanvas(!0,!0),void this.change()}if(null!=this._nodes_by_id[node.id]&&!node.ignore_remove){if(node.inputs)for(var i=0;i<node.inputs.length;i++){var slot=node.inputs[i];null!=slot.link&&node.disconnectInput(i)}if(node.outputs)for(var i=0;i<node.outputs.length;i++){var slot=node.outputs[i];null!=slot.links&&slot.links.length&&node.disconnectOutput(i)}if(node.onRemoved&&node.onRemoved(),node.graph=null,this._version++,this.list_of_graphcanvas)for(var i=0;i<this.list_of_graphcanvas.length;++i){var canvas=this.list_of_graphcanvas[i];canvas.selected_nodes[node.id]&&delete canvas.selected_nodes[node.id],canvas.node_dragged==node&&(canvas.node_dragged=null)}var pos=this._nodes.indexOf(node);-1!=pos&&this._nodes.splice(pos,1),delete this._nodes_by_id[node.id],this.onNodeRemoved&&this.onNodeRemoved(node),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(id){return null==id?null:this._nodes_by_id[id]},LGraph.prototype.findNodesByClass=function(classObject){for(var r=[],i=0,l=this._nodes.length;i<l;++i)this._nodes[i].constructor===classObject&&r.push(this._nodes[i]);return r},LGraph.prototype.findNodesByType=function(type){for(var type=type.toLowerCase(),r=[],i=0,l=this._nodes.length;i<l;++i)this._nodes[i].type.toLowerCase()==type&&r.push(this._nodes[i]);return r},LGraph.prototype.findNodesByTitle=function(title){for(var result=[],i=0,l=this._nodes.length;i<l;++i)this._nodes[i].title==title&&result.push(this._nodes[i]);return result},LGraph.prototype.getNodeOnPos=function(x,y,nodes_list,margin){nodes_list=nodes_list||this._nodes;for(var i=nodes_list.length-1;i>=0;i--){var n=nodes_list[i];if(n.isPointInside(x,y,margin))return n}return null},LGraph.prototype.getGroupOnPos=function(x,y){for(var i=this._groups.length-1;i>=0;i--){var g=this._groups[i];if(g.isPointInside(x,y,2,!0))return g}return null},LGraph.prototype.addGlobalInput=function(name,type,value){this.global_inputs[name]={name:name,type:type,value:value},this._version++,this.onGlobalInputAdded&&this.onGlobalInputAdded(name,type),this.onGlobalsChange&&this.onGlobalsChange()},LGraph.prototype.setGlobalInputData=function(name,data){var input=this.global_inputs[name];input&&(input.value=data)},LGraph.prototype.setInputData=LGraph.prototype.setGlobalInputData,LGraph.prototype.getGlobalInputData=function(name){var input=this.global_inputs[name];return input?input.value:null},LGraph.prototype.renameGlobalInput=function(old_name,name){if(name!=old_name){if(!this.global_inputs[old_name])return!1;if(this.global_inputs[name])return console.error("there is already one input with that name"),!1;this.global_inputs[name]=this.global_inputs[old_name],delete this.global_inputs[old_name],this._version++,this.onGlobalInputRenamed&&this.onGlobalInputRenamed(old_name,name),this.onGlobalsChange&&this.onGlobalsChange()}},LGraph.prototype.changeGlobalInputType=function(name,type){if(!this.global_inputs[name])return!1;this.global_inputs[name].type&&this.global_inputs[name].type.toLowerCase()==type.toLowerCase()||(this.global_inputs[name].type=type,this._version++,this.onGlobalInputTypeChanged&&this.onGlobalInputTypeChanged(name,type))},LGraph.prototype.removeGlobalInput=function(name){return!!this.global_inputs[name]&&(delete this.global_inputs[name],this._version++,this.onGlobalInputRemoved&&this.onGlobalInputRemoved(name),this.onGlobalsChange&&this.onGlobalsChange(),!0)},LGraph.prototype.addGlobalOutput=function(name,type,value){this.global_outputs[name]={name:name,type:type,value:value},this._version++,this.onGlobalOutputAdded&&this.onGlobalOutputAdded(name,type),this.onGlobalsChange&&this.onGlobalsChange()},LGraph.prototype.setGlobalOutputData=function(name,value){var output=this.global_outputs[name];output&&(output.value=value)},LGraph.prototype.getGlobalOutputData=function(name){var output=this.global_outputs[name];return output?output.value:null},LGraph.prototype.getOutputData=LGraph.prototype.getGlobalOutputData,LGraph.prototype.renameGlobalOutput=function(old_name,name){return!!this.global_outputs[old_name]&&(this.global_outputs[name]?(console.error("there is already one output with that name"),!1):(this.global_outputs[name]=this.global_outputs[old_name],delete this.global_outputs[old_name],this._version++,this.onGlobalOutputRenamed&&this.onGlobalOutputRenamed(old_name,name),void(this.onGlobalsChange&&this.onGlobalsChange())))},LGraph.prototype.changeGlobalOutputType=function(name,type){if(!this.global_outputs[name])return!1;this.global_outputs[name].type&&this.global_outputs[name].type.toLowerCase()==type.toLowerCase()||(this.global_outputs[name].type=type,this._version++,this.onGlobalOutputTypeChanged&&this.onGlobalOutputTypeChanged(name,type))},LGraph.prototype.removeGlobalOutput=function(name){return!!this.global_outputs[name]&&(delete this.global_outputs[name],this._version++,this.onGlobalOutputRemoved&&this.onGlobalOutputRemoved(name),this.onGlobalsChange&&this.onGlobalsChange(),!0)},LGraph.prototype.triggerInput=function(name,value){for(var nodes=this.findNodesByTitle(name),i=0;i<nodes.length;++i)nodes[i].onTrigger(value)},LGraph.prototype.setCallback=function(name,func){for(var nodes=this.findNodesByTitle(name),i=0;i<nodes.length;++i)nodes[i].setTrigger(func)},LGraph.prototype.connectionChange=function(node,link_info){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(node),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var i=0;i<this.list_of_graphcanvas.length;++i){if(this.list_of_graphcanvas[i].live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var i in this.links){var link_info=this.links[i];link_info&&(link_info._last_time&&(link_info._last_time=0))}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(fg,bg){this.sendActionToCanvas("setDirty",[fg,bg])},LGraph.prototype.serialize=function(){for(var nodes_info=[],i=0,l=this._nodes.length;i<l;++i)nodes_info.push(this._nodes[i].serialize());var links=[];for(var i in this.links){var link=this.links[i];links.push([link.id,link.origin_id,link.origin_slot,link.target_id,link.target_slot,link.type])}for(var groups_info=[],i=0;i<this._groups.length;++i)groups_info.push(this._groups[i].serialize());return{last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:nodes_info,links:links,groups:groups_info,config:this.config}},LGraph.prototype.configure=function(data,keep_old){if(data){keep_old||this.clear();var nodes=data.nodes;if(data.links&&data.links.constructor===Array){for(var links=[],i=0;i<data.links.length;++i){var link=data.links[i];links[link[0]]={id:link[0],origin_id:link[1],origin_slot:link[2],target_id:link[3],target_slot:link[4],type:link[5]}}data.links=links}for(var i in data)this[i]=data[i];var error=!1;if(this._nodes=[],nodes){for(var i=0,l=nodes.length;i<l;++i){var n_info=nodes[i],node=LiteGraph.createNode(n_info.type,n_info.title);node?(node.id=n_info.id,this.add(node,!0)):(LiteGraph.debug&&console.log("Node not found: "+n_info.type),error=!0)}for(var i=0,l=nodes.length;i<l;++i){var n_info=nodes[i],node=this.getNodeById(n_info.id);node&&node.configure(n_info)}}if(this._groups.length=0,data.groups)for(var i=0;i<data.groups.length;++i){var group=new LiteGraph.LGraphGroup;group.configure(data.groups[i]),this.add(group)}return this.updateExecutionOrder(),this._version++,this.setDirtyCanvas(!0,!0),error}},LGraph.prototype.load=function(url){var that=this,req=new XMLHttpRequest;req.open("GET",url,!0),req.send(null),req.onload=function(oEvent){if(200!==req.status)return void console.error("Error loading graph:",req.status,req.response);var data=JSON.parse(req.response);that.configure(data)},req.onerror=function(err){console.error("Error loading graph:",err)}},LGraph.prototype.onNodeTrace=function(node,msg,color){},global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(title){this.title=title||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(v){!v||v.length<2||(this._pos[0]=v[0],this._pos[1]=v[1])},get:function(){return this._pos},enumerable:!0}),this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(info){this.graph&&this.graph._version++;for(var j in info)if("console"!=j)if("properties"!=j)null!=info[j]&&("object"==typeof info[j]?this[j]&&this[j].configure?this[j].configure(info[j]):this[j]=LiteGraph.cloneObject(info[j],this[j]):this[j]=info[j]);else for(var k in info.properties)this.properties[k]=info.properties[k],this.onPropertyChanged&&this.onPropertyChanged(k,info.properties[k]);if(info.title||(this.title=this.constructor.title),this.onConnectionsChange){if(this.inputs)for(var i=0;i<this.inputs.length;++i){var input=this.inputs[i],link_info=this.graph?this.graph.links[input.link]:null;this.onConnectionsChange(LiteGraph.INPUT,i,!0,link_info,input)}if(this.outputs)for(var i=0;i<this.outputs.length;++i){var output=this.outputs[i];if(output.links)for(var j=0;j<output.links.length;++j){var link_info=this.graph?this.graph.links[output.links[j]]:null;this.onConnectionsChange(LiteGraph.OUTPUT,i,!0,link_info,output)}}}for(var i in this.inputs){var input=this.inputs[i];if(input.link&&input.link.length){var link=input.link;"object"==typeof link&&(input.link=link[0],this.graph&&(this.graph.links[link[0]]={id:link[0],origin_id:link[1],origin_slot:link[2],target_id:link[3],target_slot:link[4]}))}}for(var i in this.outputs){var output=this.outputs[i];if(output.links&&0!=output.links.length)for(var j in output.links){var link=output.links[j];"object"==typeof link&&(output.links[j]=link[0])}}this.onConfigure&&this.onConfigure(info)},LGraphNode.prototype.serialize=function(){var o={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),mode:this.mode};if(this.inputs&&(o.inputs=this.inputs),this.outputs){for(var i=0;i<this.outputs.length;i++)delete this.outputs[i]._data;o.outputs=this.outputs}return this.title&&this.title!=this.constructor.title&&(o.title=this.title),this.properties&&(o.properties=LiteGraph.cloneObject(this.properties)),o.type||(o.type=this.constructor.type),this.color&&(o.color=this.color),this.bgcolor&&(o.bgcolor=this.bgcolor),this.boxcolor&&(o.boxcolor=this.boxcolor),this.shape&&(o.shape=this.shape),this.onSerialize&&this.onSerialize(o)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),o},LGraphNode.prototype.clone=function(){var node=LiteGraph.createNode(this.type),data=LiteGraph.cloneObject(this.serialize());if(data.inputs)for(var i=0;i<data.inputs.length;++i)data.inputs[i].link=null;if(data.outputs)for(var i=0;i<data.outputs.length;++i)data.outputs[i].links&&(data.outputs[i].links.length=0);return delete data.id,node.configure(data),node},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setOutputData=function(slot,data){if(this.outputs&&!(-1==slot||slot>=this.outputs.length)){var output_info=this.outputs[slot];if(output_info&&(output_info._data=data,this.outputs[slot].links))for(var i=0;i<this.outputs[slot].links.length;i++){var link_id=this.outputs[slot].links[i];this.graph.links[link_id].data=data}}},LGraphNode.prototype.getInputData=function(slot,force_update){if(this.inputs&&!(slot>=this.inputs.length||null==this.inputs[slot].link)){var link_id=this.inputs[slot].link,link=this.graph.links[link_id];if(!link)return null;if(!force_update)return link.data;var node=this.graph.getNodeById(link.origin_id);return node?(node.updateOutputData?node.updateOutputData(link.origin_slot):node.onExecute&&node.onExecute(),link.data):link.data}},LGraphNode.prototype.getInputDataByName=function(slot_name,force_update){var slot=this.findInputSlot(slot_name);return-1==slot?null:this.getInputData(slot,force_update)},LGraphNode.prototype.isInputConnected=function(slot){return!!this.inputs&&(slot<this.inputs.length&&null!=this.inputs[slot].link)},LGraphNode.prototype.getInputInfo=function(slot){return this.inputs&&slot<this.inputs.length?this.inputs[slot]:null},LGraphNode.prototype.getInputNode=function(slot){if(!this.inputs)return null;if(slot>=this.inputs.length)return null;var input=this.inputs[slot];if(!input||null===input.link)return null;var link_info=this.graph.links[input.link];return link_info?this.graph.getNodeById(link_info.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(name){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[name]:null;for(var i=0,l=this.inputs.length;i<l;++i)if(name==this.inputs[i].name){var link_id=this.inputs[i].link,link=this.graph.links[link_id];return link?link.data:null}return this.properties[name]},LGraphNode.prototype.getOutputData=function(slot){return this.outputs?slot>=this.outputs.length?null:this.outputs[slot]._data:null},LGraphNode.prototype.getOutputInfo=function(slot){return this.outputs&&slot<this.outputs.length?this.outputs[slot]:null},LGraphNode.prototype.isOutputConnected=function(slot){return!!this.outputs&&(slot<this.outputs.length&&this.outputs[slot].links&&this.outputs[slot].links.length)},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var i=0;i<this.outputs.length;++i)if(this.outputs[i].links&&this.outputs[i].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(slot){if(!this.outputs||0==this.outputs.length)return null;if(slot>=this.outputs.length)return null;var output=this.outputs[slot];if(!output.links||0==output.links.length)return null;for(var r=[],i=0;i<output.links.length;i++){var link_id=output.links[i],link=this.graph.links[link_id];if(link){var target_node=this.graph.getNodeById(link.target_id);target_node&&r.push(target_node)}}return r},LGraphNode.prototype.trigger=function(action,param){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var i=0;i<this.outputs.length;++i){var output=this.outputs[i];!output||output.type!==LiteGraph.EVENT||action&&output.name!=action||this.triggerSlot(i,param)}}},LGraphNode.prototype.triggerSlot=function(slot,param,link_id){if(this.outputs){var output=this.outputs[slot];if(output){var links=output.links;if(links&&links.length){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var k=0;k<links.length;++k){var id=links[k];if(null==link_id||link_id==id){var link_info=this.graph.links[links[k]];if(link_info){link_info._last_time=LiteGraph.getTime();var node=this.graph.getNodeById(link_info.target_id);if(node){var target_connection=node.inputs[link_info.target_slot];node.onAction?node.onAction(target_connection.name,param):node.mode===LiteGraph.ON_TRIGGER&&node.onExecute&&node.onExecute(param)}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(slot,link_id){if(this.outputs){var output=this.outputs[slot];if(output){var links=output.links;if(links&&links.length)for(var k=0;k<links.length;++k){var id=links[k];if(null==link_id||link_id==id){var link_info=this.graph.links[links[k]];link_info&&(link_info._last_time=0)}}}}},LGraphNode.prototype.addProperty=function(name,default_value,type,extra_info){var o={name:name,type:type,default_value:default_value};if(extra_info)for(var i in extra_info)o[i]=extra_info[i];return this.properties_info||(this.properties_info=[]),this.properties_info.push(o),this.properties||(this.properties={}),this.properties[name]=default_value,o},LGraphNode.prototype.addOutput=function(name,type,extra_info){var o={name:name,type:type,links:null};if(extra_info)for(var i in extra_info)o[i]=extra_info[i];return this.outputs||(this.outputs=[]),this.outputs.push(o),this.onOutputAdded&&this.onOutputAdded(o),this.size=this.computeSize(),this.setDirtyCanvas(!0,!0),o},LGraphNode.prototype.addOutputs=function(array){for(var i=0;i<array.length;++i){var info=array[i],o={name:info[0],type:info[1],link:null};if(array[2])for(var j in info[2])o[j]=info[2][j];this.outputs||(this.outputs=[]),this.outputs.push(o),this.onOutputAdded&&this.onOutputAdded(o)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(slot){this.disconnectOutput(slot),this.outputs.splice(slot,1);for(var i=slot;i<this.outputs.length;++i)if(this.outputs[i]&&this.outputs[i].links)for(var links=this.outputs[i].links,j=0;j<links.length;++j){var link=this.graph.links[links[j]];link&&(link.origin_slot-=1)}this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(slot),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(name,type,extra_info){type=type||0;var o={name:name,type:type,link:null};if(extra_info)for(var i in extra_info)o[i]=extra_info[i];return this.inputs||(this.inputs=[]),this.inputs.push(o),this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(o),this.setDirtyCanvas(!0,!0),o},LGraphNode.prototype.addInputs=function(array){for(var i=0;i<array.length;++i){var info=array[i],o={name:info[0],type:info[1],link:null};if(array[2])for(var j in info[2])o[j]=info[2][j];this.inputs||(this.inputs=[]),this.inputs.push(o),this.onInputAdded&&this.onInputAdded(o)}this.size=this.computeSize(),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(slot){this.disconnectInput(slot),this.inputs.splice(slot,1);for(var i=slot;i<this.inputs.length;++i)if(this.inputs[i]){var link=this.graph.links[this.inputs[i].link];link&&(link.target_slot-=1)}this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(slot),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(name,type,pos,direction){var o={name:name,type:type,pos:pos,direction:direction,links:null};return this.connections.push(o),o},LGraphNode.prototype.computeSize=function(minHeight,out){function compute_text_size(text){return text?font_size*text.length*.6:0}var rows=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),size=out||new Float32Array([0,0]);rows=Math.max(rows,1);var font_size=LiteGraph.NODE_TEXT_SIZE;size[1]=(this.constructor.slot_start_y||0)+rows*(font_size+1)+4,this.widgets&&this.widgets.length&&(size[1]+=this.widgets.length*(LiteGraph.NODE_WIDGET_HEIGHT+4)+8);var font_size=font_size,title_width=compute_text_size(this.title),input_width=0,output_width=0;if(this.inputs)for(var i=0,l=this.inputs.length;i<l;++i){var input=this.inputs[i],text=input.label||input.name||"",text_width=compute_text_size(text);input_width<text_width&&(input_width=text_width)}if(this.outputs)for(var i=0,l=this.outputs.length;i<l;++i){var output=this.outputs[i],text=output.label||output.name||"",text_width=compute_text_size(text);output_width<text_width&&(output_width=text_width)}return size[0]=Math.max(input_width+output_width+10,title_width),size[0]=Math.max(size[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(size[0]=Math.max(size[0],1.5*LiteGraph.NODE_WIDTH)),this.onResize&&this.onResize(size),size},LGraphNode.prototype.addWidget=function(type,name,value,callback,options){this.widgets||(this.widgets=[]);var w={type:type.toLowerCase(),name:name,value:value,callback:callback,options:options||{}};if(void 0!==w.options.y&&(w.y=w.options.y),callback||console.warn("LiteGraph addWidget('button',...) without a callback"),"combo"==type&&!w.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(w),w},LGraphNode.prototype.addCustomWidget=function(custom_widget){return this.widgets||(this.widgets=[]),this.widgets.push(custom_widget),custom_widget},LGraphNode.prototype.getBounding=function(out){return out=out||new Float32Array(4),out[0]=this.pos[0]-4,out[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,out[2]=this.size[0]+4,out[3]=this.size[1]+LiteGraph.NODE_TITLE_HEIGHT,this.onBounding&&this.onBounding(out),out},LGraphNode.prototype.isPointInside=function(x,y,margin,skip_title){margin=margin||0;var margin_top=this.graph&&this.graph.isLive()?0:20;if(skip_title&&(margin_top=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(x,y,this.pos[0]-margin,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-margin,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*margin,LiteGraph.NODE_TITLE_HEIGHT+2*margin))return!0}else if(this.pos[0]-4-margin<x&&this.pos[0]+this.size[0]+4+margin>x&&this.pos[1]-margin_top-margin<y&&this.pos[1]+this.size[1]+margin>y)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(x,y){var link_pos=new Float32Array(2);if(this.inputs)for(var i=0,l=this.inputs.length;i<l;++i){var input=this.inputs[i];if(this.getConnectionPos(!0,i,link_pos),isInsideRectangle(x,y,link_pos[0]-10,link_pos[1]-5,20,10))return{input:input,slot:i,link_pos:link_pos,locked:input.locked}}if(this.outputs)for(var i=0,l=this.outputs.length;i<l;++i){var output=this.outputs[i];if(this.getConnectionPos(!1,i,link_pos),isInsideRectangle(x,y,link_pos[0]-10,link_pos[1]-5,20,10))return{output:output,slot:i,link_pos:link_pos,locked:output.locked}}return null},LGraphNode.prototype.findInputSlot=function(name){if(!this.inputs)return-1;for(var i=0,l=this.inputs.length;i<l;++i)if(name==this.inputs[i].name)return i;return-1},LGraphNode.prototype.findOutputSlot=function(name){if(!this.outputs)return-1;for(var i=0,l=this.outputs.length;i<l;++i)if(name==this.outputs[i].name)return i;return-1},LGraphNode.prototype.connect=function(slot,target_node,target_slot){if(target_slot=target_slot||0,!this.graph)return console.log("Connect: Error, node doesnt belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(slot.constructor===String){if(-1==(slot=this.findOutputSlot(slot)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+slot),null}else if(!this.outputs||slot>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(target_node&&target_node.constructor===Number&&(target_node=this.graph.getNodeById(target_node)),!target_node)throw"target node is null";if(target_node==this)return null;if(target_slot.constructor===String){if(-1==(target_slot=target_node.findInputSlot(target_slot)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+target_slot),null}else{if(target_slot===LiteGraph.EVENT)return null;if(!target_node.inputs||target_slot>=target_node.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null}null!=target_node.inputs[target_slot].link&&target_node.disconnectInput(target_slot);var output=this.outputs[slot];if(target_node.onConnectInput&&!1===target_node.onConnectInput(target_slot,output.type,output))return null;var input=target_node.inputs[target_slot],link_info=null;return LiteGraph.isValidConnection(output.type,input.type)&&(link_info={id:this.graph.last_link_id++,type:input.type,origin_id:this.id,origin_slot:slot,target_id:target_node.id,target_slot:target_slot},this.graph.links[link_info.id]=link_info,null==output.links&&(output.links=[]),output.links.push(link_info.id),target_node.inputs[target_slot].link=link_info.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,slot,!0,link_info,output),target_node.onConnectionsChange&&target_node.onConnectionsChange(LiteGraph.INPUT,target_slot,!0,link_info,input),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,target_node,target_slot,this,slot),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,slot,target_node,target_slot))),this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this,link_info),link_info},LGraphNode.prototype.disconnectOutput=function(slot,target_node){if(slot.constructor===String){if(-1==(slot=this.findOutputSlot(slot)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+slot),!1}else if(!this.outputs||slot>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var output=this.outputs[slot];if(!output||!output.links||0==output.links.length)return!1;if(target_node){if(target_node.constructor===Number&&(target_node=this.graph.getNodeById(target_node)),!target_node)throw"Target Node not found";for(var i=0,l=output.links.length;i<l;i++){var link_id=output.links[i],link_info=this.graph.links[link_id];if(link_info.target_id==target_node.id){output.links.splice(i,1);var input=target_node.inputs[link_info.target_slot];input.link=null,delete this.graph.links[link_id],this.graph&&this.graph._version++,target_node.onConnectionsChange&&target_node.onConnectionsChange(LiteGraph.INPUT,link_info.target_slot,!1,link_info,input),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,slot,!1,link_info,output),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,slot),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,slot),this.graph.onNodeConnectionChange(LiteGraph.INPUT,target_node,link_info.target_slot));break}}}else{for(var i=0,l=output.links.length;i<l;i++){var link_id=output.links[i],link_info=this.graph.links[link_id];if(link_info){var target_node=this.graph.getNodeById(link_info.target_id),input=null;this.graph&&this.graph._version++,target_node&&(input=target_node.inputs[link_info.target_slot],input.link=null,target_node.onConnectionsChange&&target_node.onConnectionsChange(LiteGraph.INPUT,link_info.target_slot,!1,link_info,input),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,target_node,link_info.target_slot)),delete this.graph.links[link_id],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,slot,!1,link_info,output),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,slot),this.graph.onNodeConnectionChange(LiteGraph.INPUT,target_node,link_info.target_slot))}}output.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(slot){if(slot.constructor===String){if(-1==(slot=this.findInputSlot(slot)))return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+slot),!1}else if(!this.inputs||slot>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var input=this.inputs[slot];if(!input)return!1;var link_id=this.inputs[slot].link;this.inputs[slot].link=null;var link_info=this.graph.links[link_id];if(link_info){var target_node=this.graph.getNodeById(link_info.origin_id);if(!target_node)return!1;var output=target_node.outputs[link_info.origin_slot];if(!output||!output.links||0==output.links.length)return!1;for(var i=0,l=output.links.length;i<l;i++)if(output.links[i]==link_id){output.links.splice(i,1);break}delete this.graph.links[link_id],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,slot,!1,link_info,input),target_node.onConnectionsChange&&target_node.onConnectionsChange(LiteGraph.OUTPUT,i,!1,link_info,output),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,target_node,i),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,slot))}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(is_input,slot_number,out){out=out||new Float32Array(2);var num_slots=0;if(is_input&&this.inputs&&(num_slots=this.inputs.length),!is_input&&this.outputs&&(num_slots=this.outputs.length),this.flags.collapsed){var w=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.flags.horizontal?(out[0]=this.pos[0]+.5*w,out[1]=is_input?this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:this.pos[1]):(out[0]=is_input?this.pos[0]:this.pos[0]+w,out[1]=this.pos[1]-.5*LiteGraph.NODE_TITLE_HEIGHT),out}return is_input&&-1==slot_number?(out[0]=this.pos[0]+10,out[1]=this.pos[1]+10,out):is_input&&num_slots>slot_number&&this.inputs[slot_number].pos?(out[0]=this.pos[0]+this.inputs[slot_number].pos[0],out[1]=this.pos[1]+this.inputs[slot_number].pos[1],out):!is_input&&num_slots>slot_number&&this.outputs[slot_number].pos?(out[0]=this.pos[0]+this.outputs[slot_number].pos[0],out[1]=this.pos[1]+this.outputs[slot_number].pos[1],out):this.flags.horizontal?(out[0]=this.pos[0]+(slot_number+.5)*(this.size[0]/num_slots),out[1]=is_input?this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:this.pos[1]+this.size[1],out):(out[0]=is_input?this.pos[0]:this.pos[0]+this.size[0]+1,out[1]=this.pos[1]+10+slot_number*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),out)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(msg){this.console||(this.console=[]),this.console.push(msg),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace(this,msg)},LGraphNode.prototype.setDirtyCanvas=function(dirty_foreground,dirty_background){this.graph&&this.graph.sendActionToCanvas("setDirty",[dirty_foreground,dirty_background])},LGraphNode.prototype.loadImage=function(url){var img=new Image;img.src=LiteGraph.node_images_path+url,img.ready=!1;var that=this;return img.onload=function(){this.ready=!0,that.setDirtyCanvas(!0)},img},LGraphNode.prototype.captureInput=function(v){if(this.graph&&this.graph.list_of_graphcanvas)for(var list=this.graph.list_of_graphcanvas,i=0;i<list.length;++i){var c=list[i];(v||c.node_capturing_input==this)&&(c.node_capturing_input=v?this:null)}},LGraphNode.prototype.collapse=function(force){this.graph._version++,(!1!==this.constructor.collapsable||force)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(v){this.graph._version++,this.flags.pinned=void 0===v?!this.flags.pinned:v},LGraphNode.prototype.localToScreen=function(x,y,graphcanvas){return[(x+this.pos[0])*graphcanvas.scale+graphcanvas.offset[0],(y+this.pos[1])*graphcanvas.scale+graphcanvas.offset[1]]},global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(title){this.title=title||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(v){!v||v.length<2||(this._pos[0]=v[0],this._pos[1]=v[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(v){!v||v.length<2||(this._size[0]=Math.max(140,v[0]),this._size[1]=Math.max(80,v[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(o){this.title=o.title,this._bounding.set(o.bounding),this.color=o.color,this.font=o.font},LGraphGroup.prototype.serialize=function(){var b=this._bounding;return{title:this.title,bounding:[Math.round(b[0]),Math.round(b[1]),Math.round(b[2]),Math.round(b[3])],color:this.color,font:this.font}},LGraphGroup.prototype.move=function(deltax,deltay,ignore_nodes){if(this._pos[0]+=deltax,this._pos[1]+=deltay,!ignore_nodes)for(var i=0;i<this._nodes.length;++i){var node=this._nodes[i];node.pos[0]+=deltax,node.pos[1]+=deltay}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var nodes=this.graph._nodes,node_bounding=new Float32Array(4),i=0;i<nodes.length;++i){var node=nodes[i];node.getBounding(node_bounding),overlapBounding(this._bounding,node_bounding)&&this._nodes.push(node)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas,global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.link_type_colors={"-1":"#F85",number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.scale=1,this.offset=[0,0],this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(graph,skip_clear){if(this.graph!=graph){if(skip_clear||this.clear(),!graph&&this.graph)return void this.graph.detachCanvas(this);graph.attachCanvas(this),this.setDirty(!0,!0)}},LGraphCanvas.prototype.openSubgraph=function(graph){if(!graph)throw"graph cannot be null";if(this.graph==graph)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),graph.attachCanvas(this),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var subraph_node=this.graph._subgraph_node,graph=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},graph.attachCanvas(this),this.setDirty(!0,!0),subraph_node&&(this.centerOnNode(subraph_node),this.selectNodes([subraph_node]))}},LGraphCanvas.prototype.setCanvas=function(canvas,skip_events){if(canvas&&canvas.constructor===String&&!(canvas=document.getElementById(canvas)))throw"Error creating LiteGraph canvas: Canvas not found";if(canvas!==this.canvas&&(!canvas&&this.canvas&&(skip_events||this.unbindEvents()),this.canvas=canvas,canvas)){if(canvas.className+=" lgraphcanvas",canvas.data=this,this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),null==canvas.getContext){if("canvas"!=canvas.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+canvas.localName;throw"This browser doesnt support Canvas"}null==(this.ctx=canvas.getContext("2d"))&&(canvas.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),skip_events||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(e){return e.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(e){return e.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded)return void console.warn("LGraphCanvas: events already binded");var canvas=this.canvas,ref_window=this.getCanvasWindow(),document=ref_window.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),canvas.addEventListener("mousedown",this._mousedown_callback,!0),canvas.addEventListener("mousemove",this._mousemove_callback),canvas.addEventListener("mousewheel",this._mousewheel_callback,!1),canvas.addEventListener("contextmenu",this._doNothing),canvas.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),canvas.addEventListener("touchstart",this.touchHandler,!0),canvas.addEventListener("touchmove",this.touchHandler,!0),canvas.addEventListener("touchend",this.touchHandler,!0),canvas.addEventListener("touchcancel",this.touchHandler,!0),this._key_callback=this.processKey.bind(this),canvas.addEventListener("keydown",this._key_callback,!0),document.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),canvas.addEventListener("dragover",this._doNothing,!1),canvas.addEventListener("dragend",this._doNothing,!1),canvas.addEventListener("drop",this._ondrop_callback,!1),canvas.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded)return void console.warn("LGraphCanvas: no events binded");var ref_window=this.getCanvasWindow(),document=ref_window.document;this.canvas.removeEventListener("mousedown",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),document.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this.canvas.removeEventListener("touchstart",this.touchHandler),this.canvas.removeEventListener("touchmove",this.touchHandler),this.canvas.removeEventListener("touchend",this.touchHandler),this.canvas.removeEventListener("touchcancel",this.touchHandler),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(url){var question=url.indexOf("?");-1!=question&&(url=url.substr(0,question));var point=url.lastIndexOf(".");return-1==point?"":url.substr(point+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(void 0===typeof GL)throw"litegl.js must be included to use a WebGL canvas";if(void 0===typeof enableWebGLCanvas)throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(fgcanvas,bgcanvas){fgcanvas&&(this.dirty_canvas=!0),bgcanvas&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var doc=this.canvas.ownerDocument;return doc.defaultView||doc.parentWindow},LGraphCanvas.prototype.startRendering=function(){function renderFrame(){this.pause_rendering||this.draw();var window=this.getCanvasWindow();this.is_rendering&&window.requestAnimationFrame(renderFrame.bind(this))}this.is_rendering||(this.is_rendering=!0,renderFrame.call(this))},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.processMouseDown=function(e){if(this.graph){this.adjustMouseEvent(e);var ref_window=this.getCanvasWindow();ref_window.document;LGraphCanvas.active_canvas=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback),ref_window.document.addEventListener("mousemove",this._mousemove_callback,!0),ref_window.document.addEventListener("mouseup",this._mouseup_callback,!0);var node=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes,5),skip_action=!1,now=LiteGraph.getTime(),is_double_click=now-this.last_mouseclick<300;if(this.canvas_mouse[0]=e.canvasX,this.canvas_mouse[1]=e.canvasY,LiteGraph.closeAllContextMenus(ref_window),!this.onMouse||1!=this.onMouse(e)){if(1==e.which){e.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=e.canvasX,this.dragging_rectangle[1]=e.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,skip_action=!0);var clicking_canvas_bg=!1;if(node&&this.allow_interaction&&!skip_action){if(this.live_mode||node.flags.pinned||this.bringToFront(node),!this.connecting_node&&!node.flags.collapsed&&!this.live_mode)if(!skip_action&&!1!==node.flags.resizable&&isInsideRectangle(e.canvasX,e.canvasY,node.pos[0]+node.size[0]-5,node.pos[1]+node.size[1]-5,10,10))this.resizing_node=node,this.canvas.style.cursor="se-resize",skip_action=!0;else{if(node.outputs)for(var i=0,l=node.outputs.length;i<l;++i){var output=node.outputs[i],link_pos=node.getConnectionPos(!1,i);if(isInsideRectangle(e.canvasX,e.canvasY,link_pos[0]-15,link_pos[1]-10,30,20)){this.connecting_node=node,this.connecting_output=output,this.connecting_pos=node.getConnectionPos(!1,i),this.connecting_slot=i,e.shiftKey&&node.disconnectOutput(i),is_double_click?node.onOutputDblClick&&node.onOutputDblClick(i,e):node.onOutputClick&&node.onOutputClick(i,e),skip_action=!0;break}}if(node.inputs)for(var i=0,l=node.inputs.length;i<l;++i){var input=node.inputs[i],link_pos=node.getConnectionPos(!0,i);if(isInsideRectangle(e.canvasX,e.canvasY,link_pos[0]-15,link_pos[1]-10,30,20)&&(is_double_click?node.onInputDblClick&&node.onInputDblClick(i,e):node.onInputClick&&node.onInputClick(i,e),null!==input.link)){var link_info=this.graph.links[input.link];node.disconnectInput(i),(this.allow_reconnect_links||e.shiftKey)&&(this.connecting_node=this.graph._nodes_by_id[link_info.origin_id],this.connecting_slot=link_info.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot)),this.dirty_bgcanvas=!0,skip_action=!0}}}if(!skip_action&&isInsideRectangle(e.canvasX,e.canvasY,node.pos[0],node.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&(node.collapse(),skip_action=!0),!skip_action){var block_drag_node=!1,widget=this.processNodeWidgets(node,this.canvas_mouse,e);widget&&(block_drag_node=!0,this.node_widget=[node,widget]),is_double_click&&this.selected_nodes[node.id]&&(node.onDblClick&&node.onDblClick(e,[e.canvasX-node.pos[0],e.canvasY-node.pos[1]],graphcanvas),this.processNodeDblClicked(node),block_drag_node=!0),node.onMouseDown&&node.onMouseDown(e,[e.canvasX-node.pos[0],e.canvasY-node.pos[1]],this)?block_drag_node=!0:this.live_mode&&(clicking_canvas_bg=!0,block_drag_node=!0),block_drag_node||(this.allow_dragnodes&&(this.node_dragged=node),this.selected_nodes[node.id]||this.processNodeSelected(node,e)),this.dirty_canvas=!0}}else{if(this.selected_group=this.graph.getGroupOnPos(e.canvasX,e.canvasY),this.selected_group_resizing=!1,this.selected_group){e.ctrlKey&&(this.dragging_rectangle=null);distance([e.canvasX,e.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}is_double_click&&this.showSearchBox(e),clicking_canvas_bg=!0}!skip_action&&clicking_canvas_bg&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2==e.which||3==e.which&&this.processContextMenu(node,e);return this.last_mouse[0]=e.localX,this.last_mouse[1]=e.localY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!ref_window.document.activeElement||"input"!=ref_window.document.activeElement.nodeName.toLowerCase()&&"textarea"!=ref_window.document.activeElement.nodeName.toLowerCase())&&e.preventDefault(),e.stopPropagation(),this.onMouseDown&&this.onMouseDown(e),!1}}},LGraphCanvas.prototype.processMouseMove=function(e){if(this.autoresize&&this.resize(),this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(e);var mouse=[e.localX,e.localY],delta=[mouse[0]-this.last_mouse[0],mouse[1]-this.last_mouse[1]];if(this.last_mouse=mouse,this.canvas_mouse[0]=e.canvasX,this.canvas_mouse[1]=e.canvasY,e.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.canvas_mouse,e,this.node_widget[1]),this.dirty_canvas=!0),this.dragging_rectangle)this.dragging_rectangle[2]=e.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=e.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group){if(this.selected_group_resizing)this.selected_group.size=[e.canvasX-this.selected_group.pos[0],e.canvasY-this.selected_group.pos[1]];else{var deltax=delta[0]/this.scale,deltay=delta[1]/this.scale;this.selected_group.move(deltax,deltay,e.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.offset[0]+=delta[0]/this.scale,this.offset[1]+=delta[1]/this.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if(this.allow_interaction){this.connecting_node&&(this.dirty_canvas=!0);for(var node=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes),i=0,l=this.graph._nodes.length;i<l;++i)this.graph._nodes[i].mouseOver&&node!=this.graph._nodes[i]&&(this.graph._nodes[i].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(e),this.node_over=null,this.dirty_canvas=!0);if(node){if(node.mouseOver||(node.mouseOver=!0,this.node_over=node,this.dirty_canvas=!0,node.onMouseEnter&&node.onMouseEnter(e)),node.onMouseMove&&node.onMouseMove(e,[e.canvasX-node.pos[0],e.canvasY-node.pos[1]],this),this.connecting_node){var pos=this._highlight_input||[0,0];if(this.isOverNodeBox(node,e.canvasX,e.canvasY));else{var slot=this.isOverNodeInput(node,e.canvasX,e.canvasY,pos);if(-1!=slot&&node.inputs[slot]){var slot_type=node.inputs[slot].type;LiteGraph.isValidConnection(this.connecting_output.type,slot_type)&&(this._highlight_input=pos)}else this._highlight_input=null}}this.canvas&&(isInsideRectangle(e.canvasX,e.canvasY,node.pos[0]+node.size[0]-5,node.pos[1]+node.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="")}else this.canvas&&(this.canvas.style.cursor="");if(this.node_capturing_input&&this.node_capturing_input!=node&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(e),this.node_dragged&&!this.live_mode){for(var i in this.selected_nodes){var n=this.selected_nodes[i];n.pos[0]+=delta[0]/this.scale,n.pos[1]+=delta[1]/this.scale}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){this.resizing_node.size[0]=e.canvasX-this.resizing_node.pos[0],this.resizing_node.size[1]=e.canvasY-this.resizing_node.pos[1];var max_slots=Math.max(this.resizing_node.inputs?this.resizing_node.inputs.length:0,this.resizing_node.outputs?this.resizing_node.outputs.length:0),min_height=max_slots*LiteGraph.NODE_SLOT_HEIGHT+(this.resizing_node.widgets?this.resizing_node.widgets.length:0)*(LiteGraph.NODE_WIDGET_HEIGHT+4)+4;this.resizing_node.size[1]<min_height&&(this.resizing_node.size[1]=min_height),this.resizing_node.size[0]<LiteGraph.NODE_MIN_WIDTH&&(this.resizing_node.size[0]=LiteGraph.NODE_MIN_WIDTH),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return e.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(e){if(this.graph){var window=this.getCanvasWindow(),document=window.document;LGraphCanvas.active_canvas=this,document.removeEventListener("mousemove",this._mousemove_callback,!0),this.canvas.addEventListener("mousemove",this._mousemove_callback,!0),document.removeEventListener("mouseup",this._mouseup_callback,!0),this.adjustMouseEvent(e);var now=LiteGraph.getTime();if(e.click_time=now-this.last_mouseclick,this.last_mouse_dragging=!1,1==e.which){if(this.node_widget=null,this.selected_group){var diffx=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),diffy=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(diffx,diffy,e.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}if(this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){var nodes=this.graph._nodes,node_bounding=new Float32Array(4);this.deselectAllNodes();var w=Math.abs(this.dragging_rectangle[2]),h=Math.abs(this.dragging_rectangle[3]),startx=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-w:this.dragging_rectangle[0],starty=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-h:this.dragging_rectangle[1];this.dragging_rectangle[0]=startx,this.dragging_rectangle[1]=starty,this.dragging_rectangle[2]=w,this.dragging_rectangle[3]=h;for(var to_select=[],i=0;i<nodes.length;++i){var node=nodes[i];node.getBounding(node_bounding),overlapBounding(this.dragging_rectangle,node_bounding)&&to_select.push(node)}to_select.length&&this.selectNodes(to_select)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var node=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);if(node)if(this.connecting_output.type==LiteGraph.EVENT&&this.isOverNodeBox(node,e.canvasX,e.canvasY))this.connecting_node.connect(this.connecting_slot,node,LiteGraph.EVENT);else{var slot=this.isOverNodeInput(node,e.canvasX,e.canvasY);if(-1!=slot)this.connecting_node.connect(this.connecting_slot,node,slot);else{var input=node.getInputInfo(0);this.connecting_output.type==LiteGraph.EVENT?this.connecting_node.connect(this.connecting_slot,node,LiteGraph.EVENT):input&&!input.link&&LiteGraph.isValidConnection(input.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,node,0)}}this.connecting_output=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.resizing_node=null;else if(this.node_dragged)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),this.graph.config.align_to_grid&&this.node_dragged.alignToGrid(),this.node_dragged=null;else{var node=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);!node&&e.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(e,[e.canvasX-this.node_over.pos[0],e.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(e,[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]])}}else 2==e.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==e.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return this.graph.change(),e.stopPropagation(),e.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(e){if(this.graph&&this.allow_dragcanvas){var delta=null!=e.wheelDeltaY?e.wheelDeltaY:-60*e.detail;this.adjustMouseEvent(e);var zoom=this.scale;return delta>0?zoom*=1.1:delta<0&&(zoom*=1/1.1),this.setZoom(zoom,[e.localX,e.localY]),this.graph.change(),e.preventDefault(),!1}},LGraphCanvas.prototype.isOverNodeBox=function(node,canvasx,canvasy){var title_height=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(canvasx,canvasy,node.pos[0]+2,node.pos[1]+2-title_height,title_height-4,title_height-4)},LGraphCanvas.prototype.isOverNodeInput=function(node,canvasx,canvasy,slot_pos){if(node.inputs)for(var i=0,l=node.inputs.length;i<l;++i){var link_pos=(node.inputs[i],node.getConnectionPos(!0,i));if(isInsideRectangle(canvasx,canvasy,link_pos[0]-10,link_pos[1]-5,20,10))return slot_pos&&(slot_pos[0]=link_pos[0],slot_pos[1]=link_pos[1]),i}return-1},LGraphCanvas.prototype.processKey=function(e){if(this.graph){var block_default=!1;if("input"!=e.target.localName){if("keydown"==e.type){if(32==e.keyCode&&(this.dragging_canvas=!0,block_default=!0),65==e.keyCode&&e.ctrlKey&&(this.selectNodes(),block_default=!0),"KeyC"!=e.code||!e.metaKey&&!e.ctrlKey||e.shiftKey||this.selected_nodes&&(this.copyToClipboard(),block_default=!0),"KeyV"!=e.code||!e.metaKey&&!e.ctrlKey||e.shiftKey||this.pasteFromClipboard(),46!=e.keyCode&&8!=e.keyCode||"input"!=e.target.localName&&"textarea"!=e.target.localName&&(this.deleteSelectedNodes(),block_default=!0),this.selected_nodes)for(var i in this.selected_nodes)this.selected_nodes[i].onKeyDown&&this.selected_nodes[i].onKeyDown(e)}else if("keyup"==e.type&&(32==e.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(var i in this.selected_nodes)this.selected_nodes[i].onKeyUp&&this.selected_nodes[i].onKeyUp(e);return this.graph.change(),block_default?(e.preventDefault(),!1):void 0}}},LGraphCanvas.prototype.copyToClipboard=function(){var clipboard_info={nodes:[],links:[]},index=0,selected_nodes_array=[];for(var i in this.selected_nodes){var node=this.selected_nodes[i];node._relative_id=index,selected_nodes_array.push(node),index+=1}for(var i=0;i<selected_nodes_array.length;++i){var node=selected_nodes_array[i];if(clipboard_info.nodes.push(node.clone().serialize()),node.inputs&&node.inputs.length)for(var j=0;j<node.inputs.length;++j){var input=node.inputs[j];if(input&&null!=input.link){var link_info=this.graph.links[input.link];if(link_info){var target_node=this.graph.getNodeById(link_info.origin_id);target_node&&this.selected_nodes[target_node.id]&&clipboard_info.links.push([target_node._relative_id,j,node._relative_id,link_info.target_slot])}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(clipboard_info))},LGraphCanvas.prototype.pasteFromClipboard=function(){var data=localStorage.getItem("litegrapheditor_clipboard");if(data){for(var clipboard_info=JSON.parse(data),nodes=[],i=0;i<clipboard_info.nodes.length;++i){var node_data=clipboard_info.nodes[i],node=LiteGraph.createNode(node_data.type);node&&(node.configure(node_data),node.pos[0]+=5,node.pos[1]+=5,this.graph.add(node),nodes.push(node))}for(var i=0;i<clipboard_info.links.length;++i){var link_info=clipboard_info.links[i],origin_node=nodes[link_info[0]],target_node=nodes[link_info[2]];origin_node.connect(link_info[1],target_node,link_info[3])}this.selectNodes(nodes)}},LGraphCanvas.prototype.processDrop=function(e){e.preventDefault(),this.adjustMouseEvent(e);var pos=[e.canvasX,e.canvasY],node=this.graph.getNodeOnPos(pos[0],pos[1]);if(!node){var r=null;return this.onDropItem&&(r=this.onDropItem(event)),void(r||this.checkDropItem(e))}if(node.onDropFile||node.onDropData){var files=e.dataTransfer.files;if(files&&files.length)for(var i=0;i<files.length;i++){var file=e.dataTransfer.files[0],filename=file.name;LGraphCanvas.getFileExtension(filename);if(node.onDropFile&&node.onDropFile(file),node.onDropData){var reader=new FileReader;reader.onload=function(event){var data=event.target.result;node.onDropData(data,filename,file)};var type=file.type.split("/")[0];"text"==type||""==type?reader.readAsText(file):"image"==type?reader.readAsDataURL(file):reader.readAsArrayBuffer(file)}}}return!(!node.onDropItem||!node.onDropItem(event))||!!this.onDropItem&&this.onDropItem(event)},LGraphCanvas.prototype.checkDropItem=function(e){if(e.dataTransfer.files.length){var file=e.dataTransfer.files[0],ext=LGraphCanvas.getFileExtension(file.name).toLowerCase(),nodetype=LiteGraph.node_types_by_file_extension[ext];if(nodetype){var node=LiteGraph.createNode(nodetype.type);node.pos=[e.canvasX,e.canvasY],this.graph.add(node),node.onDropFile&&node.onDropFile(file)}}},LGraphCanvas.prototype.processNodeDblClicked=function(n){this.onShowNodePanel&&this.onShowNodePanel(n),this.onNodeDblClicked&&this.onNodeDblClicked(n),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(node,e){this.selectNode(node,e&&e.shiftKey),this.onNodeSelected&&this.onNodeSelected(node)},LGraphCanvas.prototype.processNodeDeselected=function(node){this.deselectNode(node),this.onNodeDeselected&&this.onNodeDeselected(node)},LGraphCanvas.prototype.selectNode=function(node,add_to_current_selection){null==node?this.deselectAllNodes():this.selectNodes([node],add_to_current_selection)},LGraphCanvas.prototype.selectNodes=function(nodes,add_to_current_selection){add_to_current_selection||this.deselectAllNodes(),nodes=nodes||this.graph._nodes;for(var i=0;i<nodes.length;++i){var node=nodes[i];if(!node.selected){if(!node.selected&&node.onSelected&&node.onSelected(),node.selected=!0,this.selected_nodes[node.id]=node,node.inputs)for(var j=0;j<node.inputs.length;++j)this.highlighted_links[node.inputs[j].link]=!0;if(node.outputs)for(var j=0;j<node.outputs.length;++j){var out=node.outputs[j];if(out.links)for(var k=0;k<out.links.length;++k)this.highlighted_links[out.links[k]]=!0}}}this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(node){if(node.selected){if(node.onDeselected&&node.onDeselected(),node.selected=!1,node.inputs)for(var i=0;i<node.inputs.length;++i)delete this.highlighted_links[node.inputs[i].link];if(node.outputs)for(var i=0;i<node.outputs.length;++i){var out=node.outputs[i];if(out.links)for(var j=0;j<out.links.length;++j)delete this.highlighted_links[out.links[j]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var nodes=this.graph._nodes,i=0,l=nodes.length;i<l;++i){var node=nodes[i];node.selected&&(node.onDeselected&&node.onDeselected(),node.selected=!1)}this.selected_nodes={},this.highlighted_links={},this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){for(var i in this.selected_nodes){var m=this.selected_nodes[i];this.graph.remove(m)}this.selected_nodes={},this.highlighted_links={},this.setDirty(!0)},LGraphCanvas.prototype.centerOnNode=function(node){this.offset[0]=-node.pos[0]-.5*node.size[0]+.5*this.canvas.width/this.scale,this.offset[1]=-node.pos[1]-.5*node.size[1]+.5*this.canvas.height/this.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(e){if(this.canvas){var b=this.canvas.getBoundingClientRect();e.localX=e.pageX-b.left,e.localY=e.pageY-b.top}else e.localX=e.pageX,e.localY=e.pageY;e.deltaX=e.localX-this.last_mouse_position[0],e.deltaY=e.localY-this.last_mouse_position[1],this.last_mouse_position[0]=e.localX,this.last_mouse_position[1]=e.localY,e.canvasX=e.localX/this.scale-this.offset[0],e.canvasY=e.localY/this.scale-this.offset[1]},LGraphCanvas.prototype.setZoom=function(value,zooming_center){!zooming_center&&this.canvas&&(zooming_center=[.5*this.canvas.width,.5*this.canvas.height]);var center=this.convertOffsetToCanvas(zooming_center);this.scale=value,this.scale>this.max_zoom?this.scale=this.max_zoom:this.scale<this.min_zoom&&(this.scale=this.min_zoom);var new_center=this.convertOffsetToCanvas(zooming_center),delta_offset=[new_center[0]-center[0],new_center[1]-center[1]];this.offset[0]+=delta_offset[0],this.offset[1]+=delta_offset[1],this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(pos,out){return out=out||[],out[0]=pos[0]/this.scale-this.offset[0],out[1]=pos[1]/this.scale-this.offset[1],out},LGraphCanvas.prototype.convertCanvasToOffset=function(pos,out){return out=out||[],out[0]=(pos[0]+this.offset[0])*this.scale,out[1]=(pos[1]+this.offset[1])*this.scale,out},LGraphCanvas.prototype.convertEventToCanvas=function(e){var rect=this.canvas.getBoundingClientRect();return this.convertOffsetToCanvas([e.pageX-rect.left,e.pageY-rect.top])},LGraphCanvas.prototype.bringToFront=function(node){var i=this.graph._nodes.indexOf(node);-1!=i&&(this.graph._nodes.splice(i,1),this.graph._nodes.push(node))},LGraphCanvas.prototype.sendToBack=function(node){var i=this.graph._nodes.indexOf(node);-1!=i&&(this.graph._nodes.splice(i,1),this.graph._nodes.unshift(node))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(nodes,out){var visible_nodes=out||[];visible_nodes.length=0,nodes=nodes||this.graph._nodes;for(var i=0,l=nodes.length;i<l;++i){var n=nodes[i];(!this.live_mode||n.onDrawBackground||n.onDrawForeground)&&(overlapBounding(this.visible_area,n.getBounding(temp))&&visible_nodes.push(n))}return visible_nodes},LGraphCanvas.prototype.draw=function(force_canvas,force_bgcanvas){if(this.canvas){var now=LiteGraph.getTime();if(this.render_time=.001*(now-this.last_draw_time),this.last_draw_time=now,this.graph){var startx=-this.offset[0],starty=-this.offset[1],endx=startx+this.canvas.width/this.scale,endy=starty+this.canvas.height/this.scale;this.visible_area[0]=startx,this.visible_area[1]=starty,this.visible_area[2]=endx-startx,this.visible_area[3]=endy-starty}(this.dirty_bgcanvas||force_bgcanvas||this.always_render_background||this.graph&&this.graph._last_trigger_time&&now-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||force_canvas)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var ctx=this.ctx;if(ctx){ctx.start2D&&ctx.start2D();var canvas=this.canvas;if(ctx.restore(),ctx.setTransform(1,0,0,1,0,0),this.dirty_area&&(ctx.save(),ctx.beginPath(),ctx.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),ctx.clip()),this.clear_background&&ctx.clearRect(0,0,canvas.width,canvas.height),this.bgcanvas==this.canvas?this.drawBackCanvas():ctx.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(canvas,ctx),this.show_info&&this.renderInfo(ctx),this.graph){ctx.save(),ctx.scale(this.scale,this.scale),ctx.translate(this.offset[0],this.offset[1]);for(var drawn_nodes=0,visible_nodes=this.computeVisibleNodes(null,this.visible_nodes),i=0;i<visible_nodes.length;++i){var node=visible_nodes[i];ctx.save(),ctx.translate(node.pos[0],node.pos[1]),this.drawNode(node,ctx),drawn_nodes+=1,ctx.restore()}if(this.render_execution_order&&this.drawExecutionOrder(ctx),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(ctx)),null!=this.connecting_pos){ctx.lineWidth=this.connections_width;var link_color=null;switch(this.connecting_output.type){case LiteGraph.EVENT:link_color=LiteGraph.EVENT_LINK_COLOR;break;default:link_color=LiteGraph.CONNECTING_LINK_COLOR}this.renderLink(ctx,this.connecting_pos,[this.canvas_mouse[0],this.canvas_mouse[1]],null,!1,null,link_color,this.connecting_output.dir||(this.connecting_node.flags.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),LiteGraph.CENTER),ctx.beginPath(),this.connecting_output.type===LiteGraph.EVENT||this.connecting_output.shape===LiteGraph.BOX_SHAPE?ctx.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):ctx.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI),ctx.fill(),ctx.fillStyle="#ffcc00",this._highlight_input&&(ctx.beginPath(),ctx.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),ctx.fill())}this.dragging_rectangle&&(ctx.strokeStyle="#FFF",ctx.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.onDrawForeground&&this.onDrawForeground(ctx,this.visible_rect),ctx.restore()}this.onDrawOverlay&&this.onDrawOverlay(ctx),this.dirty_area&&ctx.restore(),ctx.finish2D&&ctx.finish2D()}},LGraphCanvas.prototype.renderInfo=function(ctx,x,y){x=x||0,y=y||0,ctx.save(),ctx.translate(x,y),ctx.font="10px Arial",ctx.fillStyle="#888",this.graph?(ctx.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),ctx.fillText("I: "+this.graph.iteration,5,26),ctx.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),ctx.fillText("V: "+this.graph._version,5,52),ctx.fillText("FPS:"+this.fps.toFixed(2),5,65)):ctx.fillText("No graph selected",5,13),ctx.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var canvas=this.bgcanvas;canvas.width==this.canvas.width&&canvas.height==this.canvas.height||(canvas.width=this.canvas.width,canvas.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var ctx=this.bgctx;if(ctx.start&&ctx.start(),this.clear_background&&ctx.clearRect(0,0,canvas.width,canvas.height),this._graph_stack&&this._graph_stack.length){ctx.save();var subgraph_node=(this._graph_stack[this._graph_stack.length-1],this.graph._subgraph_node);ctx.strokeStyle=subgraph_node.bgcolor,ctx.lineWidth=10,ctx.strokeRect(1,1,canvas.width-2,canvas.height-2),ctx.lineWidth=1,ctx.font="40px Arial",ctx.textAlign="center",ctx.fillStyle=subgraph_node.bgcolor;for(var title="",i=1;i<this._graph_stack.length;++i)title+=this._graph_stack[i]._subgraph_node.getTitle()+" >> ";ctx.fillText(title+subgraph_node.getTitle(),.5*canvas.width,40),ctx.restore()}var bg_already_painted=!1;if(this.onRenderBackground&&(bg_already_painted=this.onRenderBackground(canvas,ctx)),ctx.restore(),ctx.setTransform(1,0,0,1,0,0),this.graph){if(ctx.save(),ctx.scale(this.scale,this.scale),ctx.translate(this.offset[0],this.offset[1]),this.background_image&&this.scale>.5&&!bg_already_painted){if(this.zoom_modify_alpha?ctx.globalAlpha=(1-.5/this.scale)*this.editor_alpha:ctx.globalAlpha=this.editor_alpha,ctx.imageSmoothingEnabled=ctx.mozImageSmoothingEnabled=ctx.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var that=this;this._bg_img.onload=function(){that.draw(!0,!0)}}var pattern=null;null==this._pattern&&this._bg_img.width>0?(pattern=ctx.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=pattern):pattern=this._pattern,pattern&&(ctx.fillStyle=pattern,ctx.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),ctx.fillStyle="transparent"),ctx.globalAlpha=1,ctx.imageSmoothingEnabled=ctx.mozImageSmoothingEnabled=ctx.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(canvas,ctx),this.onDrawBackground&&this.onDrawBackground(ctx,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(ctx.strokeStyle="#235",ctx.strokeRect(0,0,canvas.width,canvas.height)),this.render_connections_shadows?(ctx.shadowColor="#000",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=6):ctx.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(ctx),ctx.shadowColor="rgba(0,0,0,0)",ctx.restore()}ctx.finish&&ctx.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(node,ctx){this.current_node=node;var color=node.color||node.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,bgcolor=node.bgcolor||node.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;if(node.mouseOver&&!0,this.live_mode)return void(node.flags.collapsed||(ctx.shadowColor="transparent",node.onDrawForeground&&node.onDrawForeground(ctx,this,this.canvas)));var editor_alpha=this.editor_alpha;if(ctx.globalAlpha=editor_alpha,this.render_shadows?(ctx.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,ctx.shadowOffsetX=2*this.scale,ctx.shadowOffsetY=2*this.scale,ctx.shadowBlur=3*this.scale):ctx.shadowColor="transparent",!node.flags.collapsed||!node.onDrawCollaped||1!=node.onDrawCollapsed(ctx,this)){var shape=node._shape||LiteGraph.BOX_SHAPE,size=temp_vec2;if(temp_vec2.set(node.size),node.flags.collapsed){ctx.font=this.inner_text_font;var title=node.getTitle?node.getTitle():node.title;node._collapsed_width=Math.min(node.size[0],ctx.measureText(title).width+40),size[0]=node._collapsed_width,size[1]=0}node.flags.clip_area&&(ctx.save(),ctx.beginPath(),shape==LiteGraph.BOX_SHAPE?ctx.rect(0,0,size[0],size[1]):shape==LiteGraph.ROUND_SHAPE?ctx.roundRect(0,0,size[0],size[1],10):shape==LiteGraph.CIRCLE_SHAPE&&ctx.arc(.5*size[0],.5*size[1],.5*size[0],0,2*Math.PI),ctx.clip()),this.drawNodeShape(node,ctx,size,color,bgcolor,node.selected,node.mouseOver),ctx.shadowColor="transparent",ctx.textAlign=node.flags.horizontal?"center":"left",ctx.font=this.inner_text_font;var render_text=this.scale>.6,out_slot=this.connecting_output;ctx.lineWidth=1;var max_y=0,slot_pos=new Float32Array(2);if(node.flags.collapsed){var input_slot=null,output_slot=null;if(node.inputs)for(var i=0;i<node.inputs.length;i++){var slot=node.inputs[i];if(null!=slot.link){input_slot=slot;break}}if(node.outputs)for(var i=0;i<node.outputs.length;i++){var slot=node.outputs[i];slot.links&&slot.links.length&&(output_slot=slot)}if(input_slot){var x=0,y=-.5*LiteGraph.NODE_TITLE_HEIGHT;node.flags.horizontal&&(x=.5*node._collapsed_width,y=-LiteGraph.NODE_TITLE_HEIGHT),ctx.fillStyle=slot.color_on||this.default_connection_color.input_on,ctx.beginPath(),slot.type===LiteGraph.EVENT||slot.shape===LiteGraph.BOX_SHAPE?ctx.rect(x-7+.5,y+4-.5*LiteGraph.NODE_TITLE_HEIGHT+.5,14,LiteGraph.NODE_TITLE_HEIGHT-8):slot.shape===LiteGraph.ARROW_SHAPE?(ctx.moveTo(x+8,y),ctx.lineTo(x+-4,y-4),ctx.lineTo(x+-4,y+4),ctx.closePath()):ctx.arc(x,y,4,0,2*Math.PI),ctx.fill()}if(output_slot){var x=node._collapsed_width,y=-.5*LiteGraph.NODE_TITLE_HEIGHT;node.flags.horizontal&&(x=.5*node._collapsed_width,y=0),ctx.fillStyle=slot.color_on||this.default_connection_color.output_on,ctx.strokeStyle="black",ctx.beginPath(),slot.type===LiteGraph.EVENT||slot.shape===LiteGraph.BOX_SHAPE?ctx.rect(x-7+.5,y+4-.5*LiteGraph.NODE_TITLE_HEIGHT+.5,14,LiteGraph.NODE_TITLE_HEIGHT-8):slot.shape===LiteGraph.ARROW_SHAPE?(ctx.moveTo(x+6,y),ctx.lineTo(x-6,y-4),ctx.lineTo(x-6,y+4),ctx.closePath()):ctx.arc(x,y,4,0,2*Math.PI),ctx.fill(),ctx.stroke()}}else{if(node.inputs)for(var i=0;i<node.inputs.length;i++){var slot=node.inputs[i];ctx.globalAlpha=editor_alpha,this.connecting_node&&LiteGraph.isValidConnection(slot.type&&out_slot.type)&&(ctx.globalAlpha=.4*editor_alpha),ctx.fillStyle=null!=slot.link?slot.color_on||this.default_connection_color.input_on:slot.color_off||this.default_connection_color.input_off;var pos=node.getConnectionPos(!0,i,slot_pos);if(pos[0]-=node.pos[0],pos[1]-=node.pos[1],max_y<pos[1]+.5*LiteGraph.NODE_SLOT_HEIGHT&&(max_y=pos[1]+.5*LiteGraph.NODE_SLOT_HEIGHT),ctx.beginPath(),slot.type===LiteGraph.EVENT||slot.shape===LiteGraph.BOX_SHAPE?ctx.rect(pos[0]-6+.5,pos[1]-5+.5,14,10):slot.shape===LiteGraph.ARROW_SHAPE?(ctx.moveTo(pos[0]+8,pos[1]+.5),ctx.lineTo(pos[0]-4,pos[1]+6+.5),ctx.lineTo(pos[0]-4,pos[1]-6+.5),ctx.closePath()):ctx.arc(pos[0],pos[1],4,0,2*Math.PI),ctx.fill(),render_text){var text=null!=slot.label?slot.label:slot.name;text&&(ctx.fillStyle=LiteGraph.NODE_TEXT_COLOR,node.flags.horizontal||slot.dir==LiteGraph.UP?ctx.fillText(text,pos[0],pos[1]-10):ctx.fillText(text,pos[0]+10,pos[1]+5))}}if(this.connecting_node&&(ctx.globalAlpha=.4*editor_alpha),ctx.textAlign=node.flags.horizontal?"center":"right",ctx.strokeStyle="black",node.outputs)for(var i=0;i<node.outputs.length;i++){var slot=node.outputs[i],pos=node.getConnectionPos(!1,i,slot_pos);if(pos[0]-=node.pos[0],pos[1]-=node.pos[1],max_y<pos[1]+.5*LiteGraph.NODE_SLOT_HEIGHT&&(max_y=pos[1]+.5*LiteGraph.NODE_SLOT_HEIGHT),ctx.fillStyle=slot.links&&slot.links.length?slot.color_on||this.default_connection_color.output_on:slot.color_off||this.default_connection_color.output_off,ctx.beginPath(),slot.type===LiteGraph.EVENT||slot.shape===LiteGraph.BOX_SHAPE?ctx.rect(pos[0]-6+.5,pos[1]-5+.5,14,10):slot.shape===LiteGraph.ARROW_SHAPE?(ctx.moveTo(pos[0]+8,pos[1]+.5),ctx.lineTo(pos[0]-4,pos[1]+6+.5),ctx.lineTo(pos[0]-4,pos[1]-6+.5),ctx.closePath()):ctx.arc(pos[0],pos[1],4,0,2*Math.PI),ctx.fill(),ctx.stroke(),render_text){var text=null!=slot.label?slot.label:slot.name;text&&(ctx.fillStyle=LiteGraph.NODE_TEXT_COLOR,node.flags.horizontal||slot.dir==LiteGraph.DOWN?ctx.fillText(text,pos[0],pos[1]-8):ctx.fillText(text,pos[0]-10,pos[1]+5))}}ctx.textAlign="left",ctx.globalAlpha=1,node.widgets&&((node.flags.horizontal||node.flags.widgets_up)&&(max_y=2),this.drawNodeWidgets(node,max_y,ctx,this.node_widget&&this.node_widget[0]==node?this.node_widget[1]:null)),node.onDrawForeground&&node.onDrawForeground(ctx,this,this.canvas)}node.flags.clip_area&&ctx.restore(),ctx.globalAlpha=1}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(node,ctx,size,fgcolor,bgcolor,selected,mouse_over){ctx.strokeStyle=fgcolor,ctx.fillStyle=bgcolor;var title_height=LiteGraph.NODE_TITLE_HEIGHT,shape=node._shape||node.constructor.shape||LiteGraph.BOX_SHAPE,title_mode=node.constructor.title_mode,render_title=!0;title_mode==LiteGraph.TRANSPARENT_TITLE?render_title=!1:title_mode==LiteGraph.AUTOHIDE_TITLE&&mouse_over&&(render_title=!0);var area=tmp_area;if(area[0]=0,area[1]=render_title?-title_height:0,area[2]=size[0]+1,area[3]=render_title?size[1]+title_height:size[1],node.flags.collapsed||(ctx.beginPath(),shape==LiteGraph.BOX_SHAPE||this.scale<.5?ctx.fillRect(area[0],area[1],area[2],area[3]):shape==LiteGraph.ROUND_SHAPE||shape==LiteGraph.CARD_SHAPE?ctx.roundRect(area[0],area[1],area[2],area[3],this.round_radius,shape==LiteGraph.CARD_SHAPE?0:this.round_radius):shape==LiteGraph.CIRCLE_SHAPE&&ctx.arc(.5*size[0],.5*size[1],.5*size[0],0,2*Math.PI),ctx.fill()),ctx.shadowColor="transparent",node.bgImage&&node.bgImage.width&&ctx.drawImage(node.bgImage,.5*(size[0]-node.bgImage.width),.5*(size[1]-node.bgImage.height)),node.bgImageUrl&&!node.bgImage&&(node.bgImage=node.loadImage(node.bgImageUrl)),node.onDrawBackground&&node.onDrawBackground(ctx,this,this.canvas),render_title||title_mode==LiteGraph.TRANSPARENT_TITLE){if(title_mode!=LiteGraph.TRANSPARENT_TITLE){if(node.flags.collapsed&&(ctx.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var grad=LGraphCanvas.gradients[fgcolor];grad||(grad=LGraphCanvas.gradients[fgcolor]=ctx.createLinearGradient(0,0,400,0),grad.addColorStop(0,fgcolor),grad.addColorStop(1,"#000")),ctx.fillStyle=grad}else ctx.fillStyle=fgcolor;var old_alpha=ctx.globalAlpha;ctx.beginPath(),shape==LiteGraph.BOX_SHAPE||this.scale<.5?ctx.rect(0,-title_height,size[0]+1,title_height):shape!=LiteGraph.ROUND_SHAPE&&shape!=LiteGraph.CARD_SHAPE||ctx.roundRect(0,-title_height,size[0]+1,title_height,this.round_radius,node.flags.collapsed?this.round_radius:0),ctx.fill(),ctx.shadowColor="transparent"}if(shape==LiteGraph.ROUND_SHAPE||shape==LiteGraph.CIRCLE_SHAPE||shape==LiteGraph.CARD_SHAPE?(this.scale>.5&&(ctx.fillStyle="black",ctx.beginPath(),ctx.arc(.5*title_height,-.5*title_height,.5*(title_height-8),0,2*Math.PI),ctx.fill()),ctx.fillStyle=node.boxcolor||LiteGraph.NODE_DEFAULT_BOXCOLOR,ctx.beginPath(),ctx.arc(.5*title_height,-.5*title_height,.4*(title_height-8),0,2*Math.PI),ctx.fill()):(this.scale>.5&&(ctx.fillStyle="black",ctx.fillRect(4,4-title_height,title_height-8,title_height-8)),ctx.fillStyle=node.boxcolor||LiteGraph.NODE_DEFAULT_BOXCOLOR,ctx.fillRect(5,5-title_height,title_height-10,title_height-10)),ctx.globalAlpha=old_alpha,this.scale>.5){ctx.font=this.title_text_font;var title=node.getTitle();if(title)if(ctx.fillStyle=selected?"white":node.constructor.title_text_color||this.node_title_color,node.flags.collapsed){ctx.textAlign="center";var measure=ctx.measureText(title);ctx.fillText(title,title_height+.5*measure.width,.2*-title_height),ctx.textAlign="left"}else ctx.textAlign="left",ctx.fillText(title,title_height,.2*-title_height)}node.onDrawTitle&&node.onDrawTitle(ctx)}selected&&(node.onBounding&&node.onBounding(area),title_mode==LiteGraph.TRANSPARENT_TITLE&&(area[1]-=title_height,area[3]+=title_height),ctx.lineWidth=1,ctx.globalAlpha=.8,ctx.beginPath(),shape==LiteGraph.BOX_SHAPE?ctx.rect(-6+area[0],-6+area[1],12+area[2],12+area[3]):shape==LiteGraph.ROUND_SHAPE||shape==LiteGraph.CARD_SHAPE&&node.flags.collapsed?ctx.roundRect(-6+area[0],-6+area[1],12+area[2],12+area[3],2*this.round_radius):shape==LiteGraph.CARD_SHAPE?ctx.roundRect(-6+area[0],-6+area[1],12+area[2],12+area[3],2*this.round_radius,2):shape==LiteGraph.CIRCLE_SHAPE&&ctx.arc(.5*size[0],.5*size[1],.5*size[0]+6,0,2*Math.PI),ctx.strokeStyle="#FFF",ctx.stroke(),ctx.strokeStyle=fgcolor,ctx.globalAlpha=1)},LGraphCanvas.prototype.drawConnections=function(ctx){var now=LiteGraph.getTime(),visible_area=this.visible_area,margin_area=new Float32Array([visible_area[0]-20,visible_area[1]-20,visible_area[2]+40,visible_area[3]+40]),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);ctx.lineWidth=this.connections_width,ctx.fillStyle="#AAA",ctx.strokeStyle="#AAA",ctx.globalAlpha=this.editor_alpha;for(var nodes=this.graph._nodes,n=0,l=nodes.length;n<l;++n){var node=nodes[n];if(node.inputs&&node.inputs.length)for(var i=0;i<node.inputs.length;++i){var input=node.inputs[i];if(input&&null!=input.link){var link_id=input.link,link=this.graph.links[link_id];if(link){var start_node=this.graph.getNodeById(link.origin_id);if(null!=start_node){var start_node_slot=link.origin_slot,start_node_slotpos=null;start_node_slotpos=-1==start_node_slot?[start_node.pos[0]+10,start_node.pos[1]+10]:start_node.getConnectionPos(!1,start_node_slot,tempA);var end_node_slotpos=node.getConnectionPos(!0,i,tempB);if(link_bounding[0]=start_node_slotpos[0],link_bounding[1]=start_node_slotpos[1],link_bounding[2]=end_node_slotpos[0]-start_node_slotpos[0],link_bounding[3]=end_node_slotpos[1]-start_node_slotpos[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),overlapBounding(link_bounding,margin_area)){var start_slot=start_node.outputs[start_node_slot],end_slot=node.inputs[i];if(start_slot&&end_slot){var start_dir=start_slot.dir||(start_node.flags.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),end_dir=end_slot.dir||(node.flags.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(ctx,start_node_slotpos,end_node_slotpos,link,!1,0,null,start_dir,end_dir),link&&link._last_time&&now-link._last_time<1e3){var f=2-.002*(now-link._last_time),tmp=ctx.globalAlpha;ctx.globalAlpha=tmp*f,this.renderLink(ctx,start_node_slotpos,end_node_slotpos,link,!0,f,"white",start_dir,end_dir),ctx.globalAlpha=tmp}}}}}}}}ctx.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(ctx,a,b,link,skip_border,flow,color,start_dir,end_dir){if(!this.highquality_render)return ctx.beginPath(),ctx.moveTo(a[0],a[1]),ctx.lineTo(b[0],b[1]),void ctx.stroke();start_dir=start_dir||LiteGraph.RIGHT,end_dir=end_dir||LiteGraph.LEFT;var dist=distance(a,b);if(this.render_connections_border&&this.scale>.6&&(ctx.lineWidth=this.connections_width+4),!color&&link&&(color=link.color||LGraphCanvas.link_type_colors[link.type]),color||(color=this.default_link_color),null!=link&&this.highlighted_links[link.id]&&(color="#FFF"),ctx.beginPath(),this.render_curved_connections){ctx.moveTo(a[0],a[1]);var start_offset_x=0,start_offset_y=0,end_offset_x=0,end_offset_y=0;switch(start_dir){case LiteGraph.LEFT:start_offset_x=-.25*dist;break;case LiteGraph.RIGHT:start_offset_x=.25*dist;break;case LiteGraph.UP:start_offset_y=-.25*dist;break;case LiteGraph.DOWN:start_offset_y=.25*dist}switch(end_dir){case LiteGraph.LEFT:end_offset_x=-.25*dist;break;case LiteGraph.RIGHT:end_offset_x=.25*dist;break;case LiteGraph.UP:end_offset_y=-.25*dist;break;case LiteGraph.DOWN:end_offset_y=.25*dist}ctx.bezierCurveTo(a[0]+start_offset_x,a[1]+start_offset_y,b[0]+end_offset_x,b[1]+end_offset_y,b[0],b[1])}else ctx.moveTo(a[0]+10,a[1]),ctx.lineTo(.5*(a[0]+10+(b[0]-10)),a[1]),ctx.lineTo(.5*(a[0]+10+(b[0]-10)),b[1]),ctx.lineTo(b[0]-10,b[1]);if(this.render_connections_border&&this.scale>.6&&!skip_border&&(ctx.strokeStyle="rgba(0,0,0,0.5)",ctx.stroke()),ctx.lineWidth=this.connections_width,ctx.fillStyle=ctx.strokeStyle=color,ctx.stroke(),this.render_connection_arrows&&this.scale>=.6&&this.render_connection_arrows&&this.scale>.6){var pos=this.computeConnectionPoint(a,b,.5,start_dir,end_dir),pos2=this.computeConnectionPoint(a,b,.51,start_dir,end_dir),angle=0;angle=this.render_curved_connections?-Math.atan2(pos2[0]-pos[0],pos2[1]-pos[1]):b[1]>a[1]?0:Math.PI,ctx.save(),ctx.translate(pos[0],pos[1]),ctx.rotate(angle),ctx.beginPath(),ctx.moveTo(-5,-5),ctx.lineTo(0,5),ctx.lineTo(5,-5),ctx.fill(),ctx.restore()}if(flow)for(var i=0;i<5;++i){var f=(.001*LiteGraph.getTime()+.2*i)%1,pos=this.computeConnectionPoint(a,b,f,start_dir,end_dir);ctx.beginPath(),ctx.arc(pos[0],pos[1],5,0,2*Math.PI),ctx.fill()}},LGraphCanvas.prototype.computeConnectionPoint=function(a,b,t,start_dir,end_dir){start_dir=start_dir||LiteGraph.RIGHT,end_dir=end_dir||LiteGraph.LEFT;var dist=distance(a,b),p0=a,p1=[a[0],a[1]],p2=[b[0],b[1]],p3=b;switch(start_dir){case LiteGraph.LEFT:p1[0]+=-.25*dist;break;case LiteGraph.RIGHT:p1[0]+=.25*dist;break;case LiteGraph.UP:p1[1]+=-.25*dist;break;case LiteGraph.DOWN:p1[1]+=.25*dist}switch(end_dir){case LiteGraph.LEFT:p2[0]+=-.25*dist;break;case LiteGraph.RIGHT:p2[0]+=.25*dist;break;case LiteGraph.UP:p2[1]+=-.25*dist;break;case LiteGraph.DOWN:p2[1]+=.25*dist}var c1=(1-t)*(1-t)*(1-t),c2=(1-t)*(1-t)*3*t,c3=3*(1-t)*(t*t),c4=t*t*t;return[c1*p0[0]+c2*p1[0]+c3*p2[0]+c4*p3[0],c1*p0[1]+c2*p1[1]+c3*p2[1]+c4*p3[1]]},LGraphCanvas.prototype.drawExecutionOrder=function(ctx){ctx.shadowColor="transparent",ctx.globalAlpha=.25,ctx.textAlign="center",ctx.strokeStyle="white",ctx.globalAlpha=.75;for(var visible_nodes=this.visible_nodes,i=0;i<visible_nodes.length;++i){var node=visible_nodes[i];ctx.fillStyle="black",ctx.fillRect(node.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,node.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),0==node.order&&ctx.strokeRect(node.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,node.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),ctx.fillStyle="#FFF",ctx.fillText(node.order,node.pos[0]+-.5*LiteGraph.NODE_TITLE_HEIGHT,node.pos[1]-6)}ctx.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(node,posY,ctx,active_widget){if(!node.widgets||!node.widgets.length)return 0;var width=node.size[0],widgets=node.widgets;posY+=2;var H=LiteGraph.NODE_WIDGET_HEIGHT,show_text=this.scale>.5;ctx.save(),ctx.globalAlpha=this.editor_alpha;for(var i=0;i<widgets.length;++i){var w=widgets[i],y=posY;switch(w.y&&(y=w.y),w.last_y=y,ctx.strokeStyle="#AAA",ctx.fillStyle="#222",ctx.textAlign="left",w.type){case"button":w.clicked&&(ctx.fillStyle="#AAA",w.clicked=!1,this.dirty_canvas=!0),ctx.fillRect(10,y,width-20,H),ctx.strokeRect(10,y,width-20,H),show_text&&(ctx.textAlign="center",ctx.fillStyle="#AAA",ctx.fillText(w.name,.5*width,y+.7*H));break;case"toggle":ctx.textAlign="left",ctx.strokeStyle="#AAA",ctx.fillStyle="#111",ctx.beginPath(),ctx.roundRect(10,posY,width-20,H,.5*H),ctx.fill(),ctx.stroke(),ctx.fillStyle=w.value?"#89A":"#333",ctx.beginPath(),ctx.arc(width-20,y+.5*H,.36*H,0,2*Math.PI),ctx.fill(),show_text&&(ctx.fillStyle="#999",null!=w.name&&ctx.fillText(w.name,20,y+.7*H),ctx.fillStyle=w.value?"#DDD":"#888",ctx.textAlign="right",ctx.fillText(w.value?w.options.on||"true":w.options.off||"false",width-30,y+.7*H));break;case"slider":ctx.fillStyle="#111",ctx.fillRect(10,y,width-20,H);var range=w.options.max-w.options.min,nvalue=(w.value-w.options.min)/range;ctx.fillStyle=active_widget==w?"#89A":"#678",ctx.fillRect(10,y,nvalue*(width-20),H),ctx.strokeRect(10,y,width-20,H),show_text&&(ctx.textAlign="center",ctx.fillStyle="#DDD",ctx.fillText(w.name+"  "+Number(w.value).toFixed(3),.5*width,y+.7*H));break;case"number":case"combo":ctx.textAlign="left",ctx.strokeStyle="#AAA",ctx.fillStyle="#111",ctx.beginPath(),ctx.roundRect(10,posY,width-20,H,.5*H),ctx.fill(),ctx.stroke(),show_text&&(ctx.fillStyle="#AAA",ctx.beginPath(),ctx.moveTo(26,posY+5),ctx.lineTo(16,posY+.5*H),ctx.lineTo(26,posY+H-5),ctx.moveTo(width-26,posY+5),ctx.lineTo(width-16,posY+.5*H),ctx.lineTo(width-26,posY+H-5),ctx.fill(),ctx.fillStyle="#999",ctx.fillText(w.name,30,y+.7*H),ctx.fillStyle="#DDD",ctx.textAlign="right","number"==w.type?ctx.fillText(Number(w.value).toFixed(void 0!==w.options.precision?w.options.precision:3),width-40,y+.7*H):ctx.fillText(w.value,width-40,y+.7*H));break;case"text":ctx.textAlign="left",ctx.strokeStyle="#AAA",ctx.fillStyle="#111",ctx.beginPath(),ctx.roundRect(10,posY,width-20,H,.5*H),ctx.fill(),ctx.stroke(),show_text&&(ctx.fillStyle="#999",null!=w.name&&ctx.fillText(w.name,20,y+.7*H),ctx.fillStyle="#DDD",ctx.textAlign="right",ctx.fillText(w.value,width-20,y+.7*H));break;default:w.draw&&w.draw(ctx,node,w,y,H)}posY+=H+4}ctx.restore()},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){function inner_clicked(v,option,event){return this.value=v,that.dirty_canvas=!0,!1}if(!node.widgets||!node.widgets.length)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(w==active_widget||x>6&&x<width-12&&y>w.last_y&&y<w.last_y+LiteGraph.NODE_WIDGET_HEIGHT){switch(w.type){case"button":w.callback&&setTimeout(function(){w.callback(w,that,node,pos)},20),w.clicked=!0,this.dirty_canvas=!0;break;case"slider":var nvalue=(w.options.max,w.options.min,Math.clamp((x-10)/(width-20),0,1));w.value=w.options.min+(w.options.max-w.options.min)*nvalue,w.callback&&setTimeout(function(){w.callback(w.value,that,node,pos)},20),this.dirty_canvas=!0;break;case"number":case"combo":if("mousemove"==event.type&&"number"==w.type)w.value+=.1*event.deltaX*(w.options.step||1),null!=w.options.min&&w.value<w.options.min&&(w.value=w.options.min),null!=w.options.max&&w.value>w.options.max&&(w.value=w.options.max);else if("mousedown"==event.type){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var delta=x<40?-1:x>width-40?1:0;if("number"==w.type)w.value+=.1*delta*(w.options.step||1),null!=w.options.min&&w.value<w.options.min&&(w.value=w.options.min),null!=w.options.max&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=values.indexOf(w.value)+delta;index>=values.length&&(index=0),index<0&&(index=values.length-1),w.value=values[index]}else{new LiteGraph.ContextMenu(values,{event:event,className:"dark",callback:inner_clicked.bind(w)},ref_window)}}w.callback&&setTimeout(function(){this.callback(this.value,that,node,pos)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":"mousedown"==event.type&&(w.value=!w.value,w.callback&&setTimeout(function(){w.callback(w.value,that,node,pos)},20));break;case"text":"mousedown"==event.type&&this.prompt("Value",w.value,function(v){this.value=v,w.callback&&w.callback(v,that,node)}.bind(w),event);break;default:w.mouse&&w.mouse(ctx,event,[x,y],node)}return w}}return null},LGraphCanvas.prototype.drawGroups=function(canvas,ctx){if(this.graph){var groups=this.graph._groups;ctx.save(),ctx.globalAlpha=.5*this.editor_alpha;for(var i=0;i<groups.length;++i){var group=groups[i];if(overlapBounding(this.visible_area,group._bounding)){ctx.fillStyle=group.color||"#335",ctx.strokeStyle=group.color||"#335";var pos=group._pos,size=group._size;ctx.globalAlpha=.25*this.editor_alpha,ctx.beginPath(),ctx.rect(pos[0]+.5,pos[1]+.5,size[0],size[1]),ctx.fill(),ctx.globalAlpha=this.editor_alpha,ctx.stroke(),ctx.beginPath(),ctx.moveTo(pos[0]+size[0],pos[1]+size[1]),ctx.lineTo(pos[0]+size[0]-10,pos[1]+size[1]),ctx.lineTo(pos[0]+size[0],pos[1]+size[1]-10),ctx.fill();var font_size=group.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;ctx.font=font_size+"px Arial",ctx.fillText(group.title,pos[0]+4,pos[1]+font_size)}}ctx.restore()}},LGraphCanvas.prototype.resize=function(width,height){if(!width&&!height){var parent=this.canvas.parentNode;width=parent.offsetWidth,height=parent.offsetHeight}this.canvas.width==width&&this.canvas.height==height||(this.canvas.width=width,this.canvas.height=height,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(transition){if(!transition)return this.live_mode=!this.live_mode,this.dirty_canvas=!0,void(this.dirty_bgcanvas=!0);var self=this,delta=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var t=setInterval(function(){self.editor_alpha*=delta,self.dirty_canvas=!0,self.dirty_bgcanvas=!0,delta<1&&self.editor_alpha<.01&&(clearInterval(t),delta<1&&(self.live_mode=!0)),delta>1&&self.editor_alpha>.99&&(clearInterval(t),self.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(node){},LGraphCanvas.prototype.touchHandler=function(event){var touches=event.changedTouches,first=touches[0],type="";switch(event.type){case"touchstart":type="mousedown";break;case"touchmove":type="mousemove";break;case"touchend":type="mouseup";break;default:return}var window=this.getCanvasWindow(),document=window.document,simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,null),first.target.dispatchEvent(simulatedEvent),event.preventDefault()},LGraphCanvas.onGroupAdd=function(info,entry,mouse_event){var canvas=LGraphCanvas.active_canvas,group=(canvas.getCanvasWindow(),new LiteGraph.LGraphGroup);group.pos=canvas.convertEventToCanvas(mouse_event),canvas.graph.add(group)},LGraphCanvas.onMenuAdd=function(node,options,e,prev_menu){function inner_clicked(v,option,e){var category=v.value,node_types=LiteGraph.getNodeTypesInCategory(category,canvas.filter),values=[];for(var i in node_types)node_types[i].skip_list||values.push({content:node_types[i].title,value:node_types[i].type});return new LiteGraph.ContextMenu(values,{event:e,callback:inner_create,parentMenu:menu},ref_window),!1}function inner_create(v,e){var first_event=prev_menu.getFirstEvent(),node=LiteGraph.createNode(v.value);node&&(node.pos=canvas.convertEventToCanvas(first_event),canvas.graph.add(node))}var canvas=LGraphCanvas.active_canvas,ref_window=canvas.getCanvasWindow(),values=LiteGraph.getNodeTypesCategories(),entries=[];for(var i in values)values[i]&&entries.push({value:values[i],content:values[i],has_submenu:!0});var menu=new LiteGraph.ContextMenu(entries,{event:e,callback:inner_clicked,parentMenu:prev_menu},ref_window);return!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(v,options,e,prev_menu,node){function inner_clicked(v,e,prev){node&&(v.callback&&v.callback.call(that,node,v,e,prev),v.value&&(node.addInput(v.value[0],v.value[1],v.value[2]),node.setDirtyCanvas(!0,!0)))}if(node){var that=this,canvas=LGraphCanvas.active_canvas,ref_window=canvas.getCanvasWindow(),options=node.optional_inputs;node.onGetInputs&&(options=node.onGetInputs());var entries=[];if(options)for(var i in options){var entry=options[i];if(entry){var label=entry[0];entry[2]&&entry[2].label&&(label=entry[2].label);var data={content:label,value:entry};entry[1]==LiteGraph.ACTION&&(data.className="event"),entries.push(data)}else entries.push(null)}if(this.onMenuNodeInputs&&(entries=this.onMenuNodeInputs(entries)),entries.length){new LiteGraph.ContextMenu(entries,{event:e,callback:inner_clicked,parentMenu:prev_menu,node:node},ref_window);return!1}}},LGraphCanvas.showMenuNodeOptionalOutputs=function(v,options,e,prev_menu,node){function inner_clicked(v,e,prev){if(node&&(v.callback&&v.callback.call(that,node,v,e,prev),v.value)){var value=v.value[1];if(value&&(value.constructor===Object||value.constructor===Array)){var entries=[];for(var i in value)entries.push({content:i,value:value[i]});return new LiteGraph.ContextMenu(entries,{event:e,callback:inner_clicked,parentMenu:prev_menu,node:node}),!1}node.addOutput(v.value[0],v.value[1],v.value[2]),node.setDirtyCanvas(!0,!0)}}if(node){var that=this,canvas=LGraphCanvas.active_canvas,ref_window=canvas.getCanvasWindow(),options=node.optional_outputs;node.onGetOutputs&&(options=node.onGetOutputs());var entries=[];if(options)for(var i in options){var entry=options[i];if(entry){if(!node.flags||!node.flags.skip_repeated_outputs||-1==node.findOutputSlot(entry[0])){var label=entry[0];entry[2]&&entry[2].label&&(label=entry[2].label);var data={content:label,value:entry};entry[1]==LiteGraph.EVENT&&(data.className="event"),entries.push(data)}}else entries.push(null)}if(this.onMenuNodeOutputs&&(entries=this.onMenuNodeOutputs(entries)),entries.length){new LiteGraph.ContextMenu(entries,{event:e,callback:inner_clicked,parentMenu:prev_menu,node:node},ref_window);return!1}}},LGraphCanvas.onShowMenuNodeProperties=function(value,options,e,prev_menu,node){function inner_clicked(v,options,e,prev){if(node){var rect=this.getBoundingClientRect();canvas.showEditPropertyValue(node,v.value,{position:[rect.left,rect.top]})}}if(node&&node.properties){var canvas=LGraphCanvas.active_canvas,ref_window=canvas.getCanvasWindow(),entries=[];for(var i in node.properties){var value=void 0!==node.properties[i]?node.properties[i]:" ";value=LGraphCanvas.decodeHTML(value),entries.push({content:"<span class='property_name'>"+i+"</span><span class='property_value'>"+value+"</span>",value:i})}if(entries.length){new LiteGraph.ContextMenu(entries,{event:e,callback:inner_clicked,parentMenu:prev_menu,allow_html:!0,node:node},ref_window);return!1}}},LGraphCanvas.decodeHTML=function(str){var e=document.createElement("div");return e.innerText=str,e.innerHTML},LGraphCanvas.onResizeNode=function(value,options,e,menu,node){node&&(node.size=node.computeSize(),node.setDirtyCanvas(!0,!0))},LGraphCanvas.onShowPropertyEditor=function(item,options,e,menu,node){function inner(){setValue(input.value)}function setValue(value){"Number"==item.type?value=Number(value):"Boolean"==item.type&&(value=Boolean(value)),node[property]=value,dialog.parentNode.removeChild(dialog),node.setDirtyCanvas(!0,!0)}var property=item.property||"title",value=node[property],dialog=document.createElement("div");dialog.className="graphdialog",dialog.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",dialog.querySelector(".name").innerText=property;var input=dialog.querySelector("input");input&&(input.value=value,input.addEventListener("blur",function(e){this.focus()}),input.addEventListener("keydown",function(e){13==e.keyCode&&(inner(),e.preventDefault(),e.stopPropagation())}));var graphcanvas=LGraphCanvas.active_canvas,canvas=graphcanvas.canvas,rect=canvas.getBoundingClientRect(),offsetx=-20,offsety=-20;rect&&(offsetx-=rect.left,offsety-=rect.top),event?(dialog.style.left=event.pageX+offsetx+"px",dialog.style.top=event.pageY+offsety+"px"):(dialog.style.left=.5*canvas.width+offsetx+"px",dialog.style.top=.5*canvas.height+offsety+"px"),dialog.querySelector("button").addEventListener("click",inner),canvas.parentNode.appendChild(dialog)},LGraphCanvas.prototype.prompt=function(title,value,callback,event){var that=this;title=title||"";var dialog=document.createElement("div");dialog.className="graphdialog rounded",dialog.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",dialog.close=function(){that.prompt_box=null,dialog.parentNode.removeChild(dialog)},dialog.addEventListener("mouseleave",function(e){dialog.close()}),that.prompt_box&&that.prompt_box.close(),that.prompt_box=dialog;dialog.querySelector(".name").innerText=title,dialog.querySelector(".value").value=value;var input=dialog.querySelector("input");input.addEventListener("keydown",function(e){if(27==e.keyCode)dialog.close();else{if(13!=e.keyCode)return;callback&&callback(this.value),dialog.close()}e.preventDefault(),e.stopPropagation()}),dialog.querySelector("button").addEventListener("click",function(e){callback&&callback(input.value),that.setDirty(!0),dialog.close()});var graphcanvas=LGraphCanvas.active_canvas,canvas=graphcanvas.canvas,rect=canvas.getBoundingClientRect(),offsetx=-20,offsety=-20;return rect&&(offsetx-=rect.left,offsety-=rect.top),event?(dialog.style.left=event.pageX+offsetx+"px",dialog.style.top=event.pageY+offsety+"px"):(dialog.style.left=.5*canvas.width+offsetx+"px",dialog.style.top=.5*canvas.height+offsety+"px"),canvas.parentNode.appendChild(dialog),setTimeout(function(){input.focus()},10),dialog},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(event){function select(name){if(name)if(that.onSearchBoxSelection)that.onSearchBoxSelection(name,event,graphcanvas);else{var extra=LiteGraph.searchbox_extras[name];extra&&(name=extra.type);var node=LiteGraph.createNode(name);if(node&&(node.pos=graphcanvas.convertEventToCanvas(event),graphcanvas.graph.add(node)),extra&&extra.data){if(extra.data.properties)for(var i in extra.data.properties)node.addProperty(extra.data.properties[i][0],extra.data.properties[i][0]);if(extra.data.inputs){node.inputs=[];for(var i in extra.data.inputs)node.addOutput(extra.data.inputs[i][0],extra.data.inputs[i][1])}if(extra.data.outputs){node.outputs=[];for(var i in extra.data.outputs)node.addOutput(extra.data.outputs[i][0],extra.data.outputs[i][1])}extra.data.title&&(node.title=extra.data.title),extra.data.json&&node.configure(extra.data.json)}}dialog.close()}function changeSelection(forward){var prev=selected;selected&&selected.classList.remove("selected"),selected?(selected=forward?selected.nextSibling:selected.previousSibling)||(selected=prev):selected=forward?helper.childNodes[0]:helper.childNodes[helper.childNodes.length],selected&&(selected.classList.add("selected"),selected.scrollIntoView())}function refreshHelper(){function addResult(type,className){var help=document.createElement("div");first||(first=type),help.innerText=type,help.dataset.type=escape(type),help.className="litegraph lite-search-item",className&&(help.className+=" "+className),help.addEventListener("click",function(e){select(unescape(this.dataset.type))}),helper.appendChild(help)}timeout=null;var str=input.value;if(first=null,helper.innerHTML="",str)if(that.onSearchBox){var list=that.onSearchBox(help,str,graphcanvas);if(list)for(var i=0;i<list.length;++i)addResult(list[i])}else{var c=0;str=str.toLowerCase();for(var i in LiteGraph.searchbox_extras){var extra=LiteGraph.searchbox_extras[i];if(-1!==extra.desc.toLowerCase().indexOf(str)&&(addResult(extra.desc,"searchbox_extra"),-1!==LGraphCanvas.search_limit&&c++>LGraphCanvas.search_limit))break}if(Array.prototype.filter)for(var keys=Object.keys(LiteGraph.registered_node_types),filtered=keys.filter(function(item){return-1!==item.toLowerCase().indexOf(str)}),i=0;i<filtered.length&&(addResult(filtered[i]),!(-1!==LGraphCanvas.search_limit&&c++>LGraphCanvas.search_limit));i++);else for(var i in LiteGraph.registered_node_types)if(-1!=i.indexOf(str)&&(addResult(i),-1!==LGraphCanvas.search_limit&&c++>LGraphCanvas.search_limit))break}}var that=this,dialog=document.createElement("div");dialog.className="litegraph litesearchbox graphdialog rounded",dialog.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>",dialog.close=function(){that.search_box=null,dialog.parentNode.removeChild(dialog)},dialog.addEventListener("mouseleave",function(e){dialog.close()}),that.search_box&&that.search_box.close(),that.search_box=dialog;var helper=dialog.querySelector(".helper"),first=null,timeout=null,selected=null,input=dialog.querySelector("input");input&&(input.addEventListener("blur",function(e){this.focus()}),input.addEventListener("keydown",function(e){if(38==e.keyCode)changeSelection(!1);else if(40==e.keyCode)changeSelection(!0);else if(27==e.keyCode)dialog.close();else{if(13!=e.keyCode)return timeout&&clearInterval(timeout),void(timeout=setTimeout(refreshHelper,10));selected?select(selected.innerHTML):first?select(first):dialog.close()}e.preventDefault(),e.stopPropagation()}));var graphcanvas=LGraphCanvas.active_canvas,canvas=graphcanvas.canvas,rect=canvas.getBoundingClientRect(),offsetx=-20,offsety=-20;return rect&&(offsetx-=rect.left,offsety-=rect.top),event?(dialog.style.left=event.pageX+offsetx+"px",dialog.style.top=event.pageY+offsety+"px"):(dialog.style.left=.5*canvas.width+offsetx+"px",dialog.style.top=.5*canvas.height+offsety+"px"),canvas.parentNode.appendChild(dialog),input.focus(),dialog},LGraphCanvas.prototype.showEditPropertyValue=function(node,property,options){function inner(){setValue(input.value)}function setValue(value){"number"==typeof node.properties[property]&&(value=Number(value)),"array"==type&&(value=value.split(",").map(Number)),node.properties[property]=value,node._graph&&node._graph._version++,node.onPropertyChanged&&node.onPropertyChanged(property,value),dialog.close(),node.setDirtyCanvas(!0,!0)}if(node&&void 0!==node.properties[property]){options=options||{};var type="string";null!==node.properties[property]&&(type=typeof node.properties[property]),"object"==type&&node.properties[property].length&&(type="array");var info=null;if(node.getPropertyInfo&&(info=node.getPropertyInfo(property)),node.properties_info)for(var i=0;i<node.properties_info.length;++i)if(node.properties_info[i].name==property){info=node.properties_info[i];break}void 0!==info&&null!==info&&info.type&&(type=info.type);var input_html="";if("string"==type||"number"==type||"array"==type)input_html="<input autofocus type='text' class='value'/>";else if("enum"==type&&info.values){input_html="<select autofocus type='text' class='value'>";for(var i in info.values){var v=info.values.constructor===Array?info.values[i]:i;input_html+="<option value='"+v+"' "+(v==node.properties[property]?"selected":"")+">"+info.values[i]+"</option>"}input_html+="</select>"}else{if("boolean"!=type)return void console.warn("unknown type: "+type);input_html="<input autofocus type='checkbox' class='value' "+(node.properties[property]?"checked":"")+"/>"}var dialog=this.createDialog("<span class='name'>"+property+"</span>"+input_html+"<button>OK</button>",options);if("enum"==type&&info.values){var input=dialog.querySelector("select");input.addEventListener("change",function(e){setValue(e.target.value)})}else if("boolean"==type){var input=dialog.querySelector("input");input&&input.addEventListener("click",function(e){setValue(!!input.checked)})}else{var input=dialog.querySelector("input");input&&(input.addEventListener("blur",function(e){this.focus()}),input.value=void 0!==node.properties[property]?node.properties[property]:"",input.addEventListener("keydown",function(e){13==e.keyCode&&(inner(),e.preventDefault(),e.stopPropagation())}))}dialog.querySelector("button").addEventListener("click",inner)}},LGraphCanvas.prototype.createDialog=function(html,options){options=options||{};var dialog=document.createElement("div");dialog.className="graphdialog",dialog.innerHTML=html;var rect=this.canvas.getBoundingClientRect(),offsetx=-20,offsety=-20;return rect&&(offsetx-=rect.left,offsety-=rect.top),options.position?(offsetx+=options.position[0],offsety+=options.position[1]):options.event?(offsetx+=options.event.pageX,offsety+=options.event.pageY):(offsetx+=.5*this.canvas.width,offsety+=.5*this.canvas.height),dialog.style.left=offsetx+"px",dialog.style.top=offsety+"px",this.canvas.parentNode.appendChild(dialog),dialog.close=function(){this.parentNode&&this.parentNode.removeChild(this)},dialog},LGraphCanvas.onMenuNodeCollapse=function(value,options,e,menu,node){node.collapse()},LGraphCanvas.onMenuNodePin=function(value,options,e,menu,node){node.pin()},LGraphCanvas.onMenuNodeMode=function(value,options,e,menu,node){function inner_clicked(v){if(node)switch(v){case"On Event":node.mode=LiteGraph.ON_EVENT;break;case"On Trigger":node.mode=LiteGraph.ON_TRIGGER;break;case"Never":node.mode=LiteGraph.NEVER;break;case"Always":default:node.mode=LiteGraph.ALWAYS}}return new LiteGraph.ContextMenu(["Always","On Event","On Trigger","Never"],{event:e,callback:inner_clicked,parentMenu:menu,node:node}),!1},LGraphCanvas.onMenuNodeColors=function(value,options,e,menu,node){function inner_clicked(v){if(node){var color=v.value?LGraphCanvas.node_colors[v.value]:null;color?node.constructor===LiteGraph.LGraphGroup?node.color=color.groupcolor:(node.color=color.color,node.bgcolor=color.bgcolor):(delete node.color,delete node.bgcolor),node.setDirtyCanvas(!0,!0)}}if(!node)throw"no node for color";var values=[];values.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var i in LGraphCanvas.node_colors){var color=LGraphCanvas.node_colors[i],value={value:i,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+color.color+"; background-color:"+color.bgcolor+"'>"+i+"</span>"};values.push(value)}return new LiteGraph.ContextMenu(values,{event:e,callback:inner_clicked,parentMenu:menu,node:node}),!1},LGraphCanvas.onMenuNodeShapes=function(value,options,e,menu,node){function inner_clicked(v){node&&(node.shape=v,node.setDirtyCanvas(!0))}if(!node)throw"no node passed";return new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:e,callback:inner_clicked,parentMenu:menu,node:node}),!1},LGraphCanvas.onMenuNodeRemove=function(value,options,e,menu,node){if(!node)throw"no node passed";!1!==node.removable&&(node.graph.remove(node),node.setDirtyCanvas(!0,!0))},LGraphCanvas.onMenuNodeClone=function(value,options,e,menu,node){if(0!=node.clonable){var newnode=node.clone();newnode&&(newnode.pos=[node.pos[0]+5,node.pos[1]+5],node.graph.add(newnode),node.setDirtyCanvas(!0,!0))}},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var options=null;if(this.getMenuOptions?options=this.getMenuOptions():(options=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],this._graph_stack&&this._graph_stack.length>0&&options.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var extra=this.getExtraMenuOptions(this,options);extra&&(options=options.concat(extra))}return options},LGraphCanvas.prototype.getNodeMenuOptions=function(node){var options=null;if(options=node.getMenuOptions?node.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode},{content:"Resize",callback:LGraphCanvas.onResizeNode},{content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null],node.onGetInputs){var inputs=node.onGetInputs();inputs&&inputs.length&&(options[0].disabled=!1)}if(node.onGetOutputs){var outputs=node.onGetOutputs();outputs&&outputs.length&&(options[1].disabled=!1)}if(node.getExtraMenuOptions){var extra=node.getExtraMenuOptions(this);extra&&(extra.push(null),options=extra.concat(options))}return!1!==node.clonable&&options.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),!1!==node.removable&&options.push(null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}),node.graph&&node.graph.onGetNodeMenuOptions&&node.graph.onGetNodeMenuOptions(options,node),options},LGraphCanvas.prototype.getGroupMenuOptions=function(node){return[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}]},LGraphCanvas.prototype.processContextMenu=function(node,event){function inner_option_clicked(v,options,e){if(v){if("Remove Slot"==v.content){var info=v.slot;return void(info.input?node.removeInput(info.slot):info.output&&node.removeOutput(info.slot))}if("Disconnect Links"==v.content){var info=v.slot;return void(info.output?node.disconnectOutput(info.slot):info.input&&node.disconnectInput(info.slot))}if("Rename Slot"==v.content){var info=v.slot,slot_info=info.input?node.getInputInfo(info.slot):node.getOutputInfo(info.slot),dialog=that.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",options),input=dialog.querySelector("input");input&&slot_info&&(input.value=slot_info.label),dialog.querySelector("button").addEventListener("click",function(e){input.value&&(slot_info&&(slot_info.label=input.value),that.setDirty(!0)),dialog.close()})}}}var that=this,canvas=LGraphCanvas.active_canvas,ref_window=canvas.getCanvasWindow(),menu_info=null,options={event:event,callback:inner_option_clicked,extra:node},slot=null;if(node&&(slot=node.getSlotInPosition(event.canvasX,event.canvasY),LGraphCanvas.active_node=node),slot)menu_info=[],slot&&slot.output&&slot.output.links&&slot.output.links.length&&menu_info.push({content:"Disconnect Links",slot:slot}),menu_info.push(slot.locked?"Cannot remove":{content:"Remove Slot",slot:slot}),menu_info.push(slot.nameLocked?"Cannot rename":{content:"Rename Slot",slot:slot}),options.title=(slot.input?slot.input.type:slot.output.type)||"*",slot.input&&slot.input.type==LiteGraph.ACTION&&(options.title="Action"),slot.output&&slot.output.type==LiteGraph.EVENT&&(options.title="Event");else if(node)menu_info=this.getNodeMenuOptions(node);else{menu_info=this.getCanvasMenuOptions();var group=this.graph.getGroupOnPos(event.canvasX,event.canvasY);group&&menu_info.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:group,options:this.getGroupMenuOptions(group)}})}if(menu_info){new LiteGraph.ContextMenu(menu_info,options,ref_window)}},this.CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundRect=function(x,y,width,height,radius,radius_low){void 0===radius&&(radius=5),void 0===radius_low&&(radius_low=radius),this.moveTo(x+radius,y),this.lineTo(x+width-radius,y),this.quadraticCurveTo(x+width,y,x+width,y+radius),this.lineTo(x+width,y+height-radius_low),this.quadraticCurveTo(x+width,y+height,x+width-radius_low,y+height),this.lineTo(x+radius_low,y+height),this.quadraticCurveTo(x,y+height,x,y+height-radius_low),this.lineTo(x,y+radius),this.quadraticCurveTo(x,y,x+radius,y)}),LiteGraph.compareObjects=compareObjects,LiteGraph.distance=distance,LiteGraph.colorToString=colorToString,LiteGraph.isInsideRectangle=isInsideRectangle,LiteGraph.growBounding=growBounding,LiteGraph.isInsideBounding=isInsideBounding,LiteGraph.overlapBounding=overlapBounding,LiteGraph.hex2num=hex2num,LiteGraph.num2hex=num2hex,ContextMenu.prototype.addItem=function(name,value,options){function inner_over(e){var value=this.value;value&&value.has_submenu&&inner_onclick.call(this,e)}function inner_onclick(e){var value=this.value,close_parent=!0;if(that.current_submenu&&that.current_submenu.close(e),options.callback){var r=options.callback.call(this,value,options,e,that,options.node);!0===r&&(close_parent=!1)}if(value){if(value.callback&&!options.ignore_item_callbacks&&!0!==value.disabled){var r=value.callback.call(this,value,options,e,that,options.extra);!0===r&&(close_parent=!1)}if(value.submenu){if(!value.submenu.options)throw"ContextMenu submenu needs options";new that.constructor(value.submenu.options,{callback:value.submenu.callback,event:e,parentMenu:that,ignore_item_callbacks:value.submenu.ignore_item_callbacks,title:value.submenu.title,extra:value.submenu.extra,autoopen:options.autoopen});close_parent=!1}}close_parent&&!that.lock&&that.close()}var that=this;options=options||{};var element=document.createElement("div");element.className="litemenu-entry submenu";var disabled=!1;return null===value?element.classList.add("separator"):(element.innerHTML=value&&value.title?value.title:name,element.value=value,value&&(value.disabled&&(disabled=!0,element.classList.add("disabled")),(value.submenu||value.has_submenu)&&element.classList.add("has_submenu")),"function"==typeof value?(element.dataset.value=name,element.onclick_callback=value):element.dataset.value=value,value.className&&(element.className+=" "+value.className)),this.root.appendChild(element),disabled||element.addEventListener("click",inner_onclick),options.autoopen&&element.addEventListener("mouseenter",inner_over),element},ContextMenu.prototype.close=function(e,ignore_parent_menu){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!ignore_parent_menu&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===e?this.parentMenu.close():e&&!ContextMenu.isCursorOverElement(e,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,"mouseleave",e)),this.current_submenu&&this.current_submenu.close(e,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(element,event_name,params,origin){var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event_name,!0,!0,params),evt.srcElement=origin,element.dispatchEvent?element.dispatchEvent(evt):element.__events&&element.__events.dispatchEvent(evt),evt},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(event,element){var left=event.pageX,top=event.pageY,rect=element.getBoundingClientRect();return!!rect&&(top>rect.top&&top<rect.top+rect.height&&left>rect.left&&left<rect.left+rect.width)},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(ref_window){ref_window=ref_window||window;var elements=ref_window.document.querySelectorAll(".litecontextmenu");if(elements.length){for(var result=[],i=0;i<elements.length;i++)result.push(elements[i]);for(var i in result)result[i].close?result[i].close():result[i].parentNode&&result[i].parentNode.removeChild(result[i])}},LiteGraph.extendClass=function(target,origin){for(var i in origin)target.hasOwnProperty(i)||(target[i]=origin[i]);if(origin.prototype)for(var i in origin.prototype)origin.prototype.hasOwnProperty(i)&&(target.prototype.hasOwnProperty(i)||(origin.prototype.__lookupGetter__(i)?target.prototype.__defineGetter__(i,origin.prototype.__lookupGetter__(i)):target.prototype[i]=origin.prototype[i],origin.prototype.__lookupSetter__(i)&&target.prototype.__defineSetter__(i,origin.prototype.__lookupSetter__(i))))},LiteGraph.getParameterNames=function(func){return(func+"").replace(/[\/][\/].*$/gm,"").replace(/\s+/g,"").replace(/[\/][*][^\/*]*[*][\/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},Math.clamp=function(v,a,b){return a>v?a:b<v?b:v},"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)})}(exports),void 0!==exports&&(exports.LiteGraph=exports.LiteGraph),function(global){function Time(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}function Subgraph(){this.size=[120,80],this.subgraph=new LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onGlobalInputAdded=this.onSubgraphNewGlobalInput.bind(this),this.subgraph.onGlobalInputRenamed=this.onSubgraphRenamedGlobalInput.bind(this),this.subgraph.onGlobalInputTypeChanged=this.onSubgraphTypeChangeGlobalInput.bind(this),this.subgraph.onGlobalOutputAdded=this.onSubgraphNewGlobalOutput.bind(this),this.subgraph.onGlobalOutputRenamed=this.onSubgraphRenamedGlobalOutput.bind(this),this.subgraph.onGlobalOutputTypeChanged=this.onSubgraphTypeChangeGlobalOutput.bind(this),this.color="#335",this.bgcolor="#557"}function GlobalInput(){var input_name="input_"+(1e3*Math.random()).toFixed();this.addOutput(input_name,null),this.properties={name:input_name,type:null};var that=this;Object.defineProperty(this.properties,"name",{get:function(){return input_name},set:function(v){if(""!=v){var info=that.getOutputInfo(0);info.name!=v&&(info.name=v,that.graph&&that.graph.renameGlobalInput(input_name,v),input_name=v)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return that.outputs[0].type},set:function(v){that.outputs[0].type=v,that.graph&&that.graph.changeGlobalInputType(input_name,that.outputs[0].type)},enumerable:!0})}function GlobalOutput(){var output_name="output_"+(1e3*Math.random()).toFixed();this.addInput(output_name,null),this._value=null,this.properties={name:output_name,type:null};var that=this;Object.defineProperty(this.properties,"name",{get:function(){return output_name},set:function(v){if(""!=v){var info=that.getInputInfo(0);info.name!=v&&(info.name=v,that.graph&&that.graph.renameGlobalOutput(output_name,v),output_name=v)}},enumerable:!0}),Object.defineProperty(this.properties,"type",{get:function(){return that.inputs[0].type},set:function(v){that.inputs[0].type=v,that.graph&&that.graph.changeGlobalInputType(output_name,that.inputs[0].type)},enumerable:!0})}function Constant(){this.addOutput("value","number"),this.addProperty("value",1),this.editable={property:"value",type:"number"}}function Watch(){this.size=[60,20],this.addInput("value",0,{label:""}),this.value=0}function Pass(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,20]}function Console(){this.mode=LiteGraph.ON_EVENT,this.size=[60,20],this.addProperty("msg",""),this.addInput("log",LiteGraph.EVENT),this.addInput("msg",0)}function NodeScript(){this.size=[60,20],this.addProperty("onExecute",""),this.addInput("in",""),this.addInput("in2",""),this.addOutput("out",""),this.addOutput("out2",""),this._func=null}var LiteGraph=global.LiteGraph;Time.title="Time",Time.desc="Time",Time.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},LiteGraph.registerNodeType("basic/time",Time),Subgraph.title="Subgraph",Subgraph.desc="Graph inside a node",Subgraph.prototype.onDrawTitle=function(ctx){if(!this.flags.collapsed){ctx.fillStyle="#AAA";var w=LiteGraph.NODE_TITLE_HEIGHT,x=this.size[0]-w;ctx.fillRect(x,-w,w,w),ctx.fillStyle="#333",ctx.beginPath(),ctx.moveTo(x+.2*w,.6*-w),ctx.lineTo(x+.8*w,.6*-w),ctx.lineTo(x+.5*w,.3*-w),ctx.fill()}},Subgraph.prototype.onDblClick=function(e,pos,graphcanvas){var that=this;setTimeout(function(){graphcanvas.openSubgraph(that.subgraph)},10)},Subgraph.prototype.onMouseDown=function(e,pos,graphcanvas){if(!this.flags.collapsed&&pos[0]>this.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&pos[1]<0){var that=this;setTimeout(function(){graphcanvas.openSubgraph(that.subgraph)},10)}},Subgraph.prototype.onSubgraphNewGlobalInput=function(name,type){this.addInput(name,type)},Subgraph.prototype.onSubgraphRenamedGlobalInput=function(oldname,name){var slot=this.findInputSlot(oldname);if(-1!=slot){this.getInputInfo(slot).name=name}},Subgraph.prototype.onSubgraphTypeChangeGlobalInput=function(name,type){var slot=this.findInputSlot(name);if(-1!=slot){this.getInputInfo(slot).type=type}},Subgraph.prototype.onSubgraphNewGlobalOutput=function(name,type){this.addOutput(name,type)},Subgraph.prototype.onSubgraphRenamedGlobalOutput=function(oldname,name){var slot=this.findOutputSlot(oldname);if(-1!=slot){this.getOutputInfo(slot).name=name}},Subgraph.prototype.onSubgraphTypeChangeGlobalOutput=function(name,type){var slot=this.findOutputSlot(name);if(-1!=slot){this.getOutputInfo(slot).type=type}},Subgraph.prototype.getExtraMenuOptions=function(graphcanvas){var that=this;return[{content:"Open",callback:function(){graphcanvas.openSubgraph(that.subgraph)}}]},Subgraph.prototype.onResize=function(size){size[1]+=20},Subgraph.prototype.onExecute=function(){if(this.inputs)for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i],value=this.getInputData(i);this.subgraph.setGlobalInputData(input.name,value)}if(this.subgraph.runStep(),this.outputs)for(var i=0;i<this.outputs.length;i++){var output=this.outputs[i],value=this.subgraph.getGlobalOutputData(output.name);this.setOutputData(i,value)}},Subgraph.prototype.configure=function(o){LGraphNode.prototype.configure.call(this,o)},Subgraph.prototype.serialize=function(){var data=LGraphNode.prototype.serialize.call(this);return data.subgraph=this.subgraph.serialize(),data},Subgraph.prototype.clone=function(){var node=LiteGraph.createNode(this.type),data=this.serialize();return delete data.id,delete data.inputs,delete data.outputs,node.configure(data),node},LiteGraph.registerNodeType("graph/subgraph",Subgraph),GlobalInput.title="Input",GlobalInput.desc="Input of the graph",GlobalInput.prototype.onAdded=function(){this.graph.addGlobalInput(this.properties.name,this.properties.type)},GlobalInput.prototype.onExecute=function(){var name=this.properties.name,data=this.graph.global_inputs[name];data&&this.setOutputData(0,data.value)},LiteGraph.registerNodeType("graph/input",GlobalInput),GlobalOutput.title="Output",GlobalOutput.desc="Output of the graph",GlobalOutput.prototype.onAdded=function(){this.graph.addGlobalOutput(this.properties.name,this.properties.type)},GlobalOutput.prototype.getValue=function(){return this._value},GlobalOutput.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setGlobalOutputData(this.properties.name,this._value)},LiteGraph.registerNodeType("graph/output",GlobalOutput),Constant.title="Const",Constant.desc="Constant value",Constant.prototype.setValue=function(v){"string"==typeof v&&(v=parseFloat(v)),this.properties.value=v,this.setDirtyCanvas(!0)},Constant.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},Constant.prototype.onDrawBackground=function(ctx){this.outputs[0].label=this.properties.value.toFixed(3)},LiteGraph.registerNodeType("basic/const",Constant),Watch.title="Watch",Watch.desc="Show value of input",Watch.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},Watch.toString=function(o){if(null==o)return"null";if(o.constructor===Number)return o.toFixed(3);if(o.constructor===Array){for(var str="[",i=0;i<o.length;++i)str+=Watch.toString(o[i])+(i+1!=o.length?",":"");return str+="]"}return String(o)},Watch.prototype.onDrawBackground=function(ctx){this.inputs[0].label=Watch.toString(this.value)},LiteGraph.registerNodeType("basic/watch",Watch),Pass.title="Pass",Pass.desc="Allows to connect different types",Pass.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},LiteGraph.registerNodeType("basic/pass",Pass),Console.title="Console",Console.desc="Show value inside the console",Console.prototype.onAction=function(action,param){"log"==action?console.log(param):"warn"==action?console.warn(param):"error"==action&&console.error(param)},Console.prototype.onExecute=function(){var msg=this.getInputData(1);null!==msg&&(this.properties.msg=msg),console.log(msg)},Console.prototype.onGetInputs=function(){return[["log",LiteGraph.ACTION],["warn",LiteGraph.ACTION],["error",LiteGraph.ACTION]]},LiteGraph.registerNodeType("basic/console",Console),NodeScript.title="Script",NodeScript.desc="executes a code",NodeScript.widgets_info={onExecute:{type:"code"}},NodeScript.prototype.onPropertyChanged=function(name,value){if("onExecute"==name&&LiteGraph.allow_scripts){this._func=null;try{this._func=new Function(value)}catch(err){console.error("Error parsing script"),console.error(err)}}},NodeScript.prototype.onExecute=function(){if(this._func)try{this._func.call(this)}catch(err){console.error("Error in script"),console.error(err)}},LiteGraph.registerNodeType("basic/script",NodeScript)}(exports),function(global){function LogEvent(){this.size=[60,20],this.addInput("event",LiteGraph.ACTION)}function FilterEvent(){this.size=[60,20],this.addInput("event",LiteGraph.ACTION),this.addOutput("event",LiteGraph.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}function DelayEvent(){this.size=[60,20],this.addProperty("time",1e3),this.addInput("event",LiteGraph.ACTION),this.addOutput("on_time",LiteGraph.EVENT),this._pending=[]}function TimerEvent(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",LiteGraph.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}var LiteGraph=global.LiteGraph;LogEvent.title="Log Event",LogEvent.desc="Log event in console",LogEvent.prototype.onAction=function(action,param){console.log(action,param)},LiteGraph.registerNodeType("events/log",LogEvent),FilterEvent.title="Filter Event",FilterEvent.desc="Blocks events that do not match the filter",FilterEvent.prototype.onAction=function(action,param){if(null!=param&&(!this.properties.equal_to||this.properties.equal_to==param)){if(this.properties.has_property){var prop=param[this.properties.has_property];if(null==prop)return;if(this.properties.property_equal_to&&this.properties.property_equal_to!=prop)return}this.triggerSlot(0,param)}},LiteGraph.registerNodeType("events/filter",FilterEvent),DelayEvent.title="Delay",DelayEvent.desc="Delays one event",DelayEvent.prototype.onAction=function(action,param){this._pending.push([this.properties.time,param])},DelayEvent.prototype.onExecute=function(){for(var dt=1e3*this.graph.elapsed_time,i=0;i<this._pending.length;++i){var action=this._pending[i];action[0]-=dt,action[0]>0||(this._pending.splice(i,1),--i,this.trigger(null,action[1]))}},DelayEvent.prototype.onGetInputs=function(){return[["event",LiteGraph.ACTION]]},LiteGraph.registerNodeType("events/delay",DelayEvent),TimerEvent.title="Timer",TimerEvent.desc="Sends an event every N milliseconds",TimerEvent.prototype.onStart=function(){this.time=0},TimerEvent.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},TimerEvent.on_color="#AAA",TimerEvent.off_color="#222",TimerEvent.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?TimerEvent.on_color:TimerEvent.off_color,this.triggered=!1},TimerEvent.prototype.onExecute=function(){var dt=1e3*this.graph.elapsed_time;if(this.time+=dt,this.last_interval=Math.max(1,0|this.getInputOrProperty("interval")),this.time<this.last_interval||isNaN(this.last_interval))return void(this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1));this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},TimerEvent.prototype.onGetInputs=function(){return[["interval","number"]]},TimerEvent.prototype.onGetOutputs=function(){return[["tick","boolean"]]},LiteGraph.registerNodeType("events/timer",TimerEvent)}(exports),function(global){function WidgetButton(){this.addOutput("clicked",LiteGraph.EVENT),this.addProperty("text",""),this.addProperty("font_size",40),this.addProperty("message",""),this.size=[64,84]}function WidgetToggle(){this.addInput("","boolean"),this.addInput("e",LiteGraph.ACTION),this.addOutput("v","boolean"),this.addOutput("e",LiteGraph.EVENT),this.properties={font:"",value:!1},this.size=[124,64]}function WidgetNumber(){this.addOutput("","number"),this.size=[74,54],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}function WidgetKnob(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,wcolor:"#7AF",size:50}}function WidgetSliderGUI(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var that=this;this.size=[80,60],this.slider=this.addWidget("slider","V",this.properties.value,function(v){that.properties.value=v},this.properties)}function WidgetHSlider(){this.size=[160,26],this.addOutput("","number"),this.properties={wcolor:"#7AF",min:0,max:1,value:.5}}function WidgetProgress(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,wcolor:"#AAF"}}function WidgetText(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}function WidgetPanel(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}var LiteGraph=global.LiteGraph;WidgetButton.title="Button",WidgetButton.desc="Triggers an event",WidgetButton.font="Arial",WidgetButton.prototype.onDrawForeground=function(ctx){if(!this.flags.collapsed&&(ctx.fillStyle="black",ctx.fillRect(1,1,this.size[0]-3,this.size[1]-3),ctx.fillStyle="#AAF",ctx.fillRect(0,0,this.size[0]-3,this.size[1]-3),ctx.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",ctx.fillRect(1,1,this.size[0]-4,this.size[1]-4),this.properties.text||0===this.properties.text)){var font_size=this.properties.font_size||30;ctx.textAlign="center",ctx.fillStyle=this.clicked?"black":"white",ctx.font=font_size+"px "+WidgetButton.font,ctx.fillText(this.properties.text,.5*this.size[0],.5*this.size[1]+.3*font_size),ctx.textAlign="left"}},WidgetButton.prototype.onMouseDown=function(e,local_pos){if(local_pos[0]>1&&local_pos[1]>1&&local_pos[0]<this.size[0]-2&&local_pos[1]<this.size[1]-2)return this.clicked=!0,this.trigger("clicked",this.properties.message),!0},WidgetButton.prototype.onMouseUp=function(e){this.clicked=!1},LiteGraph.registerNodeType("widget/button",WidgetButton),WidgetToggle.title="Toggle",WidgetToggle.desc="Toggles between true or false",WidgetToggle.prototype.onDrawForeground=function(ctx){if(!this.flags.collapsed){var size=.5*this.size[1],margin=.25,h=.8*this.size[1];ctx.fillStyle="#AAA",ctx.fillRect(10,h-size,size,size),ctx.fillStyle=this.properties.value?"#AEF":"#000",ctx.fillRect(10+size*margin,h-size+size*margin,size*(1-2*margin),size*(1-2*margin)),ctx.textAlign="left",ctx.font=this.properties.font||(.8*size).toFixed(0)+"px Arial",ctx.fillStyle="#AAA",ctx.fillText(this.title,size+20,.85*h),ctx.textAlign="left"}},WidgetToggle.prototype.onAction=function(action){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},WidgetToggle.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&(this.properties.value=v),this.setOutputData(0,this.properties.value)},WidgetToggle.prototype.onMouseDown=function(e,local_pos){if(local_pos[0]>1&&local_pos[1]>1&&local_pos[0]<this.size[0]-2&&local_pos[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},LiteGraph.registerNodeType("widget/toggle",WidgetToggle),WidgetNumber.title="Number",WidgetNumber.desc="Widget to select number value",WidgetNumber.pixels_threshold=10,WidgetNumber.markers_color="#666",WidgetNumber.prototype.onDrawForeground=function(ctx){var x=.5*this.size[0],h=this.size[1];h>30?(ctx.fillStyle=WidgetNumber.markers_color,ctx.beginPath(),ctx.moveTo(x,.1*h),ctx.lineTo(x+.1*h,.2*h),ctx.lineTo(x+-.1*h,.2*h),ctx.fill(),ctx.beginPath(),ctx.moveTo(x,.9*h),ctx.lineTo(x+.1*h,.8*h),ctx.lineTo(x+-.1*h,.8*h),ctx.fill(),ctx.font=(.7*h).toFixed(1)+"px Arial"):ctx.font=(.8*h).toFixed(1)+"px Arial",ctx.textAlign="center",ctx.font=(.7*h).toFixed(1)+"px Arial",ctx.fillStyle="#EEE",ctx.fillText(this.properties.value.toFixed(this._precision),x,.75*h)},WidgetNumber.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},WidgetNumber.prototype.onPropertyChanged=function(name,value){var t=(this.properties.step+"").split(".");this._precision=t.length>1?t[1].length:0},WidgetNumber.prototype.onMouseDown=function(e,pos){if(!(pos[1]<0))return this.old_y=e.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},WidgetNumber.prototype.onMouseMove=function(e){if(this.mouse_captured){var delta=this.old_y-e.canvasY;e.shiftKey&&(delta*=10),(e.metaKey||e.altKey)&&(delta*=.1),this.old_y=e.canvasY;var steps=this._remainder+delta/WidgetNumber.pixels_threshold;this._remainder=steps%1,steps|=0;var v=Math.clamp(this.properties.value+steps*this.properties.step,this.properties.min,this.properties.max);this.properties.value=v,this.graph._version++,this.setDirtyCanvas(!0)}},WidgetNumber.prototype.onMouseUp=function(e,pos){if(e.click_time<200){var steps=pos[1]>.5*this.size[1]?-1:1;this.properties.value=Math.clamp(this.properties.value+steps*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},LiteGraph.registerNodeType("widget/number",WidgetNumber),WidgetKnob.title="Knob",WidgetKnob.desc="Circular controller",WidgetKnob.widgets=[{name:"increase",text:"+",type:"minibutton"},{name:"decrease",text:"-",type:"minibutton"}],WidgetKnob.prototype.onAdded=function(){this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min),this.imgbg=this.loadImage("imgs/knob_bg.png"),this.imgfg=this.loadImage("imgs/knob_fg.png")},WidgetKnob.prototype.onDrawImageKnob=function(ctx){if(this.imgfg&&this.imgfg.width){var d=.5*this.imgbg.width,scale=this.size[0]/this.imgfg.width;ctx.save(),ctx.translate(0,20),ctx.scale(scale,scale),ctx.drawImage(this.imgbg,0,0),ctx.translate(d,d),ctx.rotate(this.value*(2*Math.PI)*6/8+10*Math.PI/8),ctx.translate(-d,-d),ctx.drawImage(this.imgfg,0,0),ctx.restore(),this.title&&(ctx.font="bold 16px Criticized,Tahoma",ctx.fillStyle="rgba(100,100,100,0.8)",ctx.textAlign="center",ctx.fillText(this.title.toUpperCase(),.5*this.size[0],18),ctx.textAlign="left")}},WidgetKnob.prototype.onDrawVectorKnob=function(ctx){if(this.imgfg&&this.imgfg.width){ctx.lineWidth=1,ctx.strokeStyle=this.mouseOver?"#FFF":"#AAA",ctx.fillStyle="#000",ctx.beginPath(),ctx.arc(.5*this.size[0],.5*this.size[1]+10,.5*this.properties.size,0,2*Math.PI,!0),ctx.stroke(),this.value>0&&(ctx.strokeStyle=this.properties.wcolor,ctx.lineWidth=.2*this.properties.size,ctx.beginPath(),ctx.arc(.5*this.size[0],.5*this.size[1]+10,.35*this.properties.size,-.5*Math.PI+2*Math.PI*this.value,-.5*Math.PI,!0),ctx.stroke(),ctx.lineWidth=1),ctx.font=.2*this.properties.size+"px Arial",ctx.fillStyle="#AAA",ctx.textAlign="center";var str=this.properties.value;"number"==typeof str&&(str=str.toFixed(2)),ctx.fillText(str,.5*this.size[0],.65*this.size[1]),ctx.textAlign="left"}},WidgetKnob.prototype.onDrawForeground=function(ctx){this.onDrawImageKnob(ctx)},WidgetKnob.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=LiteGraph.colorToString([this.value,this.value,this.value])},WidgetKnob.prototype.onMouseDown=function(e){if(this.imgfg&&this.imgfg.width)return this.center=[.5*this.size[0],.5*this.size[1]+20],this.radius=.5*this.size[0],!(e.canvasY-this.pos[1]<20||LiteGraph.distance([e.canvasX,e.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius)&&(this.oldmouse=[e.canvasX-this.pos[0],e.canvasY-this.pos[1]],this.captureInput(!0),!0)},WidgetKnob.prototype.onMouseMove=function(e){if(this.oldmouse){var m=[e.canvasX-this.pos[0],e.canvasY-this.pos[1]],v=this.value;v-=.01*(m[1]-this.oldmouse[1]),v>1?v=1:v<0&&(v=0),this.value=v,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=m,this.setDirtyCanvas(!0)}},WidgetKnob.prototype.onMouseUp=function(e){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},WidgetKnob.prototype.onMouseLeave=function(e){},WidgetKnob.prototype.onPropertyChanged=function(name,value){if("wcolor"==name)this.properties[name]=value;else if("size"==name)value=parseInt(value),this.properties[name]=value,this.size=[value+4,value+24],this.setDirtyCanvas(!0,!0);else{if("min"!=name&&"max"!=name&&"value"!=name)return!1;this.properties[name]=parseFloat(value)}return!0},LiteGraph.registerNodeType("widget/knob",WidgetKnob),WidgetSliderGUI.title="Internal Slider",WidgetSliderGUI.prototype.onPropertyChanged=function(name,value){"value"==name&&(this.slider.value=value)},WidgetSliderGUI.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},LiteGraph.registerNodeType("widget/internal_slider",WidgetSliderGUI),WidgetHSlider.title="H.Slider",WidgetHSlider.desc="Linear slider controller",WidgetHSlider.prototype.onAdded=function(){this.value=.5,this.imgfg=this.loadImage("imgs/slider_fg.png")},WidgetHSlider.prototype.onDrawVectorial=function(ctx){this.imgfg&&this.imgfg.width&&(ctx.lineWidth=1,ctx.strokeStyle=this.mouseOver?"#FFF":"#AAA",ctx.fillStyle="#000",ctx.beginPath(),ctx.rect(2,0,this.size[0]-4,20),ctx.stroke(),ctx.fillStyle=this.properties.wcolor,ctx.beginPath(),ctx.rect(2+(this.size[0]-4-20)*this.value,0,20,20),ctx.fill())},WidgetHSlider.prototype.onDrawImage=function(ctx){this.imgfg&&this.imgfg.width&&(ctx.lineWidth=1,ctx.fillStyle="#000",ctx.fillRect(2,9,this.size[0]-4,2),ctx.strokeStyle="#333",ctx.beginPath(),ctx.moveTo(2,9),ctx.lineTo(this.size[0]-4,9),ctx.stroke(),ctx.strokeStyle="#AAA",ctx.beginPath(),ctx.moveTo(2,11),ctx.lineTo(this.size[0]-4,11),ctx.stroke(),ctx.drawImage(this.imgfg,2+(this.size[0]-4)*this.value-.5*this.imgfg.width,.5*-this.imgfg.height+10))},WidgetHSlider.prototype.onDrawForeground=function(ctx){this.onDrawImage(ctx)},WidgetHSlider.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=LiteGraph.colorToString([this.value,this.value,this.value])},WidgetHSlider.prototype.onMouseDown=function(e){return!(e.canvasY-this.pos[1]<0)&&(this.oldmouse=[e.canvasX-this.pos[0],e.canvasY-this.pos[1]],this.captureInput(!0),!0)},WidgetHSlider.prototype.onMouseMove=function(e){if(this.oldmouse){var m=[e.canvasX-this.pos[0],e.canvasY-this.pos[1]],v=this.value;v+=(m[0]-this.oldmouse[0])/this.size[0],v>1?v=1:v<0&&(v=0),this.value=v,this.oldmouse=m,this.setDirtyCanvas(!0)}},WidgetHSlider.prototype.onMouseUp=function(e){this.oldmouse=null,this.captureInput(!1)},WidgetHSlider.prototype.onMouseLeave=function(e){},WidgetHSlider.prototype.onPropertyChanged=function(name,value){return"wcolor"==name&&(this.properties[name]=value,!0)},LiteGraph.registerNodeType("widget/hslider",WidgetHSlider),WidgetProgress.title="Progress",WidgetProgress.desc="Shows data in linear progress",WidgetProgress.prototype.onExecute=function(){var v=this.getInputData(0);void 0!=v&&(this.properties.value=v)},WidgetProgress.prototype.onDrawForeground=function(ctx){ctx.lineWidth=1,ctx.fillStyle=this.properties.wcolor;var v=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);v=Math.min(1,v),v=Math.max(0,v),ctx.fillRect(2,2,(this.size[0]-4)*v,this.size[1]-4)},LiteGraph.registerNodeType("widget/progress",WidgetProgress),WidgetText.title="Text",WidgetText.desc="Shows the input value",WidgetText.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],WidgetText.prototype.onDrawForeground=function(ctx){ctx.fillStyle=this.properties.color;var v=this.properties.value;this.properties.glowSize?(ctx.shadowColor=this.properties.color,ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=this.properties.glowSize):ctx.shadowColor="transparent";var fontsize=this.properties.fontsize;if(ctx.textAlign=this.properties.align,ctx.font=fontsize.toString()+"px "+this.properties.font,this.str="number"==typeof v?v.toFixed(this.properties.decimals):v,"string"==typeof this.str){var lines=this.str.split("\\n");for(var i in lines)ctx.fillText(lines[i],"left"==this.properties.align?15:this.size[0]-15,-.15*fontsize+fontsize*(parseInt(i)+1))}ctx.shadowColor="transparent",this.last_ctx=ctx,ctx.textAlign="left"},WidgetText.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&(this.properties.value=v)},WidgetText.prototype.resize=function(){if(this.last_ctx){var lines=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;var max=0;for(var i in lines){var w=this.last_ctx.measureText(lines[i]).width;max<w&&(max=w)}this.size[0]=max+20,this.size[1]=4+lines.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},WidgetText.prototype.onPropertyChanged=function(name,value){return this.properties[name]=value,this.str="number"==typeof value?value.toFixed(3):value,!0},LiteGraph.registerNodeType("widget/text",WidgetText),WidgetPanel.title="Panel",WidgetPanel.desc="Non interactive panel",WidgetPanel.widgets=[{name:"update",text:"Update",type:"button"}],WidgetPanel.prototype.createGradient=function(ctx){if(""==this.properties.bgcolorTop||""==this.properties.bgcolorBottom)return void(this.lineargradient=0);this.lineargradient=ctx.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},WidgetPanel.prototype.onDrawForeground=function(ctx){null==this.lineargradient&&this.createGradient(ctx),this.lineargradient&&(ctx.lineWidth=1,ctx.strokeStyle=this.properties.borderColor,ctx.fillStyle=this.lineargradient,this.properties.shadowSize?(ctx.shadowColor="#000",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=this.properties.shadowSize):ctx.shadowColor="transparent",ctx.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),ctx.fill(),ctx.shadowColor="transparent",ctx.stroke())},LiteGraph.registerNodeType("widget/panel",WidgetPanel)}(exports),function(global){function GamepadInput(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",LiteGraph.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}var LiteGraph=global.LiteGraph;GamepadInput.title="Gamepad",GamepadInput.desc="gets the input of the gamepad",GamepadInput.zero=new Float32Array(2),GamepadInput.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],GamepadInput.prototype.onExecute=function(){var gamepad=this.getGamepad(),threshold=this.properties.threshold||0;if(gamepad&&(this._left_axis[0]=Math.abs(gamepad.xbox.axes.lx)>threshold?gamepad.xbox.axes.lx:0,this._left_axis[1]=Math.abs(gamepad.xbox.axes.ly)>threshold?gamepad.xbox.axes.ly:0,this._right_axis[0]=Math.abs(gamepad.xbox.axes.rx)>threshold?gamepad.xbox.axes.rx:0,this._right_axis[1]=Math.abs(gamepad.xbox.axes.ry)>threshold?gamepad.xbox.axes.ry:0,this._triggers[0]=Math.abs(gamepad.xbox.axes.ltrigger)>threshold?gamepad.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(gamepad.xbox.axes.rtrigger)>threshold?gamepad.xbox.axes.rtrigger:0),this.outputs)for(var i=0;i<this.outputs.length;i++){var output=this.outputs[i];if(output.links&&output.links.length){var v=null;if(gamepad)switch(output.name){case"left_axis":v=this._left_axis;break;case"right_axis":v=this._right_axis;break;case"left_x_axis":v=this._left_axis[0];break;case"left_y_axis":v=this._left_axis[1];break;case"right_x_axis":v=this._right_axis[0];break;case"right_y_axis":v=this._right_axis[1];break;case"trigger_left":v=this._triggers[0];break;case"trigger_right":v=this._triggers[1];break;case"a_button":v=gamepad.xbox.buttons.a?1:0;break;case"b_button":v=gamepad.xbox.buttons.b?1:0;break;case"x_button":v=gamepad.xbox.buttons.x?1:0;break;case"y_button":v=gamepad.xbox.buttons.y?1:0;break;case"lb_button":v=gamepad.xbox.buttons.lb?1:0;break;case"rb_button":v=gamepad.xbox.buttons.rb?1:0;break;case"ls_button":v=gamepad.xbox.buttons.ls?1:0;break;case"rs_button":v=gamepad.xbox.buttons.rs?1:0;break;case"start_button":v=gamepad.xbox.buttons.start?1:0;break;case"back_button":v=gamepad.xbox.buttons.back?1:0;break;case"button_pressed":for(var j=0;j<this._current_buttons.length;++j)this._current_buttons[j]&&!this._previous_buttons[j]&&this.triggerSlot(i,GamepadInput.buttons[j])}else switch(output.name){case"button_pressed":break;case"left_axis":case"right_axis":v=GamepadInput.zero;break;default:v=0}this.setOutputData(i,v)}}},GamepadInput.prototype.getGamepad=function(){var getGamepads=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!getGamepads)return null;var gamepads=getGamepads.call(navigator),gamepad=null;this._previous_buttons.set(this._current_buttons);for(var i=this.properties.gamepad_index;i<4;i++)if(gamepads[i]){gamepad=gamepads[i];var xbox=this.xbox_mapping;xbox||(xbox=this.xbox_mapping={axes:[],buttons:{},hat:""}),xbox.axes.lx=gamepad.axes[0],xbox.axes.ly=gamepad.axes[1],xbox.axes.rx=gamepad.axes[2],xbox.axes.ry=gamepad.axes[3],xbox.axes.ltrigger=gamepad.buttons[6].value,xbox.axes.rtrigger=gamepad.buttons[7].value;for(var j=0;j<gamepad.buttons.length;j++)switch(this._current_buttons[j]=gamepad.buttons[j].pressed,j){case 0:xbox.buttons.a=gamepad.buttons[j].pressed;break;case 1:xbox.buttons.b=gamepad.buttons[j].pressed;break;case 2:xbox.buttons.x=gamepad.buttons[j].pressed;break;case 3:xbox.buttons.y=gamepad.buttons[j].pressed;break;case 4:xbox.buttons.lb=gamepad.buttons[j].pressed;break;case 5:xbox.buttons.rb=gamepad.buttons[j].pressed;break;case 6:xbox.buttons.lt=gamepad.buttons[j].pressed;break;case 7:xbox.buttons.rt=gamepad.buttons[j].pressed;break;case 8:xbox.buttons.back=gamepad.buttons[j].pressed;break;case 9:xbox.buttons.start=gamepad.buttons[j].pressed;break;case 10:xbox.buttons.ls=gamepad.buttons[j].pressed;break;case 11:xbox.buttons.rs=gamepad.buttons[j].pressed;break;case 12:gamepad.buttons[j].pressed&&(xbox.hat+="up");break;case 13:gamepad.buttons[j].pressed&&(xbox.hat+="down");break;case 14:gamepad.buttons[j].pressed&&(xbox.hat+="left");break;case 15:gamepad.buttons[j].pressed&&(xbox.hat+="right");break;case 16:xbox.buttons.home=gamepad.buttons[j].pressed}return gamepad.xbox=xbox,gamepad}},GamepadInput.prototype.onDrawBackground=function(ctx){if(!this.flags.collapsed){var la=this._left_axis,ra=this._right_axis;ctx.strokeStyle="#88A",ctx.strokeRect(.5*(la[0]+1)*this.size[0]-4,.5*(la[1]+1)*this.size[1]-4,8,8),ctx.strokeStyle="#8A8",ctx.strokeRect(.5*(ra[0]+1)*this.size[0]-4,.5*(ra[1]+1)*this.size[1]-4,8,8);var h=this.size[1]/this._current_buttons.length;ctx.fillStyle="#AEB";for(var i=0;i<this._current_buttons.length;++i)this._current_buttons[i]&&ctx.fillRect(0,h*i,6,h)}},GamepadInput.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start","number"],["back","number"],["button_pressed",LiteGraph.EVENT]]},LiteGraph.registerNodeType("input/gamepad",GamepadInput)}(exports),function(global){function Converter(){this.addInput("in","*"),this.size=[60,20]}function Bypass(){this.addInput("in"),this.addOutput("out"),this.size=[60,20]}function MathRange(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[80,20]}function MathRand(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[60,20]}function MathClamp(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[60,20],this.addProperty("min",0),this.addProperty("max",1)}function MathLerp(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}function MathAbs(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[60,20]}function MathFloor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[60,20]}function MathFrac(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[60,20]}function MathSmoothStep(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[60,20],this.properties={A:0,B:1}}function MathScale(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[60,20],this.addProperty("factor",1)}function MathAverageFilter(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[60,20],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}function MathTendTo(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[60,20],this._value=null}function MathOperation(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:MathOperation.values})}function MathCompare(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}function MathCondition(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","string",{values:MathCondition.values}),this.size=[60,40]}function MathAccumulate(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}function MathTrigonometry(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}function MathFormula(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.addWidget("toggle","allow",LiteGraph.allow_scripts,function(v){LiteGraph.allow_scripts=v}),this._func=null}function Math3DVec2ToXYZ(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}function Math3DXYToVec2(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}function Math3DVec3ToXYZ(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}function Math3DXYZToVec3(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}function Math3DVec4ToXYZW(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}function Math3DXYZWToVec4(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}function Math3DQuaternion(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1},this._value=quat.create()}function Math3DRotation(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()}function Math3DRotateVec3(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}}function Math3DMultQuat(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()}function Math3DQuatSlerp(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()}var LiteGraph=global.LiteGraph;Converter.title="Converter",Converter.desc="type A to type B",Converter.prototype.onExecute=function(){var v=this.getInputData(0);if(null!=v&&this.outputs)for(var i=0;i<this.outputs.length;i++){var output=this.outputs[i];if(output.links&&output.links.length){var result=null;switch(output.name){case"number":result=v.length?v[0]:parseFloat(v);break;case"vec2":case"vec3":case"vec4":var result=null,count=1;switch(output.name){case"vec2":count=2;break;case"vec3":count=3;break;case"vec4":count=4}var result=new Float32Array(count);if(v.length)for(var j=0;j<v.length&&j<result.length;j++)result[j]=v[j];else result[0]=parseFloat(v)}this.setOutputData(i,result)}}},Converter.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},LiteGraph.registerNodeType("math/converter",Converter),Bypass.title="Bypass",Bypass.desc="removes the type",Bypass.prototype.onExecute=function(){var v=this.getInputData(0);this.setOutputData(0,v)},LiteGraph.registerNodeType("math/bypass",Bypass),MathRange.title="Range",MathRange.desc="Convert a number from one range to another",MathRange.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},MathRange.prototype.onExecute=function(){if(this.inputs)for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i],v=this.getInputData(i);void 0!==v&&(this.properties[input.name]=v)}var v=this.properties.in;void 0!==v&&null!==v&&v.constructor===Number||(v=0);var in_min=this.properties.in_min,in_max=this.properties.in_max,out_min=this.properties.out_min,out_max=this.properties.out_max;this._last_v=(v-in_min)/(in_max-in_min)*(out_max-out_min)+out_min,this.setOutputData(0,this._last_v)},MathRange.prototype.onDrawBackground=function(ctx){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},MathRange.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},LiteGraph.registerNodeType("math/range",MathRange),MathRand.title="Rand",MathRand.desc="Random number",MathRand.prototype.onExecute=function(){if(this.inputs)for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i],v=this.getInputData(i);void 0!==v&&(this.properties[input.name]=v)}var min=this.properties.min,max=this.properties.max;this._last_v=Math.random()*(max-min)+min,this.setOutputData(0,this._last_v)},MathRand.prototype.onDrawBackground=function(ctx){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},MathRand.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},LiteGraph.registerNodeType("math/rand",MathRand),MathClamp.title="Clamp",MathClamp.desc="Clamp number between min and max",MathClamp.filter="shader",MathClamp.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&(v=Math.max(this.properties.min,v),v=Math.min(this.properties.max,v),this.setOutputData(0,v))},MathClamp.prototype.getCode=function(lang){var code="";return this.isInputConnected(0)&&(code+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),code},LiteGraph.registerNodeType("math/clamp",MathClamp),MathLerp.title="Lerp",MathLerp.desc="Linear Interpolation",MathLerp.prototype.onExecute=function(){var v1=this.getInputData(0);null==v1&&(v1=0);var v2=this.getInputData(1);null==v2&&(v2=0);var f=this.properties.f,_f=this.getInputData(2);void 0!==_f&&(f=_f),this.setOutputData(0,v1*(1-f)+v2*f)},MathLerp.prototype.onGetInputs=function(){return[["f","number"]]},LiteGraph.registerNodeType("math/lerp",MathLerp),MathAbs.title="Abs",MathAbs.desc="Absolute",MathAbs.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&this.setOutputData(0,Math.abs(v))},LiteGraph.registerNodeType("math/abs",MathAbs),MathFloor.title="Floor",MathFloor.desc="Floor number to remove fractional part",MathFloor.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&this.setOutputData(0,Math.floor(v))},LiteGraph.registerNodeType("math/floor",MathFloor),MathFrac.title="Frac",MathFrac.desc="Returns fractional part",MathFrac.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&this.setOutputData(0,v%1)},LiteGraph.registerNodeType("math/frac",MathFrac),MathSmoothStep.title="Smoothstep",MathSmoothStep.desc="Smoothstep",MathSmoothStep.prototype.onExecute=function(){var v=this.getInputData(0);if(void 0!==v){var edge0=this.properties.A,edge1=this.properties.B;v=Math.clamp((v-edge0)/(edge1-edge0),0,1),v=v*v*(3-2*v),this.setOutputData(0,v)}},LiteGraph.registerNodeType("math/smoothstep",MathSmoothStep),MathScale.title="Scale",MathScale.desc="v * factor",MathScale.prototype.onExecute=function(){var value=this.getInputData(0);null!=value&&this.setOutputData(0,value*this.properties.factor)},LiteGraph.registerNodeType("math/scale",MathScale),MathAverageFilter.title="Average",MathAverageFilter.desc="Average Filter",MathAverageFilter.prototype.onExecute=function(){var v=this.getInputData(0);null==v&&(v=0);var num_samples=this._values.length;this._values[this._current%num_samples]=v,this._current+=1,this._current>num_samples&&(this._current=0);for(var avr=0,i=0;i<num_samples;++i)avr+=this._values[i];this.setOutputData(0,avr/num_samples)},MathAverageFilter.prototype.onPropertyChanged=function(name,value){value<1&&(value=1),this.properties.samples=Math.round(value);var old=this._values;this._values=new Float32Array(this.properties.samples),old.length<=this._values.length?this._values.set(old):this._values.set(old.subarray(0,this._values.length))},LiteGraph.registerNodeType("math/average",MathAverageFilter),MathTendTo.title="TendTo",MathTendTo.desc="moves the output value always closer to the input",MathTendTo.prototype.onExecute=function(){var v=this.getInputData(0);null==v&&(v=0);var f=this.properties.factor;null==this._value?this._value=v:this._value=this._value*(1-f)+v*f,this.setOutputData(0,this._value)},LiteGraph.registerNodeType("math/tendTo",MathTendTo),MathOperation.values=["+","-","*","/","%","^"],MathOperation.title="Operation",MathOperation.desc="Easy math operators",MathOperation["@OP"]={type:"enum",title:"operation",values:MathOperation.values},MathOperation.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},MathOperation.prototype.setValue=function(v){"string"==typeof v&&(v=parseFloat(v)),this.properties.value=v},MathOperation.prototype.onExecute=function(){var A=this.getInputData(0),B=this.getInputData(1);null!=A?this.properties.A=A:A=this.properties.A,null!=B?this.properties.B=B:B=this.properties.B;var result=0;switch(this.properties.OP){case"+":result=A+B;break;case"-":result=A-B;break;case"x":case"X":case"*":result=A*B;break;case"/":result=A/B;break;case"%":result=A%B;break;case"^":result=Math.pow(A,B);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,result)},MathOperation.prototype.onDrawBackground=function(ctx){this.flags.collapsed||(ctx.font="40px Arial",ctx.fillStyle="#CCC",ctx.textAlign="center",ctx.fillText(this.properties.OP,.5*this.size[0],.35*this.size[1]+LiteGraph.NODE_TITLE_HEIGHT),ctx.textAlign="left")},LiteGraph.registerNodeType("math/operation",MathOperation),MathCompare.title="Compare",MathCompare.desc="compares between two values",MathCompare.prototype.onExecute=function(){var A=this.getInputData(0),B=this.getInputData(1);void 0!==A?this.properties.A=A:A=this.properties.A,void 0!==B?this.properties.B=B:B=this.properties.B;for(var i=0,l=this.outputs.length;i<l;++i){var output=this.outputs[i];if(output.links&&output.links.length){switch(output.name){case"A==B":value=A==B;break;case"A!=B":value=A!=B;break;case"A>B":value=A>B;break;case"A<B":value=A<B;break;case"A<=B":value=A<=B;break;case"A>=B":value=A>=B}this.setOutputData(i,value)}}},MathCompare.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},LiteGraph.registerNodeType("math/compare",MathCompare),LiteGraph.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),LiteGraph.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),LiteGraph.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),LiteGraph.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),LiteGraph.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),LiteGraph.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"}),MathCondition.values=[">","<","==","!=","<=",">="],MathCondition["@OP"]={type:"enum",title:"operation",values:MathCondition.values},MathCondition.title="Condition",MathCondition.desc="evaluates condition between A and B",MathCondition.prototype.onExecute=function(){var A=this.getInputData(0);void 0===A?A=this.properties.A:this.properties.A=A;var B=this.getInputData(1);void 0===B?B=this.properties.B:this.properties.B=B;var result=!0;switch(this.properties.OP){case">":result=A>B;break;case"<":result=A<B;break;case"==":result=A==B;break;case"!=":result=A!=B;break;case"<=":result=A<=B;break;case">=":result=A>=B}this.setOutputData(0,result)},LiteGraph.registerNodeType("math/condition",MathCondition),MathAccumulate.title="Accumulate",MathAccumulate.desc="Increments a value every time",MathAccumulate.prototype.onExecute=function(){null===this.properties.value&&(this.properties.value=0);var inc=this.getInputData(0);this.properties.value+=null!==inc?inc:this.properties.increment,this.setOutputData(0,this.properties.value)},LiteGraph.registerNodeType("math/accumulate",MathAccumulate),MathTrigonometry.title="Trigonometry",MathTrigonometry.desc="Sin Cos Tan",MathTrigonometry.filter="shader",MathTrigonometry.prototype.onExecute=function(){var v=this.getInputData(0);null==v&&(v=0);var amplitude=this.properties.amplitude,slot=this.findInputSlot("amplitude");-1!=slot&&(amplitude=this.getInputData(slot));var offset=this.properties.offset;-1!=(slot=this.findInputSlot("offset"))&&(offset=this.getInputData(slot));for(var i=0,l=this.outputs.length;i<l;++i){switch(this.outputs[i].name){case"sin":value=Math.sin(v);break;case"cos":value=Math.cos(v);break;case"tan":value=Math.tan(v);break;case"asin":value=Math.asin(v);break;case"acos":value=Math.acos(v);break;case"atan":value=Math.atan(v)}this.setOutputData(i,amplitude*value+offset)}},MathTrigonometry.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},MathTrigonometry.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},LiteGraph.registerNodeType("math/trigonometry",MathTrigonometry),LiteGraph.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),LiteGraph.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),LiteGraph.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"}),MathFormula.title="Formula",MathFormula.desc="Compute formula",MathFormula.prototype.onExecute=function(){if(LiteGraph.allow_scripts){var x=this.getInputData(0),y=this.getInputData(1);null!=x?this.properties.x=x:x=this.properties.x,null!=y?this.properties.y=y:y=this.properties.y;this.properties.formula;this._func&&this._func_code==this.properties.formula||(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula);var value=this._func(x,y,this.graph.globaltime);this.setOutputData(0,value)}},MathFormula.prototype.getTitle=function(){return this._func_code||""},MathFormula.prototype.onDrawBackground=function(){var f=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=f)},LiteGraph.registerNodeType("math/formula",MathFormula),Math3DVec2ToXYZ.title="Vec2->XY",Math3DVec2ToXYZ.desc="vector 2 to components",Math3DVec2ToXYZ.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&(this.setOutputData(0,v[0]),this.setOutputData(1,v[1]))},LiteGraph.registerNodeType("math3d/vec2-to-xyz",Math3DVec2ToXYZ),Math3DXYToVec2.title="XY->Vec2",Math3DXYToVec2.desc="components to vector2",Math3DXYToVec2.prototype.onExecute=function(){var x=this.getInputData(0);null==x&&(x=this.properties.x);var y=this.getInputData(1);null==y&&(y=this.properties.y);var data=this._data;data[0]=x,data[1]=y,this.setOutputData(0,data)},LiteGraph.registerNodeType("math3d/xy-to-vec2",Math3DXYToVec2),Math3DVec3ToXYZ.title="Vec3->XYZ",Math3DVec3ToXYZ.desc="vector 3 to components",Math3DVec3ToXYZ.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&(this.setOutputData(0,v[0]),this.setOutputData(1,v[1]),this.setOutputData(2,v[2]))},LiteGraph.registerNodeType("math3d/vec3-to-xyz",Math3DVec3ToXYZ),Math3DXYZToVec3.title="XYZ->Vec3",Math3DXYZToVec3.desc="components to vector3",Math3DXYZToVec3.prototype.onExecute=function(){var x=this.getInputData(0);null==x&&(x=this.properties.x);var y=this.getInputData(1);null==y&&(y=this.properties.y);var z=this.getInputData(2);null==z&&(z=this.properties.z);var data=this._data;data[0]=x,data[1]=y,data[2]=z,this.setOutputData(0,data)},LiteGraph.registerNodeType("math3d/xyz-to-vec3",Math3DXYZToVec3),Math3DVec4ToXYZW.title="Vec4->XYZW",Math3DVec4ToXYZW.desc="vector 4 to components",Math3DVec4ToXYZW.prototype.onExecute=function(){var v=this.getInputData(0);null!=v&&(this.setOutputData(0,v[0]),this.setOutputData(1,v[1]),this.setOutputData(2,v[2]),this.setOutputData(3,v[3]))},LiteGraph.registerNodeType("math3d/vec4-to-xyzw",Math3DVec4ToXYZW),Math3DXYZWToVec4.title="XYZW->Vec4",Math3DXYZWToVec4.desc="components to vector4",Math3DXYZWToVec4.prototype.onExecute=function(){var x=this.getInputData(0);null==x&&(x=this.properties.x);var y=this.getInputData(1);null==y&&(y=this.properties.y);var z=this.getInputData(2);null==z&&(z=this.properties.z);var w=this.getInputData(3);null==w&&(w=this.properties.w);var data=this._data;data[0]=x,data[1]=y,data[2]=z,data[3]=w,this.setOutputData(0,data)},LiteGraph.registerNodeType("math3d/xyzw-to-vec4",Math3DXYZWToVec4),global.glMatrix&&(Math3DQuaternion.title="Quaternion",Math3DQuaternion.desc="quaternion",Math3DQuaternion.prototype.onExecute=function(){this._value[0]=this.properties.x,this._value[1]=this.properties.y,this._value[2]=this.properties.z,this._value[3]=this.properties.w,this.setOutputData(0,this._value)},LiteGraph.registerNodeType("math3d/quaternion",Math3DQuaternion),Math3DRotation.title="Rotation",Math3DRotation.desc="quaternion rotation",Math3DRotation.prototype.onExecute=function(){var angle=this.getInputData(0);null==angle&&(angle=this.properties.angle);var axis=this.getInputData(1);null==axis&&(axis=this.properties.axis);var R=quat.setAxisAngle(this._value,axis,.0174532925*angle);this.setOutputData(0,R)},LiteGraph.registerNodeType("math3d/rotation",Math3DRotation),Math3DRotateVec3.title="Rot. Vec3",Math3DRotateVec3.desc="rotate a point",Math3DRotateVec3.prototype.onExecute=function(){var vec=this.getInputData(0);null==vec&&(vec=this.properties.vec);var quat=this.getInputData(1);null==quat?this.setOutputData(vec):this.setOutputData(0,vec3.transformQuat(vec3.create(),vec,quat))},LiteGraph.registerNodeType("math3d/rotate_vec3",Math3DRotateVec3),Math3DMultQuat.title="Mult. Quat",Math3DMultQuat.desc="rotate quaternion",Math3DMultQuat.prototype.onExecute=function(){var A=this.getInputData(0);if(null!=A){var B=this.getInputData(1);if(null!=B){var R=quat.multiply(this._value,A,B);this.setOutputData(0,R)}}},LiteGraph.registerNodeType("math3d/mult-quat",Math3DMultQuat),Math3DQuatSlerp.title="Quat Slerp",Math3DQuatSlerp.desc="quaternion spherical interpolation",Math3DQuatSlerp.prototype.onExecute=function(){var A=this.getInputData(0);if(null!=A){var B=this.getInputData(1);if(null!=B){var factor=this.properties.factor;null!=this.getInputData(2)&&(factor=this.getInputData(2));var R=quat.slerp(this._value,A,B,factor);this.setOutputData(0,R)}}},LiteGraph.registerNodeType("math3d/quat-slerp",Math3DQuatSlerp))}(exports),function(global){function Selector(){this.addInput("sel","boolean"),this.addOutput("value","number"),this.properties={A:0,B:1},this.size=[60,20]}var LiteGraph=global.LiteGraph;Selector.title="Selector",Selector.desc="outputs A if selector is true, B if selector is false",Selector.prototype.onExecute=function(){var cond=this.getInputData(0);if(void 0!==cond){for(var i=1;i<this.inputs.length;i++){var input=this.inputs[i],v=this.getInputData(i);void 0!==v&&(this.properties[input.name]=v)}var A=this.properties.A,B=this.properties.B;this.setOutputData(0,cond?A:B)}},Selector.prototype.onGetInputs=function(){return[["A",0],["B",0]]},LiteGraph.registerNodeType("logic/selector",Selector)}(exports),function(global){function GraphicsPlot(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}function GraphicsImage(){this.addOutput("frame","image"),this.properties={url:""}}function ColorPalette(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}function ImageFrame(){this.addInput("","image"),this.size=[200,200]}function ImageFade(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}function ImageCrop(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}function ImageVideo(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}function ImageWebcam(){this.addOutput("Webcam","image"),this.properties={facingMode:"user"},this.boxcolor="black",this.frame=0}var LiteGraph=global.LiteGraph;GraphicsPlot.title="Plot",GraphicsPlot.desc="Plots data over time",GraphicsPlot.colors=["#FFF","#F99","#9F9","#99F"],GraphicsPlot.prototype.onExecute=function(ctx){if(!this.flags.collapsed)for(var size=this.size,i=0;i<4;++i){var v=this.getInputData(i);if(null!=v){var values=this.values[i];values.push(v),values.length>size[0]&&values.shift()}}},GraphicsPlot.prototype.onDrawBackground=function(ctx){if(!this.flags.collapsed){var size=this.size,scale=.5*size[1]/this.properties.scale,colors=GraphicsPlot.colors,offset=.5*size[1];if(ctx.fillStyle="#000",ctx.fillRect(0,0,size[0],size[1]),ctx.strokeStyle="#555",ctx.beginPath(),ctx.moveTo(0,offset),ctx.lineTo(size[0],offset),ctx.stroke(),this.inputs)for(var i=0;i<4;++i){var values=this.values[i];if(this.inputs[i]&&this.inputs[i].link){ctx.strokeStyle=colors[i],ctx.beginPath();var v=values[0]*scale*-1+offset;ctx.moveTo(0,Math.clamp(v,0,size[1]));for(var j=1;j<values.length&&j<size[0];++j){var v=values[j]*scale*-1+offset;ctx.lineTo(j,Math.clamp(v,0,size[1]))}ctx.stroke()}}}},LiteGraph.registerNodeType("graphics/plot",GraphicsPlot),GraphicsImage.title="Image",GraphicsImage.desc="Image loader",GraphicsImage.widgets=[{name:"load",text:"Load",type:"button"}],GraphicsImage.supported_extensions=["jpg","jpeg","png","gif"],GraphicsImage.prototype.onAdded=function(){""!=this.properties.url&&null==this.img&&this.loadImage(this.properties.url)},GraphicsImage.prototype.onDrawBackground=function(ctx){this.img&&this.size[0]>5&&this.size[1]>5&&ctx.drawImage(this.img,0,0,this.size[0],this.size[1])},GraphicsImage.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},GraphicsImage.prototype.onPropertyChanged=function(name,value){return this.properties[name]=value,"url"==name&&""!=value&&this.loadImage(value),!0},GraphicsImage.prototype.loadImage=function(url,callback){if(""==url)return void(this.img=null);this.img=document.createElement("img"),"http"==url.substr(0,4)&&LiteGraph.proxy&&(url=LiteGraph.proxy+url.substr(url.indexOf(":")+3)),this.img.src=url,this.boxcolor="#F95";var that=this;this.img.onload=function(){callback&&callback(this),that.trace("Image loaded, size: "+that.img.width+"x"+that.img.height),this.dirty=!0,that.boxcolor="#9F9",that.setDirtyCanvas(!0)}},GraphicsImage.prototype.onWidget=function(e,widget){"load"==widget.name&&this.loadImage(this.properties.url)},GraphicsImage.prototype.onDropFile=function(file){var that=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(file),this.properties.url=this._url,this.loadImage(this._url,function(img){that.size[1]=img.height/img.width*that.size[0]})},LiteGraph.registerNodeType("graphics/image",GraphicsImage),ColorPalette.title="Palette",ColorPalette.desc="Generates a color",ColorPalette.prototype.onExecute=function(){var c=[];null!=this.properties.colorA&&c.push(hex2num(this.properties.colorA)),null!=this.properties.colorB&&c.push(hex2num(this.properties.colorB)),null!=this.properties.colorC&&c.push(hex2num(this.properties.colorC)),null!=this.properties.colorD&&c.push(hex2num(this.properties.colorD));var f=this.getInputData(0);if(null==f&&(f=.5),f>1?f=1:f<0&&(f=0),0!=c.length){var result=[0,0,0];if(0==f)result=c[0];else if(1==f)result=c[c.length-1];else{var pos=(c.length-1)*f,c1=c[Math.floor(pos)],c2=c[Math.floor(pos)+1],t=pos-Math.floor(pos);result[0]=c1[0]*(1-t)+c2[0]*t,result[1]=c1[1]*(1-t)+c2[1]*t,result[2]=c1[2]*(1-t)+c2[2]*t}for(var i in result)result[i]/=255;this.boxcolor=colorToString(result),this.setOutputData(0,result)}},LiteGraph.registerNodeType("color/palette",ColorPalette),ImageFrame.title="Frame",ImageFrame.desc="Frame viewerew",ImageFrame.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],ImageFrame.prototype.onDrawBackground=function(ctx){this.frame&&ctx.drawImage(this.frame,0,0,this.size[0],this.size[1])},ImageFrame.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},ImageFrame.prototype.onWidget=function(e,widget){if("resize"==widget.name&&this.frame){var width=this.frame.width,height=this.frame.height;width||null==this.frame.videoWidth||(width=this.frame.videoWidth,height=this.frame.videoHeight),width&&height&&(this.size=[width,height]),this.setDirtyCanvas(!0,!0)}else"view"==widget.name&&this.show()},ImageFrame.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},LiteGraph.registerNodeType("graphics/frame",ImageFrame),ImageFade.title="Image fade",ImageFade.desc="Fades between images",ImageFade.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],ImageFade.prototype.onAdded=function(){this.createCanvas();var ctx=this.canvas.getContext("2d");ctx.fillStyle="#000",ctx.fillRect(0,0,this.properties.width,this.properties.height)},ImageFade.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},ImageFade.prototype.onExecute=function(){var ctx=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var A=this.getInputData(0);null!=A&&ctx.drawImage(A,0,0,this.canvas.width,this.canvas.height);var fade=this.getInputData(2);null==fade?fade=this.properties.fade:this.properties.fade=fade,ctx.globalAlpha=fade;var B=this.getInputData(1);null!=B&&ctx.drawImage(B,0,0,this.canvas.width,this.canvas.height),ctx.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},LiteGraph.registerNodeType("graphics/imagefade",ImageFade),ImageCrop.title="Crop",ImageCrop.desc="Crop Image",ImageCrop.prototype.onAdded=function(){this.createCanvas()},ImageCrop.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},ImageCrop.prototype.onExecute=function(){var input=this.getInputData(0);if(input)if(input.width){var ctx=this.canvas.getContext("2d");ctx.drawImage(input,-this.properties.x,-this.properties.y,input.width*this.properties.scale,input.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},ImageCrop.prototype.onDrawBackground=function(ctx){this.flags.collapsed||this.canvas&&ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},ImageCrop.prototype.onPropertyChanged=function(name,value){return this.properties[name]=value,"scale"==name?(this.properties[name]=parseFloat(value),0==this.properties[name]&&(this.trace("Error in scale"),this.properties[name]=1)):this.properties[name]=parseInt(value),this.createCanvas(),!0},LiteGraph.registerNodeType("graphics/cropImage",ImageCrop),ImageVideo.title="Video",ImageVideo.desc="Video playback",ImageVideo.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],ImageVideo.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),this._video&&0!=this._video.width)){var t=this.getInputData(0);t&&t>=0&&t<=1&&(this._video.currentTime=t*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},ImageVideo.prototype.onStart=function(){this.play()},ImageVideo.prototype.onStop=function(){this.stop()},ImageVideo.prototype.loadVideo=function(url){this._video_url=url,this.properties.use_proxy&&"http"==url.substr(0,4)&&LiteGraph.proxy&&(url=LiteGraph.proxy+url.substr(url.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=url,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var that=this;this._video.addEventListener("loadedmetadata",function(e){that.trace("Duration: "+this.duration+" seconds"),that.trace("Size: "+this.videoWidth+","+this.videoHeight),that.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(e){}),this._video.addEventListener("error",function(e){if(console.log("Error loading video: "+this.src),that.trace("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:that.trace("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:that.trace("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:that.trace("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:that.trace("Sorry, your browser can't play this video.")}}),this._video.addEventListener("ended",function(e){that.trace("Ended."),this.play()})},ImageVideo.prototype.onPropertyChanged=function(name,value){return this.properties[name]=value,"url"==name&&""!=value&&this.loadVideo(value),!0},ImageVideo.prototype.play=function(){this._video&&this._video.play()},ImageVideo.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},ImageVideo.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},ImageVideo.prototype.pause=function(){this._video&&(this.trace("Video paused"),this._video.pause())},ImageVideo.prototype.onWidget=function(e,widget){},LiteGraph.registerNodeType("graphics/video",ImageVideo),ImageWebcam.title="Webcam",ImageWebcam.desc="Webcam image",ImageWebcam.prototype.openStream=function(){function onFailSoHard(e){console.log("Webcam rejected",e),that._webcam_stream=!1,that.boxcolor="red",that.trigger("stream_error")}if(navigator.getUserMedia){this._waiting_confirmation=!0;var constraints={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(constraints).then(this.streamReady.bind(this)).catch(onFailSoHard);var that=this}},ImageWebcam.prototype.closeStream=function(){if(this._webcam_stream){var tracks=this._webcam_stream.getTracks();if(tracks.length)for(var i=0;i<tracks.length;++i)tracks[i].stop();this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},ImageWebcam.prototype.onPropertyChanged=function(name,value){"facingMode"==name&&(this.properties.facingMode=value,this.closeStream(),this.openStream())},ImageWebcam.prototype.onRemoved=function(){this.closeStream()},ImageWebcam.prototype.streamReady=function(localMediaStream){this._webcam_stream=localMediaStream,this.boxcolor="green";var video=this._video;video||(video=document.createElement("video"),video.autoplay=!0,video.srcObject=localMediaStream,this._video=video,video.onloadedmetadata=function(e){console.log(e)}),this.trigger("stream_ready",video)},ImageWebcam.prototype.onExecute=function(){if(null!=this._webcam_stream||this._waiting_confirmation||this.openStream(),this._video&&this._video.videoWidth){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var i=1;i<this.outputs.length;++i)if(this.outputs[i])switch(this.outputs[i].name){case"width":this.setOutputData(i,this._video.videoWidth);break;case"height":this.setOutputData(i,this._video.videoHeight)}}},ImageWebcam.prototype.getExtraMenuOptions=function(graphcanvas){var that=this;return[{content:that.properties.show?"Hide Frame":"Show Frame",callback:function(){that.properties.show=!that.properties.show}}]},ImageWebcam.prototype.onDrawBackground=function(ctx){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(ctx.save(),ctx.drawImage(this._video,0,0,this.size[0],this.size[1]),ctx.restore())},ImageWebcam.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",LiteGraph.EVENT],["stream_closed",LiteGraph.EVENT],["stream_error",LiteGraph.EVENT]]},LiteGraph.registerNodeType("graphics/webcam",ImageWebcam)}(exports),function(global){function LGraphTexture(){this.addOutput("Texture","Texture"),this.properties={name:"",filter:!0},this.size=[LGraphTexture.image_preview_size,LGraphTexture.image_preview_size]}function LGraphTexturePreview(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[LGraphTexture.image_preview_size,LGraphTexture.image_preview_size]}function LGraphTextureSave(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={name:""}}function LGraphTextureOperation(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3</p>\t\t\t<p>uvcode must be vec2, is optional</p>\t\t\t<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture</p><p><strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time</p><p><strong>value:</strong> input value</p>",this.properties={value:1,uvcode:"",pixelcode:"color + colorB * value",precision:LGraphTexture.DEFAULT}}function LGraphTextureShader(){this.addOutput("out","Texture"),this.properties={code:"",width:512,height:512,precision:LGraphTexture.DEFAULT},this.properties.code="\nvoid main() {\n  vec2 uv = v_coord;\n  vec3 color = vec3(0.0);\n//your code here\n\ngl_FragColor = vec4(color, 1.0);\n}\n",this._uniforms={in_texture:0,texSize:vec2.create(),time:0}}function LGraphTextureScaleOffset(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:LGraphTexture.DEFAULT}}function LGraphTextureWarp(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,precision:LGraphTexture.DEFAULT}}function LGraphTextureToViewport(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1},this.size[0]=130}function LGraphTextureCopy(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:LGraphTexture.DEFAULT}}function LGraphTextureDownsample(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:LGraphTexture.DEFAULT}}function LGraphTextureAverage(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={mipmap_offset:0,low_precision:!1},this._uniforms={u_texture:0,u_mipmap_offset:this.properties.mipmap_offset},this._luminance=new Float32Array(4)}function LGraphImageToTexture(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}function LGraphTextureLUT(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={intensity:1,precision:LGraphTexture.DEFAULT,texture:null},LGraphTextureLUT._shader||(LGraphTextureLUT._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureLUT.pixel_shader))}function LGraphTextureChannels(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),this.properties={},LGraphTextureChannels._shader||(LGraphTextureChannels._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureChannels.pixel_shader))}function LGraphChannelsTexture(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={},LGraphChannelsTexture._shader||(LGraphChannelsTexture._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphChannelsTexture.pixel_shader))}function LGraphTextureColor(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:LGraphTexture.DEFAULT}}function LGraphTextureGradient(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},LGraphTextureGradient._shader||(LGraphTextureGradient._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureGradient.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}function LGraphTextureMix(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,precision:LGraphTexture.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}function LGraphTextureEdges(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:LGraphTexture.DEFAULT},LGraphTextureEdges._shader||(LGraphTextureEdges._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureEdges.pixel_shader))}function LGraphTextureDepthRange(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}function LGraphTextureBlur(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:LGraphTexture.DEFAULT}}function LGraphTextureGlow(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:LGraphTexture.DEFAULT},this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}function LGraphTextureKuwaharaFilter(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}function LGraphTextureWebcam(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}function LGraphLensFX(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:LGraphTexture.LOW},this._uniforms={u_texture:0,u_factor:1}}function LGraphExposition(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:LGraphTexture.LOW},this._uniforms={u_texture:0,u_exposition:1}}function LGraphToneMapping(){this.addInput("in","Texture"),this.addInput("avg","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:LGraphTexture.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}function LGraphTexturePerlin(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:LGraphTexture.DEFAULT},this._key=0,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}function LGraphTextureCanvas2D(){this.addOutput("out","Texture"),this.properties={code:"",width:512,height:512,precision:LGraphTexture.DEFAULT},this._func=null,this._temp_texture=null}function LGraphTextureMatte(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:LGraphTexture.DEFAULT}}function LGraphCubemap(){this.addOutput("Cubemap","Cubemap"),this.properties={name:""},this.size=[LGraphTexture.image_preview_size,LGraphTexture.image_preview_size]}var LiteGraph=global.LiteGraph;if(global.LGraphTexture=null,"undefined"!=typeof GL){LGraphCanvas.link_type_colors.Texture="#AEF",global.LGraphTexture=LGraphTexture,LGraphTexture.title="Texture",LGraphTexture.desc="Texture",LGraphTexture.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},LGraphTexture.loadTextureCallback=null,LGraphTexture.image_preview_size=256,LGraphTexture.PASS_THROUGH=1,LGraphTexture.COPY=2,LGraphTexture.LOW=3,LGraphTexture.HIGH=4,LGraphTexture.REUSE=5,LGraphTexture.DEFAULT=2,LGraphTexture.MODE_VALUES={"pass through":LGraphTexture.PASS_THROUGH,copy:LGraphTexture.COPY,low:LGraphTexture.LOW,high:LGraphTexture.HIGH,reuse:LGraphTexture.REUSE,default:LGraphTexture.DEFAULT},LGraphTexture.getTexturesContainer=function(){return gl.textures},LGraphTexture.loadTexture=function(name,options){options=options||{};var url=name;return"http://"==url.substr(0,7)&&LiteGraph.proxy&&(url=LiteGraph.proxy+url.substr(7)),LGraphTexture.getTexturesContainer()[name]=GL.Texture.fromURL(url,options)},LGraphTexture.getTexture=function(name){var container=this.getTexturesContainer();if(!container)throw"Cannot load texture, container of textures not found";var tex=container[name];return!tex&&name&&":"!=name[0]?this.loadTexture(name):tex},LGraphTexture.getTargetTexture=function(origin,target,mode){if(!origin)throw"LGraphTexture.getTargetTexture expects a reference texture";var tex_type=null;switch(mode){case LGraphTexture.LOW:tex_type=gl.UNSIGNED_BYTE;break;case LGraphTexture.HIGH:tex_type=gl.HIGH_PRECISION_FORMAT;break;case LGraphTexture.REUSE:return origin;case LGraphTexture.COPY:default:tex_type=origin?origin.type:gl.UNSIGNED_BYTE}return target&&target.width==origin.width&&target.height==origin.height&&target.type==tex_type||(target=new GL.Texture(origin.width,origin.height,{type:tex_type,format:gl.RGBA,filter:gl.LINEAR})),target},LGraphTexture.getTextureType=function(precision,ref_texture){var type=ref_texture?ref_texture.type:gl.UNSIGNED_BYTE;switch(precision){case LGraphTexture.HIGH:type=gl.HIGH_PRECISION_FORMAT;break;case LGraphTexture.LOW:type=gl.UNSIGNED_BYTE}return type},LGraphTexture.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var noise=new Uint8Array(1048576),i=0;i<1048576;++i)noise[i]=255*Math.random();var texture=GL.Texture.fromMemory(512,512,noise,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=texture,texture},LGraphTexture.prototype.onDropFile=function(data,filename,file){if(data){var texture=null;if("string"==typeof data)texture=GL.Texture.fromURL(data);else if(-1!=filename.toLowerCase().indexOf(".dds"))texture=GL.Texture.fromDDSInMemory(data);else{var blob=new Blob([file]),url=URL.createObjectURL(blob);texture=GL.Texture.fromURL(url)}this._drop_texture=texture,this.properties.name=filename}else this._drop_texture=null,this.properties.name=""},LGraphTexture.prototype.getExtraMenuOptions=function(graphcanvas){var that=this;if(this._drop_texture)return[{content:"Clear",callback:function(){that._drop_texture=null,that.properties.name=""}}]},LGraphTexture.prototype.onExecute=function(){var tex=null;if(this.isOutputConnected(1)&&(tex=this.getInputData(0)),!tex&&this._drop_texture&&(tex=this._drop_texture),!tex&&this.properties.name&&(tex=LGraphTexture.getTexture(this.properties.name)),tex){this._last_tex=tex,!1===this.properties.filter?tex.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):tex.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,tex);for(var i=1;i<this.outputs.length;i++){var output=this.outputs[i];if(output){var v=null;"width"==output.name?v=tex.width:"height"==output.name?v=tex.height:"aspect"==output.name&&(v=tex.width/tex.height),this.setOutputData(i,v)}}}},LGraphTexture.prototype.onResourceRenamed=function(old_name,new_name){this.properties.name==old_name&&(this.properties.name=new_name)},LGraphTexture.prototype.onDrawBackground=function(ctx){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&ctx.webgl)return void ctx.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);if(this._last_preview_tex!=this._last_tex)if(ctx.webgl)this._canvas=this._last_tex;else{var tex_canvas=LGraphTexture.generateLowResTexturePreview(this._last_tex);if(!tex_canvas)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(tex_canvas)}this._canvas&&(ctx.save(),ctx.webgl||(ctx.translate(0,this.size[1]),ctx.scale(1,-1)),ctx.drawImage(this._canvas,0,0,this.size[0],this.size[1]),ctx.restore())}},LGraphTexture.generateLowResTexturePreview=function(tex){if(!tex)return null;var size=LGraphTexture.image_preview_size,temp_tex=tex;if(tex.format==gl.DEPTH_COMPONENT)return null;(tex.width>size||tex.height>size)&&(temp_tex=this._preview_temp_tex,this._preview_temp_tex||(temp_tex=new GL.Texture(size,size,{minFilter:gl.NEAREST}),this._preview_temp_tex=temp_tex),tex.copyTo(temp_tex),tex=temp_tex);var tex_canvas=this._preview_canvas;return tex_canvas||(tex_canvas=createCanvas(size,size),this._preview_canvas=tex_canvas),temp_tex&&temp_tex.toCanvas(tex_canvas),tex_canvas},LGraphTexture.prototype.getResources=function(res){return res[this.properties.name]=GL.Texture,res},LGraphTexture.prototype.onGetInputs=function(){return[["in","Texture"]]},LGraphTexture.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},LiteGraph.registerNodeType("texture/texture",LGraphTexture),LGraphTexturePreview.title="Preview",LGraphTexturePreview.desc="Show a texture in the graph canvas",LGraphTexturePreview.allow_preview=!1,LGraphTexturePreview.prototype.onDrawBackground=function(ctx){if(!this.flags.collapsed&&(ctx.webgl||LGraphTexturePreview.allow_preview)){var tex=this.getInputData(0);if(tex){var tex_canvas=null;tex_canvas=!tex.handle&&ctx.webgl?tex:LGraphTexture.generateLowResTexturePreview(tex),ctx.save(),this.properties.flipY&&(ctx.translate(0,this.size[1]),ctx.scale(1,-1)),ctx.drawImage(tex_canvas,0,0,this.size[0],this.size[1]),ctx.restore()}}},LiteGraph.registerNodeType("texture/preview",LGraphTexturePreview),LGraphTextureSave.title="Save",LGraphTextureSave.desc="Save a texture in the repository",LGraphTextureSave.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex){if(this.properties.name)if(LGraphTexture.storeTexture)LGraphTexture.storeTexture(this.properties.name,tex);else{var container=LGraphTexture.getTexturesContainer();container[this.properties.name]=tex}this.setOutputData(0,tex)}},LiteGraph.registerNodeType("texture/save",LGraphTextureSave),LGraphTextureOperation.widgets_info={uvcode:{widget:"textarea",height:100},pixelcode:{widget:"textarea",height:100},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureOperation.title="Operation",LGraphTextureOperation.desc="Texture shader operation",LGraphTextureOperation.prototype.getExtraMenuOptions=function(graphcanvas){var that=this;return[{content:that.properties.show?"Hide Texture":"Show Texture",callback:function(){that.properties.show=!that.properties.show}}]},LGraphTextureOperation.prototype.onDrawBackground=function(ctx){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==ctx&&(ctx.save(),ctx.drawImage(this._tex,0,0,this.size[0],this.size[1]),ctx.restore())},LGraphTextureOperation.prototype.onExecute=function(){var tex=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);var texB=this.getInputData(1);if(this.properties.uvcode||this.properties.pixelcode){var width=512,height=512;tex?(width=tex.width,height=tex.height):texB&&(width=texB.width,height=texB.height);var type=LGraphTexture.getTextureType(this.properties.precision,tex);tex||this._tex?this._tex=LGraphTexture.getTargetTexture(tex||this._tex,this._tex,this.properties.precision):this._tex=new GL.Texture(width,height,{type:type,format:gl.RGBA,filter:gl.LINEAR});var uvcode="";this.properties.uvcode&&(uvcode="uv = "+this.properties.uvcode,-1!=this.properties.uvcode.indexOf(";")&&(uvcode=this.properties.uvcode));var pixelcode="";this.properties.pixelcode&&(pixelcode="result = "+this.properties.pixelcode,-1!=this.properties.pixelcode.indexOf(";")&&(pixelcode=this.properties.pixelcode));var shader=this._shader;if(!shader||this._shader_code!=uvcode+"|"+pixelcode){try{this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureOperation.pixel_shader,{UV_CODE:uvcode,PIXEL_CODE:pixelcode}),this.boxcolor="#00FF00"}catch(err){return console.log("Error compiling shader: ",err),void(this.boxcolor="#FF0000")}this.boxcolor="#FF0000",this._shader_code=uvcode+"|"+pixelcode,shader=this._shader}if(!shader)return void(this.boxcolor="red");this.boxcolor="green";var value=this.getInputData(2);null!=value?this.properties.value=value:value=parseFloat(this.properties.value);var time=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),tex&&tex.bind(0),texB&&texB.bind(1);var mesh=Mesh.getScreenQuad();shader.uniforms({u_texture:0,u_textureB:1,value:value,texSize:[width,height],time:time}).draw(mesh)}),this.setOutputData(0,this._tex)}}},LGraphTextureOperation.pixel_shader="precision highp float;\n\t\t\t\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_textureB;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform vec2 texSize;\n\t\t\tuniform float time;\n\t\t\tuniform float value;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 uv = v_coord;\n\t\t\t\tUV_CODE;\n\t\t\t\tvec4 color4 = texture2D(u_texture, uv);\n\t\t\t\tvec3 color = color4.rgb;\n\t\t\t\tvec4 color4B = texture2D(u_textureB, uv);\n\t\t\t\tvec3 colorB = color4B.rgb;\n\t\t\t\tvec3 result = color;\n\t\t\t\tfloat alpha = 1.0;\n\t\t\t\tPIXEL_CODE;\n\t\t\t\tgl_FragColor = vec4(result, alpha);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/operation",LGraphTextureOperation),LGraphTextureShader.title="Shader",LGraphTextureShader.desc="Texture shader",LGraphTextureShader.widgets_info={code:{type:"code"},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureShader.prototype.onPropertyChanged=function(name,value){if("code"==name){var shader=this.getShader();if(shader){var uniforms=shader.uniformInfo;if(this.inputs)for(var already={},i=0;i<this.inputs.length;++i){var info=this.getInputInfo(i);info&&(!uniforms[info.name]||already[info.name]?(this.removeInput(i),i--):already[info.name]=!0)}for(var i in uniforms){var info=shader.uniformInfo[i];if(null!==info.loc&&"time"!=i){var type="number";if(this._shader.samplers[i])type="texture";else switch(info.size){case 1:type="number";break;case 2:type="vec2";break;case 3:type="vec3";break;case 4:type="vec4";break;case 9:type="mat3";break;case 16:type="mat4";break;default:continue}var slot=this.findInputSlot(i);if(-1!=slot){var input_info=this.getInputInfo(slot);if(input_info){if(input_info.type==type)continue;this.removeInput(slot,type),this.addInput(i,type)}else this.addInput(i,type)}else this.addInput(i,type)}}}}},LGraphTextureShader.prototype.getShader=function(){return this._shader&&this._shader_code==this.properties.code?this._shader:(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureShader.pixel_shader+this.properties.code),this._shader?(this.boxcolor="green",this._shader):(this.boxcolor="red",null))},LGraphTextureShader.prototype.onExecute=function(){if(this.isOutputConnected(0)){var shader=this.getShader();if(shader){for(var tex_slot=0,in_tex=null,i=0;i<this.inputs.length;++i){var info=this.getInputInfo(i),data=this.getInputData(i);null!=data&&(data.constructor===GL.Texture&&(data.bind(tex_slot),in_tex||(in_tex=data),data=tex_slot,tex_slot++),shader.setUniform(info.name,data))}var uniforms=this._uniforms,type=LGraphTexture.getTextureType(this.properties.precision,in_tex),w=0|this.properties.width,h=0|this.properties.height;0==w&&(w=in_tex?in_tex.width:gl.canvas.width),0==h&&(h=in_tex?in_tex.height:gl.canvas.height),uniforms.texSize[0]=w,uniforms.texSize[1]=h,uniforms.time=this.graph.getTime(),this._tex&&this._tex.type==type&&this._tex.width==w&&this._tex.height==h||(this._tex=new GL.Texture(w,h,{type:type,format:gl.RGBA,filter:gl.LINEAR}));this._tex.drawTo(function(){shader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},LGraphTextureShader.pixel_shader="precision highp float;\n\t\t\t\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform float time;\n\t",LiteGraph.registerNodeType("texture/shader",LGraphTextureShader),LGraphTextureScaleOffset.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureScaleOffset.title="Scale/Offset",LGraphTextureScaleOffset.desc="Applies an scaling and offseting",LGraphTextureScaleOffset.prototype.onExecute=function(){var tex=this.getInputData(0);if(this.isOutputConnected(0)&&tex){if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);var width=tex.width,height=tex.height,type=this.precision===LGraphTexture.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===LGraphTexture.DEFAULT&&(type=tex.type),this._tex&&this._tex.width==width&&this._tex.height==height&&this._tex.type==type||(this._tex=new GL.Texture(width,height,{type:type,format:gl.RGBA,filter:gl.LINEAR}));var shader=this._shader;shader||(shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureScaleOffset.pixel_shader));var scale=this.getInputData(1);scale?(this.properties.scale[0]=scale[0],this.properties.scale[1]=scale[1]):scale=this.properties.scale;var offset=this.getInputData(2);offset?(this.properties.offset[0]=offset[0],this.properties.offset[1]=offset[1]):offset=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),tex.bind(0);var mesh=Mesh.getScreenQuad();shader.uniforms({u_texture:0,u_scale:scale,u_offset:offset}).draw(mesh)}),this.setOutputData(0,this._tex)}},LGraphTextureScaleOffset.pixel_shader="precision highp float;\n\t\t\t\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_textureB;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform vec2 u_scale;\n\t\t\tuniform vec2 u_offset;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 uv = v_coord;\n\t\t\t\tuv = uv / u_scale - u_offset;\n\t\t\t\tgl_FragColor = texture2D(u_texture, uv);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/scaleOffset",LGraphTextureScaleOffset),LGraphTextureWarp.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureWarp.title="Warp",LGraphTextureWarp.desc="Texture warp operation",LGraphTextureWarp.prototype.onExecute=function(){var tex=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);var texB=this.getInputData(1),width=512,height=512;gl.UNSIGNED_BYTE;tex?(width=tex.width,height=tex.height,tex.type):texB&&(width=texB.width,height=texB.height,texB.type),tex||this._tex?this._tex=LGraphTexture.getTargetTexture(tex||this._tex,this._tex,this.properties.precision):this._tex=new GL.Texture(width,height,{type:this.precision===LGraphTexture.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR});var shader=this._shader;shader||(shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureWarp.pixel_shader));var factor=this.getInputData(2);null!=factor?this.properties.factor=factor:factor=parseFloat(this.properties.factor),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),tex&&tex.bind(0),texB&&texB.bind(1);var mesh=Mesh.getScreenQuad();shader.uniforms({u_texture:0,u_textureB:1,u_factor:factor}).draw(mesh)}),this.setOutputData(0,this._tex)}},LGraphTextureWarp.pixel_shader="precision highp float;\n\t\t\t\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_textureB;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform float u_factor;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 uv = v_coord;\n\t\t\t\tuv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor;\n\t\t\t\tgl_FragColor = texture2D(u_texture, uv);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/warp",LGraphTextureWarp),LGraphTextureToViewport.title="to Viewport",LGraphTextureToViewport.desc="Texture to viewport",LGraphTextureToViewport.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var gamma=this.properties.gamma||1;if(this.isInputConnected(1)&&(gamma=this.getInputData(1)),tex.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),this.properties.antialiasing){LGraphTextureToViewport._shader||(LGraphTextureToViewport._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureToViewport.aa_pixel_shader));var mesh=(gl.getViewport(),Mesh.getScreenQuad());tex.bind(0),LGraphTextureToViewport._shader.uniforms({u_texture:0,uViewportSize:[tex.width,tex.height],u_igamma:1/gamma,inverseVP:[1/tex.width,1/tex.height]}).draw(mesh)}else 1!=gamma?(LGraphTextureToViewport._gamma_shader||(LGraphTextureToViewport._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureToViewport.gamma_pixel_shader)),tex.toViewport(LGraphTextureToViewport._gamma_shader,{u_texture:0,u_igamma:1/gamma})):tex.toViewport()}},LGraphTextureToViewport.prototype.onGetInputs=function(){return[["gamma","number"]]},LGraphTextureToViewport.aa_pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 uViewportSize;\n\t\t\tuniform vec2 inverseVP;\n\t\t\tuniform float u_igamma;\n\t\t\t#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n\t\t\t#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n\t\t\t#define FXAA_SPAN_MAX     8.0\n\t\t\t\n\t\t\t/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */\n\t\t\tvec4 applyFXAA(sampler2D tex, vec2 fragCoord)\n\t\t\t{\n\t\t\t\tvec4 color = vec4(0.0);\n\t\t\t\t/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/\n\t\t\t\tvec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;\n\t\t\t\tvec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;\n\t\t\t\tvec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;\n\t\t\t\tvec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;\n\t\t\t\tvec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;\n\t\t\t\tvec3 luma = vec3(0.299, 0.587, 0.114);\n\t\t\t\tfloat lumaNW = dot(rgbNW, luma);\n\t\t\t\tfloat lumaNE = dot(rgbNE, luma);\n\t\t\t\tfloat lumaSW = dot(rgbSW, luma);\n\t\t\t\tfloat lumaSE = dot(rgbSE, luma);\n\t\t\t\tfloat lumaM  = dot(rgbM,  luma);\n\t\t\t\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n\t\t\t\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\t\t\t\t\n\t\t\t\tvec2 dir;\n\t\t\t\tdir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n\t\t\t\tdir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\t\t\t\t\n\t\t\t\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\t\t\t\t\n\t\t\t\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n\t\t\t\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;\n\t\t\t\t\n\t\t\t\tvec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + \n\t\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n\t\t\t\tvec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + \n\t\t\t\t\ttexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\t\t\t\t\n\t\t\t\t//return vec4(rgbA,1.0);\n\t\t\t\tfloat lumaB = dot(rgbB, luma);\n\t\t\t\tif ((lumaB < lumaMin) || (lumaB > lumaMax))\n\t\t\t\t\tcolor = vec4(rgbA, 1.0);\n\t\t\t\telse\n\t\t\t\t\tcolor = vec4(rgbB, 1.0);\n\t\t\t\tif(u_igamma != 1.0)\n\t\t\t\t\tcolor.xyz = pow( color.xyz, vec3(u_igamma) );\n\t\t\t\treturn color;\n\t\t\t}\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;\n\t\t\t}\n\t\t\t",LGraphTextureToViewport.gamma_pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_igamma;\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D( u_texture, v_coord);\n\t\t\t\tcolor.xyz = pow(color.xyz, vec3(u_igamma) );\n\t\t\t   gl_FragColor = color;\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/toviewport",LGraphTextureToViewport),LGraphTextureCopy.title="Copy",LGraphTextureCopy.desc="Copy Texture",LGraphTextureCopy.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureCopy.prototype.onExecute=function(){var tex=this.getInputData(0);if((tex||this._temp_texture)&&this.isOutputConnected(0)){if(tex){var width=tex.width,height=tex.height;0!=this.properties.size&&(width=this.properties.size,height=this.properties.size);var temp=this._temp_texture,type=tex.type;if(this.properties.precision===LGraphTexture.LOW?type=gl.UNSIGNED_BYTE:this.properties.precision===LGraphTexture.HIGH&&(type=gl.HIGH_PRECISION_FORMAT),!temp||temp.width!=width||temp.height!=height||temp.type!=type){var minFilter=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(width)&&isPowerOfTwo(height)&&(minFilter=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(width,height,{type:type,format:gl.RGBA,minFilter:minFilter,magFilter:gl.LINEAR})}tex.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},LiteGraph.registerNodeType("texture/copy",LGraphTextureCopy),LGraphTextureDownsample.title="Downsample",LGraphTextureDownsample.desc="Downsample Texture",LGraphTextureDownsample.widgets_info={iterations:{type:"number",step:1,precision:0,min:1},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureDownsample.prototype.onExecute=function(){var tex=this.getInputData(0);if((tex||this._temp_texture)&&this.isOutputConnected(0)&&tex&&tex.texture_type===GL.TEXTURE_2D){var shader=LGraphTextureDownsample._shader;shader||(LGraphTextureDownsample._shader=shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureDownsample.pixel_shader));var width=0|tex.width,height=0|tex.height,type=tex.type;this.properties.precision===LGraphTexture.LOW?type=gl.UNSIGNED_BYTE:this.properties.precision===LGraphTexture.HIGH&&(type=gl.HIGH_PRECISION_FORMAT);var iterations=this.properties.iterations||1,origin=tex,target=null,temp=[],options={type:type,format:tex.format},offset=vec2.create(),uniforms={u_offset:offset};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var i=0;i<iterations&&(offset[0]=1/width,offset[1]=1/height,width=width>>1||0,height=height>>1||0,target=GL.Texture.getTemporary(width,height,options),temp.push(target),origin.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),origin.copyTo(target,shader,uniforms),1!=width||1!=height);++i)origin=target;this._texture=temp.pop();for(var i=0;i<temp.length;++i)GL.Texture.releaseTemporary(temp[i]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},LGraphTextureDownsample.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_offset;\n\t\t\tvarying vec2 v_coord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord );\n\t\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );\n\t\t\t\tcolor += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );\n\t\t\t\tcolor += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );\n\t\t\t   gl_FragColor = color * 0.25;\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/downsample",LGraphTextureDownsample),LGraphTextureAverage.title="Average",LGraphTextureAverage.desc="Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture",LGraphTextureAverage.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&(this.isOutputConnected(0)||this.isOutputConnected(1)||this.isOutputConnected(2))){if(!LGraphTextureAverage._shader){LGraphTextureAverage._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureAverage.pixel_shader);for(var samples=new Float32Array(32),i=0;i<32;++i)samples[i]=Math.random();LGraphTextureAverage._shader.uniforms({u_samples_a:samples.subarray(0,16),u_samples_b:samples.subarray(16,32)})}var temp=this._temp_texture,type=gl.UNSIGNED_BYTE;tex.type!=type&&(type=gl.FLOAT),temp&&temp.type==type||(this._temp_texture=new GL.Texture(1,1,{type:type,format:gl.RGBA,filter:gl.NEAREST}));var shader=LGraphTextureAverage._shader,uniforms=this._uniforms;if(uniforms.u_mipmap_offset=this.properties.mipmap_offset,this._temp_texture.drawTo(function(){tex.toViewport(shader,uniforms)}),this.setOutputData(0,this._temp_texture),this.isOutputConnected(1)||this.isOutputConnected(2)){var pixel=this._temp_texture.getPixels();if(pixel){var v=this._luminance,type=this._temp_texture.type;v.set(pixel),type==gl.UNSIGNED_BYTE?vec4.scale(v,v,1/255):type!=GL.HALF_FLOAT&&type!=GL.HALF_FLOAT_OES||vec4.scale(v,v,1/65025),this.setOutputData(1,v),this.setOutputData(2,(v[0]+v[1]+v[2])/3)}}}},LGraphTextureAverage.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tuniform mat4 u_samples_a;\n\t\t\tuniform mat4 u_samples_b;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_mipmap_offset;\n\t\t\tvarying vec2 v_coord;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = vec4(0.0);\n\t\t\t\tfor(int i = 0; i < 4; ++i)\n\t\t\t\t\tfor(int j = 0; j < 4; ++j)\n\t\t\t\t\t{\n\t\t\t\t\t\tcolor += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );\n\t\t\t\t\t\tcolor += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );\n\t\t\t\t\t}\n\t\t\t   gl_FragColor = color * 0.03125;\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/average",LGraphTextureAverage),LGraphImageToTexture.title="Image to Texture",LGraphImageToTexture.desc="Uploads an image to the GPU",LGraphImageToTexture.prototype.onExecute=function(){var img=this.getInputData(0);if(img){var width=img.videoWidth||img.width,height=img.videoHeight||img.height;if(img.gltexture)return void this.setOutputData(0,img.gltexture);var temp=this._temp_texture;temp&&temp.width==width&&temp.height==height||(this._temp_texture=new GL.Texture(width,height,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(img)}catch(err){return void console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+err)}this.setOutputData(0,this._temp_texture)}},LiteGraph.registerNodeType("texture/imageToTexture",LGraphImageToTexture),LGraphTextureLUT.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureLUT.title="LUT",LGraphTextureLUT.desc="Apply LUT to Texture",LGraphTextureLUT.prototype.onExecute=function(){if(this.isOutputConnected(0)){var tex=this.getInputData(0);if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);if(tex){var lut_tex=this.getInputData(1);if(lut_tex||(lut_tex=LGraphTexture.getTexture(this.properties.texture)),!lut_tex)return void this.setOutputData(0,tex);lut_tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var intensity=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=intensity=this.getInputData(2)),this._tex=LGraphTexture.getTargetTexture(tex,this._tex,this.properties.precision),this._tex.drawTo(function(){lut_tex.bind(1),tex.toViewport(LGraphTextureLUT._shader,{u_texture:0,u_textureB:1,u_amount:intensity})}),this.setOutputData(0,this._tex)}}},LGraphTextureLUT.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_textureB;\n\t\t\tuniform float u_amount;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\t lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );\n\t\t\t\t mediump float blueColor = textureColor.b * 63.0;\n\t\t\t\t mediump vec2 quad1;\n\t\t\t\t quad1.y = floor(floor(blueColor) / 8.0);\n\t\t\t\t quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\t\t\t\t mediump vec2 quad2;\n\t\t\t\t quad2.y = floor(ceil(blueColor) / 8.0);\n\t\t\t\t quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\t\t\t\t highp vec2 texPos1;\n\t\t\t\t texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n\t\t\t\t texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\n\t\t\t\t highp vec2 texPos2;\n\t\t\t\t texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n\t\t\t\t texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));\n\t\t\t\t lowp vec4 newColor1 = texture2D(u_textureB, texPos1);\n\t\t\t\t lowp vec4 newColor2 = texture2D(u_textureB, texPos2);\n\t\t\t\t lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n\t\t\t\t gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/LUT",LGraphTextureLUT),LGraphTextureChannels.title="Texture to Channels",LGraphTextureChannels.desc="Split texture channels",LGraphTextureChannels.prototype.onExecute=function(){var texA=this.getInputData(0);if(texA){this._channels||(this._channels=Array(4));for(var connections=0,i=0;i<4;i++)this.isOutputConnected(i)?(this._channels[i]&&this._channels[i].width==texA.width&&this._channels[i].height==texA.height&&this._channels[i].type==texA.type||(this._channels[i]=new GL.Texture(texA.width,texA.height,{type:texA.type,format:gl.RGBA,filter:gl.LINEAR})),connections++):this._channels[i]=null;if(connections){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var mesh=Mesh.getScreenQuad(),shader=LGraphTextureChannels._shader,masks=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],i=0;i<4;i++)this._channels[i]&&(this._channels[i].drawTo(function(){texA.bind(0),shader.uniforms({u_texture:0,u_mask:masks[i]}).draw(mesh)}),this.setOutputData(i,this._channels[i]))}}},LGraphTextureChannels.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec4 u_mask;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/textureChannels",LGraphTextureChannels),LGraphChannelsTexture.title="Channels to Texture",LGraphChannelsTexture.desc="Split texture channels",LGraphChannelsTexture.prototype.onExecute=function(){var tex=[this.getInputData(0),this.getInputData(1),this.getInputData(2),this.getInputData(3)];if(tex[0]&&tex[1]&&tex[2]&&tex[3]){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad(),shader=LGraphChannelsTexture._shader;this._tex=LGraphTexture.getTargetTexture(tex[0],this._tex),this._tex.drawTo(function(){tex[0].bind(0),tex[1].bind(1),tex[2].bind(2),tex[3].bind(3),shader.uniforms({u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3}).draw(mesh)}),this.setOutputData(0,this._tex)}},LGraphChannelsTexture.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_textureR;\n\t\t\tuniform sampler2D u_textureG;\n\t\t\tuniform sampler2D u_textureB;\n\t\t\tuniform sampler2D u_textureA;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t   gl_FragColor = vec4( \t\t\t\t\t\ttexture2D(u_textureR, v_coord).r,\t\t\t\t\t\ttexture2D(u_textureG, v_coord).r,\t\t\t\t\t\ttexture2D(u_textureB, v_coord).r,\t\t\t\t\t\ttexture2D(u_textureA, v_coord).r);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/channelsTexture",LGraphChannelsTexture),LGraphTextureColor.title="Color",LGraphTextureColor.desc="Generates a 1x1 texture with a constant color",LGraphTextureColor.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureColor.prototype.onDrawBackground=function(ctx){var c=this.properties.color;ctx.fillStyle="rgb("+Math.floor(255*Math.clamp(c[0],0,1))+","+Math.floor(255*Math.clamp(c[1],0,1))+","+Math.floor(255*Math.clamp(c[2],0,1))+")",this.flags.collapsed?this.boxcolor=ctx.fillStyle:ctx.fillRect(0,0,this.size[0],this.size[1])},LGraphTextureColor.prototype.onExecute=function(){var type=this.properties.precision==LGraphTexture.HIGH?LGraphTexture.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;this._tex&&this._tex.type==type||(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:type,minFilter:gl.NEAREST}));var color=this.properties.color;if(this.inputs)for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i],v=this.getInputData(i);if(void 0!==v)switch(input.name){case"RGB":case"RGBA":color.set(v);break;case"R":color[0]=v;break;case"G":color[1]=v;break;case"B":color[2]=v;break;case"A":color[3]=v}}vec4.sqrDist(this._tex_color,color)>.001&&(this._tex_color.set(color),this._tex.fill(color)),this.setOutputData(0,this._tex)},LGraphTextureColor.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},LiteGraph.registerNodeType("texture/color",LGraphTextureColor),LGraphTextureGradient.title="Gradient",LGraphTextureGradient.desc="Generates a gradient",LGraphTextureGradient["@A"]={type:"color"},LGraphTextureGradient["@B"]={type:"color"},LGraphTextureGradient["@texture_size"]={type:"enum",values:[32,64,128,256,512]},LGraphTextureGradient.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=GL.Mesh.getScreenQuad(),shader=LGraphTextureGradient._shader,A=this.getInputData(0);A||(A=this.properties.A);var B=this.getInputData(1);B||(B=this.properties.B);for(var i=2;i<this.inputs.length;i++){var input=this.inputs[i],v=this.getInputData(i);void 0!==v&&(this.properties[input.name]=v)}var uniforms=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(uniforms.u_colorA,A),vec3.copy(uniforms.u_colorB,B);var size=parseInt(this.properties.texture_size);this._tex&&this._tex.width==size||(this._tex=new GL.Texture(size,size,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){shader.uniforms(uniforms).draw(mesh)}),this.setOutputData(0,this._tex)},LGraphTextureGradient.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},LGraphTextureGradient.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform float u_angle;\n\t\t\tuniform float u_scale;\n\t\t\tuniform vec3 u_colorA;\n\t\t\tuniform vec3 u_colorB;\n\t\t\t\n\t\t\tvec2 rotate(vec2 v, float angle)\n\t\t\t{\n\t\t\t\tvec2 result;\n\t\t\t\tfloat _cos = cos(angle);\n\t\t\t\tfloat _sin = sin(angle);\n\t\t\t\tresult.x = v.x * _cos - v.y * _sin;\n\t\t\t\tresult.y = v.x * _sin + v.y * _cos;\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tvoid main() {\n\t\t\t\tfloat f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;\n\t\t\t\tvec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));\n\t\t\t   gl_FragColor = vec4(color,1.0);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/gradient",LGraphTextureGradient),LGraphTextureMix.title="Mix",LGraphTextureMix.desc="Generates a texture mixing two textures",LGraphTextureMix.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureMix.prototype.onExecute=function(){var texA=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,texA);var texB=this.getInputData(1);if(texA&&texB){var texMix=this.getInputData(2),factor=this.getInputData(3);this._tex=LGraphTexture.getTargetTexture(texA,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad(),shader=null,uniforms=this._uniforms;if(texMix)(shader=LGraphTextureMix._shader_tex)||(shader=LGraphTextureMix._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureMix.pixel_shader,{MIX_TEX:""}));else{shader=LGraphTextureMix._shader_factor,shader||(shader=LGraphTextureMix._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureMix.pixel_shader));var f=null==factor?this.properties.factor:factor;uniforms.u_mix.set([f,f,f,f])}this._tex.drawTo(function(){texA.bind(0),texB.bind(1),texMix&&texMix.bind(2),shader.uniforms(uniforms).draw(mesh)}),this.setOutputData(0,this._tex)}}},LGraphTextureMix.prototype.onGetInputs=function(){return[["factor","number"]]},LGraphTextureMix.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_textureA;\n\t\t\tuniform sampler2D u_textureB;\n\t\t\t#ifdef MIX_TEX\n\t\t\t\tuniform sampler2D u_textureMix;\n\t\t\t#else\n\t\t\t\tuniform vec4 u_mix;\n\t\t\t#endif\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\t#ifdef MIX_TEX\n\t\t\t\t   vec4 f = texture2D(u_textureMix, v_coord);\n\t\t\t\t#else\n\t\t\t\t   vec4 f = u_mix;\n\t\t\t\t#endif\n\t\t\t   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/mix",LGraphTextureMix),LGraphTextureEdges.title="Edges",LGraphTextureEdges.desc="Detects edges",LGraphTextureEdges.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureEdges.prototype.onExecute=function(){if(this.isOutputConnected(0)){var tex=this.getInputData(0);if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);if(tex){this._tex=LGraphTexture.getTargetTexture(tex,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad(),shader=LGraphTextureEdges._shader,invert=this.properties.invert,factor=this.properties.factor,threshold=this.properties.threshold?1:0;this._tex.drawTo(function(){tex.bind(0),shader.uniforms({u_texture:0,u_isize:[1/tex.width,1/tex.height],u_factor:factor,u_threshold:threshold,u_invert:invert?1:0}).draw(mesh)}),this.setOutputData(0,this._tex)}}},LGraphTextureEdges.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_isize;\n\t\t\tuniform int u_invert;\n\t\t\tuniform float u_factor;\n\t\t\tuniform float u_threshold;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 center = texture2D(u_texture, v_coord);\n\t\t\t\tvec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );\n\t\t\t\tvec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );\n\t\t\t\tvec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );\n\t\t\t\tvec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );\n\t\t\t\tvec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);\n\t\t\t\tdiff *= u_factor;\n\t\t\t\tif(u_invert == 1)\n\t\t\t\t\tdiff.xyz = vec3(1.0) - diff.xyz;\n\t\t\t\tif( u_threshold == 0.0 )\n\t\t\t\t\tgl_FragColor = vec4( diff.xyz, center.a );\n\t\t\t\telse\n\t\t\t\t\tgl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/edges",LGraphTextureEdges),LGraphTextureDepthRange.title="Depth Range",LGraphTextureDepthRange.desc="Generates a texture with a depth range",LGraphTextureDepthRange.prototype.onExecute=function(){if(this.isOutputConnected(0)){var tex=this.getInputData(0);if(tex){var precision=gl.UNSIGNED_BYTE;this.properties.high_precision&&(precision=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),this._temp_texture&&this._temp_texture.type==precision&&this._temp_texture.width==tex.width&&this._temp_texture.height==tex.height||(this._temp_texture=new GL.Texture(tex.width,tex.height,{type:precision,format:gl.RGBA,filter:gl.LINEAR}));var uniforms=this._uniforms,distance=this.properties.distance;this.isInputConnected(1)&&(distance=this.getInputData(1),this.properties.distance=distance);var range=this.properties.range;this.isInputConnected(2)&&(range=this.getInputData(2),this.properties.range=range),uniforms.u_distance=distance,uniforms.u_range=range,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad();LGraphTextureDepthRange._shader||(LGraphTextureDepthRange._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureDepthRange.pixel_shader),LGraphTextureDepthRange._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureDepthRange.pixel_shader,{ONLY_DEPTH:""}));var shader=this.properties.only_depth?LGraphTextureDepthRange._shader_onlydepth:LGraphTextureDepthRange._shader,planes=null;planes=tex.near_far_planes?tex.near_far_planes:window.LS&&LS.Renderer._main_camera?LS.Renderer._main_camera._uniforms.u_camera_planes:[.1,1e3],uniforms.u_camera_planes=planes,this._temp_texture.drawTo(function(){tex.bind(0),shader.uniforms(uniforms).draw(mesh)}),this._temp_texture.near_far_planes=planes,this.setOutputData(0,this._temp_texture)}}},LGraphTextureDepthRange.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform float u_distance;\n\t\t\tuniform float u_range;\n\t\t\t\n\t\t\tfloat LinearDepth()\n\t\t\t{\n\t\t\t\tfloat zNear = u_camera_planes.x;\n\t\t\t\tfloat zFar = u_camera_planes.y;\n\t\t\t\tfloat depth = texture2D(u_texture, v_coord).x;\n\t\t\t\tdepth = depth * 2.0 - 1.0;\n\t\t\t\treturn zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));\n\t\t\t}\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tfloat depth = LinearDepth();\n\t\t\t\t#ifdef ONLY_DEPTH\n\t\t\t\t   gl_FragColor = vec4(depth);\n\t\t\t\t#else\n\t\t\t\t\tfloat diff = abs(depth * u_camera_planes.y - u_distance);\n\t\t\t\t\tfloat dof = 1.0;\n\t\t\t\t\tif(diff <= u_range)\n\t\t\t\t\t\tdof = diff / u_range;\n\t\t\t\t   gl_FragColor = vec4(dof);\n\t\t\t\t#endif\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("texture/depth_range",LGraphTextureDepthRange),LGraphTextureBlur.title="Blur",LGraphTextureBlur.desc="Blur a texture",LGraphTextureBlur.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureBlur.max_iterations=20,LGraphTextureBlur.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&this.isOutputConnected(0)){var temp=this._final_texture;temp&&temp.width==tex.width&&temp.height==tex.height&&temp.type==tex.type||(temp=this._final_texture=new GL.Texture(tex.width,tex.height,{type:tex.type,format:gl.RGBA,filter:gl.LINEAR}));var iterations=this.properties.iterations;if(this.isInputConnected(1)&&(iterations=this.getInputData(1),this.properties.iterations=iterations),0==(iterations=Math.min(Math.floor(iterations),LGraphTextureBlur.max_iterations)))return void this.setOutputData(0,tex);var intensity=this.properties.intensity;this.isInputConnected(2)&&(intensity=this.getInputData(2),this.properties.intensity=intensity);var aspect=LiteGraph.camera_aspect;aspect||void 0===window.gl||(aspect=gl.canvas.height/gl.canvas.width),aspect||(aspect=1),aspect=this.properties.preserve_aspect?aspect:1;var scale=this.properties.scale||[1,1];tex.applyBlur(aspect*scale[0],scale[1],intensity,temp);for(var i=1;i<iterations;++i)temp.applyBlur(aspect*scale[0]*(i+1),scale[1]*(i+1),intensity);this.setOutputData(0,temp)}},LiteGraph.registerNodeType("texture/blur",LGraphTextureBlur),LGraphTextureGlow.title="Glow",LGraphTextureGlow.desc="Filters a texture giving it a glow effect",LGraphTextureGlow.weights=new Float32Array([.5,.4,.3,.2]),LGraphTextureGlow.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureGlow.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},LGraphTextureGlow.prototype.onGetOutputs=function(){return[["average","Texture"]]},LGraphTextureGlow.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&this.isAnyOutputConnected()){if(this.properties.precision===LGraphTexture.PASS_THROUGH||!1===this.getInputOrProperty("enabled"))return void this.setOutputData(0,tex);var width=tex.width,height=tex.height,texture_info={format:tex.format,type:tex.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},type=LGraphTexture.getTextureType(this.properties.precision,tex),uniforms=this._uniforms,textures=this._textures,shader=LGraphTextureGlow._cut_shader;shader||(shader=LGraphTextureGlow._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureGlow.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),uniforms.u_threshold=this.getInputOrProperty("threshold");var currentDestination=textures[0]=GL.Texture.getTemporary(width,height,texture_info);tex.blit(currentDestination,shader.uniforms(uniforms));var currentSource=currentDestination,iterations=this.getInputOrProperty("iterations");iterations=0|Math.clamp(iterations,1,16);var texel_size=uniforms.u_texel_size,intensity=this.getInputOrProperty("intensity");uniforms.u_intensity=1,uniforms.u_delta=this.properties.scale;var shader=LGraphTextureGlow._shader;shader||(shader=LGraphTextureGlow._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureGlow.scale_pixel_shader));for(var i=1;i<iterations&&(width>>=1,(0|height)>1&&(height>>=1),!(width<2));i++)currentDestination=textures[i]=GL.Texture.getTemporary(width,height,texture_info),texel_size[0]=1/currentSource.width,texel_size[1]=1/currentSource.height,currentSource.blit(currentDestination,shader.uniforms(uniforms)),currentSource=currentDestination;if(this.isOutputConnected(2)){var average_texture=this._average_texture;average_texture&&average_texture.type==tex.type&&average_texture.format==tex.format||(average_texture=this._average_texture=new GL.Texture(1,1,{type:tex.type,format:tex.format,filter:gl.LINEAR})),texel_size[0]=1/currentSource.width,texel_size[1]=1/currentSource.height,uniforms.u_intensity=intensity,uniforms.u_delta=1,currentSource.blit(average_texture,shader.uniforms(uniforms)),this.setOutputData(2,average_texture)}for(gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),uniforms.u_intensity=this.getInputOrProperty("persistence"),uniforms.u_delta=.5,i-=2;i>=0;i--)currentDestination=textures[i],textures[i]=null,texel_size[0]=1/currentSource.width,texel_size[1]=1/currentSource.height,currentSource.blit(currentDestination,shader.uniforms(uniforms)),GL.Texture.releaseTemporary(currentSource),currentSource=currentDestination;if(gl.disable(gl.BLEND),this.isOutputConnected(1)){var glow_texture=this._glow_texture;glow_texture&&glow_texture.width==tex.width&&glow_texture.height==tex.height&&glow_texture.type==type&&glow_texture.format==tex.format||(glow_texture=this._glow_texture=new GL.Texture(tex.width,tex.height,{type:type,format:tex.format,filter:gl.LINEAR})),currentSource.blit(glow_texture),this.setOutputData(1,glow_texture)}if(this.isOutputConnected(0)){var final_texture=this._final_texture;final_texture&&final_texture.width==tex.width&&final_texture.height==tex.height&&final_texture.type==type&&final_texture.format==tex.format||(final_texture=this._final_texture=new GL.Texture(tex.width,tex.height,{type:type,format:tex.format,filter:gl.LINEAR}));var dirt_texture=this.getInputData(1),dirt_factor=this.getInputOrProperty("dirt_factor");uniforms.u_intensity=intensity,shader=dirt_texture?LGraphTextureGlow._dirt_final_shader:LGraphTextureGlow._final_shader,shader||(shader=dirt_texture?LGraphTextureGlow._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureGlow.final_pixel_shader,{USE_DIRT:""}):LGraphTextureGlow._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureGlow.final_pixel_shader)),final_texture.drawTo(function(){tex.bind(0),currentSource.bind(1),dirt_texture&&(shader.setUniform("u_dirt_factor",dirt_factor),shader.setUniform("u_dirt_texture",dirt_texture.bind(2))),shader.toViewport(uniforms)}),this.setOutputData(0,final_texture)}GL.Texture.releaseTemporary(currentSource)}},LGraphTextureGlow.cut_pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform float u_threshold;\n\t\tvoid main() {\n\t\t\tgl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );\n\t\t}",LGraphTextureGlow.scale_pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform vec2 u_texel_size;\n\t\tuniform float u_delta;\n\t\tuniform float u_intensity;\n\t\t\n\t\tvec4 sampleBox(vec2 uv) {\n\t\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\n\t\t\tvec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);\n\t\t\treturn s * 0.25;\n\t\t}\n\t\tvoid main() {\n\t\t\tgl_FragColor = u_intensity * sampleBox( v_coord );\n\t\t}",LGraphTextureGlow.final_pixel_shader="precision highp float;\n\t\tvarying vec2 v_coord;\n\t\tuniform sampler2D u_texture;\n\t\tuniform sampler2D u_glow_texture;\n\t\t#ifdef USE_DIRT\n\t\t\tuniform sampler2D u_dirt_texture;\n\t\t#endif\n\t\tuniform vec2 u_texel_size;\n\t\tuniform float u_delta;\n\t\tuniform float u_intensity;\n\t\tuniform float u_dirt_factor;\n\t\t\n\t\tvec4 sampleBox(vec2 uv) {\n\t\t\tvec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;\n\t\t\tvec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);\n\t\t\treturn s * 0.25;\n\t\t}\n\t\tvoid main() {\n\t\t\tvec4 glow = sampleBox( v_coord );\n\t\t\t#ifdef USE_DIRT\n\t\t\t\tglow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );\n\t\t\t#endif\n\t\t\tgl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;\n\t\t}",LiteGraph.registerNodeType("texture/glow",LGraphTextureGlow),LGraphTextureKuwaharaFilter.title="Kuwahara Filter",LGraphTextureKuwaharaFilter.desc="Filters a texture giving an artistic oil canvas painting",LGraphTextureKuwaharaFilter.max_radius=10,LGraphTextureKuwaharaFilter._shaders=[],LGraphTextureKuwaharaFilter.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&this.isOutputConnected(0)){var temp=this._temp_texture;temp&&temp.width==tex.width&&temp.height==tex.height&&temp.type==tex.type||(this._temp_texture=new GL.Texture(tex.width,tex.height,{type:tex.type,format:gl.RGBA,filter:gl.LINEAR}));var radius=this.properties.radius;if(0==(radius=Math.min(Math.floor(radius),LGraphTextureKuwaharaFilter.max_radius)))return void this.setOutputData(0,tex);var intensity=this.properties.intensity,aspect=LiteGraph.camera_aspect;aspect||void 0===window.gl||(aspect=gl.canvas.height/gl.canvas.width),aspect||(aspect=1),aspect=this.properties.preserve_aspect?aspect:1,LGraphTextureKuwaharaFilter._shaders[radius]||(LGraphTextureKuwaharaFilter._shaders[radius]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphTextureKuwaharaFilter.pixel_shader,{RADIUS:radius.toFixed(0)}));var shader=LGraphTextureKuwaharaFilter._shaders[radius],mesh=GL.Mesh.getScreenQuad();tex.bind(0),this._temp_texture.drawTo(function(){shader.uniforms({u_texture:0,u_intensity:intensity,u_resolution:[tex.width,tex.height],u_iResolution:[1/tex.width,1/tex.height]}).draw(mesh)}),this.setOutputData(0,this._temp_texture)}},LGraphTextureKuwaharaFilter.pixel_shader="\n\tprecision highp float;\n\tvarying vec2 v_coord;\n\tuniform sampler2D u_texture;\n\tuniform float u_intensity;\n\tuniform vec2 u_resolution;\n\tuniform vec2 u_iResolution;\n\t#ifndef RADIUS\n\t\t#define RADIUS 7\n\t#endif\n\tvoid main() {\n\t\n\t\tconst int radius = RADIUS;\n\t\tvec2 fragCoord = v_coord;\n\t\tvec2 src_size = u_iResolution;\n\t\tvec2 uv = v_coord;\n\t\tfloat n = float((radius + 1) * (radius + 1));\n\t\tint i;\n\t\tint j;\n\t\tvec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);\n\t\tvec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);\n\t\tvec3 c;\n\t\t\n\t\tfor (int j = -radius; j <= 0; ++j)  {\n\t\t\tfor (int i = -radius; i <= 0; ++i)  {\n\t\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\t\tm0 += c;\n\t\t\t\ts0 += c * c;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor (int j = -radius; j <= 0; ++j)  {\n\t\t\tfor (int i = 0; i <= radius; ++i)  {\n\t\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\t\tm1 += c;\n\t\t\t\ts1 += c * c;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor (int j = 0; j <= radius; ++j)  {\n\t\t\tfor (int i = 0; i <= radius; ++i)  {\n\t\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\t\tm2 += c;\n\t\t\t\ts2 += c * c;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor (int j = 0; j <= radius; ++j)  {\n\t\t\tfor (int i = -radius; i <= 0; ++i)  {\n\t\t\t\tc = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;\n\t\t\t\tm3 += c;\n\t\t\t\ts3 += c * c;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfloat min_sigma2 = 1e+2;\n\t\tm0 /= n;\n\t\ts0 = abs(s0 / n - m0 * m0);\n\t\t\n\t\tfloat sigma2 = s0.r + s0.g + s0.b;\n\t\tif (sigma2 < min_sigma2) {\n\t\t\tmin_sigma2 = sigma2;\n\t\t\tgl_FragColor = vec4(m0, 1.0);\n\t\t}\n\t\t\n\t\tm1 /= n;\n\t\ts1 = abs(s1 / n - m1 * m1);\n\t\t\n\t\tsigma2 = s1.r + s1.g + s1.b;\n\t\tif (sigma2 < min_sigma2) {\n\t\t\tmin_sigma2 = sigma2;\n\t\t\tgl_FragColor = vec4(m1, 1.0);\n\t\t}\n\t\t\n\t\tm2 /= n;\n\t\ts2 = abs(s2 / n - m2 * m2);\n\t\t\n\t\tsigma2 = s2.r + s2.g + s2.b;\n\t\tif (sigma2 < min_sigma2) {\n\t\t\tmin_sigma2 = sigma2;\n\t\t\tgl_FragColor = vec4(m2, 1.0);\n\t\t}\n\t\t\n\t\tm3 /= n;\n\t\ts3 = abs(s3 / n - m3 * m3);\n\t\t\n\t\tsigma2 = s3.r + s3.g + s3.b;\n\t\tif (sigma2 < min_sigma2) {\n\t\t\tmin_sigma2 = sigma2;\n\t\t\tgl_FragColor = vec4(m3, 1.0);\n\t\t}\n\t}\n\t",LiteGraph.registerNodeType("texture/kuwahara",LGraphTextureKuwaharaFilter),LGraphTextureWebcam.title="Webcam",LGraphTextureWebcam.desc="Webcam texture",LGraphTextureWebcam.prototype.openStream=function(){function onFailSoHard(e){console.log("Webcam rejected",e),that._webcam_stream=!1,that.boxcolor="red",that.trigger("stream_error")}if(navigator.getUserMedia){this._waiting_confirmation=!0;var constraints={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(constraints).then(this.streamReady.bind(this)).catch(onFailSoHard);var that=this}},LGraphTextureWebcam.prototype.closeStream=function(){if(this._webcam_stream){var tracks=this._webcam_stream.getTracks();if(tracks.length)for(var i=0;i<tracks.length;++i)tracks[i].stop();this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},LGraphTextureWebcam.prototype.streamReady=function(localMediaStream){this._webcam_stream=localMediaStream,this.boxcolor="green";var video=this._video;video||(video=document.createElement("video"),video.autoplay=!0,video.srcObject=localMediaStream,this._video=video,video.onloadedmetadata=function(e){console.log(e)}),this.trigger("stream_ready",video)},LGraphTextureWebcam.prototype.onPropertyChanged=function(name,value){"facingMode"==name&&(this.properties.facingMode=value,this.closeStream(),this.openStream())},LGraphTextureWebcam.prototype.onRemoved=function(){if(this._webcam_stream){var tracks=this._webcam_stream.getTracks();if(tracks.length)for(var i=0;i<tracks.length;++i)tracks[i].stop();this._webcam_stream=null,this._video=null}},LGraphTextureWebcam.prototype.onDrawBackground=function(ctx){this.flags.collapsed||this.size[1]<=20||this._video&&(ctx.save(),ctx.webgl?this._video_texture&&ctx.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):ctx.drawImage(this._video,0,0,this.size[0],this.size[1]),ctx.restore())},LGraphTextureWebcam.prototype.onExecute=function(){if(null!=this._webcam_stream||this._waiting_confirmation||this.openStream(),this._video&&this._video.videoWidth){var width=this._video.videoWidth,height=this._video.videoHeight,temp=this._video_texture;if(temp&&temp.width==width&&temp.height==height||(this._video_texture=new GL.Texture(width,height,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){LGraphTexture.getTexturesContainer()[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var i=1;i<this.outputs.length;++i)if(this.outputs[i])switch(this.outputs[i].name){case"width":this.setOutputData(i,this._video.videoWidth);break;case"height":this.setOutputData(i,this._video.videoHeight)}}},LGraphTextureWebcam.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",LiteGraph.EVENT],["stream_closed",LiteGraph.EVENT],["stream_error",LiteGraph.EVENT]]},LiteGraph.registerNodeType("texture/webcam",LGraphTextureWebcam),LGraphLensFX.title="Lens FX",LGraphLensFX.desc="distortion and chromatic aberration",LGraphLensFX.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphLensFX.prototype.onGetInputs=function(){return[["enabled","boolean"]]},LGraphLensFX.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&this.isOutputConnected(0)){if(this.properties.precision===LGraphTexture.PASS_THROUGH||!1===this.getInputOrProperty("enabled"))return void this.setOutputData(0,tex);var temp=this._temp_texture;temp&&temp.width==tex.width&&temp.height==tex.height&&temp.type==tex.type||(temp=this._temp_texture=new GL.Texture(tex.width,tex.height,{type:tex.type,format:gl.RGBA,filter:gl.LINEAR}));var shader=LGraphLensFX._shader;shader||(shader=LGraphLensFX._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphLensFX.pixel_shader));var factor=this.getInputData(1);null==factor&&(factor=this.properties.factor);var uniforms=this._uniforms;uniforms.u_factor=factor,gl.disable(gl.DEPTH_TEST),temp.drawTo(function(){tex.bind(0),shader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,temp)}},LGraphLensFX.pixel_shader="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_factor;\n\t\t\tvec2 barrelDistortion(vec2 coord, float amt) {\n\t\t\t\tvec2 cc = coord - 0.5;\n\t\t\t\tfloat dist = dot(cc, cc);\n\t\t\t\treturn coord + cc * dist * amt;\n\t\t\t}\n\t\t\t\n\t\t\tfloat sat( float t )\n\t\t\t{\n\t\t\t\treturn clamp( t, 0.0, 1.0 );\n\t\t\t}\n\t\t\t\n\t\t\tfloat linterp( float t ) {\n\t\t\t\treturn sat( 1.0 - abs( 2.0*t - 1.0 ) );\n\t\t\t}\n\t\t\t\n\t\t\tfloat remap( float t, float a, float b ) {\n\t\t\t\treturn sat( (t - a) / (b - a) );\n\t\t\t}\n\t\t\t\n\t\t\tvec4 spectrum_offset( float t ) {\n\t\t\t\tvec4 ret;\n\t\t\t\tfloat lo = step(t,0.5);\n\t\t\t\tfloat hi = 1.0-lo;\n\t\t\t\tfloat w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );\n\t\t\t\tret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);\n\t\t\t\n\t\t\t\treturn pow( ret, vec4(1.0/2.2) );\n\t\t\t}\n\t\t\t\n\t\t\tconst float max_distort = 2.2;\n\t\t\tconst int num_iter = 12;\n\t\t\tconst float reci_num_iter_f = 1.0 / float(num_iter);\n\t\t\t\n\t\t\tvoid main()\n\t\t\t{\t\n\t\t\t\tvec2 uv=v_coord;\n\t\t\t\tvec4 sumcol = vec4(0.0);\n\t\t\t\tvec4 sumw = vec4(0.0);\t\n\t\t\t\tfor ( int i=0; i<num_iter;++i )\n\t\t\t\t{\n\t\t\t\t\tfloat t = float(i) * reci_num_iter_f;\n\t\t\t\t\tvec4 w = spectrum_offset( t );\n\t\t\t\t\tsumw += w;\n\t\t\t\t\tsumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );\n\t\t\t\t}\n\t\t\t\tgl_FragColor = sumcol / sumw;\n\t\t\t}",LiteGraph.registerNodeType("texture/lensfx",LGraphLensFX),LGraphExposition.title="Exposition",LGraphExposition.desc="Controls texture exposition",LGraphExposition.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphExposition.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&this.isOutputConnected(0)){var temp=this._temp_texture;temp&&temp.width==tex.width&&temp.height==tex.height&&temp.type==tex.type||(temp=this._temp_texture=new GL.Texture(tex.width,tex.height,{type:tex.type,format:gl.RGBA,filter:gl.LINEAR}));var shader=LGraphExposition._shader;shader||(shader=LGraphExposition._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphExposition.pixel_shader));var exp_input=(this.properties.exposition,this.getInputData(1));null!=exp_input&&(this.properties.exposition=exp_input);var uniforms=this._uniforms;temp.drawTo(function(){gl.disable(gl.DEPTH_TEST),tex.bind(0),shader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,temp)}},LGraphExposition.pixel_shader="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_exposition;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D( u_texture, v_coord );\n\t\t\t\tgl_FragColor = vec4( color.xyz * u_exposition, color.a );\n\t\t\t}",LiteGraph.registerNodeType("texture/exposition",LGraphExposition),LGraphToneMapping.title="Tone Mapping",LGraphToneMapping.desc="Applies Tone Mapping to convert from high to low",LGraphToneMapping.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphToneMapping.prototype.onGetInputs=function(){return[["enabled","boolean"]]},LGraphToneMapping.prototype.onExecute=function(){var tex=this.getInputData(0);if(tex&&this.isOutputConnected(0)){if(this.properties.precision===LGraphTexture.PASS_THROUGH||!1===this.getInputOrProperty("enabled"))return void this.setOutputData(0,tex);var temp=this._temp_texture;temp&&temp.width==tex.width&&temp.height==tex.height&&temp.type==tex.type||(temp=this._temp_texture=new GL.Texture(tex.width,tex.height,{type:tex.type,format:gl.RGBA,filter:gl.LINEAR}));var shader=LGraphToneMapping._shader;shader||(shader=LGraphToneMapping._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphToneMapping.pixel_shader));var avg=this.getInputData(1);null!=avg&&(this.properties.average_lum=avg);var uniforms=this._uniforms;uniforms.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,uniforms.u_scale=this.properties.scale,uniforms.u_average_lum=this.properties.average_lum,uniforms.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),temp.drawTo(function(){tex.bind(0),shader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},LGraphToneMapping.pixel_shader="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_scale;\n\t\t\tuniform float u_average_lum;\n\t\t\tuniform float u_lumwhite2;\n\t\t\tuniform float u_igamma;\n\t\t\tvec3 RGB2xyY (vec3 rgb)\n\t\t\t{\n\t\t\t\t const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,\n\t\t\t\t\t\t\t\t\t\t   0.2126, 0.7152, 0.0722,\n\t\t\t\t\t\t\t\t\t\t   0.0193, 0.1192, 0.9505);\n\t\t\t\tvec3 XYZ = RGB2XYZ * rgb;\n\t\t\t\t\n\t\t\t\tfloat f = (XYZ.x + XYZ.y + XYZ.z);\n\t\t\t\treturn vec3(XYZ.x / f,\n\t\t\t\t\t\t\tXYZ.y / f,\n\t\t\t\t\t\t\tXYZ.y);\n\t\t\t}\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D( u_texture, v_coord );\n\t\t\t\tvec3 rgb = color.xyz;\n\t\t\t\t//Ld - this part of the code is the same for both versions\n\t\t\t\tfloat lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));\n\t\t\t\tfloat L = (u_scale / u_average_lum) * lum;\n\t\t\t\tfloat Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);\n\t\t\t\t//first\n\t\t\t\t//vec3 xyY = RGB2xyY(rgb);\n\t\t\t\t//xyY.z *= Ld;\n\t\t\t\t//rgb = xyYtoRGB(xyY);\n\t\t\t\t//second\n\t\t\t\trgb = (rgb / lum) * Ld;\n\t\t\t\trgb = pow( rgb, vec3( u_igamma ) );\n\t\t\t\tgl_FragColor = vec4( rgb, color.a );\n\t\t\t}",LiteGraph.registerNodeType("texture/tonemapping",LGraphToneMapping),LGraphTexturePerlin.title="Perlin";LGraphTexturePerlin.desc="Generates a perlin noise texture",LGraphTexturePerlin.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES},width:{type:"Number",precision:0,step:1},height:{type:"Number",precision:0,step:1},octaves:{type:"Number",precision:0,step:1,min:1,max:50}},LGraphTexturePerlin.prototype.onExecute=function(){if(this.isOutputConnected(0)){var w=0|this.properties.width,h=0|this.properties.height;0==w&&(w=gl.viewport_data[2]),0==h&&(h=gl.viewport_data[3]);var type=LGraphTexture.getTextureType(this.properties.precision),temp=this._temp_texture;temp&&temp.width==w&&temp.height==h&&temp.type==type||(temp=this._temp_texture=new GL.Texture(w,h,{type:type,format:gl.RGB,filter:gl.LINEAR}));var key=w+h+type+this.properties.persistence+this.properties.octaves+this.properties.scale+this.properties.seed+this.properties.offset[0]+this.properties.offset[1]+this.properties.amplitude;if(key==this._key)return void this.setOutputData(0,temp);this._key=key;var uniforms=this._uniforms;uniforms.u_persistence=this.properties.persistence,uniforms.u_octaves=this.properties.octaves,uniforms.u_offset[0]=this.properties.offset[0],uniforms.u_offset[1]=this.properties.offset[1],uniforms.u_scale=this.properties.scale,uniforms.u_amplitude=this.properties.amplitude,uniforms.u_viewport[0]=w,uniforms.u_viewport[1]=h,uniforms.u_seed=128*this.properties.seed;var shader=LGraphTexturePerlin._shader;shader||(shader=LGraphTexturePerlin._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTexturePerlin.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),temp.drawTo(function(){shader.uniforms(uniforms).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,temp)}},LGraphTexturePerlin.pixel_shader="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform vec2 u_offset;\n\t\t\tuniform float u_scale;\n\t\t\tuniform float u_persistence;\n\t\t\tuniform int u_octaves;\n\t\t\tuniform float u_amplitude;\n\t\t\tuniform vec2 u_viewport;\n\t\t\tuniform float u_seed;\n\t\t\t#define M_PI 3.14159265358979323846\n\t\t\t\n\t\t\tfloat rand(vec2 c){\treturn fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }\n\t\t\t\n\t\t\tfloat noise(vec2 p, float freq ){\n\t\t\t\tfloat unit = u_viewport.x/freq;\n\t\t\t\tvec2 ij = floor(p/unit);\n\t\t\t\tvec2 xy = mod(p,unit)/unit;\n\t\t\t\t//xy = 3.*xy*xy-2.*xy*xy*xy;\n\t\t\t\txy = .5*(1.-cos(M_PI*xy));\n\t\t\t\tfloat a = rand((ij+vec2(0.,0.)));\n\t\t\t\tfloat b = rand((ij+vec2(1.,0.)));\n\t\t\t\tfloat c = rand((ij+vec2(0.,1.)));\n\t\t\t\tfloat d = rand((ij+vec2(1.,1.)));\n\t\t\t\tfloat x1 = mix(a, b, xy.x);\n\t\t\t\tfloat x2 = mix(c, d, xy.x);\n\t\t\t\treturn mix(x1, x2, xy.y);\n\t\t\t}\n\t\t\t\n\t\t\tfloat pNoise(vec2 p, int res){\n\t\t\t\tfloat persistance = u_persistence;\n\t\t\t\tfloat n = 0.;\n\t\t\t\tfloat normK = 0.;\n\t\t\t\tfloat f = 4.;\n\t\t\t\tfloat amp = 1.0;\n\t\t\t\tint iCount = 0;\n\t\t\t\tfor (int i = 0; i<50; i++){\n\t\t\t\t\tn+=amp*noise(p, f);\n\t\t\t\t\tf*=2.;\n\t\t\t\t\tnormK+=amp;\n\t\t\t\t\tamp*=persistance;\n\t\t\t\t\tif (iCount >= res)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tiCount++;\n\t\t\t\t}\n\t\t\t\tfloat nf = n/normK;\n\t\t\t\treturn nf*nf*nf*nf;\n\t\t\t}\n\t\t\tvoid main() {\n\t\t\t\tvec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;\n\t\t\t\tvec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );\n\t\t\t\tgl_FragColor = color;\n\t\t\t}",LiteGraph.registerNodeType("texture/perlin",LGraphTexturePerlin),LGraphTextureCanvas2D.title="Canvas2D",LGraphTextureCanvas2D.desc="Executes Canvas2D code inside a texture or the viewport",LGraphTextureCanvas2D.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES},code:{type:"code"},width:{type:"Number",precision:0,step:1},height:{type:"Number",precision:0,step:1}},LGraphTextureCanvas2D.prototype.onPropertyChanged=function(name,value){if("code"==name&&LiteGraph.allow_scripts){this._func=null;try{this._func=new Function("canvas","ctx","time","script",value),this.boxcolor="#00FF00"}catch(err){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(err)}}},LGraphTextureCanvas2D.prototype.onExecute=function(){var func=this._func;if(func&&this.isOutputConnected(0)){if(!global.enableWebGLCanvas)return void console.warn("cannot use LGraphTextureCanvas2D if Canvas2DtoWebGL is not included");var width=this.properties.width||gl.canvas.width,height=this.properties.height||gl.canvas.height,temp=this._temp_texture;temp&&temp.width==width&&temp.height==height||(temp=this._temp_texture=new GL.Texture(width,height,{format:gl.RGBA,filter:gl.LINEAR}));var that=this,time=this.graph.getTime();temp.drawTo(function(){gl.start2D();try{func.draw?func.draw.call(that,gl.canvas,gl,time,func):func.call(that,gl.canvas,gl,time,func),that.boxcolor="#00FF00"}catch(err){that.boxcolor="#FF0000",console.error("Error executing script"),console.error(err)}gl.finish2D()}),this.setOutputData(0,temp)}},LiteGraph.registerNodeType("texture/canvas2D",LGraphTextureCanvas2D),LGraphTextureMatte.title="Matte",LGraphTextureMatte.desc="Extracts background",LGraphTextureMatte.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphTextureMatte.prototype.onExecute=function(){if(this.isOutputConnected(0)){var tex=this.getInputData(0);if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);if(tex){this._tex=LGraphTexture.getTargetTexture(tex,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var uniforms=this._uniforms,mesh=Mesh.getScreenQuad(),shader=LGraphTextureMatte._shader;shader||(shader=LGraphTextureMatte._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphTextureMatte.pixel_shader)),uniforms.u_key_color=this.properties.key_color,uniforms.u_threshold=this.properties.threshold,uniforms.u_slope=this.properties.slope,this._tex.drawTo(function(){tex.bind(0),shader.uniforms(uniforms).draw(mesh)}),this.setOutputData(0,this._tex)}}},LGraphTextureMatte.pixel_shader="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec3 u_key_color;\n\t\t\tuniform float u_threshold;\n\t\t\tuniform float u_slope;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec3 color = texture2D( u_texture, v_coord ).xyz;\n\t\t\t\tfloat diff = length( normalize(color) - normalize(u_key_color) );\n\t\t\t\tfloat edge = u_threshold * (1.0 - u_slope);\n\t\t\t\tfloat alpha = smoothstep( edge, u_threshold, diff);\n\t\t\t\tgl_FragColor = vec4( color, alpha );\n\t\t\t}",LiteGraph.registerNodeType("texture/matte",LGraphTextureMatte),LGraphCubemap.title="Cubemap",LGraphCubemap.prototype.onDropFile=function(data,filename,file){data?(this._drop_texture="string"==typeof data?GL.Texture.fromURL(data):GL.Texture.fromDDSInMemory(data),this.properties.name=filename):(this._drop_texture=null,this.properties.name="")},LGraphCubemap.prototype.onExecute=function(){if(this._drop_texture)return void this.setOutputData(0,this._drop_texture);if(this.properties.name){var tex=LGraphTexture.getTexture(this.properties.name);tex&&(this._last_tex=tex,this.setOutputData(0,tex))}},LGraphCubemap.prototype.onDrawBackground=function(ctx){if(!(this.flags.collapsed||this.size[1]<=20)&&ctx.webgl){var cube_mesh=gl.meshes.cube;cube_mesh||(cube_mesh=gl.meshes.cube=GL.Mesh.cube({size:1}))}},LiteGraph.registerNodeType("texture/cubemap",LGraphCubemap)}}(exports),function(global){function LGraphFXLens(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:LGraphTexture.DEFAULT},LGraphFXLens._shader||(LGraphFXLens._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,LGraphFXLens.pixel_shader),LGraphFXLens._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))}function LGraphFXBokeh(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}}function LGraphFXGeneric(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:LGraphTexture.DEFAULT}}function LGraphFXVigneting(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:LGraphTexture.DEFAULT},LGraphFXVigneting._shader||(LGraphFXVigneting._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphFXVigneting.pixel_shader))}var LiteGraph=global.LiteGraph;"undefined"!=typeof GL&&(LGraphFXLens.title="Lens",LGraphFXLens.desc="Camera Lens distortion",LGraphFXLens.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphFXLens.prototype.onExecute=function(){var tex=this.getInputData(0);if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);if(tex){this._tex=LGraphTexture.getTargetTexture(tex,this._tex,this.properties.precision);var aberration=this.properties.aberration;this.isInputConnected(1)&&(aberration=this.getInputData(1),this.properties.aberration=aberration);var distortion=this.properties.distortion;this.isInputConnected(2)&&(distortion=this.getInputData(2),this.properties.distortion=distortion);var blur=this.properties.blur;this.isInputConnected(3)&&(blur=this.getInputData(3),this.properties.blur=blur),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad(),shader=LGraphFXLens._shader;this._tex.drawTo(function(){tex.bind(0),shader.uniforms({u_texture:0,u_aberration:aberration,u_distortion:distortion,u_blur:blur}).draw(mesh)}),this.setOutputData(0,this._tex)}},LGraphFXLens.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform float u_aberration;\n\t\t\tuniform float u_distortion;\n\t\t\tuniform float u_blur;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 coord = v_coord;\n\t\t\t\tfloat dist = distance(vec2(0.5), coord);\n\t\t\t\tvec2 dist_coord = coord - vec2(0.5);\n\t\t\t\tfloat percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;\n\t\t\t\tdist_coord *= percent;\n\t\t\t\tcoord = dist_coord + vec2(0.5);\n\t\t\t\tvec4 color = texture2D(u_texture,coord, u_blur * dist);\n\t\t\t\tcolor.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;\n\t\t\t\tcolor.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;\n\t\t\t\tgl_FragColor = color;\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("fx/lens",LGraphFXLens),global.LGraphFXLens=LGraphFXLens,LGraphFXBokeh.title="Bokeh",LGraphFXBokeh.desc="applies an Bokeh effect",LGraphFXBokeh.widgets_info={shape:{widget:"texture"}},LGraphFXBokeh.prototype.onExecute=function(){var tex=this.getInputData(0),blurred_tex=this.getInputData(1),mask_tex=this.getInputData(2);if(!tex||!mask_tex||!this.properties.shape)return void this.setOutputData(0,tex);blurred_tex||(blurred_tex=tex);var shape_tex=LGraphTexture.getTexture(this.properties.shape);if(shape_tex){var threshold=this.properties.threshold;this.isInputConnected(3)&&(threshold=this.getInputData(3),this.properties.threshold=threshold);var precision=gl.UNSIGNED_BYTE;this.properties.high_precision&&(precision=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),this._temp_texture&&this._temp_texture.type==precision&&this._temp_texture.width==tex.width&&this._temp_texture.height==tex.height||(this._temp_texture=new GL.Texture(tex.width,tex.height,{type:precision,format:gl.RGBA,filter:gl.LINEAR}));var first_shader=(this.properties.size,LGraphFXBokeh._first_shader);first_shader||(first_shader=LGraphFXBokeh._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,LGraphFXBokeh._first_pixel_shader));var second_shader=LGraphFXBokeh._second_shader;second_shader||(second_shader=LGraphFXBokeh._second_shader=new GL.Shader(LGraphFXBokeh._second_vertex_shader,LGraphFXBokeh._second_pixel_shader));var points_mesh=this._points_mesh;points_mesh&&points_mesh._width==tex.width&&points_mesh._height==tex.height&&2==points_mesh._spacing||(points_mesh=this.createPointsMesh(tex.width,tex.height,2));var screen_mesh=Mesh.getScreenQuad(),point_size=this.properties.size,alpha=(this.properties.min_light,this.properties.alpha);gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){tex.bind(0),blurred_tex.bind(1),mask_tex.bind(2),first_shader.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[tex.width,tex.height]}).draw(screen_mesh)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),tex.bind(0),shape_tex.bind(3),second_shader.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:alpha,u_threshold:threshold,u_pointSize:point_size,u_itexsize:[1/tex.width,1/tex.height]}).draw(points_mesh,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},LGraphFXBokeh.prototype.createPointsMesh=function(width,height,spacing){for(var nwidth=Math.round(width/spacing),nheight=Math.round(height/spacing),vertices=new Float32Array(nwidth*nheight*2),ny=-1,dx=2/width*spacing,dy=2/height*spacing,y=0;y<nheight;++y){for(var nx=-1,x=0;x<nwidth;++x){var pos=y*nwidth*2+2*x;vertices[pos]=nx,vertices[pos+1]=ny,nx+=dx}ny+=dy}return this._points_mesh=GL.Mesh.load({vertices2D:vertices}),this._points_mesh._width=width,this._points_mesh._height=height,this._points_mesh._spacing=spacing,this._points_mesh},LGraphFXBokeh._first_pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_texture_blur;\n\t\t\tuniform sampler2D u_mask;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tvec4 blurred_color = texture2D(u_texture_blur, v_coord);\n\t\t\t\tfloat mask = texture2D(u_mask, v_coord).x;\n\t\t\t   gl_FragColor = mix(color, blurred_color, mask);\n\t\t\t}\n\t\t\t",LGraphFXBokeh._second_vertex_shader="precision highp float;\n\t\t\tattribute vec2 a_vertex2D;\n\t\t\tvarying vec4 v_color;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_mask;\n\t\t\tuniform vec2 u_itexsize;\n\t\t\tuniform float u_pointSize;\n\t\t\tuniform float u_threshold;\n\t\t\tvoid main() {\n\t\t\t\tvec2 coord = a_vertex2D * 0.5 + 0.5;\n\t\t\t\tv_color = texture2D( u_texture, coord );\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );\n\t\t\t\tv_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));\n\t\t\t\tv_color += texture2D( u_texture, coord + u_itexsize);\n\t\t\t\tv_color *= 0.25;\n\t\t\t\tfloat mask = texture2D(u_mask, coord).x;\n\t\t\t\tfloat luminance = length(v_color) * mask;\n\t\t\t\t/*luminance /= (u_pointSize*u_pointSize)*0.01 */;\n\t\t\t\tluminance -= u_threshold;\n\t\t\t\tif(luminance < 0.0)\n\t\t\t\t{\n\t\t\t\t\tgl_Position.x = -100.0;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tgl_PointSize = u_pointSize;\n\t\t\t\tgl_Position = vec4(a_vertex2D,0.0,1.0);\n\t\t\t}\n\t\t\t",LGraphFXBokeh._second_pixel_shader="precision highp float;\n\t\t\tvarying vec4 v_color;\n\t\t\tuniform sampler2D u_shape;\n\t\t\tuniform float u_alpha;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D( u_shape, gl_PointCoord );\n\t\t\t\tcolor *= v_color * u_alpha;\n\t\t\t\tgl_FragColor = color;\n\t\t\t}\n",LiteGraph.registerNodeType("fx/bokeh",LGraphFXBokeh),global.LGraphFXBokeh=LGraphFXBokeh,LGraphFXGeneric.title="FX",LGraphFXGeneric.desc="applies an FX from a list",LGraphFXGeneric.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphFXGeneric.shaders={},LGraphFXGeneric.prototype.onExecute=function(){if(this.isOutputConnected(0)){var tex=this.getInputData(0);if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);if(tex){this._tex=LGraphTexture.getTargetTexture(tex,this._tex,this.properties.precision);var value1=this.properties.value1;this.isInputConnected(1)&&(value1=this.getInputData(1),this.properties.value1=value1);var value2=this.properties.value2;this.isInputConnected(2)&&(value2=this.getInputData(2),this.properties.value2=value2);var fx=this.properties.fx,shader=LGraphFXGeneric.shaders[fx];if(!shader){var pixel_shader_code=LGraphFXGeneric["pixel_shader_"+fx];if(!pixel_shader_code)return;shader=LGraphFXGeneric.shaders[fx]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,pixel_shader_code)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad(),camera=global.LS?LS.Renderer._current_camera:null;camera_planes=camera?[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:[1,100];var noise=null;"noise"==fx&&(noise=LGraphTexture.getNoiseTexture()),this._tex.drawTo(function(){tex.bind(0),"noise"==fx&&noise.bind(1),shader.uniforms({u_texture:0,u_noise:1,u_size:[tex.width,tex.height],u_rand:[Math.random(),Math.random()],u_value1:value1,u_value2:value2,u_camera_planes:camera_planes}).draw(mesh)}),this.setOutputData(0,this._tex)}}},LGraphFXGeneric.pixel_shader_halftone="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\t\n\t\t\tfloat pattern() {\n\t\t\t\tfloat s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);\n\t\t\t\tvec2 tex = v_coord * u_size.xy;\n\t\t\t\tvec2 point = vec2(\n\t\t\t\t   c * tex.x - s * tex.y ,\n\t\t\t\t   s * tex.x + c * tex.y \n\t\t\t\t) * u_value2;\n\t\t\t\treturn (sin(point.x) * sin(point.y)) * 4.0;\n\t\t\t}\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tfloat average = (color.r + color.g + color.b) / 3.0;\n\t\t\t\tgl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n\t\t\t}\n",LGraphFXGeneric.pixel_shader_pixelate="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );\n\t\t\t\tvec4 color = texture2D(u_texture, coord);\n\t\t\t\tgl_FragColor = color;\n\t\t\t}\n",LGraphFXGeneric.pixel_shader_lowpalette="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform vec2 u_camera_planes;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tgl_FragColor = floor(color * u_value1) / u_value1;\n\t\t\t}\n",LGraphFXGeneric.pixel_shader_noise="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform sampler2D u_noise;\n\t\t\tuniform vec2 u_size;\n\t\t\tuniform float u_value1;\n\t\t\tuniform float u_value2;\n\t\t\tuniform vec2 u_rand;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tvec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);\n\t\t\t\tgl_FragColor = vec4( color.xyz + noise * u_value1, color.a );\n\t\t\t}\n",LGraphFXGeneric.pixel_shader_gamma="precision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_value1;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tfloat gamma = 1.0 / u_value1;\n\t\t\t\tgl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );\n\t\t\t}\n",LiteGraph.registerNodeType("fx/generic",LGraphFXGeneric),global.LGraphFXGeneric=LGraphFXGeneric,LGraphFXVigneting.title="Vigneting",LGraphFXVigneting.desc="Vigneting",LGraphFXVigneting.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},LGraphFXVigneting.prototype.onExecute=function(){var tex=this.getInputData(0);if(this.properties.precision===LGraphTexture.PASS_THROUGH)return void this.setOutputData(0,tex);if(tex){this._tex=LGraphTexture.getTargetTexture(tex,this._tex,this.properties.precision);var intensity=this.properties.intensity;this.isInputConnected(1)&&(intensity=this.getInputData(1),this.properties.intensity=intensity),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var mesh=Mesh.getScreenQuad(),shader=LGraphFXVigneting._shader,invert=this.properties.invert;this._tex.drawTo(function(){tex.bind(0),shader.uniforms({u_texture:0,u_intensity:intensity,u_isize:[1/tex.width,1/tex.height],u_invert:invert?1:0}).draw(mesh)}),this.setOutputData(0,this._tex)}},LGraphFXVigneting.pixel_shader="precision highp float;\n\t\t\tprecision highp float;\n\t\t\tvarying vec2 v_coord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tuniform float u_intensity;\n\t\t\tuniform int u_invert;\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\tfloat luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;\n\t\t\t\tvec4 color = texture2D(u_texture, v_coord);\n\t\t\t\tif(u_invert == 1)\n\t\t\t\t\tluminance = 1.0 - luminance;\n\t\t\t\tluminance = mix(1.0, luminance, u_intensity);\n\t\t\t   gl_FragColor = vec4( luminance * color.xyz, color.a);\n\t\t\t}\n\t\t\t",LiteGraph.registerNodeType("fx/vigneting",LGraphFXVigneting),global.LGraphFXVigneting=LGraphFXVigneting)}(exports),function(global){function MIDIEvent(data){this.channel=0,this.cmd=0,data?this.setup(data):this.data=[0,0,0]}function MIDIInterface(on_ready,on_error){if(!navigator.requestMIDIAccess)return this.error="not suppoorted",void(on_error?on_error("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags"));this.on_ready=on_ready,this.state={note:[],cc:[]},navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}function LGMIDIIn(){this.addOutput("on_midi",LiteGraph.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null;var that=this;new MIDIInterface(function(midi){that._midi=midi,that._waiting&&that.onStart(),that._waiting=!1})}function LGMIDIOut(){this.addInput("send",LiteGraph.EVENT),this.properties={port:0};var that=this;new MIDIInterface(function(midi){that._midi=midi})}function LGMIDIShow(){this.addInput("on_midi",LiteGraph.EVENT),this._str="",this.size=[200,40]}function LGMIDIFilter(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1},this.addInput("in",LiteGraph.EVENT),this.addOutput("on_midi",LiteGraph.EVENT)}function LGMIDIEvent(){this.properties={channel:0,cmd:"CC",value1:1,value2:1},this.addInput("send",LiteGraph.EVENT),this.addInput("assign",LiteGraph.EVENT),this.addOutput("on_midi",LiteGraph.EVENT)}function LGMIDICC(){this.properties={cc:1,value:0},this.addOutput("value","number")}var LiteGraph=global.LiteGraph;MIDIEvent.prototype.setup=function(raw_data){this.data=raw_data;var midiStatus=raw_data[0];this.status=midiStatus;var midiCommand=240&midiStatus;this.cmd=midiStatus>=240?midiStatus:midiCommand,this.cmd==MIDIEvent.NOTEON&&0==this.velocity&&(this.cmd=MIDIEvent.NOTEOFF),this.cmd_str=MIDIEvent.commands[this.cmd]||"",(midiCommand>=MIDIEvent.NOTEON||midiCommand<=MIDIEvent.NOTEOFF)&&(this.channel=15&midiStatus)},Object.defineProperty(MIDIEvent.prototype,"velocity",{get:function(){return this.cmd==MIDIEvent.NOTEON?this.data[2]:-1},set:function(v){this.data[2]=v},enumerable:!0}),MIDIEvent.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],MIDIEvent.prototype.getPitch=function(){return 440*Math.pow(2,(this.data[1]-69)/12)},MIDIEvent.computePitch=function(note){return 440*Math.pow(2,(note-69)/12)},MIDIEvent.prototype.getCC=function(){return this.data[1]},MIDIEvent.prototype.getCCValue=function(){return this.data[2]},MIDIEvent.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},MIDIEvent.computePitchBend=function(v1,v2){return v1+(v2<<7)-8192},MIDIEvent.prototype.setCommandFromString=function(str){this.cmd=MIDIEvent.computeCommandFromString(str)},MIDIEvent.computeCommandFromString=function(str){if(!str)return 0;if(str&&str.constructor===Number)return str;switch(str=str.toUpperCase()){case"NOTE ON":case"NOTEON":return MIDIEvent.NOTEON;case"NOTE OFF":case"NOTEOFF":return MIDIEvent.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return MIDIEvent.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return MIDIEvent.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return MIDIEvent.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return MIDIEvent.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return MIDIEvent.PITCHBEND;case"TIME TICK":case"TIMETICK":return MIDIEvent.TIMETICK;default:return Number(str)}},MIDIEvent.toNoteString=function(d){var note=d-21,octave=d-24;return note%=12,note<0&&(note=12+note),MIDIEvent.notes[note]+Math.floor(octave/12+1)},MIDIEvent.prototype.toString=function(){var str=this.channel+". ";switch(this.cmd){case MIDIEvent.NOTEON:str+="NOTEON "+MIDIEvent.toNoteString(this.data[1]);break;case MIDIEvent.NOTEOFF:str+="NOTEOFF "+MIDIEvent.toNoteString(this.data[1]);break;case MIDIEvent.CONTROLLERCHANGE:str+="CC "+this.data[1]+" "+this.data[2];break;case MIDIEvent.PROGRAMCHANGE:str+="PC "+this.data[1];break;case MIDIEvent.PITCHBEND:str+="PITCHBEND "+this.getPitchBend();break;case MIDIEvent.KEYPRESSURE:str+="KEYPRESS "+this.data[1]}return str},MIDIEvent.prototype.toHexString=function(){for(var str="",i=0;i<this.data.length;i++)str+=this.data[i].toString(16)+" "},MIDIEvent.NOTEOFF=128,MIDIEvent.NOTEON=144,MIDIEvent.KEYPRESSURE=160,MIDIEvent.CONTROLLERCHANGE=176,MIDIEvent.PROGRAMCHANGE=192,MIDIEvent.CHANNELPRESSURE=208,MIDIEvent.PITCHBEND=224,MIDIEvent.TIMETICK=248,MIDIEvent.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},MIDIInterface.input=null,MIDIInterface.MIDIEvent=MIDIEvent,MIDIInterface.prototype.onMIDISuccess=function(midiAccess){console.log("MIDI ready!"),console.log(midiAccess),this.midi=midiAccess,this.updatePorts(),this.on_ready&&this.on_ready(this)},MIDIInterface.prototype.updatePorts=function(){var midi=this.midi;this.input_ports=midi.inputs;for(var num=0,it=this.input_ports.values(),it_value=it.next();it_value&&!1===it_value.done;){var port_info=it_value.value;console.log("Input port [type:'"+port_info.type+"'] id:'"+port_info.id+"' manufacturer:'"+port_info.manufacturer+"' name:'"+port_info.name+"' version:'"+port_info.version+"'"),num++,it_value=it.next()}this.num_input_ports=num,num=0,this.output_ports=midi.outputs;for(var it=this.output_ports.values(),it_value=it.next();it_value&&!1===it_value.done;){var port_info=it_value.value;console.log("Output port [type:'"+port_info.type+"'] id:'"+port_info.id+"' manufacturer:'"+port_info.manufacturer+"' name:'"+port_info.name+"' version:'"+port_info.version+"'"),num++,it_value=it.next()}this.num_output_ports=num},MIDIInterface.prototype.onMIDIFailure=function(msg){console.error("Failed to get MIDI access - "+msg)},MIDIInterface.prototype.openInputPort=function(port,callback){var input_port=this.input_ports.get("input-"+port);if(!input_port)return!1;MIDIInterface.input=this;var that=this;return input_port.onmidimessage=function(a){var midi_event=new MIDIEvent(a.data);that.updateState(midi_event),callback&&callback(a.data,midi_event),MIDIInterface.on_message&&MIDIInterface.on_message(a.data,midi_event)},console.log("port open: ",input_port),!0},MIDIInterface.parseMsg=function(data){},MIDIInterface.prototype.updateState=function(midi_event){switch(midi_event.cmd){case MIDIEvent.NOTEON:this.state.note[0|midi_event.value1]=midi_event.value2;break;case MIDIEvent.NOTEOFF:this.state.note[0|midi_event.value1]=0;break;case MIDIEvent.CONTROLLERCHANGE:this.state.cc[midi_event.getCC()]=midi_event.getCCValue()}},MIDIInterface.prototype.sendMIDI=function(port,midi_data){if(midi_data){var output_port=this.output_ports.get("output-"+port);output_port&&(MIDIInterface.output=this,midi_data.constructor===MIDIEvent?output_port.send(midi_data.data):output_port.send(midi_data))}},LGMIDIIn.MIDIInterface=MIDIInterface,LGMIDIIn.title="MIDI Input",LGMIDIIn.desc="Reads MIDI from a input port",LGMIDIIn.prototype.getPropertyInfo=function(name){if(this._midi&&"port"==name){for(var values={},i=0;i<this._midi.input_ports.size;++i){var input=this._midi.input_ports.get("input-"+i);values[i]=i+".- "+input.name+" version:"+input.version}return{type:"enum",values:values}}},LGMIDIIn.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},LGMIDIIn.prototype.onMIDIEvent=function(data,midi_event){this._last_midi_event=midi_event,this.trigger("on_midi",midi_event),midi_event.cmd==MIDIEvent.NOTEON?this.trigger("on_noteon",midi_event):midi_event.cmd==MIDIEvent.NOTEOFF?this.trigger("on_noteoff",midi_event):midi_event.cmd==MIDIEvent.CONTROLLERCHANGE?this.trigger("on_cc",midi_event):midi_event.cmd==MIDIEvent.PROGRAMCHANGE?this.trigger("on_pc",midi_event):midi_event.cmd==MIDIEvent.PITCHBEND&&this.trigger("on_pitchbend",midi_event)},LGMIDIIn.prototype.onExecute=function(){if(this.outputs)for(var last=this._last_midi_event,i=0;i<this.outputs.length;++i){var output=this.outputs[i],v=null;switch(output.name){case"midi":v=this._midi;break;case"last_midi":v=last;break;default:continue}this.setOutputData(i,v)}},LGMIDIIn.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",LiteGraph.EVENT],["on_noteon",LiteGraph.EVENT],["on_noteoff",LiteGraph.EVENT],["on_cc",LiteGraph.EVENT],["on_pc",LiteGraph.EVENT],["on_pitchbend",LiteGraph.EVENT]]},LiteGraph.registerNodeType("midi/input",LGMIDIIn),LGMIDIOut.MIDIInterface=MIDIInterface,LGMIDIOut.title="MIDI Output",LGMIDIOut.desc="Sends MIDI to output channel",LGMIDIOut.prototype.getPropertyInfo=function(name){if(this._midi&&"port"==name){for(var values={},i=0;i<this._midi.output_ports.size;++i){var output=this._midi.output_ports.get(i);values[i]=i+".- "+output.name+" version:"+output.version}return{type:"enum",values:values}}},LGMIDIOut.prototype.onAction=function(event,midi_event){console.log(midi_event),this._midi&&("send"==event&&this._midi.sendMIDI(this.port,midi_event),this.trigger("midi",midi_event))},LGMIDIOut.prototype.onGetInputs=function(){return[["send",LiteGraph.ACTION]]},LGMIDIOut.prototype.onGetOutputs=function(){return[["on_midi",LiteGraph.EVENT]]},LiteGraph.registerNodeType("midi/output",LGMIDIOut),LGMIDIShow.title="MIDI Show",LGMIDIShow.desc="Shows MIDI in the graph",LGMIDIShow.prototype.onAction=function(event,midi_event){midi_event&&(midi_event.constructor===MIDIEvent?this._str=midi_event.toString():this._str="???")},LGMIDIShow.prototype.onDrawForeground=function(ctx){this._str&&(ctx.font="30px Arial",ctx.fillText(this._str,10,.8*this.size[1]))},LGMIDIShow.prototype.onGetInputs=function(){return[["in",LiteGraph.ACTION]]},LGMIDIShow.prototype.onGetOutputs=function(){return[["on_midi",LiteGraph.EVENT]]},LiteGraph.registerNodeType("midi/show",LGMIDIShow),LGMIDIFilter.title="MIDI Filter",LGMIDIFilter.desc="Filters MIDI messages",LGMIDIFilter.prototype.onAction=function(event,midi_event){midi_event&&midi_event.constructor===MIDIEvent&&(-1!=this.properties.channel&&midi_event.channel!=this.properties.channel||-1!=this.properties.cmd&&midi_event.cmd!=this.properties.cmd||-1!=this.properties.min_value&&midi_event.data[1]<this.properties.min_value||-1!=this.properties.max_value&&midi_event.data[1]>this.properties.max_value||this.trigger("on_midi",midi_event))},LiteGraph.registerNodeType("midi/filter",LGMIDIFilter),LGMIDIEvent.title="MIDIEvent",LGMIDIEvent.desc="Create a MIDI Event",LGMIDIEvent.prototype.onAction=function(event,midi_event){if("assign"==event)return this.properties.channel=midi_event.channel,this.properties.cmd=midi_event.cmd,this.properties.value1=midi_event.data[1],void(this.properties.value2=midi_event.data[2]);var midi_event=new MIDIEvent;midi_event.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?midi_event.setCommandFromString(this.properties.cmd):midi_event.cmd=this.properties.cmd,midi_event.data[0]=midi_event.cmd|midi_event.channel,midi_event.data[1]=Number(this.properties.value1),midi_event.data[2]=Number(this.properties.value2),this.trigger("on_midi",midi_event)},LGMIDIEvent.prototype.onExecute=function(){var props=this.properties;if(this.outputs)for(var i=0;i<this.outputs.length;++i){var output=this.outputs[i],v=null;switch(output.name){case"midi":v=new MIDIEvent,v.setup([props.cmd,props.value1,props.value2]),v.channel=props.channel;break;case"command":v=props.cmd;break;case"cc":v=props.value1;break;case"cc_value":v=props.value2;break;case"note":v=props.cmd==MIDIEvent.NOTEON||props.cmd==MIDIEvent.NOTEOFF?props.value1:null;break;case"velocity":v=props.cmd==MIDIEvent.NOTEON?props.value2:null;break;case"pitch":v=props.cmd==MIDIEvent.NOTEON?MIDIEvent.computePitch(props.value1):null;break;case"pitchbend":v=props.cmd==MIDIEvent.PITCHBEND?MIDIEvent.computePitchBend(props.value1,props.value2):null;break;default:continue}null!==v&&this.setOutputData(i,v)}},LGMIDIEvent.prototype.onPropertyChanged=function(name,value){"cmd"==name&&(this.properties.cmd=MIDIEvent.computeCommandFromString(value))},LGMIDIEvent.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",LiteGraph.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["pitchbend","number"]]},LiteGraph.registerNodeType("midi/event",LGMIDIEvent),LGMIDICC.title="MIDICC",LGMIDICC.desc="gets a Controller Change",LGMIDICC.prototype.onExecute=function(){this.properties;MIDIInterface.input&&(this.properties.value=MIDIInterface.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},LiteGraph.registerNodeType("midi/cc",LGMIDICC)}(exports),function(global){function LGAudioSource(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var context=LGAudio.getAudioContext();this.audionode=context.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}function LGAudioMediaSource(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var context=LGAudio.getAudioContext();this.audionode=context.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}function LGAudioAnalyser(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var context=LGAudio.getAudioContext();this.audionode=context.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}function LGAudioGain(){this.properties={gain:1},this.audionode=LGAudio.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}function LGAudioConvolver(){this.properties={impulse_src:"",normalize:!0},this.audionode=LGAudio.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}function LGAudioDynamicsCompressor(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=LGAudio.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}function LGAudioWaveShaper(){this.properties={},this.audionode=LGAudio.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}function LGAudioMixer(){this.properties={gain1:.5,gain2:.5},this.audionode=LGAudio.getAudioContext().createGain(),this.audionode1=LGAudio.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=LGAudio.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}function LGAudioDelay(){this.properties={delayTime:.5},this.audionode=LGAudio.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}function LGAudioBiquadFilter(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=LGAudio.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}function LGAudioOscillatorNode(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=LGAudio.getAudioContext().createOscillator(),this.addOutput("out","audio")}function LGAudioVisualization(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}function LGAudioBandSignal(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}function LGAudioScript(){if(!LGAudioScript.default_code){var code=LGAudioScript.default_function.toString(),index=code.indexOf("{")+1,index2=code.lastIndexOf("}");LGAudioScript.default_code=code.substr(index,index2-index)}this.properties={code:LGAudioScript.default_code};var ctx=LGAudio.getAudioContext();ctx.createScriptProcessor?this.audionode=ctx.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=ctx.createGain()),this.processCode(),LGAudioScript._bypass_function||(LGAudioScript._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}function LGAudioDestination(){this.audionode=LGAudio.getAudioContext().destination,this.addInput("in","audio")}var LiteGraph=global.LiteGraph,LGAudio={};global.LGAudio=LGAudio,LGAudio.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(msg){console.log("msg",msg)},this._audio_context.onended=function(msg){console.log("ended",msg)},this._audio_context.oncomplete=function(msg){console.log("complete",msg)}}return this._audio_context},LGAudio.connect=function(audionodeA,audionodeB){try{audionodeA.connect(audionodeB)}catch(err){console.warn("LGraphAudio:",err)}},LGAudio.disconnect=function(audionodeA,audionodeB){try{audionodeA.disconnect(audionodeB)}catch(err){console.warn("LGraphAudio:",err)}},LGAudio.changeAllAudiosConnections=function(node,connect){if(node.inputs)for(var i=0;i<node.inputs.length;++i){var input=node.inputs[i],link_info=node.graph.links[input.link];if(link_info){var origin_node=node.graph.getNodeById(link_info.origin_id),origin_audionode=null;origin_audionode=origin_node.getAudioNodeInOutputSlot?origin_node.getAudioNodeInOutputSlot(link_info.origin_slot):origin_node.audionode;var target_audionode=null;target_audionode=node.getAudioNodeInInputSlot?node.getAudioNodeInInputSlot(i):node.audionode,connect?LGAudio.connect(origin_audionode,target_audionode):LGAudio.disconnect(origin_audionode,target_audionode)}}if(node.outputs)for(var i=0;i<node.outputs.length;++i)for(var output=node.outputs[i],j=0;j<output.links.length;++j){var link_info=node.graph.links[output.links[j]];if(link_info){var origin_audionode=null;origin_audionode=node.getAudioNodeInOutputSlot?node.getAudioNodeInOutputSlot(i):node.audionode;var target_node=node.graph.getNodeById(link_info.target_id),target_audionode=null;target_audionode=target_node.getAudioNodeInInputSlot?target_node.getAudioNodeInInputSlot(link_info.target_slot):target_node.audionode,connect?LGAudio.connect(origin_audionode,target_audionode):LGAudio.disconnect(origin_audionode,target_audionode)}}},LGAudio.onConnectionsChange=function(connection,slot,connected,link_info){if(connection==LiteGraph.OUTPUT){var target_node=null;if(link_info&&(target_node=this.graph.getNodeById(link_info.target_id)),target_node){var local_audionode=null;local_audionode=this.getAudioNodeInOutputSlot?this.getAudioNodeInOutputSlot(slot):this.audionode;var target_audionode=null;target_audionode=target_node.getAudioNodeInInputSlot?target_node.getAudioNodeInInputSlot(link_info.target_slot):target_node.audionode,connected?LGAudio.connect(local_audionode,target_audionode):LGAudio.disconnect(local_audionode,target_audionode)}}},LGAudio.createAudioNodeWrapper=function(class_object){var old_func=class_object.prototype.onPropertyChanged;class_object.prototype.onPropertyChanged=function(name,value){old_func&&old_func.call(this,name,value),this.audionode&&void 0!==this.audionode[name]&&(void 0!==this.audionode[name].value?this.audionode[name].value=value:this.audionode[name]=value)},class_object.prototype.onConnectionsChange=LGAudio.onConnectionsChange},LGAudio.cached_audios={},LGAudio.loadSound=function(url,on_complete,on_error){function onError(err){console.log("Audio loading sample error:",err),on_error&&on_error(err)}if(LGAudio.cached_audios[url]&&-1==url.indexOf("blob:"))return void(on_complete&&on_complete(LGAudio.cached_audios[url]));LGAudio.onProcessAudioURL&&(url=LGAudio.onProcessAudioURL(url));var request=new XMLHttpRequest;request.open("GET",url,!0),request.responseType="arraybuffer";var context=LGAudio.getAudioContext();return request.onload=function(){console.log("AudioSource loaded"),context.decodeAudioData(request.response,function(buffer){console.log("AudioSource decoded"),LGAudio.cached_audios[url]=buffer,on_complete&&on_complete(buffer)},onError)},request.send(),request},LGAudioSource["@src"]={widget:"resource"},LGAudioSource.supported_extensions=["wav","ogg","mp3"],LGAudioSource.prototype.onAdded=function(graph){graph.status===LGraph.STATUS_RUNNING&&this.onStart()},LGAudioSource.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},LGAudioSource.prototype.onStop=function(){this.stopAllSounds()},LGAudioSource.prototype.onPause=function(){this.pauseAllSounds()},LGAudioSource.prototype.onUnpause=function(){this.unpauseAllSounds()},LGAudioSource.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},LGAudioSource.prototype.stopAllSounds=function(){for(var i=0;i<this._audionodes.length;++i)this._audionodes[i].started&&(this._audionodes[i].started=!1,this._audionodes[i].stop());this._audionodes.length=0},LGAudioSource.prototype.pauseAllSounds=function(){LGAudio.getAudioContext().suspend()},LGAudioSource.prototype.unpauseAllSounds=function(){LGAudio.getAudioContext().resume()},LGAudioSource.prototype.onExecute=function(){if(this.inputs)for(var i=0;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link){var v=this.getInputData(i);if(void 0!==v)if("gain"==input.name)this.audionode.gain.value=v;else if("playbackRate"==input.name){this.properties.playbackRate=v;for(var j=0;j<this._audionodes.length;++j)this._audionodes[j].playbackRate.value=v}}}if(this.outputs)for(var i=0;i<this.outputs.length;++i){var output=this.outputs[i];"buffer"==output.name&&this._audiobuffer&&this.setOutputData(i,this._audiobuffer)}},LGAudioSource.prototype.onAction=function(event){this._audiobuffer&&("Play"==event?this.playBuffer(this._audiobuffer):"Stop"==event&&this.stopAllSounds())},LGAudioSource.prototype.onPropertyChanged=function(name,value){if("src"==name)this.loadSound(value);else if("gain"==name)this.audionode.gain.value=value;else if("playbackRate"==name)for(var j=0;j<this._audionodes.length;++j)this._audionodes[j].playbackRate.value=value},LGAudioSource.prototype.playBuffer=function(buffer){var that=this,context=LGAudio.getAudioContext(),audionode=context.createBufferSource();return this._last_sourcenode=audionode,audionode.graphnode=this,audionode.buffer=buffer,audionode.loop=this.properties.loop,audionode.playbackRate.value=this.properties.playbackRate,this._audionodes.push(audionode),audionode.connect(this.audionode),this._audionodes.push(audionode),audionode.onended=function(){that.trigger("ended");var index=that._audionodes.indexOf(audionode);-1!=index&&that._audionodes.splice(index,1)},audionode.started||(audionode.started=!0,audionode.start()),audionode},LGAudioSource.prototype.loadSound=function(url){function inner(buffer){this.boxcolor=LiteGraph.NODE_DEFAULT_BOXCOLOR,that._audiobuffer=buffer,that._loading_audio=!1,that.graph&&that.graph.status===LGraph.STATUS_RUNNING&&that.onStart()}var that=this;this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,url&&(this._request=LGAudio.loadSound(url,inner),this._loading_audio=!0,this.boxcolor="#AA4")},LGAudioSource.prototype.onConnectionsChange=LGAudio.onConnectionsChange,LGAudioSource.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",LiteGraph.ACTION],["Stop",LiteGraph.ACTION]]},LGAudioSource.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["ended",LiteGraph.EVENT]]},LGAudioSource.prototype.onDropFile=function(file){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var url=URL.createObjectURL(file);this.properties.src=url,this.loadSound(url),this._dropped_url=url},LGAudioSource.title="Source",LGAudioSource.desc="Plays audio",LiteGraph.registerNodeType("audio/source",LGAudioSource),LGAudioMediaSource.prototype.onAdded=function(graph){graph.status===LGraph.STATUS_RUNNING&&this.onStart()},LGAudioMediaSource.prototype.onStart=function(){null!=this._media_stream||this._waiting_confirmation||this.openStream()},LGAudioMediaSource.prototype.onStop=function(){this.audionode.gain.value=0},LGAudioMediaSource.prototype.onPause=function(){this.audionode.gain.value=0},LGAudioMediaSource.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},LGAudioMediaSource.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var tracks=this._media_stream.getTracks();tracks.length&&tracks[0].stop()}},LGAudioMediaSource.prototype.openStream=function(){function onFailSoHard(err){console.log("Media rejected",err),that._media_stream=!1,that.boxcolor="red"}if(!navigator.mediaDevices)return void console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(onFailSoHard);var that=this},LGAudioMediaSource.prototype.streamReady=function(localMediaStream){this._media_stream=localMediaStream,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var context=LGAudio.getAudioContext();this.audiosource_node=context.createMediaStreamSource(localMediaStream),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},LGAudioMediaSource.prototype.onExecute=function(){if(null!=this._media_stream||this._waiting_confirmation||this.openStream(),this.inputs)for(var i=0;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link){var v=this.getInputData(i);void 0!==v&&"gain"==input.name&&(this.audionode.gain.value=this.properties.gain=v)}}},LGAudioMediaSource.prototype.onAction=function(event){"Play"==event?this.audionode.gain.value=this.properties.gain:"Stop"==event&&(this.audionode.gain.value=0)},LGAudioMediaSource.prototype.onPropertyChanged=function(name,value){"gain"==name&&(this.audionode.gain.value=value)},LGAudioMediaSource.prototype.onConnectionsChange=LGAudio.onConnectionsChange,LGAudioMediaSource.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",LiteGraph.ACTION],["Stop",LiteGraph.ACTION]]},LGAudioMediaSource.title="MediaSource",LGAudioMediaSource.desc="Plays microphone",LiteGraph.registerNodeType("audio/media_source",LGAudioMediaSource),LGAudioAnalyser.prototype.onPropertyChanged=function(name,value){this.audionode[name]=value},LGAudioAnalyser.prototype.onExecute=function(){if(this.isOutputConnected(0)){var bufferLength=this.audionode.frequencyBinCount;this._freq_bin&&this._freq_bin.length==bufferLength||(this._freq_bin=new Uint8Array(bufferLength)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var bufferLength=this.audionode.frequencyBinCount;this._time_bin&&this._time_bin.length==bufferLength||(this._time_bin=new Uint8Array(bufferLength)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var i=1;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link){var v=this.getInputData(i);void 0!==v&&(this.audionode[input.name].value=v)}}},LGAudioAnalyser.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},LGAudioAnalyser.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},LGAudioAnalyser.title="Analyser",LGAudioAnalyser.desc="Audio Analyser",LiteGraph.registerNodeType("audio/analyser",LGAudioAnalyser),LGAudioGain.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var i=1;i<this.inputs.length;++i){var input=this.inputs[i],v=this.getInputData(i);void 0!==v&&(this.audionode[input.name].value=v)}},LGAudio.createAudioNodeWrapper(LGAudioGain),LGAudioGain.title="Gain",LGAudioGain.desc="Audio gain",LiteGraph.registerNodeType("audio/gain",LGAudioGain),LGAudio.createAudioNodeWrapper(LGAudioConvolver),LGAudioConvolver.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},LGAudioConvolver.prototype.onPropertyChanged=function(name,value){"impulse_src"==name?this.loadImpulse(value):"normalize"==name&&(this.audionode.normalize=value)},LGAudioConvolver.prototype.onDropFile=function(file){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(file),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},LGAudioConvolver.prototype.loadImpulse=function(url){function inner(buffer){that._impulse_buffer=buffer,that.audionode.buffer=buffer,console.log("Impulse signal set"),that._loading_impulse=!1}var that=this;this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,url&&(this._request=LGAudio.loadSound(url,inner),this._loading_impulse=!0)},LGAudioConvolver.title="Convolver",LGAudioConvolver.desc="Convolves the signal (used for reverb)",LiteGraph.registerNodeType("audio/convolver",LGAudioConvolver),LGAudio.createAudioNodeWrapper(LGAudioDynamicsCompressor),LGAudioDynamicsCompressor.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var i=1;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link){var v=this.getInputData(i);void 0!==v&&(this.audionode[input.name].value=v)}}},LGAudioDynamicsCompressor.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},LGAudioDynamicsCompressor.title="DynamicsCompressor",LGAudioDynamicsCompressor.desc="Dynamics Compressor",LiteGraph.registerNodeType("audio/dynamicsCompressor",LGAudioDynamicsCompressor),LGAudioWaveShaper.prototype.onExecute=function(){if(this.inputs&&this.inputs.length){var v=this.getInputData(1);void 0!==v&&(this.audionode.curve=v)}},LGAudioWaveShaper.prototype.setWaveShape=function(shape){this.audionode.curve=shape},LGAudio.createAudioNodeWrapper(LGAudioWaveShaper),LGAudioMixer.prototype.getAudioNodeInInputSlot=function(slot){return 0==slot?this.audionode1:2==slot?this.audionode2:void 0},LGAudioMixer.prototype.onPropertyChanged=function(name,value){"gain1"==name?this.audionode1.gain.value=value:"gain2"==name&&(this.audionode2.gain.value=value)},LGAudioMixer.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var i=1;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link&&"audio"!=input.type){var v=this.getInputData(i);void 0!==v&&(1==i?this.audionode1.gain.value=v:3==i&&(this.audionode2.gain.value=v))}}},LGAudio.createAudioNodeWrapper(LGAudioMixer),LGAudioMixer.title="Mixer",LGAudioMixer.desc="Audio mixer",LiteGraph.registerNodeType("audio/mixer",LGAudioMixer),LGAudio.createAudioNodeWrapper(LGAudioDelay),LGAudioDelay.prototype.onExecute=function(){var v=this.getInputData(1);void 0!==v&&(this.audionode.delayTime.value=v)},LGAudioDelay.title="Delay",LGAudioDelay.desc="Audio delay",LiteGraph.registerNodeType("audio/delay",LGAudioDelay),LGAudioBiquadFilter.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var i=1;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link){var v=this.getInputData(i);void 0!==v&&(this.audionode[input.name].value=v)}}},LGAudioBiquadFilter.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},LGAudio.createAudioNodeWrapper(LGAudioBiquadFilter),LGAudioBiquadFilter.title="BiquadFilter",LGAudioBiquadFilter.desc="Audio filter",LiteGraph.registerNodeType("audio/biquadfilter",LGAudioBiquadFilter),LGAudioOscillatorNode.prototype.onStart=function(){this.audionode.started||(this.audionode.started=!0,this.audionode.start())},LGAudioOscillatorNode.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},LGAudioOscillatorNode.prototype.onPause=function(){this.onStop()},LGAudioOscillatorNode.prototype.onUnpause=function(){this.onStart()},LGAudioOscillatorNode.prototype.onExecute=function(){if(this.inputs&&this.inputs.length)for(var i=0;i<this.inputs.length;++i){var input=this.inputs[i];if(null!=input.link){var v=this.getInputData(i);void 0!==v&&(this.audionode[input.name].value=v)}}},LGAudioOscillatorNode.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},LGAudio.createAudioNodeWrapper(LGAudioOscillatorNode),LGAudioOscillatorNode.title="Oscillator",LGAudioOscillatorNode.desc="Oscillator",LiteGraph.registerNodeType("audio/oscillator",LGAudioOscillatorNode),LGAudioVisualization.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var v=this.getInputData(1);void 0!==v&&(this.properties.mark=v),this.setDirtyCanvas(!0,!1)},LGAudioVisualization.prototype.onDrawForeground=function(ctx){if(this._last_buffer){var buffer=this._last_buffer,delta=buffer.length/this.size[0],h=this.size[1];ctx.fillStyle="black",ctx.fillRect(0,0,this.size[0],this.size[1]),ctx.strokeStyle="white",ctx.beginPath();var x=0;if(this.properties.continuous){ctx.moveTo(x,h);for(var i=0;i<buffer.length;i+=delta)ctx.lineTo(x,h-buffer[0|i]/255*h),x++}else for(var i=0;i<buffer.length;i+=delta)ctx.moveTo(x+.5,h),ctx.lineTo(x+.5,h-buffer[0|i]/255*h),x++;if(ctx.stroke(),this.properties.mark>=0){var samplerate=LGAudio.getAudioContext().sampleRate,binfreq=samplerate/buffer.length,x=this.properties.mark/binfreq*2/delta;x>=this.size[0]&&(x=this.size[0]-1),ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(x,h),ctx.lineTo(x,0),ctx.stroke()}}},LGAudioVisualization.title="Visualization",LGAudioVisualization.desc="Audio Visualization",LiteGraph.registerNodeType("audio/visualization",LGAudioVisualization),LGAudioBandSignal.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),this._freqs){var band=this.properties.band,v=this.getInputData(1);void 0!==v&&(band=v);var samplerate=LGAudio.getAudioContext().sampleRate,binfreq=samplerate/this._freqs.length,index=band/binfreq*2,v=0;if(index<0&&(v=this._freqs[0]),index>=this._freqs.length)v=this._freqs[this._freqs.length-1];else{var pos=0|index,v0=this._freqs[pos],v1=this._freqs[pos+1],f=index-pos;v=v0*(1-f)+v1*f}this.setOutputData(0,v/255*this.properties.amplitude)}},LGAudioBandSignal.prototype.onGetInputs=function(){return[["band","number"]]},LGAudioBandSignal.title="Signal",LGAudioBandSignal.desc="extract the signal of some frequency",LiteGraph.registerNodeType("audio/signal",LGAudioBandSignal),LGAudioScript.prototype.onAdded=function(graph){graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},LGAudioScript["@code"]={widget:"code"},LGAudioScript.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},LGAudioScript.prototype.onStop=function(){this.audionode.onaudioprocess=LGAudioScript._bypass_function},LGAudioScript.prototype.onPause=function(){this.audionode.onaudioprocess=LGAudioScript._bypass_function},LGAudioScript.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},LGAudioScript.prototype.onExecute=function(){},LGAudioScript.prototype.onRemoved=function(){this.audionode.onaudioprocess=LGAudioScript._bypass_function},LGAudioScript.prototype.processCode=function(){try{var func=new Function("properties",this.properties.code);this._script=new func(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(err){console.error("Error in onaudioprocess code",err),this._callback=LGAudioScript._bypass_function,this.audionode.onaudioprocess=this._callback}},LGAudioScript.prototype.onPropertyChanged=function(name,value){"code"==name&&(this.properties.code=value,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},LGAudioScript.default_function=function(){this.onaudioprocess=function(audioProcessingEvent){for(var inputBuffer=audioProcessingEvent.inputBuffer,outputBuffer=audioProcessingEvent.outputBuffer,channel=0;channel<outputBuffer.numberOfChannels;channel++)for(var inputData=inputBuffer.getChannelData(channel),outputData=outputBuffer.getChannelData(channel),sample=0;sample<inputBuffer.length;sample++)outputData[sample]=inputData[sample]}},LGAudio.createAudioNodeWrapper(LGAudioScript),LGAudioScript.title="Script",LGAudioScript.desc="apply script to signal",LiteGraph.registerNodeType("audio/script",LGAudioScript),LGAudioDestination.title="Destination",LGAudioDestination.desc="Audio output",LiteGraph.registerNodeType("audio/destination",LGAudioDestination)}(exports),function(global){function LGWebSocket(){this.size=[60,20],this.addInput("send",LiteGraph.ACTION),this.addOutput("received",LiteGraph.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph"},this._ws=null,this._last_data=[]}function LGSillyClient(){this.size=[60,20],this.addInput("send",LiteGraph.ACTION),this.addOutput("received",LiteGraph.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",save_bandwidth:!0},this._server=null,this.createSocket(),this._last_input_data=[],this._last_output_data=[]}var LiteGraph=global.LiteGraph;LGWebSocket.title="WebSocket",LGWebSocket.desc="Send data through a websocket",LGWebSocket.prototype.onPropertyChanged=function(name,value){"url"==name&&this.createSocket()},LGWebSocket.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.createSocket(),this._ws&&this._ws.readyState==WebSocket.OPEN){for(var room=this.properties.room,i=1;i<this.inputs.length;++i){var data=this.getInputData(i);if(null!=data){var json;try{json=JSON.stringify({type:0,room:room,channel:i,data:data})}catch(err){continue}this._ws.send(json)}}for(var i=1;i<this.outputs.length;++i)this.setOutputData(i,this._last_data[i])}},LGWebSocket.prototype.createSocket=function(){var that=this,url=this.properties.url;"ws"!=url.substr(0,2)&&(url="ws://"+url),this._ws=new WebSocket(url),this._ws.onopen=function(){console.log("ready"),that.boxcolor="#8E8"},this._ws.onmessage=function(e){var data=JSON.parse(e.data);data.room&&data.room!=this.properties.room||(1==e.data.type?that.triggerSlot(0,data):that._last_data[e.data.channel||0]=data.data)},this._ws.onerror=function(e){console.log("couldnt connect to websocket"),that.boxcolor="#E88"},this._ws.onclose=function(e){console.log("connection closed"),that.boxcolor="#000"}},LGWebSocket.prototype.send=function(data){this._ws&&this._ws.readyState==WebSocket.OPEN&&this._ws.send(JSON.stringify({type:1,msg:data}))},LGWebSocket.prototype.onAction=function(action,param){this._ws&&this._ws.readyState==WebSocket.OPEN&&this._ws.send({type:1,room:this.properties.room,action:action,data:param})},LGWebSocket.prototype.onGetInputs=function(){return[["in",0]]},LGWebSocket.prototype.onGetOutputs=function(){return[["out",0]]},LiteGraph.registerNodeType("network/websocket",LGWebSocket),LGSillyClient.title="SillyClient",LGSillyClient.desc="Connects to SillyServer to broadcast messages",LGSillyClient.prototype.onPropertyChanged=function(name,value){var final_url=this.properties.url+"/"+this.properties.room;this._server&&this._final_url!=final_url&&(this._server.connect(this.properties.url,this.properties.room),this._final_url=final_url)},LGSillyClient.prototype.onExecute=function(){if(this._server&&this._server.is_connected){for(var save_bandwidth=this.properties.save_bandwidth,i=1;i<this.inputs.length;++i){var data=this.getInputData(i);if(null!=data){if(save_bandwidth&&this._last_input_data[i]==data)continue;this._server.sendMessage({type:0,channel:i,data:data}),this._last_input_data[i]=data}}for(var i=1;i<this.outputs.length;++i)this.setOutputData(i,this._last_output_data[i])}},LGSillyClient.prototype.createSocket=function(){var that=this;if("undefined"==typeof SillyClient)return this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),void(this._error=!0);this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),that.boxcolor="#8E8"},this._server.on_message=function(id,msg){var data=null;try{data=JSON.parse(msg)}catch(err){return}1==data.type?that.triggerSlot(0,data):that._last_output_data[data.channel||0]=data.data},this._server.on_error=function(e){console.log("couldnt connect to websocket"),that.boxcolor="#E88"},this._server.on_close=function(e){console.log("connection closed"),that.boxcolor="#000"},this.properties.url&&this.properties.room&&(this._server.connect(this.properties.url,this.properties.room),this._final_url=this.properties.url+"/"+this.properties.room)},LGSillyClient.prototype.send=function(data){this._server&&this._server.is_connected&&this._server.sendMessage({type:1,data:data})},LGSillyClient.prototype.onAction=function(action,param){this._server&&this._server.is_connected&&this._server.sendMessage({type:1,action:action,data:param})},LGSillyClient.prototype.onGetInputs=function(){return[["in",0]]},LGSillyClient.prototype.onGetOutputs=function(){return[["out",0]]},LiteGraph.registerNodeType("network/sillyclient",LGSillyClient)}(exports)}),$__System.registerDynamic("10",["16"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("16"),LiteGraphNode=function(){function LiteGraphNode(addExecute){this.size=[60,20],this.shape="round",addExecute&&this.addInput("Execute",litegraph_js_1.LiteGraph.EVENT)}return LiteGraphNode.prototype.onConnectionsChange=function(type,slot,added){LiteGraphNode.Loaded&&this.mode!==litegraph_js_1.LiteGraph.NEVER&&(type===litegraph_js_1.LiteGraph.INPUT&&0===slot&&(this.mode=added?litegraph_js_1.LiteGraph.ON_TRIGGER:litegraph_js_1.LiteGraph.ALWAYS),LiteGraphNode.SetColor(this))},LiteGraphNode.prototype.hasProperty=function(name){return void 0!==this.properties[name]},LiteGraphNode.prototype.onDrawBackground=function(ctx,graph,canvas,text){!this.flags.collapsed&&text&&(ctx.font="14px Arial",ctx.fillStyle="grey",ctx.textAlign="center",ctx.fillText(text,.5*this.size[0],.5*this.size[1]+7),ctx.textAlign="left")},LiteGraphNode.prototype.getTargetNode=function(name){return"self"===name?this.graph.scriptObject:"Scene"===name?this.graph.scriptScene:this.graph.scriptScene.getNodeByName(name)},LiteGraphNode.Register=function(location,ctor){if(!this.LastCtor)return this.LastCtor=ctor,void litegraph_js_1.LiteGraph.registerNodeType(location,ctor);litegraph_js_1.LiteGraph.registered_node_types[location]=this.LastCtor},LiteGraphNode.SetColor=function(node){switch(node.mode){case litegraph_js_1.LiteGraph.ALWAYS:node.color="#333",node.bgColor="#AAA";break;case litegraph_js_1.LiteGraph.ON_EVENT:node.color="#55A",node.bgColor="#44A";break;case litegraph_js_1.LiteGraph.ON_TRIGGER:node.color="#5A5",node.bgColor="#4A4";break;case litegraph_js_1.LiteGraph.NEVER:node.color="#A55",node.bgColor="#A44"}},LiteGraphNode.LastCtor=null,LiteGraphNode.Loaded=!1,LiteGraphNode}();exports.LiteGraphNode=LiteGraphNode}),$__System.registerDynamic("1f",["c","16","d","e","f","11","12","13","14","15","17","18","19","1a","1b","1c","1d","1e","10"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),litegraph_js_1=$__require("16");exports.LGraph=litegraph_js_1.LGraph,exports.LGraphCanvas=litegraph_js_1.LGraphCanvas,exports.LiteGraph=litegraph_js_1.LiteGraph,exports.LGraphGroup=litegraph_js_1.LGraphGroup;var extensions_1=$__require("d"),extension_1=$__require("e"),position_1=$__require("f"),rotation_1=$__require("11"),scale_1=$__require("12"),ambient_color_1=$__require("13"),clear_color_1=$__require("14"),engine_1=$__require("15"),property_1=$__require("17"),condition_1=$__require("18"),pointer_1=$__require("19"),timeout_1=$__require("1a"),animation_1=$__require("1b"),const_1=$__require("1c"),color_1=$__require("1d"),time_1=$__require("1e"),typings_1=$__require("10");exports.LiteGraphNode=typings_1.LiteGraphNode;var GraphExtension=function(_super){function GraphExtension(scene){var _this=_super.call(this,scene)||this;return _this.id="graph-editor",_this.assetsCaption="Graphs",_this.datas=null,_this}return __extends(GraphExtension,_super),GraphExtension.prototype.onGetAssets=function(){var data=this.onSerialize(),attached=[],unAttached=[];return data.graphs.forEach(function(s){if(data.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.graphId===s.id})}))return attached.push({name:s.name,data:s});unAttached.push({name:s.name,data:s})}),[{separator:"Attached"}].concat(attached).concat([{separator:"Unattached"}]).concat(unAttached)},GraphExtension.prototype.onRemoveAsset=function(asset){var data=asset.data,remove=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behaviorGraph)for(var graphs=o.metadata.behaviorGraph,links=graphs.metadatas,i=0;i<links.length;i++)links[i].graphId===data.id&&(links.splice(i,1),i--)})};remove([this.scene]),remove(this.scene.meshes),remove(this.scene.lights),remove(this.scene.cameras);var index=this.scene.metadata.behaviorGraphs.indexOf(data);-1!==index&&this.scene.metadata.behaviorGraphs.splice(index,1)},GraphExtension.prototype.onAddAsset=function(asset){this.scene.metadata.behaviorGraphs.push(asset.data)},GraphExtension.prototype.onDragAndDropAsset=function(targetMesh,asset){targetMesh.metadata=targetMesh.metadata||{},targetMesh.metadata.behaviorGraph||(targetMesh.metadata.behaviorGraph={node:targetMesh.name,metadatas:[]}),targetMesh.metadata.behaviorGraph.metadatas.push({graphId:asset.data.id,active:!0})},GraphExtension.prototype.onApply=function(data){var _this=this;this.datas=data,GraphExtension.RegisterNodes(),this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node&&d.metadatas.forEach(function(m){if(m.active){var graph=new litegraph_js_1.LGraph;graph.scriptObject=node,graph.scriptScene=_this.scene,typings_1.LiteGraphNode.Loaded=!1,graph.configure(_this.datas.graphs.find(function(s){return s.id===m.graphId}).graph),typings_1.LiteGraphNode.Loaded=!0,_this.scene.onReadyObservable.addOnce(function(){graph.start()});graph._nodes.forEach(function(n){n instanceof engine_1.RenderLoop?_this.scene.onAfterRenderObservable.add(function(){return n.onExecute()}):n instanceof engine_1.RenderStart&&_this.scene.onAfterRenderObservable.addOnce(function(){return n.onExecute()})})}})})},GraphExtension.prototype.onSerialize=function(){var result={graphs:this.scene.metadata?this.scene.metadata.behaviorGraphs||[]:[],nodes:[]},add=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behaviorGraph){var behavior=o.metadata.behaviorGraph;behavior.node=o instanceof babylonjs_1.Scene?"Scene":o instanceof Node?o.name:o.id,behavior.nodeId=o instanceof babylonjs_1.Scene?"Scene":o.id,result.nodes.push(behavior)}})};return add([this.scene]),add(this.scene.meshes),add(this.scene.lights),add(this.scene.cameras),result},GraphExtension.prototype.onLoad=function(data){var _this=this;if(!data.graphs){var oldData=data;data={graphs:[],nodes:[]},oldData.forEach(function(od){var node={node:od.node,nodeId:od.node,metadatas:[]};od.metadatas.forEach(function(m){var id=babylonjs_1.Tools.RandomId();data.graphs.push({name:m.name,id:id,graph:m.graph}),node.metadatas.push({graphId:id,active:m.active})}),data.nodes.push(node)})}this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.behaviorGraphs=this.datas.graphs,this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node&&(node.metadata=node.metadata||{},node.metadata.behaviorGraph=d)})},GraphExtension.ClearNodes=function(){var available=["node","scene","core","logic","basic/script","basic/const","math/compare","math/condition","math/formula","math/converter","math/range"];Object.keys(litegraph_js_1.LiteGraph.registered_node_types).forEach(function(k){var split=k.split("/");-1===available.indexOf(split[0])&&-1===available.indexOf(k)||delete litegraph_js_1.LiteGraph.registered_node_types[k]})},GraphExtension.RegisterNodes=function(object){var available=["node","scene","math","math3d","basic","logic"];Object.keys(litegraph_js_1.LiteGraph.registered_node_types).forEach(function(k){var split=k.split("/");-1===available.indexOf(split[0])&&-1===available.indexOf(k)&&delete litegraph_js_1.LiteGraph.registered_node_types[k]}),const_1.Number.Register("basic/number",const_1.Number),const_1.String.Register("basic/string",const_1.String),const_1.Boolean.Register("basic/boolean",const_1.Boolean),color_1.Color.Register("basic/color",color_1.Color),time_1.Time.Register("basic/time",time_1.Time),engine_1.RenderStart.Register("render/renderstarts",engine_1.RenderStart),engine_1.RenderLoop.Register("render/renderloop",engine_1.RenderLoop),condition_1.Condition.Register("logic/condition",condition_1.Condition),(!object||object instanceof babylonjs_1.AbstractMesh)&&(pointer_1.PointerOver.Register("event/pointerover",pointer_1.PointerOver),pointer_1.PointerDown.Register("event/pointerdown",pointer_1.PointerDown),pointer_1.PointerOut.Register("event/pointerout",pointer_1.PointerOut)),timeout_1.SetTimeout.Register("event/settimeout",timeout_1.SetTimeout),timeout_1.ClearTimeout.Register("event/cleartimeout",timeout_1.ClearTimeout),animation_1.PlayAnimations.Register("action/playanimations",animation_1.PlayAnimations),animation_1.StopAnimations.Register("action/stopanimations",animation_1.StopAnimations),property_1.GetProperty.Register("property/get",property_1.GetProperty),property_1.SetProperty.Register("property/set",property_1.SetProperty),(!object||object instanceof babylonjs_1.Scene)&&(clear_color_1.GetClearColor.Register("scene/getclearcolor",clear_color_1.GetClearColor),clear_color_1.SetClearColor.Register("scene/setclearcolor",clear_color_1.SetClearColor),ambient_color_1.GetAmbientColor.Register("scene/getambientcolor",ambient_color_1.GetAmbientColor),ambient_color_1.SetAmbientColor.Register("scene/setambientcolor",ambient_color_1.SetAmbientColor)),(!object||object.position&&object.position instanceof babylonjs_1.Vector3)&&(position_1.GetPosition.Register("node/getposition",position_1.GetPosition),position_1.SetPosition.Register("node/setposition",position_1.SetPosition)),(!object||object.rotation&&object.rotation instanceof babylonjs_1.Vector3)&&(rotation_1.GetRotation.Register("node/getrotation",rotation_1.GetRotation),rotation_1.SetRotation.Register("node/setrotation",rotation_1.SetRotation)),(!object||object.scaling&&object.scaling instanceof babylonjs_1.Vector3)&&(scale_1.GetScale.Register("node/getscale",scale_1.GetScale),scale_1.SetScale.Register("node/setscale",scale_1.SetScale))},GraphExtension}(extension_1.default);exports.default=GraphExtension,extensions_1.default.Register("BehaviorGraphExtension",GraphExtension)}),function(definition){if("object"==typeof module&&"object"==typeof module.exports)module.exports=definition();else{$__System.registerDynamic("20",[],!1,function($__require,$__exports,$__module){return"function"==typeof definition?definition.call(this):definition})}}(function(){function pathTo(node){for(var curr=node,path=[];curr.parent;)path.unshift(curr),curr=curr.parent;return path}function getHeap(){return new BinaryHeap(function(node){return node.f})}function Graph(gridIn,options){options=options||{},this.nodes=[],this.diagonal=!!options.diagonal,this.grid=[];for(var x=0;x<gridIn.length;x++){this.grid[x]=[];for(var y=0,row=gridIn[x];y<row.length;y++){var node=new GridNode(x,y,row[y]);this.grid[x][y]=node,this.nodes.push(node)}}this.init()}function GridNode(x,y,weight){this.x=x,this.y=y,this.weight=weight}function BinaryHeap(scoreFunction){this.content=[],this.scoreFunction=scoreFunction}var astar={search:function(graph,start,end,options){graph.cleanDirty(),options=options||{};var heuristic=options.heuristic||astar.heuristics.manhattan,closest=options.closest||!1,openHeap=getHeap(),closestNode=start;for(start.h=heuristic(start,end),openHeap.push(start);openHeap.size()>0;){var currentNode=openHeap.pop();if(currentNode===end)return pathTo(currentNode);currentNode.closed=!0;for(var neighbors=graph.neighbors(currentNode),i=0,il=neighbors.length;i<il;++i){var neighbor=neighbors[i];if(!neighbor.closed&&!neighbor.isWall()){var gScore=currentNode.g+neighbor.getCost(currentNode),beenVisited=neighbor.visited;(!beenVisited||gScore<neighbor.g)&&(neighbor.visited=!0,neighbor.parent=currentNode,neighbor.h=neighbor.h||heuristic(neighbor,end),neighbor.g=gScore,neighbor.f=neighbor.g+neighbor.h,graph.markDirty(neighbor),closest&&(neighbor.h<closestNode.h||neighbor.h===closestNode.h&&neighbor.g<closestNode.g)&&(closestNode=neighbor),beenVisited?openHeap.rescoreElement(neighbor):openHeap.push(neighbor))}}}return closest?pathTo(closestNode):[]},heuristics:{manhattan:function(pos0,pos1){return Math.abs(pos1.x-pos0.x)+Math.abs(pos1.y-pos0.y)},diagonal:function(pos0,pos1){var D=1,D2=Math.sqrt(2),d1=Math.abs(pos1.x-pos0.x),d2=Math.abs(pos1.y-pos0.y);return D*(d1+d2)+(D2-2*D)*Math.min(d1,d2)}},cleanNode:function(node){node.f=0,node.g=0,node.h=0,node.visited=!1,node.closed=!1,node.parent=null}};return Graph.prototype.init=function(){this.dirtyNodes=[];for(var i=0;i<this.nodes.length;i++)astar.cleanNode(this.nodes[i])},Graph.prototype.cleanDirty=function(){for(var i=0;i<this.dirtyNodes.length;i++)astar.cleanNode(this.dirtyNodes[i]);this.dirtyNodes=[]},Graph.prototype.markDirty=function(node){this.dirtyNodes.push(node)},Graph.prototype.neighbors=function(node){var ret=[],x=node.x,y=node.y,grid=this.grid;return grid[x-1]&&grid[x-1][y]&&ret.push(grid[x-1][y]),grid[x+1]&&grid[x+1][y]&&ret.push(grid[x+1][y]),grid[x]&&grid[x][y-1]&&ret.push(grid[x][y-1]),grid[x]&&grid[x][y+1]&&ret.push(grid[x][y+1]),this.diagonal&&(grid[x-1]&&grid[x-1][y-1]&&ret.push(grid[x-1][y-1]),grid[x+1]&&grid[x+1][y-1]&&ret.push(grid[x+1][y-1]),grid[x-1]&&grid[x-1][y+1]&&ret.push(grid[x-1][y+1]),grid[x+1]&&grid[x+1][y+1]&&ret.push(grid[x+1][y+1])),ret},Graph.prototype.toString=function(){for(var rowDebug,row,y,l,graphString=[],nodes=this.grid,x=0,len=nodes.length;x<len;x++){for(rowDebug=[],row=nodes[x],y=0,l=row.length;y<l;y++)rowDebug.push(row[y].weight);graphString.push(rowDebug.join(" "))}return graphString.join("\n")},GridNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},GridNode.prototype.getCost=function(fromNeighbor){return fromNeighbor&&fromNeighbor.x!=this.x&&fromNeighbor.y!=this.y?1.41421*this.weight:this.weight},GridNode.prototype.isWall=function(){return 0===this.weight},BinaryHeap.prototype={push:function(element){this.content.push(element),this.sinkDown(this.content.length-1)},pop:function(){var result=this.content[0],end=this.content.pop();return this.content.length>0&&(this.content[0]=end,this.bubbleUp(0)),result},remove:function(node){var i=this.content.indexOf(node),end=this.content.pop();i!==this.content.length-1&&(this.content[i]=end,this.scoreFunction(end)<this.scoreFunction(node)?this.sinkDown(i):this.bubbleUp(i))},size:function(){return this.content.length},rescoreElement:function(node){this.sinkDown(this.content.indexOf(node))},sinkDown:function(n){for(var element=this.content[n];n>0;){var parentN=(n+1>>1)-1,parent=this.content[parentN];if(!(this.scoreFunction(element)<this.scoreFunction(parent)))break;this.content[parentN]=element,this.content[n]=parent,n=parentN}},bubbleUp:function(n){for(var length=this.content.length,element=this.content[n],elemScore=this.scoreFunction(element);;){var child1Score,child2N=n+1<<1,child1N=child2N-1,swap=null;if(child1N<length){var child1=this.content[child1N];child1Score=this.scoreFunction(child1),child1Score<elemScore&&(swap=child1N)}if(child2N<length){var child2=this.content[child2N];this.scoreFunction(child2)<(null===swap?elemScore:child1Score)&&(swap=child2N)}if(null===swap)break;this.content[n]=this.content[swap],this.content[swap]=element,n=swap}}},{astar:astar,Graph:Graph}}),$__System.registerDynamic("21",["c","20"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),Astar=$__require("20"),PathFinder=function(){function PathFinder(size){this.graph=null,this.points=[],this.availablePoints=[],this._removeAnimationKey=function(path,i){var first=path[i].point,middle=path[i+1].point,last=path[i+2].point;return first.equals(last)&&first.equals(middle)?(path.splice(i+1,1),!0):!!new babylonjs_1.Vector3(.5*first.x+.5*last.x,.5*first.y+.5*last.y,.5*first.z+.5*last.z).equals(middle)&&(path.splice(i+1,1),!0)},this.rebuildBuffers(size)}return PathFinder.prototype.rebuildBuffers=function(size){this.width=this.height=size>>0,this.buffer=new Array(this.width);for(var i=0;i<this.height;i++)this.buffer[i]=new Array(this.height);this.points=[]},PathFinder.prototype.fromTo=function(from,to,optimize){void 0===optimize&&(optimize=!1);for(var fromIndex=-1,toIndex=-1,i=0;i<this.points.length;i++){var p=this.points[i];if(p&&(p.x===from.x&&p.z===from.z&&(fromIndex=i),p.x===to.x&&p.z===to.z&&(toIndex=i),-1!==fromIndex&&-1!==toIndex))break}var sx=fromIndex/this.width>>0,sy=fromIndex%this.height>>0,ex=toIndex/this.width>>0,ey=toIndex%this.width>>0,path=Astar.astar.search(this.graph,this.graph.grid[ex][ey],this.graph.grid[sx][sy],{heuristic:Astar.astar.heuristics.diagonal,closest:!0});if(optimize)for(var i=path.length-3;i>=0;--i)for(;path.length-i>=3&&this._removeAnimationKey(path,i););for(var result=[],i=0;i<path.length;i++){var p=path[i];if(!p.point)return;result.push(new babylonjs_1.Vector3(p.point.x,babylonjs_1.Scalar.Lerp(from.y,to.y,i/path.length),p.point.z))}return result.reverse()},PathFinder.prototype.createAnimation=function(name,path,framesPerSecond){void 0===framesPerSecond&&(framesPerSecond=60);for(var a=new babylonjs_1.Animation(name,"position",framesPerSecond,babylonjs_1.Animation.ANIMATIONTYPE_VECTOR3,babylonjs_1.Animation.ANIMATIONLOOPMODE_RELATIVE,!1),keys=new Array(path.length),i=0;i<path.length;i++)keys[i]={frame:i,value:path[i]};return a.setKeys(keys),a},PathFinder.prototype.findNearestPoint=function(point){for(var lastDistance=Number.MAX_VALUE,nearest=point,i=0;i<this.points.length;i++){var p=this.points[i];if(p){var d=babylonjs_1.Vector3.Distance(p,point);d<lastDistance&&(lastDistance=d,nearest=p)}}return new babylonjs_1.Vector3(nearest.x,point.y,nearest.z)},PathFinder.prototype.fill=function(castMeshes,rayHeight,rayLength){this.rebuildBuffers(this.width);var b=new babylonjs_1.BoundingInfo(babylonjs_1.Vector3.Zero(),babylonjs_1.Vector3.Zero()),average=babylonjs_1.Vector3.Zero();castMeshes.forEach(function(cm){cm.computeWorldMatrix(!0);var cb=cm._boundingInfo;cb.update(cm.getWorldMatrix()),b.minimum.x=Math.min(b.minimum.x,cb.minimum.x),b.minimum.y=Math.min(b.minimum.y,cb.minimum.y),b.minimum.z=Math.min(b.minimum.z,cb.minimum.z),b.maximum.x=Math.max(b.maximum.x,cb.maximum.x),b.maximum.y=Math.max(b.maximum.y,cb.maximum.y),b.maximum.z=Math.max(b.maximum.z,cb.maximum.z),average.x+=cb.boundingBox.centerWorld.x,average.y+=cb.boundingBox.centerWorld.y,average.z+=cb.boundingBox.centerWorld.z}),average.x/=castMeshes.length,average.y/=castMeshes.length,average.z/=castMeshes.length,this.boundingInfo=b;for(var xd=Math.abs(b.maximum.x)+Math.abs(b.minimum.x),yd=Math.abs(b.maximum.z)+Math.abs(b.minimum.z),s=average.subtract(new babylonjs_1.Vector3(xd/2,0,yd/2)),x=0;x<this.width;x++)for(var rx=x*xd/this.width,y=0;y<this.height;y++){var ry=y*yd/this.height,r=new babylonjs_1.Ray(s.add(new babylonjs_1.Vector3(rx,rayHeight||b.maximum.y+10,ry)),new babylonjs_1.Vector3(0,-1,0),rayLength||100),p=r.intersectsMeshes(castMeshes,!1),hit=p.find(function(p){return p.hit});hit?(this.points.push(hit.pickedPoint),this.buffer[x][y]=1):(this.points.push(null),this.buffer[x][y]=0)}this.graph=new Astar.Graph(this.buffer,{diagonal:!0});for(var x=0;x<this.width;x++)for(var y=0;y<this.height;y++){var coord=y*this.width+x;this.graph.grid[y][x].point=this.points[coord]}this.availablePoints=this.points.filter(function(p){return null!==p})},PathFinder}();exports.default=PathFinder}),$__System.registerDynamic("22",["d","e","21"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var extensions_1=$__require("d"),extension_1=$__require("e"),path_finder_1=$__require("21"),PathFinderExtension=function(_super){function PathFinderExtension(scene){var _this=_super.call(this,scene)||this;return _this.instances={},_this.datas=[],_this}return __extends(PathFinderExtension,_super),PathFinderExtension.prototype.onApply=function(data){var _this=this;this.datas=data,data.forEach(function(d){return _this._buildPathFinder(d)})},PathFinderExtension.prototype.onSerialize=function(){return this.scene.metadata&&this.scene.metadata.PathFinderExtension?this.scene.metadata.PathFinderExtension:null},PathFinderExtension.prototype.onLoad=function(data){var _this=this;this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.PathFinderExtension=[],this.datas.forEach(function(d){return _this.scene.metadata.PathFinderExtension.push(d)})},PathFinderExtension.prototype._buildPathFinder=function(data){var _this=this,p=new path_finder_1.default(data.size),meshes=[];data.castMeshes.forEach(function(cm){var m=_this.scene.getMeshByName(cm);m&&meshes.push(m)}),p.fill(meshes,data.rayHeight,data.rayLength),this.instances[data.name]=p},PathFinderExtension}(extension_1.default);exports.default=PathFinderExtension,extensions_1.default.Register("PathFinderExtension",PathFinderExtension)}),$__System.registerDynamic("23",["c"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),AbstractPostProcessEditor=function(_super){function AbstractPostProcessEditor(name,fragmentUrl,camera,engine,config,customCode){var _this=_super.call(this,name,fragmentUrl,[],["textureSampler"],config.ratio,camera,babylonjs_1.Texture.BILINEAR_SAMPLINGMODE,engine)||this;return _this.userConfig={},_this.additionalUniforms=[],_this.additionalSamplers=[],_this.scene=camera?camera.getScene():engine.scenes[0],_this.customCode=customCode,_this.config=config,customCode&&customCode.init(),_this.setConfig(config),_this.setOnApply(),_this}return __extends(AbstractPostProcessEditor,_super),AbstractPostProcessEditor.prototype.setOnApply=function(){var _this=this;this.onApply=function(effect){_this.customCode&&_this.customCode.onApply(effect),_this.config.textures.forEach(function(t){return void 0!==_this.userConfig[t]&&effect.setTexture(t,_this.userConfig[t])}),_this.config.floats.forEach(function(f){return void 0!==_this.userConfig[f]&&effect.setFloat(f,_this.userConfig[f]||0)}),_this.config.vectors2.forEach(function(v){return void 0!==_this.userConfig[v]&&effect.setVector2(v,_this.userConfig[v])}),_this.config.vectors3.forEach(function(v){return void 0!==_this.userConfig[v]&&effect.setVector3(v,_this.userConfig[v])})}},AbstractPostProcessEditor.prototype.setConfig=function(config){var uniforms=["scale"].concat(config.floats).concat(config.vectors2).concat(config.vectors3),samplers=["textureSampler"].concat(config.textures);this.customCode&&this.customCode.setUniforms(uniforms,samplers);try{this.updateEffect("#define UPDATED"+babylonjs_1.Tools.RandomId()+"\n",uniforms,samplers),this.config=config,this.setOnApply()}catch(e){}},AbstractPostProcessEditor.prototype.dispose=function(){this.customCode&&this.customCode.dispose(),_super.prototype.dispose.call(this)},AbstractPostProcessEditor.prototype.getClassName=function(){return"PostProcessEditor"},AbstractPostProcessEditor}(babylonjs_1.PostProcess);exports.default=AbstractPostProcessEditor}),$__System.registerDynamic("24",["c","d","e","25","23"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var EDITOR,babylonjs_1=$__require("c"),extensions_1=$__require("d"),extension_1=$__require("e"),tools_1=$__require("25"),post_process_1=$__require("23"),template="\nEDITOR.PostProcessCreator.Constructors['{{name}}'] = function (camera, tools, mobile) {\nvar returnValue = null;\nvar exports = { };\n\n{{code}}\n"+tools_1.exportScriptString+"\n}\n";!function(EDITOR){var PostProcessCreator=function(){function PostProcessCreator(){}return PostProcessCreator.Constructors={},PostProcessCreator}();EDITOR.PostProcessCreator=PostProcessCreator}(EDITOR=exports.EDITOR||(exports.EDITOR={})),window.EDITOR=window.EDITOR||{},window.EDITOR.PostProcessCreator=EDITOR.PostProcessCreator;var PostProcessEditorExtension=function(_super){function PostProcessEditorExtension(scene){var _this=_super.call(this,scene)||this;return _this.instances={},_this.datas=[],PostProcessEditorExtension.Instance=_this,_this}return __extends(PostProcessEditorExtension,_super),PostProcessEditorExtension.prototype.createPostProcess=function(data,rootUrl){var _this=this,id=data.name+babylonjs_1.Tools.RandomId();babylonjs_1.Effect.ShadersStore[id+"PixelShader"]=data.pixel;var url=window.location.href;url=url.replace(babylonjs_1.Tools.GetFilename(url),"")+"post-processes/"+data.name.replace(/ /g,"")+".js",extension_1.default.AddScript(template.replace("{{name}}",id).replace("{{code}}",data.compiledCode||data.code),url);var camera=this.scene.getCameraByName(data.cameraName)||this.scene.activeCamera,ctor=new EDITOR.PostProcessCreator.Constructors[id](camera,extensions_1.default.Tools,extensions_1.default.Mobile),code=new ctor(camera,this.scene),config=null;try{config=JSON.parse(data.config)}catch(e){}var postprocess=new post_process_1.default(data.name,id,data.preview?camera:null,this.scene.getEngine(),config,code);return data.userConfig.textures.forEach(function(t){return postprocess.userConfig[t.name]=babylonjs_1.Texture.Parse(t.value,_this.scene,rootUrl||"file:")}),data.userConfig.floats.forEach(function(f){return postprocess.userConfig[f.name]=f.value}),data.userConfig.vectors2.forEach(function(v){return postprocess.userConfig[v.name]=babylonjs_1.Vector2.FromArray(v.value)}),data.userConfig.vectors3.forEach(function(v){return postprocess.userConfig[v.name]=babylonjs_1.Vector3.FromArray(v.value)}),this.instances[data.name]={code:code,postprocess:postprocess},postprocess},PostProcessEditorExtension.prototype.onApply=function(data,rootUrl){var _this=this;this.datas=data,this.datas.forEach(function(d){return _this.createPostProcess(d,rootUrl)})},PostProcessEditorExtension.prototype.onSerialize=function(){var _this=this;if(!this.scene.metadata||!this.scene.metadata.PostProcessCreator)return null;var data=this.scene.metadata.PostProcessCreator;return data.forEach(function(d){_this.scene.postProcesses.forEach(function(p){p instanceof post_process_1.default&&p.config&&p.name===d.name&&(d.userConfig.textures=[],p.config.textures.forEach(function(t){return p.userConfig[t]&&d.userConfig.textures.push({value:p.userConfig[t].serialize(),name:t})}),d.userConfig.floats=[],p.config.floats.forEach(function(f){return d.userConfig.floats.push({value:p.userConfig[f],name:f})}),d.userConfig.vectors2=[],p.config.vectors2.forEach(function(v){return d.userConfig.vectors2.push({value:p.userConfig[v].asArray(),name:v})}),d.userConfig.vectors3=[],p.config.vectors3.forEach(function(v){return d.userConfig.vectors3.push({value:p.userConfig[v].asArray(),name:v})}))})}),data},PostProcessEditorExtension.prototype.onLoad=function(data){var _this=this;this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.PostProcessCreator=[],this.datas.forEach(function(d){d.id=d.id||babylonjs_1.Tools.RandomId(),_this.scene.metadata.PostProcessCreator.push(d)})},PostProcessEditorExtension.Instance=null,PostProcessEditorExtension}(extension_1.default);exports.default=PostProcessEditorExtension,extensions_1.default.Register("PostProcessCreatorExtension",PostProcessEditorExtension)}),$__System.registerDynamic("26",["c"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__decorate=exports&&exports.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),CustomMaterialDefines=function(_super){function CustomMaterialDefines(){var _this=_super.call(this)||this;return _this.TEXTURE=!1,_this.CLIPPLANE=!1,_this.ALPHATEST=!1,_this.DEPTHPREPASS=!1,_this.POINTSIZE=!1,_this.FOG=!1,_this.NORMAL=!1,_this.UV1=!1,_this.UV2=!1,_this.VERTEXCOLOR=!1,_this.VERTEXALPHA=!1,_this.NUM_BONE_INFLUENCERS=0,_this.BonesPerMesh=0,_this.INSTANCES=!1,_this.rebuild(),_this}return __extends(CustomMaterialDefines,_super),CustomMaterialDefines}(babylonjs_1.MaterialDefines);exports.CustomMaterialDefines=CustomMaterialDefines;var CustomEditorMaterial=function(_super){function CustomEditorMaterial(name,scene,shaderName,customCode,config){var _this=_super.call(this,name,scene)||this;return _this.baseColor=new babylonjs_1.Color3(1,1,1),_this._disableLighting=!1,_this._maxSimultaneousLights=4,_this.userConfig={},_this._buildId=0,_this._lastBuildId=0,_this._shaderName=shaderName,_this.customCode=customCode,_this.customCode&&_this.customCode.init(),_this.config=config,_this}return __extends(CustomEditorMaterial,_super),CustomEditorMaterial.prototype.setCustomCode=function(customCode){this.customCode=customCode,this.customCode&&this.customCode.init()},CustomEditorMaterial.prototype.needAlphaBlending=function(){return this.alpha<1},CustomEditorMaterial.prototype.needAlphaTesting=function(){return!1},CustomEditorMaterial.prototype.getAlphaTestTexture=function(){return null},CustomEditorMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){if(void 0===this.customCode)return!1;if(this.isFrozen&&this._wasPreviouslyReady&&subMesh.effect)return!0;subMesh._materialDefines||(subMesh._materialDefines=new CustomMaterialDefines);var defines=subMesh._materialDefines,scene=this.getScene();if(!this.checkReadyOnEveryCall&&subMesh.effect&&this._renderId===scene.getRenderId())return!0;var engine=scene.getEngine();if(defines._areTexturesDirty&&(defines._needUVs=!1,scene.texturesEnabled&&this.config)){for(var atLeastOneTexture=!1,_i=0,_a=this.config.textures;_i<_a.length;_i++){var t=_a[_i];if(this.userConfig[t.name]){if(!this.userConfig[t.name].isReady())return!1;atLeastOneTexture=!0}}atLeastOneTexture&&(defines._needUVs=!0,defines.TEXTURE=!0)}if(babylonjs_1.MaterialHelper.PrepareDefinesForMisc(mesh,scene,!1,this.pointsCloud,this.fogEnabled,!1,defines),defines._needNormals=babylonjs_1.MaterialHelper.PrepareDefinesForLights(scene,mesh,defines,!1,this._maxSimultaneousLights,this._disableLighting),babylonjs_1.MaterialHelper.PrepareDefinesForFrameBoundValues(scene,engine,defines,!!useInstances),babylonjs_1.MaterialHelper.PrepareDefinesForAttributes(mesh,defines,!0,!0),!this.customCode){for(var i=0;i<this._buildId;i++)delete defines["BUILD_"+i];defines["BUILD_"+this._buildId]=!0,defines.rebuild(),this._lastBuildId!==this._buildId&&subMesh.effect&&(this._lastBuildId=this._buildId,scene.getEngine()._releaseEffect(subMesh.effect))}if(defines.isDirty){defines.markAsProcessed(),scene.resetCachedMaterial();var fallbacks=new babylonjs_1.EffectFallbacks;defines.FOG&&fallbacks.addFallback(1,"FOG"),babylonjs_1.MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this.maxSimultaneousLights),defines.NUM_BONE_INFLUENCERS>0&&fallbacks.addCPUSkinningFallback(0,mesh);var attribs=[babylonjs_1.VertexBuffer.PositionKind];defines.NORMAL&&attribs.push(babylonjs_1.VertexBuffer.NormalKind),defines.UV1&&attribs.push(babylonjs_1.VertexBuffer.UVKind),defines.UV2&&attribs.push(babylonjs_1.VertexBuffer.UV2Kind),defines.VERTEXCOLOR&&attribs.push(babylonjs_1.VertexBuffer.ColorKind),babylonjs_1.MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks),babylonjs_1.MaterialHelper.PrepareAttributesForInstances(attribs,defines);var shaderName=this._shaderName,join=defines.toString(),uniformBuffers=new Array,samplers=this.config?this.config.textures.map(function(t){return t.name}):[],uniforms_1=["world","view","viewProjection","vEyePosition","vLightsType","vBaseColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane"];if(this.config&&(uniforms_1=uniforms_1.concat(this.config.floats).concat(this.config.vectors2).concat(this.config.vectors3),this.config.textures.forEach(function(t){uniforms_1.push(t.name+"Infos"),uniforms_1.push(t.name+"Matrix")})),this.customCode&&this.customCode.setUniforms(uniforms_1,samplers),this.customCode&&!this.customCode.isReadyForSubMesh(mesh,subMesh,defines))return!1;babylonjs_1.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms_1,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this.maxSimultaneousLights}),subMesh.setEffect(scene.getEngine().createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms_1,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},engine),defines)}return!(!subMesh.effect||!subMesh.effect.isReady())&&(this._renderId=scene.getRenderId(),this._wasPreviouslyReady=!0,!0)},CustomEditorMaterial.prototype.bindForSubMesh=function(world,mesh,subMesh){var _this=this,scene=this.getScene(),defines=subMesh._materialDefines;if(defines){var effect=subMesh.effect;effect&&(this._activeEffect=effect,this.bindOnlyWorldMatrix(world),this._activeEffect.setMatrix("viewProjection",scene.getTransformMatrix()),babylonjs_1.MaterialHelper.BindBonesParameters(mesh,this._activeEffect),this._mustRebind(scene,effect)&&(this.config&&this.config.textures.forEach(function(t){var texture=_this.userConfig[t.name];texture&&(_this._activeEffect.setTexture(t.name,texture),_this._activeEffect.setFloat2(t.name+"Infos",texture.coordinatesIndex,texture.level),_this._activeEffect.setMatrix(t.name+"Matrix",texture.getTextureMatrix()))}),babylonjs_1.MaterialHelper.BindClipPlane(this._activeEffect,scene),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),babylonjs_1.MaterialHelper.BindEyePosition(effect,scene)),this._activeEffect.setColor4("vBaseColor",this.baseColor,this.alpha*mesh.visibility),scene.lightsEnabled&&!this.disableLighting&&babylonjs_1.MaterialHelper.BindLights(scene,mesh,this._activeEffect,defines,this.maxSimultaneousLights),scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==babylonjs_1.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",scene.getViewMatrix()),babylonjs_1.MaterialHelper.BindFogParameters(scene,mesh,this._activeEffect),this.customCode&&this.customCode.bindForSubMesh(world,mesh,subMesh,this._activeEffect),this.config&&(this.config.floats.forEach(function(f){return void 0!==_this.userConfig[f]&&_this._activeEffect.setFloat(f,_this.userConfig[f]||0)}),this.config.vectors2.forEach(function(v){return void 0!==_this.userConfig[v]&&_this._activeEffect.setVector2(v,_this.userConfig[v])}),this.config.vectors3.forEach(function(v){return void 0!==_this.userConfig[v]&&_this._activeEffect.setVector3(v,_this.userConfig[v])})),this._afterBind(mesh,this._activeEffect))}},CustomEditorMaterial.prototype.getAnimatables=function(){var _this=this,results=[];return this.config.textures.forEach(function(t){var texture=_this.userConfig[t.name];texture&&texture.animations&&texture.animations.length>0&&results.push(texture)}),results},CustomEditorMaterial.prototype.getActiveTextures=function(){var _this=this,activeTextures=_super.prototype.getActiveTextures.call(this);return this.config.textures.forEach(function(t){var texture=_this.userConfig[t.name];texture&&activeTextures.push(texture)}),activeTextures},CustomEditorMaterial.prototype.hasTexture=function(texture){if(_super.prototype.hasTexture.call(this,texture))return!0;if(this.config)for(var _i=0,_a=this.config.textures;_i<_a.length;_i++){var t=_a[_i];if(this.userConfig[t.name]===texture)return!0}return!1},CustomEditorMaterial.prototype.dispose=function(forceDisposeEffect){this.customCode&&this.customCode.dispose(),_super.prototype.dispose.call(this,forceDisposeEffect)},CustomEditorMaterial.prototype.clone=function(name){var _this=this;return babylonjs_1.SerializationHelper.Clone(function(){return new CustomEditorMaterial(name,_this.getScene(),_this._shaderName,_this.customCode,_this.config)},this)},CustomEditorMaterial.prototype.serialize=function(){var _this=this,serializationObject=babylonjs_1.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.CustomEditorMaterial",serializationObject.textures={},serializationObject.floats={},serializationObject.vectors2={},serializationObject.vectors3={},this.config&&(this.config.textures.forEach(function(t){return void 0!==_this.userConfig[t.name]&&(serializationObject.textures[t.name]=_this.userConfig[t.name].serialize())}),this.config.floats.forEach(function(f){return void 0!==_this.userConfig[f]&&(serializationObject.floats[f]=_this.userConfig[f])}),this.config.vectors2.forEach(function(v){return void 0!==_this.userConfig[v]&&(serializationObject.vectors2[v]=_this.userConfig[v].asArray())}),this.config.vectors3.forEach(function(v){return void 0!==_this.userConfig[v]&&(serializationObject.vectors3[v]=_this.userConfig[v].asArray())})),serializationObject},CustomEditorMaterial.prototype.getClassName=function(){return"CustomMaterial"},CustomEditorMaterial.Parse=function(source,scene,rootUrl){var material=babylonjs_1.SerializationHelper.Parse(function(){return new CustomEditorMaterial(source.name,scene,source._shaderName,source._customCode,source.config)},source,scene,rootUrl);for(var thing in source.textures)material.userConfig[thing]=babylonjs_1.Texture.Parse(source.textures[thing],scene,rootUrl);for(var thing in source.floats)material.userConfig[thing]=source.floats[thing];for(var thing in source.vectors2)material.userConfig[thing]=babylonjs_1.Vector2.FromArray(source.vectors2[thing]);for(var thing in source.vectors3)material.userConfig[thing]=babylonjs_1.Vector3.FromArray(source.vectors3[thing]);return material},__decorate([babylonjs_1.serializeAsColor3("baseColor")],CustomEditorMaterial.prototype,"baseColor",void 0),__decorate([babylonjs_1.serialize("disableLighting")],CustomEditorMaterial.prototype,"_disableLighting",void 0),__decorate([babylonjs_1.expandToProperty("_markAllSubMeshesAsLightsDirty")],CustomEditorMaterial.prototype,"disableLighting",void 0),__decorate([babylonjs_1.serialize("maxSimultaneousLights")],CustomEditorMaterial.prototype,"_maxSimultaneousLights",void 0),__decorate([babylonjs_1.expandToProperty("_markAllSubMeshesAsLightsDirty")],CustomEditorMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([babylonjs_1.serialize()],CustomEditorMaterial.prototype,"_shaderName",void 0),CustomEditorMaterial}(babylonjs_1.PushMaterial);exports.default=CustomEditorMaterial,BABYLON.CustomEditorMaterial=CustomEditorMaterial}),$__System.registerDynamic("27",["c","d","e","25","26"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var EDITOR,babylonjs_1=$__require("c"),extensions_1=$__require("d"),extension_1=$__require("e"),tools_1=$__require("25"),material_1=$__require("26"),template="\nEDITOR.MaterialCreator.Constructors['{{name}}'] = function () {\nvar returnValue = null;\nvar exports = { };\n\n{{code}}\n"+tools_1.exportScriptString+"\n}\n";!function(EDITOR){var MaterialCreator=function(){function MaterialCreator(){}return MaterialCreator.Constructors={},MaterialCreator}();EDITOR.MaterialCreator=MaterialCreator}(EDITOR=exports.EDITOR||(exports.EDITOR={})),window.EDITOR=window.EDITOR||{},window.EDITOR.MaterialCreator=EDITOR.MaterialCreator;var MaterialEditorExtension=function(_super){function MaterialEditorExtension(scene){var _this=_super.call(this,scene)||this;return _this.instances={},_this.datas=[],MaterialEditorExtension.Instance=_this,_this}return __extends(MaterialEditorExtension,_super),MaterialEditorExtension.prototype.createMaterial=function(data,rootUrl){var _this=this,id=data.name+babylonjs_1.Tools.RandomId();babylonjs_1.Effect.ShadersStore[id+"VertexShader"]=data.vertex,babylonjs_1.Effect.ShadersStore[id+"PixelShader"]=data.pixel;var code=null;if(data.code){var url=window.location.href;url=url.replace(babylonjs_1.Tools.GetFilename(url),"")+"materials/"+data.name.replace(/ /g,"")+".js",extension_1.default.AddScript(template.replace("{{name}}",id).replace("{{code}}",data.compiledCode||data.code),url);code=new(EDITOR.MaterialCreator.Constructors[id]())}var config=null;try{config=JSON.parse(data.config)}catch(e){}var material=this.scene.getMaterialByName(data.name);return material?(material.config=config,material._shaderName=id,material.setCustomCode(code)):material=new material_1.default(data.name,this.scene,id,code,config),data.code&&(data.userConfig.textures.forEach(function(t){return material.userConfig[t.name]=babylonjs_1.Texture.Parse(t.value,_this.scene,rootUrl||"file:")}),data.userConfig.floats.forEach(function(f){return material.userConfig[f.name]=f.value}),data.userConfig.vectors2.forEach(function(v){return material.userConfig[v.name]=babylonjs_1.Vector2.FromArray(v.value)}),data.userConfig.vectors3.forEach(function(v){return material.userConfig[v.name]=babylonjs_1.Vector3.FromArray(v.value)})),this.instances[data.name]={code:code,material:material},material},MaterialEditorExtension.prototype.onApply=function(data,rootUrl){var _this=this;this.datas=data,this.datas.forEach(function(d){return _this.createMaterial(d,rootUrl)})},MaterialEditorExtension.prototype.onSerialize=function(){var _this=this;if(!this.scene.metadata||!this.scene.metadata.MaterialCreator)return null;var data=this.scene.metadata.MaterialCreator;return data.forEach(function(d){_this.scene.materials.forEach(function(m){m instanceof material_1.default&&m.config&&m.name===d.name&&(d.userConfig.textures=[],m.config.textures.forEach(function(t){return m.userConfig[t.name]&&d.userConfig.textures.push({value:m.userConfig[t.name].serialize(),name:t.name})}),d.userConfig.floats=[],m.config.floats.forEach(function(f){return d.userConfig.floats.push({value:m.userConfig[f],name:f})}),d.userConfig.vectors2=[],m.config.vectors2.forEach(function(v){return d.userConfig.vectors2.push({value:m.userConfig[v].asArray(),name:v})}),d.userConfig.vectors3=[],m.config.vectors3.forEach(function(v){return d.userConfig.vectors3.push({value:m.userConfig[v].asArray(),name:v})}))})}),data},MaterialEditorExtension.prototype.onLoad=function(data){var _this=this;this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.MaterialCreator=[],this.datas.forEach(function(d){d.id=d.id||babylonjs_1.Tools.RandomId(),_this.scene.metadata.MaterialCreator.push(d)})},MaterialEditorExtension.Instance=null,MaterialEditorExtension}(extension_1.default);exports.default=MaterialEditorExtension,extensions_1.default.Register("MaterialCreatorExtension",MaterialEditorExtension)}),$__System.registerDynamic("28",["c","e","d"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),extension_1=$__require("e"),extensions_1=$__require("d"),PostProcessesExtension=function(_super){function PostProcessesExtension(scene){var _this=_super.call(this,scene)||this;return _this.standard=null,_this.default=null,_this.ssao2=null,_this.datas={},_this}return __extends(PostProcessesExtension,_super),PostProcessesExtension.prototype.onApply=function(data,rootUrl){this._applyPostProcesses(data,rootUrl)},PostProcessesExtension.prototype.onSerialize=function(){var pipelines=this.scene.postProcessRenderPipelineManager._renderPipelines,data={};return pipelines.Standard&&(data.standard=pipelines.Standard.serialize()),pipelines.SSAO2&&(data.ssao2=pipelines.SSAO2.serialize()),pipelines.Default&&(data.default=pipelines.Default.serialize()),data},PostProcessesExtension.prototype.onLoad=function(data){this._applyPostProcesses(data,"file:")},PostProcessesExtension.prototype._applyPostProcesses=function(data,rootUrl){data.ssao2&&(this.ssao2=babylonjs_1.SSAO2RenderingPipeline.Parse(data.ssao2,this.scene,rootUrl),this.ssao2._attachCameras(this.scene.cameras,!0)),data.standard&&(this.standard=babylonjs_1.StandardRenderingPipeline.Parse(data.standard,this.scene,rootUrl),this.standard._attachCameras(this.scene.cameras,!0)),data.default&&(this.default=babylonjs_1.DefaultRenderingPipeline.Parse(data.default,this.scene,rootUrl),this.default._attachCameras(this.scene.cameras,!0))},PostProcessesExtension}(extension_1.default);exports.default=PostProcessesExtension,extensions_1.default.Register("PostProcess",PostProcessesExtension)}),$__System.registerDynamic("29",["d","e"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var extensions_1=$__require("d"),extension_1=$__require("e"),CustomMetadatasExtension=function(_super){function CustomMetadatasExtension(scene){var _this=_super.call(this,scene)||this;return _this.datas=[],_this}return __extends(CustomMetadatasExtension,_super),CustomMetadatasExtension.prototype.onApply=function(data){var _this=this;this.datas=data,data.forEach(function(d){var node=_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node)||_this.scene.getParticleSystemByID(d.nodeId);node&&(node.metadata=d.metadatas)})},CustomMetadatasExtension.prototype.onSerialize=function(){var result=[],add=function(nodes){nodes.forEach(function(n){n.metadata&&n.metadata.customMetadatas&&result.push({nodeId:n.id,node:n.name,metadatas:n.metadata.customMetadatas})})};return add(this.scene.meshes),add(this.scene.lights),add(this.scene.cameras),add(this.scene.particleSystems),result},CustomMetadatasExtension.prototype.onLoad=function(data){var _this=this;this.datas=data,data.forEach(function(d){var node=_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node)||_this.scene.getParticleSystemByID(d.nodeId);node&&(node.metadata=node.metadata||{},node.metadata.customMetadatas=d.metadatas)})},CustomMetadatasExtension}(extension_1.default);exports.default=CustomMetadatasExtension,extensions_1.default.Register("CustomMetadatasExtension",CustomMetadatasExtension)}),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("babylonjs")):$__System.registerDynamic("2a",["c"],!1,function($__require,$__exports,$__module){return factory.call(this,$__require("c"))})}("undefined"!=typeof self?self:"undefined"!=typeof global&&global,function(__WEBPACK_EXTERNAL_MODULE_babylonjs_Misc_decorators__){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="./legacy/legacy.ts")}({"../../node_modules/tslib/tslib.es6.js":function(module,__webpack_exports__,__webpack_require__){"use strict";function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&(t[p[i]]=s[p[i]]);return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g}function __exportStar(m,exports){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}function __values(o){var m="function"==typeof Symbol&&o[Symbol.iterator],i=0;return m?m.call(o):{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}}}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})})}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i}function __asyncDelegator(o){function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i}function __asyncValues(o){function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){v=o[n](v),settle(resolve,reject,v.done,v.value)})}}function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i)}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"__extends",function(){return __extends}),__webpack_require__.d(__webpack_exports__,"__assign",function(){return __assign}),__webpack_require__.d(__webpack_exports__,"__rest",function(){return __rest}),__webpack_require__.d(__webpack_exports__,"__decorate",function(){return __decorate}),__webpack_require__.d(__webpack_exports__,"__param",function(){return __param}),__webpack_require__.d(__webpack_exports__,"__metadata",function(){return __metadata}),__webpack_require__.d(__webpack_exports__,"__awaiter",function(){return __awaiter}),__webpack_require__.d(__webpack_exports__,"__generator",function(){return __generator}),__webpack_require__.d(__webpack_exports__,"__exportStar",function(){return __exportStar}),__webpack_require__.d(__webpack_exports__,"__values",function(){return __values}),__webpack_require__.d(__webpack_exports__,"__read",function(){return __read}),__webpack_require__.d(__webpack_exports__,"__spread",function(){return __spread}),__webpack_require__.d(__webpack_exports__,"__await",function(){return __await}),__webpack_require__.d(__webpack_exports__,"__asyncGenerator",function(){return __asyncGenerator}),__webpack_require__.d(__webpack_exports__,"__asyncDelegator",function(){return __asyncDelegator}),__webpack_require__.d(__webpack_exports__,"__asyncValues",function(){return __asyncValues}),__webpack_require__.d(__webpack_exports__,"__makeTemplateObject",function(){return __makeTemplateObject}),__webpack_require__.d(__webpack_exports__,"__importStar",function(){return __importStar}),__webpack_require__.d(__webpack_exports__,"__importDefault",function(){return __importDefault});var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign.apply(this,arguments)}},"../../node_modules/webpack/buildin/global.js":function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},"./asciiArt/asciiArtPostProcess.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"AsciiArtFontTexture",function(){return AsciiArtFontTexture}),__webpack_require__.d(__webpack_exports__,"AsciiArtPostProcess",function(){return AsciiArtPostProcess});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),AsciiArtFontTexture=(__webpack_require__("./asciiArt/asciiart.fragment.ts"),function(_super){function AsciiArtFontTexture(name,font,text,scene){void 0===scene&&(scene=null);var _this=_super.call(this,scene)||this;if(!(scene=_this.getScene()))return _this;_this.name=name,_this._text,_this._font,_this.wrapU=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.CLAMP_ADDRESSMODE,_this.wrapV=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.CLAMP_ADDRESSMODE;var maxCharHeight=_this.getFontHeight(font),maxCharWidth=_this.getFontWidth(font);_this._charSize=Math.max(maxCharHeight.height,maxCharWidth);var textureWidth=Math.ceil(_this._charSize*text.length),textureHeight=_this._charSize;_this._texture=scene.getEngine().createDynamicTexture(textureWidth,textureHeight,!1,babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.NEAREST_SAMPLINGMODE);var textureSize=_this.getSize(),canvas=document.createElement("canvas");canvas.width=textureSize.width,canvas.height=textureSize.height;var context=canvas.getContext("2d");context.textBaseline="top",context.font=font,context.fillStyle="white",context.imageSmoothingEnabled=!1;for(var i=0;i<text.length;i++)context.fillText(text[i],i*_this._charSize,-maxCharHeight.offset);return scene.getEngine().updateDynamicTexture(_this._texture,canvas,!1,!0),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(AsciiArtFontTexture,_super),Object.defineProperty(AsciiArtFontTexture.prototype,"charSize",{get:function(){return this._charSize},enumerable:!0,configurable:!0}),AsciiArtFontTexture.prototype.getFontWidth=function(font){var fontDraw=document.createElement("canvas"),ctx=fontDraw.getContext("2d");return ctx.fillStyle="white",ctx.font=font,ctx.measureText("W").width},AsciiArtFontTexture.prototype.getFontHeight=function(font){var fontDraw=document.createElement("canvas"),ctx=fontDraw.getContext("2d");ctx.fillRect(0,0,fontDraw.width,fontDraw.height),ctx.textBaseline="top",ctx.fillStyle="white",ctx.font=font,ctx.fillText("jH|",0,0);for(var pixels=ctx.getImageData(0,0,fontDraw.width,fontDraw.height).data,start=-1,end=-1,row=0;row<fontDraw.height;row++)for(var column=0;column<fontDraw.width;column++){var index=4*(row*fontDraw.width+column);{if(0!==pixels[index]){-1===start&&(start=row);break}if(column===fontDraw.width-1&&-1!==start){end=row,row=fontDraw.height;break}}}return{height:end-start+1,offset:start-1}},AsciiArtFontTexture.prototype.clone=function(){return new AsciiArtFontTexture(this.name,this._font,this._text,this.getScene())},AsciiArtFontTexture.Parse=function(source,scene){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new AsciiArtFontTexture(source.name,source.font,source.text,scene)},source,scene,null)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)("font")],AsciiArtFontTexture.prototype,"_font",void 0),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)("text")],AsciiArtFontTexture.prototype,"_text",void 0),AsciiArtFontTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.BaseTexture)),AsciiArtPostProcess=function(_super){function AsciiArtPostProcess(name,camera,options){var _this=_super.call(this,name,"asciiart",["asciiArtFontInfos","asciiArtOptions"],["asciiArtFont"],{width:camera.getEngine().getRenderWidth(),height:camera.getEngine().getRenderHeight()},camera,babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.TRILINEAR_SAMPLINGMODE,camera.getEngine(),!0)||this;_this.mixToTile=0,_this.mixToNormal=0;var font="40px Monospace",characterSet=" `-.'_:,\"=^;<+!*?/cL\\zrs7TivJtC{3F)Il(xZfY5S2eajo14[nuyE]P6V9kXpKwGhqAUbOd8#HRDB0$mgMW&Q%N@";options&&("string"==typeof options?font=options:(font=options.font||font,characterSet=options.characterSet||characterSet,_this.mixToTile=options.mixToTile||_this.mixToTile,_this.mixToNormal=options.mixToNormal||_this.mixToNormal)),_this._asciiArtFontTexture=new AsciiArtFontTexture(name,font,characterSet,camera.getScene());var textureSize=_this._asciiArtFontTexture.getSize();return _this.onApply=function(effect){effect.setTexture("asciiArtFont",_this._asciiArtFontTexture),effect.setFloat4("asciiArtFontInfos",_this._asciiArtFontTexture.charSize,characterSet.length,textureSize.width,textureSize.height),effect.setFloat4("asciiArtOptions",_this.width,_this.height,_this.mixToNormal,_this.mixToTile)},_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(AsciiArtPostProcess,_super),AsciiArtPostProcess}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.PostProcess)},"./asciiArt/asciiart.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"asciiartPixelShader",function(){return asciiartPixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="asciiartPixelShader",shader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D asciiArtFont;\n\nuniform vec4 asciiArtFontInfos;\nuniform vec4 asciiArtOptions;\n\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\n\nvoid main(void)\n{\nfloat caracterSize=asciiArtFontInfos.x;\nfloat numChar=asciiArtFontInfos.y-1.0;\nfloat fontx=asciiArtFontInfos.z;\nfloat fonty=asciiArtFontInfos.w;\nfloat screenx=asciiArtOptions.x;\nfloat screeny=asciiArtOptions.y;\nfloat tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;\nfloat tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;\nvec2 tileUV=vec2(tileX,tileY);\nvec4 tileColor=texture2D(textureSampler,tileUV);\nvec4 baseColor=texture2D(textureSampler,vUV);\nfloat tileLuminance=getLuminance(tileColor.rgb);\nfloat offsetx=(float(floor(tileLuminance*numChar)))*caracterSize/fontx;\nfloat offsety=0.0;\nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;\nfloat y=float(mod(gl_FragCoord.y,caracterSize))/fonty;\nvec4 finalColor=texture2D(asciiArtFont,vec2(offsetx+x,offsety+(caracterSize/fonty-y)));\nfinalColor.rgb*=tileColor.rgb;\nfinalColor.a=1.0;\nfinalColor=mix(finalColor,tileColor,asciiArtOptions.w);\nfinalColor=mix(finalColor,baseColor,asciiArtOptions.z);\ngl_FragColor=finalColor;\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var asciiartPixelShader={name:name,shader:shader}},"./asciiArt/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _asciiArtPostProcess__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./asciiArt/asciiArtPostProcess.ts");__webpack_require__.d(__webpack_exports__,"AsciiArtFontTexture",function(){return _asciiArtPostProcess__WEBPACK_IMPORTED_MODULE_0__.AsciiArtFontTexture}),__webpack_require__.d(__webpack_exports__,"AsciiArtPostProcess",function(){return _asciiArtPostProcess__WEBPACK_IMPORTED_MODULE_0__.AsciiArtPostProcess})},"./digitalRain/digitalRainPostProcess.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"DigitalRainFontTexture",function(){return DigitalRainFontTexture}),__webpack_require__.d(__webpack_exports__,"DigitalRainPostProcess",function(){return DigitalRainPostProcess});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),DigitalRainFontTexture=(__webpack_require__("./digitalRain/digitalrain.fragment.ts"),function(_super){function DigitalRainFontTexture(name,font,text,scene){void 0===scene&&(scene=null);var _this=_super.call(this,scene)||this;if(!(scene=_this.getScene()))return _this;_this.name=name,_this._text,_this._font,_this.wrapU=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.CLAMP_ADDRESSMODE,_this.wrapV=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.CLAMP_ADDRESSMODE;var maxCharHeight=_this.getFontHeight(font),maxCharWidth=_this.getFontWidth(font);_this._charSize=Math.max(maxCharHeight.height,maxCharWidth);var textureWidth=_this._charSize,textureHeight=Math.ceil(_this._charSize*text.length);_this._texture=scene.getEngine().createDynamicTexture(textureWidth,textureHeight,!1,babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.NEAREST_SAMPLINGMODE);var textureSize=_this.getSize(),canvas=document.createElement("canvas");canvas.width=textureSize.width,canvas.height=textureSize.height;var context=canvas.getContext("2d");context.textBaseline="top",context.font=font,context.fillStyle="white",context.imageSmoothingEnabled=!1;for(var i=0;i<text.length;i++)context.fillText(text[i],0,i*_this._charSize-maxCharHeight.offset);return scene.getEngine().updateDynamicTexture(_this._texture,canvas,!1,!0),_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(DigitalRainFontTexture,_super),Object.defineProperty(DigitalRainFontTexture.prototype,"charSize",{get:function(){return this._charSize},enumerable:!0,configurable:!0}),DigitalRainFontTexture.prototype.getFontWidth=function(font){var fontDraw=document.createElement("canvas"),ctx=fontDraw.getContext("2d");return ctx.fillStyle="white",ctx.font=font,ctx.measureText("W").width},DigitalRainFontTexture.prototype.getFontHeight=function(font){var fontDraw=document.createElement("canvas"),ctx=fontDraw.getContext("2d");ctx.fillRect(0,0,fontDraw.width,fontDraw.height),ctx.textBaseline="top",ctx.fillStyle="white",ctx.font=font,ctx.fillText("jH|",0,0);for(var pixels=ctx.getImageData(0,0,fontDraw.width,fontDraw.height).data,start=-1,end=-1,row=0;row<fontDraw.height;row++)for(var column=0;column<fontDraw.width;column++){var index=4*(row*fontDraw.width+column);{if(0!==pixels[index]){-1===start&&(start=row);break}if(column===fontDraw.width-1&&-1!==start){end=row,row=fontDraw.height;break}}}return{height:end-start+1,offset:start-1}},DigitalRainFontTexture.prototype.clone=function(){return new DigitalRainFontTexture(this.name,this._font,this._text,this.getScene())},DigitalRainFontTexture.Parse=function(source,scene){return babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.SerializationHelper.Parse(function(){return new DigitalRainFontTexture(source.name,source.font,source.text,scene)},source,scene,null)},tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)("font")],DigitalRainFontTexture.prototype,"_font",void 0),tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate([Object(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.serialize)("text")],DigitalRainFontTexture.prototype,"_text",void 0),DigitalRainFontTexture}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.BaseTexture)),DigitalRainPostProcess=function(_super){function DigitalRainPostProcess(name,camera,options){var _this=_super.call(this,name,"digitalrain",["digitalRainFontInfos","digitalRainOptions","cosTimeZeroOne","matrixSpeed"],["digitalRainFont"],{width:camera.getEngine().getRenderWidth(),height:camera.getEngine().getRenderHeight()},camera,babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Texture.TRILINEAR_SAMPLINGMODE,camera.getEngine(),!0)||this;_this.mixToTile=0,_this.mixToNormal=0;var font="15px Monospace",characterSet="古池や蛙飛び込む水の音ふるいけやかわずとびこむみずのおと初しぐれ猿も小蓑をほしげ也はつしぐれさるもこみのをほしげなり江戸の雨何石呑んだ時鳥えどのあめなんごくのんだほととぎす";options&&("string"==typeof options?font=options:(font=options.font||font,_this.mixToTile=options.mixToTile||_this.mixToTile,_this.mixToNormal=options.mixToNormal||_this.mixToNormal)),_this._digitalRainFontTexture=new DigitalRainFontTexture(name,font,characterSet,camera.getScene());var textureSize=_this._digitalRainFontTexture.getSize(),alpha=0,cosTimeZeroOne=0,matrix=babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.Matrix.FromValues(Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random());return _this.onApply=function(effect){effect.setTexture("digitalRainFont",_this._digitalRainFontTexture),effect.setFloat4("digitalRainFontInfos",_this._digitalRainFontTexture.charSize,characterSet.length,textureSize.width,textureSize.height),effect.setFloat4("digitalRainOptions",_this.width,_this.height,_this.mixToNormal,_this.mixToTile),effect.setMatrix("matrixSpeed",matrix),alpha+=.003,cosTimeZeroOne=alpha,effect.setFloat("cosTimeZeroOne",cosTimeZeroOne)},_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(DigitalRainPostProcess,_super),DigitalRainPostProcess}(babylonjs_Misc_decorators__WEBPACK_IMPORTED_MODULE_1__.PostProcess)},"./digitalRain/digitalrain.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"digitalrainPixelShader",function(){return digitalrainPixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="digitalrainPixelShader",shader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D digitalRainFont;\n\nuniform vec4 digitalRainFontInfos;\nuniform vec4 digitalRainOptions;\nuniform mat4 matrixSpeed;\nuniform float cosTimeZeroOne;\n\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\n\nvoid main(void)\n{\nfloat caracterSize=digitalRainFontInfos.x;\nfloat numChar=digitalRainFontInfos.y-1.0;\nfloat fontx=digitalRainFontInfos.z;\nfloat fonty=digitalRainFontInfos.w;\nfloat screenx=digitalRainOptions.x;\nfloat screeny=digitalRainOptions.y;\nfloat ratio=screeny/fonty;\nfloat columnx=float(floor((gl_FragCoord.x)/caracterSize));\nfloat tileX=float(floor((gl_FragCoord.x)/caracterSize))*caracterSize/screenx;\nfloat tileY=float(floor((gl_FragCoord.y)/caracterSize))*caracterSize/screeny;\nvec2 tileUV=vec2(tileX,tileY);\nvec4 tileColor=texture2D(textureSampler,tileUV);\nvec4 baseColor=texture2D(textureSampler,vUV);\nfloat tileLuminance=getLuminance(tileColor.rgb);\nint st=int(mod(columnx,4.0));\nfloat speed=cosTimeZeroOne*(sin(tileX*314.5)*0.5+0.6);\nfloat x=float(mod(gl_FragCoord.x,caracterSize))/fontx;\nfloat y=float(mod(speed+gl_FragCoord.y/screeny,1.0));\ny*=ratio;\nvec4 finalColor=texture2D(digitalRainFont,vec2(x,1.0-y));\nvec3 high=finalColor.rgb*(vec3(1.2,1.2,1.2)*pow(1.0-y,30.0));\nfinalColor.rgb*=vec3(pow(tileLuminance,5.0),pow(tileLuminance,1.5),pow(tileLuminance,3.0));\nfinalColor.rgb+=high;\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\nfinalColor.a=1.0;\nfinalColor=mix(finalColor,tileColor,digitalRainOptions.w);\nfinalColor=mix(finalColor,baseColor,digitalRainOptions.z);\ngl_FragColor=finalColor;\n}";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var digitalrainPixelShader={name:name,shader:shader}},"./digitalRain/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _digitalRainPostProcess__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./digitalRain/digitalRainPostProcess.ts");__webpack_require__.d(__webpack_exports__,"DigitalRainFontTexture",function(){return _digitalRainPostProcess__WEBPACK_IMPORTED_MODULE_0__.DigitalRainFontTexture}),__webpack_require__.d(__webpack_exports__,"DigitalRainPostProcess",function(){return _digitalRainPostProcess__WEBPACK_IMPORTED_MODULE_0__.DigitalRainPostProcess})},"./index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _asciiArt__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./asciiArt/index.ts");__webpack_require__.d(__webpack_exports__,"AsciiArtFontTexture",function(){return _asciiArt__WEBPACK_IMPORTED_MODULE_0__.AsciiArtFontTexture}),__webpack_require__.d(__webpack_exports__,"AsciiArtPostProcess",function(){return _asciiArt__WEBPACK_IMPORTED_MODULE_0__.AsciiArtPostProcess});var _digitalRain__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./digitalRain/index.ts");__webpack_require__.d(__webpack_exports__,"DigitalRainFontTexture",function(){return _digitalRain__WEBPACK_IMPORTED_MODULE_1__.DigitalRainFontTexture}),__webpack_require__.d(__webpack_exports__,"DigitalRainPostProcess",function(){return _digitalRain__WEBPACK_IMPORTED_MODULE_1__.DigitalRainPostProcess});var _ocean__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./ocean/index.ts");__webpack_require__.d(__webpack_exports__,"OceanPostProcess",function(){return _ocean__WEBPACK_IMPORTED_MODULE_2__.OceanPostProcess})},"./legacy/legacy.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(global){var _index__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./index.ts");__webpack_require__.d(__webpack_exports__,"AsciiArtFontTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.AsciiArtFontTexture}),__webpack_require__.d(__webpack_exports__,"AsciiArtPostProcess",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.AsciiArtPostProcess}),__webpack_require__.d(__webpack_exports__,"DigitalRainFontTexture",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.DigitalRainFontTexture}),__webpack_require__.d(__webpack_exports__,"DigitalRainPostProcess",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.DigitalRainPostProcess}),__webpack_require__.d(__webpack_exports__,"OceanPostProcess",function(){return _index__WEBPACK_IMPORTED_MODULE_0__.OceanPostProcess});var globalObject=void 0!==global?global:"undefined"!=typeof window?window:void 0;if(void 0!==globalObject)for(var key in _index__WEBPACK_IMPORTED_MODULE_0__)globalObject.BABYLON[key]=_index__WEBPACK_IMPORTED_MODULE_0__[key]}.call(this,__webpack_require__("../../node_modules/webpack/buildin/global.js"))},"./ocean/index.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _oceanPostProcess__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./ocean/oceanPostProcess.ts");__webpack_require__.d(__webpack_exports__,"OceanPostProcess",function(){return _oceanPostProcess__WEBPACK_IMPORTED_MODULE_0__.OceanPostProcess})},"./ocean/oceanPostProcess.fragment.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"oceanPostProcessPixelShader",function(){return oceanPostProcessPixelShader});var babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("babylonjs/Misc/decorators"),name="oceanPostProcessPixelShader",shader="\n\nuniform sampler2D textureSampler;\nuniform sampler2D positionSampler;\n#ifdef REFLECTION_ENABLED\nuniform sampler2D reflectionSampler;\n#endif\n#ifdef REFRACTION_ENABLED\nuniform sampler2D refractionSampler;\n#endif\nuniform float time;\nuniform vec2 resolution;\nuniform vec3 cameraRotation;\nuniform vec3 cameraPosition;\n\nvarying vec2 vUV;\n\nconst int NUM_STEPS=8;\nconst float PI=3.141592;\nconst float EPSILON=1e-3;\n#define EPSILON_NRM (0.1/resolution.x)\n\nconst int ITER_GEOMETRY=8;\nconst int ITER_FRAGMENT=5;\nconst float SEA_HEIGHT=0.6;\nconst float SEA_CHOPPY=4.0;\nconst float SEA_SPEED=0.8;\nconst float SEA_FREQ=0.16;\nconst vec3 SEA_BASE=vec3(0.1,0.19,0.22);\nconst vec3 SEA_WATER_COLOR=vec3(0.8,0.9,0.6);\n#define SEA_TIME (1.0+time*SEA_SPEED)\nconst mat2 octave_m=mat2(1.6,1.2,-1.2,1.6);\n\nmat3 fromEuler(vec3 ang)\n{\nvec2 a1=vec2(sin(ang.x),cos(ang.x));\nvec2 a2=vec2(sin(ang.y),cos(ang.y));\nvec2 a3=vec2(sin(ang.z),cos(ang.z));\nmat3 m;\nm[0]=vec3(a1.y*a3.y+a1.x*a2.x*a3.x,a1.y*a2.x*a3.x+a3.y*a1.x,-a2.y*a3.x);\nm[1]=vec3(-a2.y*a1.x,a1.y*a2.y,a2.x);\nm[2]=vec3(a3.y*a1.x*a2.x+a1.y*a3.x,a1.x*a3.x-a1.y*a3.y*a2.x,a2.y*a3.y);\nreturn m;\n}\nfloat hash( vec2 p )\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn fract(sin(h)*43758.5453123);\n}\nfloat noise( in vec2 p )\n{\nvec2 i=floor( p );\nvec2 f=fract( p );\nvec2 u=f*f*(3.0-2.0*f);\nreturn -1.0+2.0*mix( mix( hash( i+vec2(0.0,0.0) ),\nhash( i+vec2(1.0,0.0) ),u.x),\nmix( hash( i+vec2(0.0,1.0) ),\nhash( i+vec2(1.0,1.0) ),u.x),u.y);\n}\n\nfloat diffuse(vec3 n,vec3 l,float p)\n{\nreturn pow(dot(n,l)*0.4+0.6,p);\n}\nfloat specular(vec3 n,vec3 l,vec3 e,float s)\n{\nfloat nrm=(s+8.0)/(PI*8.0);\nreturn pow(max(dot(reflect(e,n),l),0.0),s)*nrm;\n}\n\nfloat sea_octave(vec2 uv,float choppy)\n{\nuv+=noise(uv);\nvec2 wv=1.0-abs(sin(uv));\nvec2 swv=abs(cos(uv));\nwv=mix(wv,swv,wv);\nreturn pow(1.0-pow(wv.x*wv.y,0.65),choppy);\n}\nfloat map(vec3 p)\n{\nfloat freq=SEA_FREQ;\nfloat amp=SEA_HEIGHT;\nfloat choppy=SEA_CHOPPY;\nvec2 uv=p.xz; uv.x*=0.75;\nfloat d,h=0.0;\nfor(int i=0; i<ITER_GEOMETRY; i++)\n{\nd=sea_octave((uv+SEA_TIME)*freq,choppy);\nd+=sea_octave((uv-SEA_TIME)*freq,choppy);\nh+=d*amp;\nuv*=octave_m; freq*=1.9; amp*=0.22;\nchoppy=mix(choppy,1.0,0.2);\n}\nreturn p.y-h;\n}\nfloat map_detailed(vec3 p)\n{\nfloat freq=SEA_FREQ;\nfloat amp=SEA_HEIGHT;\nfloat choppy=SEA_CHOPPY;\nvec2 uv=p.xz; uv.x*=0.75;\nfloat d,h=0.0;\nfor(int i=0; i<ITER_FRAGMENT; i++)\n{\nd=sea_octave((uv+SEA_TIME)*freq,choppy);\nd+=sea_octave((uv-SEA_TIME)*freq,choppy);\nh+=d*amp;\nuv*=octave_m; freq*=1.9; amp*=0.22;\nchoppy=mix(choppy,1.0,0.2);\n}\nreturn p.y-h;\n}\nvec3 getSeaColor(vec3 p,vec3 n,vec3 l,vec3 eye,vec3 dist)\n{\nfloat fresnel=clamp(1.0-dot(n,-eye),0.0,1.0);\nfresnel=pow(fresnel,3.0)*0.65;\n#if defined(REFLECTION_ENABLED) || defined(REFRACTION_ENABLED)\nvec2 reflectionUv=vec2(vUV.x,vUV.y+normalize(n).y);\n#endif\n#ifdef REFLECTION_ENABLED\nvec3 reflected=texture2D(reflectionSampler,reflectionUv).rgb*(1.0-fresnel);\n#else\nvec3 eyeNormal=reflect(eye,n);\neyeNormal.y=max(eyeNormal.y,0.0);\nvec3 reflected=vec3(pow(1.0-eyeNormal.y,2.0),1.0-eyeNormal.y,0.6+(1.0-eyeNormal.y)*0.4);\n#endif\n#ifdef REFRACTION_ENABLED\nvec3 refracted=SEA_BASE+diffuse(n,l,80.0)*SEA_WATER_COLOR*0.12;\nrefracted+=(texture2D(refractionSampler,reflectionUv).rgb*fresnel);\n#else\nvec3 refracted=SEA_BASE+diffuse(n,l,80.0)*SEA_WATER_COLOR*0.12;\n#endif\nvec3 color=mix(refracted,reflected,fresnel);\nfloat atten=max(1.0-dot(dist,dist)*0.001,0.0);\ncolor+=SEA_WATER_COLOR*(p.y-SEA_HEIGHT)*0.18*atten;\ncolor+=vec3(specular(n,l,eye,60.0));\nreturn color;\n}\n\nvec3 getNormal(vec3 p,float eps)\n{\nvec3 n;\nn.y=map_detailed(p);\nn.x=map_detailed(vec3(p.x+eps,p.y,p.z))-n.y;\nn.z=map_detailed(vec3(p.x,p.y,p.z+eps))-n.y;\nn.y=eps;\nreturn normalize(n);\n}\nfloat heightMapTracing(vec3 ori,vec3 dir,out vec3 p)\n{\nfloat tm=0.0;\nfloat tx=1000.0;\nfloat hx=map(ori+dir*tx);\nif(hx>0.0) return tx;\nfloat hm=map(ori+dir*tm);\nfloat tmid=0.0;\nfor(int i=0; i<NUM_STEPS; i++)\n{\ntmid=mix(tm,tx,hm/(hm-hx));\np=ori+dir*tmid;\nfloat hmid=map(p);\nif(hmid<0.0)\n{\ntx=tmid;\nhx=hmid;\n}\nelse\n{\ntm=tmid;\nhm=hmid;\n}\n}\nreturn tmid;\n}\n\nvoid main()\n{\n#ifdef NOT_SUPPORTED\n\ngl_FragColor=texture2D(textureSampler,vUV);\n#else\nvec2 uv=vUV;\nuv=uv*2.0-1.0;\nuv.x*=resolution.x/resolution.y;\n\nvec3 ang=vec3(cameraRotation.z,cameraRotation.x,cameraRotation.y);\nvec3 ori=vec3(cameraPosition.x,cameraPosition.y,-cameraPosition.z);\nvec3 dir=normalize(vec3(uv.xy,-3.0));\ndir=normalize(dir)*fromEuler(ang);\n\nvec3 p;\nheightMapTracing(ori,dir,p);\nvec3 dist=p-ori;\nvec3 n=getNormal(p,dot(dist,dist)*EPSILON_NRM);\nvec3 light=normalize(vec3(0.0,1.0,0.8));\n\nfloat seaFact=clamp(max(ori.y,0.0),0.0,1.0);\nvec3 position=texture2D(positionSampler,vUV).rgb;\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 color=baseColor;\nif (max(position.y,0.0)<p.y)\n{\n\ncolor=mix(\nbaseColor,\ngetSeaColor(p,n,light,dir,dist),\npow(smoothstep(0.0,-0.05,dir.y),0.3)\n)*seaFact;\n}\ncolor=mix(\ncolor,\nbaseColor*SEA_BASE+diffuse(n,n,80.0)*SEA_WATER_COLOR*0.12,\n1.0-seaFact\n);\n\ngl_FragColor=vec4(pow(color,vec3(0.75)),1.0);\n#endif\n}\n";babylonjs_Materials_effect__WEBPACK_IMPORTED_MODULE_0__.Effect.ShadersStore[name]=shader;var oceanPostProcessPixelShader={name:name,shader:shader}},"./ocean/oceanPostProcess.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"OceanPostProcess",function(){return OceanPostProcess});var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/tslib/tslib.es6.js"),babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("babylonjs/Misc/decorators"),OceanPostProcess=(__webpack_require__("./ocean/oceanPostProcess.fragment.ts"),function(_super){function OceanPostProcess(name,camera,options){void 0===options&&(options={});var _this=_super.call(this,name,"oceanPostProcess",["time","resolution","cameraPosition","cameraRotation"],["positionSampler","reflectionSampler","refractionSampler"],{width:camera.getEngine().getRenderWidth(),height:camera.getEngine().getRenderHeight()},camera,babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Texture.TRILINEAR_SAMPLINGMODE,camera.getEngine(),!0)||this;return _this._time=0,_this._cameraRotation=babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Vector3.Zero(),_this._cameraViewMatrix=babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Matrix.Identity(),_this._reflectionEnabled=!1,_this._refractionEnabled=!1,_this._geometryRenderer=camera.getScene().enableGeometryBufferRenderer(1),_this._geometryRenderer&&_this._geometryRenderer.isSupported?(_this._geometryRenderer.enablePosition=!0,_this.reflectionTexture=new babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.MirrorTexture("oceanPostProcessReflection",options.reflectionSize||{width:512,height:512},camera.getScene()),_this.reflectionTexture.mirrorPlane=babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Plane.FromPositionAndNormal(babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Vector3.Zero(),new babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Vector3(0,-1,0)),_this.refractionTexture=new babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.RenderTargetTexture("oceanPostProcessRefraction",options.refractionSize||{width:512,height:512},camera.getScene())):_this.updateEffect("#define NOT_SUPPORTED\n"),_this.onApply=function(effect){if(_this._geometryRenderer&&_this._geometryRenderer.isSupported){var engine=camera.getEngine(),scene=camera.getScene();_this._time+=.001*engine.getDeltaTime(),effect.setFloat("time",_this._time),effect.setVector2("resolution",new babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Vector2(engine.getRenderWidth(),engine.getRenderHeight())),scene&&(effect.setVector3("cameraPosition",camera.globalPosition),_this._computeCameraRotation(camera),effect.setVector3("cameraRotation",_this._cameraRotation),effect.setTexture("positionSampler",_this._geometryRenderer.getGBuffer().textures[2]),_this._reflectionEnabled&&effect.setTexture("reflectionSampler",_this.reflectionTexture),_this._refractionEnabled&&effect.setTexture("refractionSampler",_this.refractionTexture))}},_this}return tslib__WEBPACK_IMPORTED_MODULE_0__.__extends(OceanPostProcess,_super),Object.defineProperty(OceanPostProcess.prototype,"reflectionEnabled",{get:function(){return this._reflectionEnabled},set:function(enabled){if(this._reflectionEnabled!==enabled){this._reflectionEnabled=enabled,this.updateEffect(this._getDefines());var customRenderTargets=this.getCamera().getScene().customRenderTargets;if(enabled)customRenderTargets.push(this.reflectionTexture);else{var index=customRenderTargets.indexOf(this.reflectionTexture);-1!==index&&customRenderTargets.splice(index,1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(OceanPostProcess.prototype,"refractionEnabled",{get:function(){return this._refractionEnabled},set:function(enabled){if(this._refractionEnabled!==enabled){this._refractionEnabled=enabled,this.updateEffect(this._getDefines());var customRenderTargets=this.getCamera().getScene().customRenderTargets;if(enabled)customRenderTargets.push(this.refractionTexture);else{var index=customRenderTargets.indexOf(this.refractionTexture);-1!==index&&customRenderTargets.splice(index,1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(OceanPostProcess.prototype,"isSupported",{get:function(){return null!==this._geometryRenderer&&this._geometryRenderer.isSupported},enumerable:!0,configurable:!0}),OceanPostProcess.prototype._getDefines=function(){var defines=[];return this._reflectionEnabled&&defines.push("#define REFLECTION_ENABLED"),this._refractionEnabled&&defines.push("#define REFRACTION_ENABLED"),defines.join("\n")},OceanPostProcess.prototype._computeCameraRotation=function(camera){camera.upVector.normalize();var target=camera.getTarget();camera._initialFocalDistance=target.subtract(camera.position).length(),camera.position.z===target.z&&(camera.position.z+=babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.Epsilon);var direction=target.subtract(camera.position);camera._viewMatrix.invertToRef(this._cameraViewMatrix),this._cameraRotation.x=Math.atan(this._cameraViewMatrix.m[6]/this._cameraViewMatrix.m[10]),direction.x>=0?this._cameraRotation.y=-Math.atan(direction.z/direction.x)+Math.PI/2:this._cameraRotation.y=-Math.atan(direction.z/direction.x)-Math.PI/2,this._cameraRotation.z=0,isNaN(this._cameraRotation.x)&&(this._cameraRotation.x=0),isNaN(this._cameraRotation.y)&&(this._cameraRotation.y=0),isNaN(this._cameraRotation.z)&&(this._cameraRotation.z=0)},OceanPostProcess}(babylonjs_Materials_Textures_texture__WEBPACK_IMPORTED_MODULE_1__.PostProcess))},"babylonjs/Misc/decorators":function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_babylonjs_Misc_decorators__}})}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("babylonjs")):$__System.registerDynamic("2b",["c"],!1,function($__require,$__exports,$__module){return e.call(this,$__require("c"))})}("undefined"!=typeof self?self:"undefined"!=typeof global&&global,function(t){return function(t){function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}var e={};return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(e,i){e.exports=t},function(t,e,i){"use strict";function n(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function o(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s}i.r(e);var s,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},h=i(0),a=function(){function t(e,i,r){void 0===i&&(i=t.UNITMODE_PIXEL),void 0===r&&(r=!0),this.unit=i,this.negativeValueAllowed=r,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=e,this._originalUnit=i}return Object.defineProperty(t.prototype,"isPercentage",{get:function(){return this.unit===t.UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPixel",{get:function(){return this.unit===t.UNITMODE_PIXEL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"internalValue",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.getValueInPixel=function(t,e){return this.isPixel?this.getValue(t):this.getValue(t)*e},t.prototype.updateInPlace=function(e,i){return void 0===i&&(i=t.UNITMODE_PIXEL),this._value=e,this.unit=i,this},t.prototype.getValue=function(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==t.UNITMODE_PERCENTAGE){var i=0,r=0;if(e.idealWidth&&(i=this._value*e.getSize().width/e.idealWidth),e.idealHeight&&(r=this._value*e.getSize().height/e.idealHeight),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?i:r;if(e.idealWidth)return i;if(e.idealHeight)return r}return this._value},t.prototype.toString=function(e,i){switch(this.unit){case t.UNITMODE_PERCENTAGE:var r=100*this.getValue(e);return(i?r.toFixed(i):r)+"%";case t.UNITMODE_PIXEL:var n=this.getValue(e);return(i?n.toFixed(i):n)+"px"}return this.unit.toString()},t.prototype.fromString=function(e){var i=t._Regex.exec(e.toString());if(!i||0===i.length)return!1;var r=parseFloat(i[1]),n=this._originalUnit;if(this.negativeValueAllowed||r<0&&(r=0),4===i.length)switch(i[3]){case"px":n=t.UNITMODE_PIXEL;break;case"%":n=t.UNITMODE_PERCENTAGE,r/=100}return(r!==this._value||n!==this.unit)&&(this._value=r,this.unit=n,!0)},Object.defineProperty(t,"UNITMODE_PERCENTAGE",{get:function(){return t._UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UNITMODE_PIXEL",{get:function(){return t._UNITMODE_PIXEL},enumerable:!0,configurable:!0}),t._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,t._UNITMODE_PERCENTAGE=0,t._UNITMODE_PIXEL=1,t}(),l=function(){function t(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height},t.prototype.copyFromFloats=function(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r},t.CombineToRef=function(t,e,i){var r=Math.min(t.left,e.left),n=Math.min(t.top,e.top),o=Math.max(t.left+t.width,e.left+e.width),s=Math.max(t.top+t.height,e.top+e.height);i.left=r,i.top=n,i.width=o-r,i.height=s-n},t.prototype.transformToRef=function(t,e){for(var i=h.Polygon.Rectangle(this.left,this.top,this.left+this.width,this.top+this.height),r=new h.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),n=new h.Vector2(0,0),o=0;o<4;o++)t.transformCoordinates(i[o].x,i[o].y,i[o]),r.x=Math.floor(Math.min(r.x,i[o].x)),r.y=Math.floor(Math.min(r.y,i[o].y)),n.x=Math.ceil(Math.max(n.x,i[o].x)),n.y=Math.ceil(Math.max(n.y,i[o].y));e.left=r.x,e.top=r.y,e.width=n.x-r.x,e.height=n.y-r.y},t.prototype.isEqualsTo=function(t){return this.left===t.left&&this.top===t.top&&this.width===t.width&&this.height===t.height},t.Empty=function(){return new t(0,0,0,0)},t}(),u=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this,e.x,e.y)||this;return r.buttonIndex=i,r}return n(e,t),e}(h.Vector2),c=function(){function t(t,e,i,r,n,o){this.m=new Float32Array(6),this.fromValues(t,e,i,r,n,o)}return t.prototype.fromValues=function(t,e,i,r,n,o){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=r,this.m[4]=n,this.m[5]=o,this},t.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},t.prototype.invertToRef=function(t){var e=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],s=this.m[5],a=this.determinant();if(a<h.Epsilon*h.Epsilon)return t.m[0]=0,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[5]=0,this;var l=1/a,u=r*s-n*o,c=i*o-e*s;return t.m[0]=n*l,t.m[1]=-i*l,t.m[2]=-r*l,t.m[3]=e*l,t.m[4]=u*l,t.m[5]=c*l,this},t.prototype.multiplyToRef=function(t,e){var i=this.m[0],r=this.m[1],n=this.m[2],o=this.m[3],s=this.m[4],h=this.m[5],a=t.m[0],l=t.m[1],u=t.m[2],c=t.m[3],_=t.m[4],d=t.m[5];return e.m[0]=i*a+r*u,e.m[1]=i*l+r*c,e.m[2]=n*a+o*u,e.m[3]=n*l+o*c,e.m[4]=s*a+h*u+_,e.m[5]=s*l+h*c+d,this},t.prototype.transformCoordinates=function(t,e,i){return i.x=t*this.m[0]+e*this.m[2]+this.m[4],i.y=t*this.m[1]+e*this.m[3]+this.m[5],this},t.Identity=function(){return new t(1,0,0,1,0,0)},t.TranslationToRef=function(t,e,i){i.fromValues(1,0,0,1,t,e)},t.ScalingToRef=function(t,e,i){i.fromValues(t,0,0,e,0,0)},t.RotationToRef=function(t,e){var i=Math.sin(t),r=Math.cos(t);e.fromValues(r,i,-i,r,0,0)},t.ComposeToRef=function(e,i,r,n,o,s,h){t.TranslationToRef(e,i,t._TempPreTranslationMatrix),t.ScalingToRef(n,o,t._TempScalingMatrix),t.RotationToRef(r,t._TempRotationMatrix),t.TranslationToRef(-e,-i,t._TempPostTranslationMatrix),t._TempPreTranslationMatrix.multiplyToRef(t._TempScalingMatrix,t._TempCompose0),t._TempCompose0.multiplyToRef(t._TempRotationMatrix,t._TempCompose1),s?(t._TempCompose1.multiplyToRef(t._TempPostTranslationMatrix,t._TempCompose2),t._TempCompose2.multiplyToRef(s,h)):t._TempCompose1.multiplyToRef(t._TempPostTranslationMatrix,h)},t._TempPreTranslationMatrix=t.Identity(),t._TempPostTranslationMatrix=t.Identity(),t._TempRotationMatrix=t.Identity(),t._TempScalingMatrix=t.Identity(),t._TempCompose0=t.Identity(),t._TempCompose1=t.Identity(),t._TempCompose2=t.Identity(),t}(),_=function(){function t(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=l.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new a(18,a.UNITMODE_PIXEL,!1),this._width=new a(1,a.UNITMODE_PERCENTAGE,!1),this._height=new a(1,a.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=t.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=t.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=l.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=l.Empty(),this._cachedParentMeasure=l.Empty(),this._paddingLeft=new a(0),this._paddingRight=new a(0),this._paddingTop=new a(0),this._paddingBottom=new a(0),this._left=new a(0),this._top=new a(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=c.Identity(),this._invertTransformMatrix=c.Identity(),this._transformedPosition=h.Vector2.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=h.Vector2.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._rebuildLayout=!1,this._isClipped=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new a(0),this._linkOffsetY=new a(0),this.onPointerMoveObservable=new h.Observable,this.onPointerOutObservable=new h.Observable,this.onPointerDownObservable=new h.Observable,this.onPointerUpObservable=new h.Observable,this.onPointerClickObservable=new h.Observable,this.onPointerEnterObservable=new h.Observable,this.onDirtyObservable=new h.Observable,this.onBeforeDrawObservable=new h.Observable,this.onAfterDrawObservable=new h.Observable,this._tmpMeasureA=new l(0,0,0,0)}return Object.defineProperty(t.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(t){this._fontOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alphaSet=!0,this._alpha=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(t){this._isHighlighted!==t&&(this._isHighlighted=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(t){this._transformCenterY!==t&&(this._transformCenterY=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(t){this._transformCenterX!==t&&(this._transformCenterX=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(t){this._horizontalAlignment!==t&&(this._horizontalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(t){this._verticalAlignment!==t&&(this._verticalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.width=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.height=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(t){var e=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=t,this._style&&(this._styleObserver=this._style.onChangedObservable.add(function(){e._markAsDirty(),e._resetFontCache()})),this._markAsDirty(),this._resetFontCache()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSizeInPixels",{get:function(){var t=this._style?this._style._fontSize:this._fontSize;return t.isPixel?t.getValue(this._host):t.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.fontSize=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color!==t&&(this._color=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this.zIndex!==t&&(this._zIndex=t,this.parent&&this.parent._reOrderControl(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(t){this._doNotRender!==t&&(this._doNotRender=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},set:function(t){this._isVisible!==t&&(this._isVisible=t,this._markAsDirty(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(t){this._paddingLeft.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.paddingLeft=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(t){this._paddingRight.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.paddingRight=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(t){this._paddingTop.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.paddingTop=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(t){this._paddingBottom.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.paddingBottom=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(t){this._left.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.left=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(t){this._top.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.top=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(t){this._linkOffsetX.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.linkOffsetX=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(t){this._linkOffsetY.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.linkOffsetY=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Control"},t.prototype.getAscendantOfClass=function(t){return this.parent?this.parent.getClassName()===t?this.parent:this.parent.getAscendantOfClass(t):null},t.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},t.prototype.isAscendant=function(t){return!!this.parent&&(this.parent===t||this.parent.isAscendant(t))},t.prototype.getLocalCoordinates=function(t){var e=h.Vector2.Zero();return this.getLocalCoordinatesToRef(t,e),e},t.prototype.getLocalCoordinatesToRef=function(t,e){return e.x=t.x-this._currentMeasure.left,e.y=t.y-this._currentMeasure.top,this},t.prototype.getParentLocalCoordinates=function(t){var e=h.Vector2.Zero();return e.x=t.x-this._cachedParentMeasure.left,e.y=t.y-this._cachedParentMeasure.top,e},t.prototype.moveToVector3=function(e,i){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=t.VERTICAL_ALIGNMENT_TOP;var r=this._host._getGlobalViewport(i),n=h.Vector3.Project(e,h.Matrix.Identity(),i.getTransformMatrix(),r);this._moveToProjectedPosition(n),n.z<0||n.z>1?this.notRenderable=!0:this.notRenderable=!1}else h.Tools.Error("Cannot move a control to a vector3 if the control is not at root level")},t.prototype._getDescendants=function(t,e,i){void 0===e&&(e=!1)},t.prototype.getDescendants=function(t,e){var i=new Array;return this._getDescendants(i,t,e),i},t.prototype.linkWithMesh=function(e){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)e&&h.Tools.Error("Cannot link a control to a mesh if the control is not at root level");else{var i=this._host._linkedControls.indexOf(this);if(-1!==i)return this._linkedMesh=e,void(e||this._host._linkedControls.splice(i,1));e&&(this.horizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=t.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this))}},t.prototype._moveToProjectedPosition=function(t){var e=this._left.getValue(this._host),i=this._top.getValue(this._host),r=t.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=t.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(r-e)<.5&&(r=e),Math.abs(n-i)<.5&&(n=i)),this.left=r+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},t.prototype._offsetLeft=function(t){this._isDirty=!0,this._currentMeasure.left+=t},t.prototype._offsetTop=function(t){this._isDirty=!0,this._currentMeasure.top+=t},t.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},t.prototype._flagDescendantsAsMatrixDirty=function(){},t.prototype._intersectsRect=function(t){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=t.left+t.width||this._tmpMeasureA.top>=t.top+t.height||this._tmpMeasureA.left+this._tmpMeasureA.width<=t.left||this._tmpMeasureA.top+this._tmpMeasureA.height<=t.top)},t.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization)if(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),l.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var t=this.shadowOffsetX,e=this.shadowOffsetY,i=this.shadowBlur,r=Math.min(Math.min(t,0)-2*i,0),n=Math.max(Math.max(t,0)+2*i,0),o=Math.min(Math.min(e,0)-2*i,0),s=Math.max(Math.max(e,0)+2*i,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+r),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+s))}else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height))},t.prototype._markAsDirty=function(t){void 0===t&&(t=!1),(this._isVisible||t)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},t.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},t.prototype._link=function(t){this._host=t,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},t.prototype._transform=function(t){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var e=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;t&&(t.translate(e,i),t.rotate(this._rotation),t.scale(this._scaleX,this._scaleY),t.translate(-e,-i)),(this._isMatrixDirty||this._cachedOffsetX!==e||this._cachedOffsetY!==i)&&(this._cachedOffsetX=e,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),c.ComposeToRef(-e,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},t.prototype._renderHighlight=function(t){this.isHighlighted&&(t.save(),t.strokeStyle="#4affff",t.lineWidth=2,this._renderHighlightSpecific(t),t.restore())},t.prototype._renderHighlightSpecific=function(t){t.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},t.prototype._applyStates=function(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),this._color&&(e.fillStyle=this._color),t.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},t.prototype._layout=function(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(t)){this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace),e.save(),this._applyStates(e);var i=0;do{this._rebuildLayout=!1,this._processMeasures(t,e),i++}while(this._rebuildLayout&&i<3);i>=3&&h.Logger.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),e.restore(),this.invalidateRect(),this._evaluateClippingState(t)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0},t.prototype._processMeasures=function(t,e){this._currentMeasure.copyFrom(t),this._preMeasure(t,e),this._measure(),this._computeAlignment(t,e),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(t,e),this._cachedParentMeasure.copyFrom(t),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},t.prototype._evaluateClippingState=function(t){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>t.left+t.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<t.left)return void(this._isClipped=!0);if(this._currentMeasure.top>t.top+t.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<t.top)return void(this._isClipped=!0)}this._isClipped=!1},t.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host)},t.prototype._computeAlignment=function(e,i){var r=this._currentMeasure.width,n=this._currentMeasure.height,o=e.width,s=e.height,h=0,a=0;switch(this.horizontalAlignment){case t.HORIZONTAL_ALIGNMENT_LEFT:h=0;break;case t.HORIZONTAL_ALIGNMENT_RIGHT:h=o-r;break;case t.HORIZONTAL_ALIGNMENT_CENTER:h=(o-r)/2}switch(this.verticalAlignment){case t.VERTICAL_ALIGNMENT_TOP:a=0;break;case t.VERTICAL_ALIGNMENT_BOTTOM:a=s-n;break;case t.VERTICAL_ALIGNMENT_CENTER:a=(s-n)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=o*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=o*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=o*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=s*this._paddingTop.getValue(this._host),this._currentMeasure.height-=s*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=s*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=o*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=s*this._top.getValue(this._host),this._currentMeasure.left+=h,this._currentMeasure.top+=a},t.prototype._preMeasure=function(t,e){},t.prototype._additionalProcessing=function(t,e){},t.prototype._clipForChildren=function(t){},t.prototype._clip=function(e,i){if(e.beginPath(),t._ClipMeasure.copyFrom(this._currentMeasure),i){i.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var r=new l(0,0,0,0);r.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),r.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),r.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-r.left,r.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-r.top,t._ClipMeasure.copyFrom(r)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var n=this.shadowOffsetX,o=this.shadowOffsetY,s=this.shadowBlur,h=Math.min(Math.min(n,0)-2*s,0),a=Math.max(Math.max(n,0)+2*s,0),u=Math.min(Math.min(o,0)-2*s,0),c=Math.max(Math.max(o,0)+2*s,0);e.rect(t._ClipMeasure.left+h,t._ClipMeasure.top+u,t._ClipMeasure.width+a-h,t._ClipMeasure.height+c-u)}else e.rect(t._ClipMeasure.left,t._ClipMeasure.top,t._ClipMeasure.width,t._ClipMeasure.height);e.clip()},t.prototype._render=function(t,e){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(t.save(),this._applyStates(t),this._transform(t),this.clipContent&&this._clip(t,e),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?t.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(t,e),this.useBitmapCache&&this._wasDirty&&(this._cacheData=t.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(t),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),t.restore(),!0)},t.prototype._draw=function(t,e){},t.prototype.contains=function(t,e){return this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y,!(t<this._currentMeasure.left||t>this._currentMeasure.left+this._currentMeasure.width||e<this._currentMeasure.top||e>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))},t.prototype._processPicking=function(t,e,i,r,n){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(t,e)||(this._processObservables(i,t,e,r,n),0))},t.prototype._onPointerMove=function(t,e,i){this.onPointerMoveObservable.notifyObservers(e,-1,t,this)&&null!=this.parent&&this.parent._onPointerMove(t,e,i)},t.prototype._onPointerEnter=function(t){return!(!this._isEnabled||this._enterCount>0||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this)&&null!=this.parent&&this.parent._onPointerEnter(t),0))},t.prototype._onPointerOut=function(t,e){if(void 0===e&&(e=!1),e||this._isEnabled&&t!==this){this._enterCount=0;var i=!0;t.isAscendant(this)||(i=this.onPointerOutObservable.notifyObservers(this,-1,t,this)),i&&null!=this.parent&&this.parent._onPointerOut(t,e)}},t.prototype._onPointerDown=function(t,e,i,r){return this._onPointerEnter(this),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new u(e,r),-1,t,this)&&null!=this.parent&&this.parent._onPointerDown(t,e,i,r),!0)},t.prototype._onPointerUp=function(t,e,i,r,n){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[i];var o=n;n&&(this._enterCount>0||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new u(e,r),-1,t,this)),this.onPointerUpObservable.notifyObservers(new u(e,r),-1,t,this)&&null!=this.parent&&this.parent._onPointerUp(t,e,i,r,o)}},t.prototype._forcePointerUp=function(t){if(void 0===t&&(t=null),null!==t)this._onPointerUp(this,h.Vector2.Zero(),t,0,!0);else for(var e in this._downPointerIds)this._onPointerUp(this,h.Vector2.Zero(),+e,0,!0)},t.prototype._processObservables=function(t,e,i,r,n){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(e,i),t===h.PointerEventTypes.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r);var o=this._host._lastControlOver[r];return o&&o!==this&&o._onPointerOut(this),o!==this&&this._onPointerEnter(this),this._host._lastControlOver[r]=this,!0}return t===h.PointerEventTypes.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,n),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):t===h.PointerEventTypes.POINTERUP&&(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0),delete this._host._lastControlDown[r],!0)},t.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=t._GetFontOffset(this._font))},t.prototype.dispose=function(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null)},Object.defineProperty(t,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return t._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return t._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return t._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VERTICAL_ALIGNMENT_TOP",{get:function(){return t._VERTICAL_ALIGNMENT_TOP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return t._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return t._VERTICAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),t._GetFontOffset=function(e){if(t._FontHeightSizes[e])return t._FontHeightSizes[e];var i=document.createElement("span");i.innerHTML="Hg",i.style.font=e;var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var n=document.createElement("div");n.appendChild(i),n.appendChild(r),document.body.appendChild(n);var o=0,s=0;try{s=r.getBoundingClientRect().top-i.getBoundingClientRect().top,r.style.verticalAlign="baseline",o=r.getBoundingClientRect().top-i.getBoundingClientRect().top}finally{document.body.removeChild(n)}var h={ascent:o,height:s,descent:s-o};return t._FontHeightSizes[e]=h,h},t.drawEllipse=function(t,e,i,r,n){n.translate(t,e),n.scale(i,r),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/i,1/r),n.translate(-t,-e)},t.AllowAlphaInheritance=!1,t._ClipMeasure=new l(0,0,0,0),t._HORIZONTAL_ALIGNMENT_LEFT=0,t._HORIZONTAL_ALIGNMENT_RIGHT=1,t._HORIZONTAL_ALIGNMENT_CENTER=2,t._VERTICAL_ALIGNMENT_TOP=0,t._VERTICAL_ALIGNMENT_BOTTOM=1,t._VERTICAL_ALIGNMENT_CENTER=2,t._FontHeightSizes={},t.AddHeader=function(){},t}(),d=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._children=new Array,i._measureForChildren=l.Empty(),i._background="",i._adaptWidthToChildren=!1,i._adaptHeightToChildren=!1,i}return n(e,t),Object.defineProperty(e.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(t){this._adaptHeightToChildren!==t&&(this._adaptHeightToChildren=t,t&&(this.height="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(t){this._adaptWidthToChildren!==t&&(this._adaptWidthToChildren=t,t&&(this.width="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Container"},e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t=0,e=this.children;t<e.length;t++)e[t]._markMatrixAsDirty()},e.prototype.getChildByName=function(t){for(var e=0,i=this.children;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},e.prototype.getChildByType=function(t,e){for(var i=0,r=this.children;i<r.length;i++){var n=r[i];if(n.typeName===e)return n}return null},e.prototype.containsControl=function(t){return-1!==this.children.indexOf(t)},e.prototype.addControl=function(t){return t?-1!==this._children.indexOf(t)?this:(t._link(this._host),t._markAllAsDirty(),this._reOrderControl(t),this._markAsDirty(),this):this},e.prototype.clearControls=function(){for(var t=0,e=this.children.slice();t<e.length;t++){var i=e[t];this.removeControl(i)}return this},e.prototype.removeControl=function(t){var e=this._children.indexOf(t);return-1!==e&&(this._children.splice(e,1),t.parent=null),t.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(t),this._markAsDirty(),this},e.prototype._reOrderControl=function(t){this.removeControl(t);for(var e=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>t.zIndex){this._children.splice(i,0,t),e=!0;break}e||this._children.push(t),t.parent=this,this._markAsDirty()},e.prototype._offsetLeft=function(e){t.prototype._offsetLeft.call(this,e);for(var i=0,r=this._children;i<r.length;i++)r[i]._offsetLeft(e)},e.prototype._offsetTop=function(e){t.prototype._offsetTop.call(this,e);for(var i=0,r=this._children;i<r.length;i++)r[i]._offsetTop(e)},e.prototype._markAllAsDirty=function(){t.prototype._markAllAsDirty.call(this);for(var e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()},e.prototype._localDraw=function(t){this._background&&(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.restore())},e.prototype._link=function(e){t.prototype._link.call(this,e);for(var i=0,r=this._children;i<r.length;i++)r[i]._link(e)},e.prototype._beforeLayout=function(){},e.prototype._processMeasures=function(e,i){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(t.prototype._processMeasures.call(this,e,i),this._evaluateClippingState(e))},e.prototype._layout=function(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var i=0;e.save(),this._applyStates(e),this._beforeLayout();do{var r=-1,n=-1;if(this._rebuildLayout=!1,this._processMeasures(t,e),!this._isClipped){for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._tempParentMeasure.copyFrom(this._measureForChildren),a._layout(this._measureForChildren,e)&&(this.adaptWidthToChildren&&a._width.isPixel&&(r=Math.max(r,a._currentMeasure.width)),this.adaptHeightToChildren&&a._height.isPixel&&(n=Math.max(n,a._currentMeasure.height)))}this.adaptWidthToChildren&&r>=0&&this.width!==r+"px"&&(this.width=r+"px",this._rebuildLayout=!0),this.adaptHeightToChildren&&n>=0&&this.height!==n+"px"&&(this.height=n+"px",this._rebuildLayout=!0),this._postMeasure()}i++}while(this._rebuildLayout&&i<3);return i>=3&&h.Logger.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),e.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},e.prototype._postMeasure=function(){},e.prototype._draw=function(t,e){this._localDraw(t),this.clipChildren&&this._clipForChildren(t);for(var i=0,r=this._children;i<r.length;i++){var n=r[i];e&&!n._intersectsRect(e)||n._render(t,e)}},e.prototype._getDescendants=function(t,e,i){if(void 0===e&&(e=!1),this.children)for(var r=0;r<this.children.length;r++){var n=this.children[r];i&&!i(n)||t.push(n),e||n._getDescendants(t,!1,i)}},e.prototype._processPicking=function(e,i,r,n,o){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!t.prototype.contains.call(this,e,i))return!1;for(var s=this._children.length-1;s>=0;s--){var h=this._children[s];if(h._processPicking(e,i,r,n,o))return h.hoverCursor&&this._host._changeCursor(h.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(r,e,i,n,o)},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.copyFrom(this._currentMeasure)},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=this.children.length-1;e>=0;e--)this.children[e].dispose()},e}(_),f=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thickness=1,i._cornerRadius=0,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(t){t<0&&(t=0),this._cornerRadius!==t&&(this._cornerRadius=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Rectangle"},e.prototype._localDraw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._background&&(t.fillStyle=this._background,this._cornerRadius?(this._drawRoundedRect(t,this._thickness/2),t.fill()):t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(t,this._thickness/2),t.stroke()):t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},e.prototype._drawRoundedRect=function(t,e){void 0===e&&(e=0);var i=this._currentMeasure.left+e,r=this._currentMeasure.top+e,n=this._currentMeasure.width-2*e,o=this._currentMeasure.height-2*e,s=Math.min(o/2-2,Math.min(n/2-2,this._cornerRadius));t.beginPath(),t.moveTo(i+s,r),t.lineTo(i+n-s,r),t.quadraticCurveTo(i+n,r,i+n,r+s),t.lineTo(i+n,r+o-s),t.quadraticCurveTo(i+n,r+o,i+n-s,r+o),t.lineTo(i+s,r+o),t.quadraticCurveTo(i,r+o,i,r+o-s),t.lineTo(i,r+s),t.quadraticCurveTo(i,r,i+s,r),t.closePath()},e.prototype._clipForChildren=function(t){this._cornerRadius&&(this._drawRoundedRect(t,this._thickness),t.clip())},e}(d);!function(t){t[t.Clip=0]="Clip",t[t.WordWrap=1]="WordWrap",t[t.Ellipsis=2]="Ellipsis"}(s||(s={}));var p=function(t){function e(e,i){void 0===i&&(i="");var r=t.call(this,e)||this;return r.name=e,r._text="",r._textWrapping=s.Clip,r._textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,r._textVerticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,r._resizeToFit=!1,r._lineSpacing=new a(0),r._outlineWidth=0,r._outlineColor="white",r.onTextChangedObservable=new h.Observable,r.onLinesReadyObservable=new h.Observable,r.text=i,r}return n(e,t),Object.defineProperty(e.prototype,"lines",{get:function(){return this._lines},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(t){this._resizeToFit!==t&&(this._resizeToFit=t,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(t){this._textWrapping!==t&&(this._textWrapping=+t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(t){this._textHorizontalAlignment!==t&&(this._textHorizontalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(t){this._textVerticalAlignment!==t&&(this._textVerticalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(t){this._lineSpacing.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"TextBlock"},e.prototype._processMeasures=function(e,i){this._fontOffset||(this._fontOffset=_._GetFontOffset(i.font)),t.prototype._processMeasures.call(this,e,i),this._lines=this._breakLines(this._currentMeasure.width,i),this.onLinesReadyObservable.notifyObservers(this);for(var r=0,n=0;n<this._lines.length;n++){var o=this._lines[n];o.width>r&&(r=o.width)}if(this._resizeToFit){if(this._textWrapping===s.Clip){var h=this.paddingLeftInPixels+this.paddingRightInPixels+r;h!==this._width.internalValue&&(this._width.updateInPlace(h,a.UNITMODE_PIXEL),this._rebuildLayout=!0)}var l=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length;l!==this._height.internalValue&&(this._height.updateInPlace(l,a.UNITMODE_PIXEL),this._rebuildLayout=!0)}},e.prototype._drawText=function(t,e,i,r){var n=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case _.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case _.HORIZONTAL_ALIGNMENT_RIGHT:o=n-e;break;case _.HORIZONTAL_ALIGNMENT_CENTER:o=(n-e)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(t,this._currentMeasure.left+o,i),r.fillText(t,this._currentMeasure.left+o,i)},e.prototype._draw=function(t){t.save(),this._applyStates(t),this._renderLines(t),t.restore()},e.prototype._applyStates=function(e){t.prototype._applyStates.call(this,e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor)},e.prototype._breakLines=function(t,e){var i=[],r=this.text.split("\n");if(this._textWrapping===s.Ellipsis)for(var n=0,o=r;n<o.length;n++){var h=o[n];i.push(this._parseLineEllipsis(h,t,e))}else if(this._textWrapping===s.WordWrap)for(var a=0,l=r;a<l.length;a++)h=l[a],i.push.apply(i,this._parseLineWordWrap(h,t,e));else for(var u=0,c=r;u<c.length;u++)h=c[u],i.push(this._parseLine(h,e));return i},e.prototype._parseLine=function(t,e){return void 0===t&&(t=""),{text:t,width:e.measureText(t).width}},e.prototype._parseLineEllipsis=function(t,e,i){void 0===t&&(t="");var r=i.measureText(t).width;for(r>e&&(t+="…");t.length>2&&r>e;)t=t.slice(0,-2)+"…",r=i.measureText(t).width;return{text:t,width:r}},e.prototype._parseLineWordWrap=function(t,e,i){void 0===t&&(t="");for(var r=[],n=t.split(" "),o=0,s=0;s<n.length;s++){var h=s>0?t+" "+n[s]:n[0],a=i.measureText(h).width;a>e&&s>0?(r.push({text:t,width:o}),t=n[s],o=i.measureText(t).width):(o=a,t=h)}return r.push({text:t,width:o}),r},e.prototype._renderLines=function(t){var e=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case _.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case _.VERTICAL_ALIGNMENT_BOTTOM:i=e-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case _.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(e-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var r=0;r<this._lines.length;r++){var n=this._lines[r];0!==r&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,i,t),i+=this._fontOffset.height}},e.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var t=document.createElement("canvas").getContext("2d");if(t){this._applyStates(t),this._fontOffset||(this._fontOffset=_._GetFontOffset(t.font));var e=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,t);return this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*e.length}}return 0},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onTextChangedObservable.clear()},e}(_),g=function(t){function e(i,r){void 0===r&&(r=null);var n=t.call(this,i)||this;return n.name=i,n._loaded=!1,n._stretch=e.STRETCH_FILL,n._autoScale=!1,n._sourceLeft=0,n._sourceTop=0,n._sourceWidth=0,n._sourceHeight=0,n._cellWidth=0,n._cellHeight=0,n._cellId=-1,n._populateNinePatchSlicesFromImage=!1,n.onImageLoadedObservable=new h.Observable,n.source=r,n}return n(e,t),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(t){this._populateNinePatchSlicesFromImage!==t&&(this._populateNinePatchSlicesFromImage=t,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(t){this._detectPointerOnOpaqueOnly!==t&&(this._detectPointerOnOpaqueOnly=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(t){this._sliceLeft!==t&&(this._sliceLeft=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(t){this._sliceRight!==t&&(this._sliceRight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(t){this._sliceTop!==t&&(this._sliceTop=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(t){this._sliceBottom!==t&&(this._sliceBottom=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(t){this._sourceLeft!==t&&(this._sourceLeft=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(t){this._sourceTop!==t&&(this._sourceTop=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(t){this._sourceWidth!==t&&(this._sourceWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(t){this._sourceHeight!==t&&(this._sourceHeight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoScale",{get:function(){return this._autoScale},set:function(t){this._autoScale!==t&&(this._autoScale=t,t&&this._loaded&&this.synchronizeSizeWithContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stretch",{get:function(){return this._stretch},set:function(t){this._stretch!==t&&(this._stretch=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domImage",{get:function(){return this._domImage},set:function(t){var e=this;this._domImage=t,this._loaded=!1,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){e._onImageLoaded()}},enumerable:!0,configurable:!0}),e.prototype._onImageLoaded=function(){this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},e.prototype._extractNinePatchSliceDataFromImage=function(){e._WorkingCanvas||(e._WorkingCanvas=document.createElement("canvas"));var t=e._WorkingCanvas,i=t.getContext("2d"),r=this._domImage.width,n=this._domImage.height;t.width=r,t.height=n,i.drawImage(this._domImage,0,0,r,n);var o=i.getImageData(0,0,r,n);this._sliceLeft=-1,this._sliceRight=-1;for(var s=0;s<r;s++)if((a=o.data[4*s+3])>127&&-1===this._sliceLeft)this._sliceLeft=s;else if(a<127&&this._sliceLeft>-1){this._sliceRight=s;break}this._sliceTop=-1,this._sliceBottom=-1;for(var h=0;h<n;h++){var a;if((a=o.data[h*r*4+3])>127&&-1===this._sliceTop)this._sliceTop=h;else if(a<127&&this._sliceTop>-1){this._sliceBottom=h;break}}},Object.defineProperty(e.prototype,"source",{set:function(t){var e=this;this._source!==t&&(this._loaded=!1,this._source=t,this._domImage=document.createElement("img"),this._domImage.onload=function(){e._onImageLoaded()},t&&(h.Tools.SetCorsBehavior(t,this._domImage),this._domImage.src=t))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(t){this._cellWidth!==t&&(this._cellWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(t){this._cellHeight!==t&&(this._cellHeight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellId",{get:function(){return this._cellId},set:function(t){this._cellId!==t&&(this._cellId=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype.contains=function(i,r){if(!t.prototype.contains.call(this,i,r))return!1;if(!this._detectPointerOnOpaqueOnly||!e._WorkingCanvas)return!0;var n=e._WorkingCanvas.getContext("2d"),o=0|this._currentMeasure.width,s=0|this._currentMeasure.height;return n.getImageData(0,0,o,s).data[4*((i=i-this._currentMeasure.left|0)+(r=r-this._currentMeasure.top|0)*this._currentMeasure.width)+3]>0},e.prototype._getTypeName=function(){return"Image"},e.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},e.prototype._processMeasures=function(i,r){if(this._loaded)switch(this._stretch){case e.STRETCH_NONE:case e.STRETCH_FILL:case e.STRETCH_UNIFORM:case e.STRETCH_NINE_PATCH:break;case e.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}t.prototype._processMeasures.call(this,i,r)},e.prototype._prepareWorkingCanvasForOpaqueDetection=function(){if(this._detectPointerOnOpaqueOnly){e._WorkingCanvas||(e._WorkingCanvas=document.createElement("canvas"));var t=e._WorkingCanvas,i=this._currentMeasure.width,r=this._currentMeasure.height,n=t.getContext("2d");t.width=i,t.height=r,n.clearRect(0,0,i,r)}},e.prototype._drawImage=function(t,i,r,n,o,s,h,a,l){t.drawImage(this._domImage,i,r,n,o,s,h,a,l),this._detectPointerOnOpaqueOnly&&(t=e._WorkingCanvas.getContext("2d")).drawImage(this._domImage,i,r,n,o,s-this._currentMeasure.left,h-this._currentMeasure.top,a,l)},e.prototype._draw=function(t){var i,r,n,o;if(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)i=this._sourceLeft,r=this._sourceTop,n=this._sourceWidth?this._sourceWidth:this._imageWidth,o=this._sourceHeight?this._sourceHeight:this._imageHeight;else{var s=this._domImage.naturalWidth/this.cellWidth,h=this.cellId/s>>0,a=this.cellId%s;i=this.cellWidth*a,r=this.cellHeight*h,n=this.cellWidth,o=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(t),this._loaded)switch(this._stretch){case e.STRETCH_NONE:case e.STRETCH_FILL:this._drawImage(t,i,r,n,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case e.STRETCH_UNIFORM:var l=this._currentMeasure.width/n,u=this._currentMeasure.height/o,c=Math.min(l,u),_=(this._currentMeasure.width-n*c)/2,d=(this._currentMeasure.height-o*c)/2;this._drawImage(t,i,r,n,o,this._currentMeasure.left+_,this._currentMeasure.top+d,n*c,o*c);break;case e.STRETCH_EXTEND:this._drawImage(t,i,r,n,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case e.STRETCH_NINE_PATCH:this._renderNinePatch(t)}t.restore()},e.prototype._renderCornerPatch=function(t,e,i,r,n,o,s){this._drawImage(t,e,i,r,n,this._currentMeasure.left+o,this._currentMeasure.top+s,r,n)},e.prototype._renderNinePatch=function(t){var e=this._imageHeight,i=this._sliceLeft,r=this._sliceTop,n=this._imageHeight-this._sliceBottom,o=this._imageWidth-this._sliceRight,s=0,h=0;this._populateNinePatchSlicesFromImage&&(s=1,h=1,e-=2,i-=1,r-=1,n-=1,o-=1);var a=this._sliceRight-this._sliceLeft+1,l=this._currentMeasure.width-o-this.sliceLeft+1,u=this._currentMeasure.height-e+this._sliceBottom;this._renderCornerPatch(t,s,h,i,r,0,0),this._renderCornerPatch(t,s,this._sliceBottom,i,e-this._sliceBottom,0,u),this._renderCornerPatch(t,this._sliceRight,h,o,r,this._currentMeasure.width-o,0),this._renderCornerPatch(t,this._sliceRight,this._sliceBottom,o,e-this._sliceBottom,this._currentMeasure.width-o,u),this._drawImage(t,this._sliceLeft,this._sliceTop,a,this._sliceBottom-this._sliceTop+1,this._currentMeasure.left+i,this._currentMeasure.top+r,l,u-r+1),this._drawImage(t,s,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left,this._currentMeasure.top+r,i,u-r),this._drawImage(t,this._sliceRight,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left+this._currentMeasure.width-o,this._currentMeasure.top+r,i,u-r),this._drawImage(t,this._sliceLeft,h,a,r,this._currentMeasure.left+i,this._currentMeasure.top,l,r),this._drawImage(t,this._sliceLeft,this._sliceBottom,a,n,this._currentMeasure.left+i,this._currentMeasure.top+u,l,n)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onImageLoadedObservable.clear()},e._WorkingCanvas=null,e.STRETCH_NONE=0,e.STRETCH_FILL=1,e.STRETCH_UNIFORM=2,e.STRETCH_EXTEND=3,e.STRETCH_NINE_PATCH=4,e}(_),b=function(t){function e(e){var i=t.call(this,e)||this;i.name=e,i.thickness=1,i.isPointerBlocker=!0;var r=null;return i.pointerEnterAnimation=function(){r=i.alpha,i.alpha-=.1},i.pointerOutAnimation=function(){null!==r&&(i.alpha=r)},i.pointerDownAnimation=function(){i.scaleX-=.05,i.scaleY-=.05},i.pointerUpAnimation=function(){i.scaleX+=.05,i.scaleY+=.05},i}return n(e,t),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Button"},e.prototype._processPicking=function(e,i,r,n,o){return!(!(this._isEnabled&&this.isHitTestVisible&&this.isVisible)||this.notRenderable||!t.prototype.contains.call(this,e,i)||(this._processObservables(r,e,i,n,o),0))},e.prototype._onPointerEnter=function(e){return!!t.prototype._onPointerEnter.call(this,e)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},e.prototype._onPointerOut=function(e,i){void 0===i&&(i=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),t.prototype._onPointerOut.call(this,e,i)},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},e.prototype._onPointerUp=function(e,i,r,n,o){this.pointerUpAnimation&&this.pointerUpAnimation(),t.prototype._onPointerUp.call(this,e,i,r,n,o)},e.CreateImageButton=function(t,i,r){var n=new e(t),o=new p(t+"_button",i);o.textWrapping=!0,o.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,o.paddingLeft="20%",n.addControl(o);var s=new g(t+"_icon",r);return s.width="20%",s.stretch=g.STRETCH_UNIFORM,s.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,n.addControl(s),n._image=s,n._textBlock=o,n},e.CreateImageOnlyButton=function(t,i){var r=new e(t),n=new g(t+"_icon",i);return n.stretch=g.STRETCH_FILL,n.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(n),r._image=n,r},e.CreateSimpleButton=function(t,i){var r=new e(t),n=new p(t+"_button",i);return n.textWrapping=!0,n.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(n),r._textBlock=n,r},e.CreateImageWithCenterTextButton=function(t,i,r){var n=new e(t),o=new g(t+"_icon",r);o.stretch=g.STRETCH_FILL,n.addControl(o);var s=new p(t+"_button",i);return s.textWrapping=!0,s.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,n.addControl(s),n._image=o,n._textBlock=s,n},e}(f),m=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._isVertical=!0,i._manualWidth=!1,i._manualHeight=!1,i._doNotTrackManualChanges=!1,i}return n(e,t),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"StackPanel"},e.prototype._preMeasure=function(e,i){for(var r=0,n=this._children;r<n.length;r++){var o=n[r];this._isVertical?o.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP:o.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT}t.prototype._preMeasure.call(this,e,i)},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},e.prototype._postMeasure=function(){for(var e=0,i=0,r=0,n=this._children;r<n.length;r++){var o=n[r];o.isVisible&&!o.notRenderable&&(this._isVertical?(o.top!==i+"px"&&(o.top=i+"px",this._rebuildLayout=!0,o._top.ignoreAdaptiveScaling=!0),o._height.isPercentage?h.Tools.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):i+=o._currentMeasure.height+o.paddingTopInPixels+o.paddingBottomInPixels):(o.left!==e+"px"&&(o.left=e+"px",this._rebuildLayout=!0,o._left.ignoreAdaptiveScaling=!0),o._width.isPercentage?h.Tools.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):e+=o._currentMeasure.width+o.paddingLeftInPixels+o.paddingRightInPixels))}this._doNotTrackManualChanges=!0;var s=!1,a=!1;if(!this._manualHeight&&this._isVertical){var l=this.height;this.height=i+"px",a=l!==this.height||!this._height.ignoreAdaptiveScaling}if(!this._manualWidth&&!this._isVertical){var u=this.width;this.width=e+"px",s=u!==this.width||!this._width.ignoreAdaptiveScaling}a&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||a)&&(this._rebuildLayout=!0),t.prototype._postMeasure.call(this)},e}(d),y=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.onIsCheckedChangedObservable=new h.Observable,i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t))},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Checkbox"},e.prototype._draw=function(t){t.save(),this._applyStates(t);var e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,e,i),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColor;var r=e*this._checkSizeRatio,n=i*this._checkSizeRatio;t.fillRect(this._currentMeasure.left+this._thickness/2+(e-r)/2,this._currentMeasure.top+this._thickness/2+(i-n)/2,r,n)}t.strokeStyle=this.color,t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,e,i),t.restore()},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this.isChecked=!this.isChecked,!0)},e.AddCheckBoxWithHeader=function(t,i){var r=new m;r.isVertical=!1,r.height="30px";var n=new e;n.width="20px",n.height="20px",n.isChecked=!0,n.color="green",n.onIsCheckedChangedObservable.add(i),r.addControl(n);var o=new p;return o.text=t,o.width="180px",o.paddingLeft="5px",o.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,o.color="white",r.addControl(o),r},e}(_),v=function(t){function e(e,i){void 0===i&&(i="");var r=t.call(this,e)||this;return r.name=e,r._text="",r._placeholderText="",r._background="#222222",r._focusedBackground="#000000",r._focusedColor="white",r._placeholderColor="gray",r._thickness=1,r._margin=new a(10,a.UNITMODE_PIXEL),r._autoStretchWidth=!0,r._maxWidth=new a(1,a.UNITMODE_PERCENTAGE,!1),r._isFocused=!1,r._blinkIsEven=!1,r._cursorOffset=0,r._deadKey=!1,r._addKey=!0,r._currentKey="",r._isTextHighlightOn=!1,r._textHighlightColor="#d5e0ff",r._highligherOpacity=.4,r._highlightedText="",r._startHighlightIndex=0,r._endHighlightIndex=0,r._cursorIndex=-1,r._onFocusSelectAll=!1,r._isPointerDown=!1,r.promptMessage="Please enter text:",r.onTextChangedObservable=new h.Observable,r.onBeforeKeyAddObservable=new h.Observable,r.onFocusObservable=new h.Observable,r.onBlurObservable=new h.Observable,r.onTextHighlightObservable=new h.Observable,r.onTextCopyObservable=new h.Observable,r.onTextCutObservable=new h.Observable,r.onTextPasteObservable=new h.Observable,r.onKeyboardEventProcessedObservable=new h.Observable,r.text=i,r.isPointerBlocker=!0,r}return n(e,t),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(t){this._maxWidth.toString(this._host)!==t&&this._maxWidth.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(t){this._highligherOpacity!==t&&(this._highligherOpacity=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(t){this._onFocusSelectAll!==t&&(this._onFocusSelectAll=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(t){this._textHighlightColor!==t&&(this._textHighlightColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(t){this._margin.toString(this._host)!==t&&this._margin.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(t){this._autoStretchWidth!==t&&(this._autoStretchWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(t){this._focusedBackground!==t&&(this._focusedBackground=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(t){this._focusedColor!==t&&(this._focusedColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(t){this._placeholderColor!==t&&(this._placeholderColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(t){this._placeholderText!==t&&(this._placeholderText=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deadKey",{get:function(){return this._deadKey},set:function(t){this._deadKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(t){this._highlightedText!==t&&(this._highlightedText=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addKey",{get:function(){return this._addKey},set:function(t){this._addKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentKey",{get:function(){return this._currentKey},set:function(t){this._currentKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){var e=t.toString();this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._width.toString(this._host)!==t&&(this._width.fromString(t)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!0,configurable:!0}),e.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var t=this._host.getScene();this._onPointerDblTapObserver&&t&&t.onPointerObservable.remove(this._onPointerDblTapObserver)},e.prototype.onFocus=function(){var t=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")){var e=prompt(this.promptMessage);return null!==e&&(this.text=e),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add(function(e){switch(e.type){case h.ClipboardEventTypes.COPY:t._onCopyText(e.event),t.onTextCopyObservable.notifyObservers(t);break;case h.ClipboardEventTypes.CUT:t._onCutText(e.event),t.onTextCutObservable.notifyObservers(t);break;case h.ClipboardEventTypes.PASTE:t._onPasteText(e.event),t.onTextPasteObservable.notifyObservers(t);break;default:return}});var i=this._host.getScene();i&&(this._onPointerDblTapObserver=i.onPointerObservable.add(function(e){t._isFocused&&e.type===h.PointerEventTypes.POINTERDOUBLETAP&&t._processDblClick(e)})),this._onFocusSelectAll&&this._selectAllText()}},e.prototype._getTypeName=function(){return"InputText"},e.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},e.prototype.processKey=function(t,e,i){if(!i||!i.ctrlKey&&!i.metaKey||67!==t&&86!==t&&88!==t){if(i&&(i.ctrlKey||i.metaKey)&&65===t)return this._selectAllText(),void i.preventDefault();switch(t){case 32:e=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._text&&this._text.length>0){if(this._isTextHighlightOn)return this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());0===this._cursorOffset?this.text=this._text.substr(0,this._text.length-1):(n=this._text.length-this._cursorOffset)>0&&(this.text=this._text.slice(0,n-1)+this._text.slice(n))}return void(i&&i.preventDefault());case 46:if(this._isTextHighlightOn){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex);for(var r=this._endHighlightIndex-this._startHighlightIndex;r>0&&this._cursorOffset>0;)this._cursorOffset--;return this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,void(i&&i.preventDefault())}if(this._text&&this._text.length>0&&this._cursorOffset>0){var n=this._text.length-this._cursorOffset;this.text=this._text.slice(0,n)+this._text.slice(n+1),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._text.length&&(this._cursorOffset=this._text.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(this._text.length===this._cursorOffset)return;this._endHighlightIndex=this._text.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=this._text.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._text.length:this._text.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._text.length?this._text.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._startHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this.text.length,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._text.length-this._cursorOffset-1}return this._endHighlightIndex=this._text.length,this._isTextHighlightOn=!0,this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=this._text.length===this._endHighlightIndex?0:this._text.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._endHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:i&&i.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}if(e&&(-1===t||32===t||t>47&&t<64||t>64&&t<91||t>159&&t<193||t>218&&t<223||t>95&&t<112)&&(this._currentKey=e,this.onBeforeKeyAddObservable.notifyObservers(this),e=this._currentKey,this._addKey))if(this._isTextHighlightOn)this.text=this._text.slice(0,this._startHighlightIndex)+e+this._text.slice(this._endHighlightIndex),this._cursorOffset=this.text.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=e;else{var o=this._text.length-this._cursorOffset;this.text=this._text.slice(0,o)+e+this._text.slice(o)}}},e.prototype._updateValueFromCursorIndex=function(t){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=t;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},e.prototype._processDblClick=function(t){this._startHighlightIndex=this._text.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;var e,i,r=/\w+/g;do{i=this._endHighlightIndex<this._text.length&&-1!==this._text[this._endHighlightIndex].search(r)?++this._endHighlightIndex:0,e=this._startHighlightIndex>0&&-1!==this._text[this._startHighlightIndex-1].search(r)?--this._startHighlightIndex:0}while(e||i);this._cursorOffset=this.text.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},e.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._text.length,this._cursorOffset=this._text.length,this._cursorIndex=-1,this._markAsDirty()},e.prototype.processKeyboard=function(t){this.processKey(t.keyCode,t.key,t),this.onKeyboardEventProcessedObservable.notifyObservers(t)},e.prototype._onCopyText=function(t){this._isTextHighlightOn=!1;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText},e.prototype._onCutText=function(t){if(this._highlightedText){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},e.prototype._onPasteText=function(t){var e="";e=t.clipboardData&&-1!==t.clipboardData.types.indexOf("text/plain")?t.clipboardData.getData("text/plain"):this._host.clipboardData;var i=this._text.length-this._cursorOffset;this.text=this._text.slice(0,i)+e+this._text.slice(i)},e.prototype._draw=function(t){var e=this;t.save(),this._applyStates(t),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(t.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._fontOffset||(this._fontOffset=_._GetFontOffset(t.font));var i=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(t.fillStyle=this.color);var r=this._beforeRenderText(this._text);this._isFocused||this._text||!this._placeholderText||(r=this._placeholderText,this._placeholderColor&&(t.fillStyle=this._placeholderColor)),this._textWidth=t.measureText(r).width;var n=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+n)+"px");var o=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,s=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-n;if(t.save(),t.beginPath(),t.rect(i,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,s+2,this._currentMeasure.height),t.clip(),this._isFocused&&this._textWidth>s){var h=i-this._textWidth+s;this._scrollLeft||(this._scrollLeft=h)}else this._scrollLeft=i;if(t.fillText(r,this._scrollLeft,this._currentMeasure.top+o),this._isFocused){if(this._clickedCoordinate){var a=this._scrollLeft+this._textWidth-this._clickedCoordinate,l=0;this._cursorOffset=0;var u=0;do{this._cursorOffset&&(u=Math.abs(a-l)),this._cursorOffset++,l=t.measureText(r.substr(r.length-this._cursorOffset,this._cursorOffset)).width}while(l<a&&r.length>=this._cursorOffset);Math.abs(a-l)>u&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){var c=this.text.substr(this._text.length-this._cursorOffset),d=t.measureText(c).width,f=this._scrollLeft+this._textWidth-d;f<i?(this._scrollLeft+=i-f,f=i,this._markAsDirty()):f>i+s&&(this._scrollLeft+=i+s-f,f=i+s,this._markAsDirty()),this._isTextHighlightOn||t.fillRect(f,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(function(){e._blinkIsEven=!e._blinkIsEven,e._markAsDirty()},500),this._isTextHighlightOn){clearTimeout(this._blinkTimeout);var p=t.measureText(this.text.substring(this._startHighlightIndex)).width,g=this._scrollLeft+this._textWidth-p;this._highlightedText=this.text.substring(this._startHighlightIndex,this._endHighlightIndex);var b=t.measureText(this.text.substring(this._startHighlightIndex,this._endHighlightIndex)).width;g<i&&((b-=i-g)||(b=t.measureText(this.text.charAt(this.text.length-this._cursorOffset)).width),g=i),t.globalAlpha=this._highligherOpacity,t.fillStyle=this._textHighlightColor,t.fillRect(g,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,b,this._fontOffset.height),t.globalAlpha=1}}t.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(t.strokeStyle=this.focusedColor):this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()},e.prototype._onPointerDown=function(e,i,r,n){return!(!t.prototype._onPointerDown.call(this,e,i,r,n)||(this._clickedCoordinate=i.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[r]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))},e.prototype._onPointerMove=function(e,i,r){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=i.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),t.prototype._onPointerMove.call(this,e,i,r)},e.prototype._onPointerUp=function(e,i,r,n,o){this._isPointerDown=!1,delete this._host._capturingControl[r],t.prototype._onPointerUp.call(this,e,i,r,n,o)},e.prototype._beforeRenderText=function(t){return t},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},e}(_),O=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._rowDefinitions=new Array,i._columnDefinitions=new Array,i._cells={},i._childControls=new Array,i}return n(e,t),Object.defineProperty(e.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._childControls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),e.prototype.getRowDefinition=function(t){return t<0||t>=this._rowDefinitions.length?null:this._rowDefinitions[t]},e.prototype.getColumnDefinition=function(t){return t<0||t>=this._columnDefinitions.length?null:this._columnDefinitions[t]},e.prototype.addRowDefinition=function(t,e){return void 0===e&&(e=!1),this._rowDefinitions.push(new a(t,e?a.UNITMODE_PIXEL:a.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},e.prototype.addColumnDefinition=function(t,e){return void 0===e&&(e=!1),this._columnDefinitions.push(new a(t,e?a.UNITMODE_PIXEL:a.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},e.prototype.setRowDefinition=function(t,e,i){if(void 0===i&&(i=!1),t<0||t>=this._rowDefinitions.length)return this;var r=this._rowDefinitions[t];return r&&r.isPixel===i&&r.internalValue===e?this:(this._rowDefinitions[t]=new a(e,i?a.UNITMODE_PIXEL:a.UNITMODE_PERCENTAGE),this._markAsDirty(),this)},e.prototype.setColumnDefinition=function(t,e,i){if(void 0===i&&(i=!1),t<0||t>=this._columnDefinitions.length)return this;var r=this._columnDefinitions[t];return r&&r.isPixel===i&&r.internalValue===e?this:(this._columnDefinitions[t]=new a(e,i?a.UNITMODE_PIXEL:a.UNITMODE_PERCENTAGE),this._markAsDirty(),this)},e.prototype.getChildrenAt=function(t,e){var i=this._cells[t+":"+e];return i?i.children:null},e.prototype.getChildCellInfo=function(t){return t._tag},e.prototype._removeCell=function(e,i){if(e){t.prototype.removeControl.call(this,e);for(var r=0,n=e.children;r<n.length;r++){var o=n[r],s=this._childControls.indexOf(o);-1!==s&&this._childControls.splice(s,1)}delete this._cells[i]}},e.prototype._offsetCell=function(t,e){if(this._cells[e]){this._cells[t]=this._cells[e];for(var i=0,r=this._cells[t].children;i<r.length;i++)r[i]._tag=t;delete this._cells[e]}},e.prototype.removeColumnDefinition=function(t){if(t<0||t>=this._columnDefinitions.length)return this;for(var e=0;e<this._rowDefinitions.length;e++){var i=e+":"+t,r=this._cells[i];this._removeCell(r,i)}for(e=0;e<this._rowDefinitions.length;e++)for(var n=t+1;n<this._columnDefinitions.length;n++){var o=e+":"+(n-1);i=e+":"+n,this._offsetCell(o,i)}return this._columnDefinitions.splice(t,1),this._markAsDirty(),this},e.prototype.removeRowDefinition=function(t){if(t<0||t>=this._rowDefinitions.length)return this;for(var e=0;e<this._columnDefinitions.length;e++){var i=t+":"+e,r=this._cells[i];this._removeCell(r,i)}for(e=0;e<this._columnDefinitions.length;e++)for(var n=t+1;n<this._rowDefinitions.length;n++){var o=n-1+":"+e;i=n+":"+e,this._offsetCell(o,i)}return this._rowDefinitions.splice(t,1),this._markAsDirty(),this},e.prototype.addControl=function(e,i,r){if(void 0===i&&(i=0),void 0===r&&(r=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(e))return h.Tools.Warn("Control (Name:"+e.name+", UniqueId:"+e.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var n=Math.min(i,this._rowDefinitions.length-1)+":"+Math.min(r,this._columnDefinitions.length-1),o=this._cells[n];return o||(o=new d(n),this._cells[n]=o,o.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,t.prototype.addControl.call(this,o)),o.addControl(e),this._childControls.push(e),e._tag=n,e.parent=this,this._markAsDirty(),this},e.prototype.removeControl=function(t){var e=this._childControls.indexOf(t);-1!==e&&this._childControls.splice(e,1);var i=this._cells[t._tag];return i&&(i.removeControl(t),t._tag=null),this._markAsDirty(),this},e.prototype._getTypeName=function(){return"Grid"},e.prototype._getGridDefinitions=function(t){for(var e=[],i=[],r=[],n=[],o=this._currentMeasure.width,s=0,h=this._currentMeasure.height,a=0,l=0,u=0,c=this._rowDefinitions;u<c.length;u++)(g=c[u]).isPixel?(h-=p=g.getValue(this._host),i[l]=p):a+=g.internalValue,l++;var _=0;l=0;for(var d=0,f=this._rowDefinitions;d<f.length;d++){var p,g=f[d];n.push(_),g.isPixel?_+=g.getValue(this._host):(_+=p=g.internalValue/a*h,i[l]=p),l++}l=0;for(var b=0,m=this._columnDefinitions;b<m.length;b++)(g=m[b]).isPixel?(o-=C=g.getValue(this._host),e[l]=C):s+=g.internalValue,l++;var y=0;l=0;for(var v=0,O=this._columnDefinitions;v<O.length;v++){var C;g=O[v],r.push(y),g.isPixel?y+=g.getValue(this._host):(y+=C=g.internalValue/s*o,e[l]=C),l++}t(r,n,e,i)},e.prototype._additionalProcessing=function(e,i){var r=this;this._getGridDefinitions(function(t,e,i,n){for(var o in r._cells)if(r._cells.hasOwnProperty(o)){var s=o.split(":"),h=parseInt(s[0]),a=parseInt(s[1]),l=r._cells[o];l.left=t[a]+"px",l.top=e[h]+"px",l.width=i[a]+"px",l.height=n[h]+"px",l._left.ignoreAdaptiveScaling=!0,l._top.ignoreAdaptiveScaling=!0,l._width.ignoreAdaptiveScaling=!0,l._height.ignoreAdaptiveScaling=!0}}),t.prototype._additionalProcessing.call(this,e,i)},e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t in this._cells)this._cells.hasOwnProperty(t)&&this._cells[t]._markMatrixAsDirty()},e.prototype._renderHighlightSpecific=function(e){var i=this;t.prototype._renderHighlightSpecific.call(this,e),this._getGridDefinitions(function(t,r,n,o){for(var s=0;s<t.length;s++){var h=i._currentMeasure.left+t[s]+n[s];e.beginPath(),e.moveTo(h,i._currentMeasure.top),e.lineTo(h,i._currentMeasure.top+i._currentMeasure.height),e.stroke()}for(s=0;s<r.length;s++){var a=i._currentMeasure.top+r[s]+o[s];e.beginPath(),e.moveTo(i._currentMeasure.left,a),e.lineTo(i._currentMeasure.left+i._currentMeasure.width,a),e.stroke()}}),e.restore()},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=0,i=this._childControls;e<i.length;e++)i[e].dispose();this._childControls=[]},e}(d),C=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._value=h.Color3.Red(),i._tmpColor=new h.Color3,i._pointerStartedOnSquare=!1,i._pointerStartedOnWheel=!1,i._squareLeft=0,i._squareTop=0,i._squareSize=0,i._h=360,i._s=1,i._v=1,i._lastPointerDownID=-1,i.onValueChangedObservable=new h.Observable,i._pointerIsDown=!1,i.value=new h.Color3(.88,.1,.1),i.size="200px",i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value.equals(t)||(this._value.copyFrom(t),this._RGBtoHSV(this._value,this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=e._Epsilon&&(this._value.r=0),this._value.g<=e._Epsilon&&(this._value.g=0),this._value.b<=e._Epsilon&&(this._value.b=0),this._value.r>=1-e._Epsilon&&(this._value.r=1),this._value.g>=1-e._Epsilon&&(this._value.g=1),this._value.b>=1-e._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._width.toString(this._host)!==t&&this._width.fromString(t)&&(this._height.fromString(t),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._height.toString(this._host)!==t&&this._height.fromString(t)&&(this._width.fromString(t),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(t){this.width=t},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"ColorPicker"},e.prototype._preMeasure=function(t,e){t.width<t.height?this._currentMeasure.height=t.width:this._currentMeasure.width=t.height},e.prototype._updateSquareProps=function(){var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),e=2*(t-.2*t)/Math.sqrt(2),i=t-.5*e;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=e},e.prototype._drawGradientSquare=function(t,e,i,r,n,o){var s=o.createLinearGradient(e,i,r+e,i);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+t+", 100%, 50%)"),o.fillStyle=s,o.fillRect(e,i,r,n);var h=o.createLinearGradient(e,i,e,n+i);h.addColorStop(0,"rgba(0,0,0,0)"),h.addColorStop(1,"#000"),o.fillStyle=h,o.fillRect(e,i,r,n)},e.prototype._drawCircle=function(t,e,i,r){r.beginPath(),r.arc(t,e,i+1,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#333333",r.stroke(),r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#ffffff",r.stroke()},e.prototype._createColorWheelCanvas=function(t,e){var i=document.createElement("canvas");i.width=2*t,i.height=2*t;for(var r=i.getContext("2d"),n=r.getImageData(0,0,2*t,2*t),o=n.data,s=this._tmpColor,h=t*t,a=t-e,l=a*a,u=-t;u<t;u++)for(var c=-t;c<t;c++){var _=u*u+c*c;if(!(_>h||_<l)){var d=Math.sqrt(_),f=Math.atan2(c,u);this._HSVtoRGB(180*f/Math.PI+180,d/t,1,s);var p=4*(u+t+2*(c+t)*t);o[p]=255*s.r,o[p+1]=255*s.g,o[p+2]=255*s.b;var g=.2;g=t<50?.2:t>150?.04:-.16*(t-50)/100+.2;var b=(d-a)/(t-a);o[p+3]=b<g?b/g*255:b>1-g?255*(1-(b-(1-g))/g):255}}return r.putImageData(n,0,0),i},e.prototype._RGBtoHSV=function(t,e){var i=t.r,r=t.g,n=t.b,o=Math.max(i,r,n),s=Math.min(i,r,n),h=0,a=0,l=o,u=o-s;0!==o&&(a=u/o),o!=s&&(o==i?(h=(r-n)/u,r<n&&(h+=6)):o==r?h=(n-i)/u+2:o==n&&(h=(i-r)/u+4),h*=60),e.r=h,e.g=a,e.b=l},e.prototype._HSVtoRGB=function(t,e,i,r){var n=i*e,o=t/60,s=n*(1-Math.abs(o%2-1)),h=0,a=0,l=0;o>=0&&o<=1?(h=n,a=s):o>=1&&o<=2?(h=s,a=n):o>=2&&o<=3?(a=n,l=s):o>=3&&o<=4?(a=s,l=n):o>=4&&o<=5?(h=s,l=n):o>=5&&o<=6&&(h=n,l=s);var u=i-n;r.set(h+u,a+u,l+u)},e.prototype._draw=function(t){t.save(),this._applyStates(t);var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*e,r=this._currentMeasure.left,n=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*e||(this._colorWheelCanvas=this._createColorWheelCanvas(e,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),t.drawImage(this._colorWheelCanvas,r,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,t);var o=this._squareLeft+this._squareSize*this._s,s=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,s,.04*e,t);var h=e-.5*i;o=r+e+Math.cos((this._h-180)*Math.PI/180)*h,s=n+e+Math.sin((this._h-180)*Math.PI/180)*h,this._drawCircle(o,s,.35*i,t),t.restore()},e.prototype._updateValueFromPointer=function(t,i){if(this._pointerStartedOnWheel){var r=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),n=r+this._currentMeasure.left,o=r+this._currentMeasure.top;this._h=180*Math.atan2(i-o,t-n)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(t-this._squareLeft)/this._squareSize,this._v=1-(i-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,e._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,e._Epsilon));this._HSVtoRGB(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},e.prototype._isPointOnSquare=function(t,e){this._updateSquareProps();var i=this._squareLeft,r=this._squareTop,n=this._squareSize;return t>=i&&t<=i+n&&e>=r&&e<=r+n},e.prototype._isPointOnWheel=function(t,e){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=i-.2*i,n=t-(i+this._currentMeasure.left),o=e-(i+this._currentMeasure.top),s=n*n+o*o;return s<=i*i&&s>=r*r},e.prototype._onPointerDown=function(e,i,r,n){if(!t.prototype._onPointerDown.call(this,e,i,r,n))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var o=this._transformedPosition.x,s=this._transformedPosition.y;return this._isPointOnSquare(o,s)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(o,s)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(o,s),this._host._capturingControl[r]=this,this._lastPointerDownID=r,!0},e.prototype._onPointerMove=function(e,i,r){if(r==this._lastPointerDownID){this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var n=this._transformedPosition.x,o=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(n,o),t.prototype._onPointerMove.call(this,e,i,r)}},e.prototype._onPointerUp=function(e,i,r,n,o){this._pointerIsDown=!1,delete this._host._capturingControl[r],t.prototype._onPointerUp.call(this,e,i,r,n,o)},e.ShowPickerDialogAsync=function(t,i){return new Promise(function(r,n){function Z(t,e){A=e;var i=t.toHexString();if(k.background=i,y.name!=A&&(y.text=Math.floor(255*t.r).toString()),C.name!=A&&(C.text=Math.floor(255*t.g).toString()),T.name!=A&&(T.text=Math.floor(255*t.b).toString()),w.name!=A&&(w.text=t.r.toString()),x.name!=A&&(x.text=t.g.toString()),P.name!=A&&(P.text=t.b.toString()),M.name!=A){var r=i.split("#");M.text=r[1]}m.name!=A&&(m.value=t)}function J(t,e){var i=t.text;if(/[^0-9]/g.test(i))t.text=I;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),A==t.name&&(I=i),""!=i){i=parseInt(i).toString(),t.text=i;var r=h.Color3.FromHexString(k.background);A==t.name&&Z("r"==e?new h.Color3(parseInt(i)/255,r.g,r.b):"g"==e?new h.Color3(r.r,parseInt(i)/255,r.b):new h.Color3(r.r,r.g,parseInt(i)/255),t.name)}}function Q(t,e){var i=t.text;if(/[^0-9\.]/g.test(i))t.text=I;else{""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),A==t.name&&(I=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),t.text=i):i="0.0";var r=h.Color3.FromHexString(k.background);A==t.name&&Z("r"==e?new h.Color3(parseFloat(i),r.g,r.b):"g"==e?new h.Color3(r.r,parseFloat(i),r.b):new h.Color3(r.r,r.g,parseFloat(i)),t.name)}}function $(){if(i.savedColors&&i.savedColors[d]){if(q)var t="b";else t="";var e=b.CreateSimpleButton("Swatch_"+d,t);e.fontFamily="BabylonJSglyphs";var r=h.Color3.FromHexString(i.savedColors[d]),n=r.r+r.g+r.b;e.color=n>X?Y:U,e.fontSize=Math.floor(.7*L),e.textBlock.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,e.height=e.width=L.toString()+"px",e.background=i.savedColors[d],e.thickness=2;var o=d;return e.pointerDownAnimation=function(){e.thickness=4},e.pointerUpAnimation=function(){e.thickness=3},e.pointerEnterAnimation=function(){e.thickness=3},e.pointerOutAnimation=function(){e.thickness=2},e.onPointerClickObservable.add(function(){var t;q?(t=o,i.savedColors&&i.savedColors.splice(t,1),i.savedColors&&0==i.savedColors.length&&(it(!1),q=!1),et("",Nt)):i.savedColors&&Z(h.Color3.FromHexString(i.savedColors[o]),e.name)}),e}return null}function tt(t){if(void 0!==t&&(q=t),q){for(var e=0;e<g.children.length;e++)g.children[e].textBlock.text="b";void 0!==a&&(a.textBlock.text="Done")}else{for(e=0;e<g.children.length;e++)g.children[e].textBlock.text="";void 0!==a&&(a.textBlock.text="Edit")}}function et(t,e){if(i.savedColors){""!=t&&i.savedColors.push(t),d=0,g.clearControls();var r=Math.ceil(i.savedColors.length/i.numSwatchesPerLine);if(0==r)var n=0;else n=r+1;if(g.rowCount!=r+n){for(var o=g.rowCount,s=0;s<o;s++)g.removeRowDefinition(0);for(s=0;s<r+n;s++)s%2?g.addRowDefinition(L,!0):g.addRowDefinition(D,!0)}g.height=(L*r+n*D).toString()+"px";for(var h=1,a=1;h<r+n;h+=2,a++){if(i.savedColors.length>a*i.numSwatchesPerLine)var l=i.numSwatchesPerLine;else l=i.savedColors.length-(a-1)*i.numSwatchesPerLine;for(var u=Math.min(Math.max(l,0),i.numSwatchesPerLine),c=0,_=1;c<u;c++)if(!(c>i.numSwatchesPerLine)){var f=$();null!=f&&(g.addControl(f,h,_),_+=2,d++)}}i.savedColors.length>=i.swatchLimit?rt(e,!0):rt(e,!1)}}function it(t){t?((a=b.CreateSimpleButton("butEdit","Edit")).width=l,a.height=u,a.left=Math.floor(.1*parseInt(l)).toString()+"px",a.top=(-1*parseFloat(a.left)).toString()+"px",a.verticalAlignment=_.VERTICAL_ALIGNMENT_BOTTOM,a.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,a.thickness=2,a.color=H,a.fontSize=s,a.background=V,a.onPointerEnterObservable.add(function(){a.background=F}),a.onPointerOutObservable.add(function(){a.background=V}),a.pointerDownAnimation=function(){a.background=j},a.pointerUpAnimation=function(){a.background=F},a.onPointerClickObservable.add(function(){q=!q,tt()}),mt.addControl(a,1,0)):mt.removeControl(a)}function rt(t,e){e?(t.color=W,t.background=z):(t.color=H,t.background=V)}function nt(e){r(i.savedColors&&i.savedColors.length>0?{savedColors:i.savedColors,pickedColor:e}:{pickedColor:e}),t.removeControl(ot)}i.pickerWidth=i.pickerWidth||"640px",i.pickerHeight=i.pickerHeight||"400px",i.headerHeight=i.headerHeight||"35px",i.lastColor=i.lastColor||"#000000",i.swatchLimit=i.swatchLimit||20,i.numSwatchesPerLine=i.numSwatchesPerLine||10;var o,s,a,l,u,c,d,g,m,y,C,T,w,x,P,M,k,I,A,E=i.swatchLimit/i.numSwatchesPerLine,S=parseFloat(i.pickerWidth)/i.numSwatchesPerLine,D=Math.floor(.25*S),R=D*(i.numSwatchesPerLine+1),L=Math.floor((parseFloat(i.pickerWidth)-R)/i.numSwatchesPerLine),N=L*E+D*(E+1),B=(parseInt(i.pickerHeight)+N+Math.floor(.25*L)).toString()+"px",H="#c0c0c0",V="#535353",F="#414141",j="515151",W="#555555",z="#454545",G=h.Color3.FromHexString("#dddddd"),X=G.r+G.g+G.b,Y="#aaaaaa",U="#ffffff",K=["R","G","B"],q=!1,ot=new O;if(ot.name="Dialog Container",ot.width=i.pickerWidth,i.savedColors){ot.height=B;var st=parseInt(i.pickerHeight)/parseInt(B);ot.addRowDefinition(st,!1),ot.addRowDefinition(1-st,!1)}else ot.height=i.pickerHeight,ot.addRowDefinition(1,!1);if(t.addControl(ot),i.savedColors){(g=new O).name="Swatch Drawer",g.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,g.background=V,g.width=i.pickerWidth;var ht=i.savedColors.length/i.numSwatchesPerLine;if(0==ht)var at=0;else at=ht+1;g.height=(L*ht+at*D).toString()+"px",g.top=Math.floor(.25*L).toString()+"px";for(var lt=0;lt<2*Math.ceil(i.savedColors.length/i.numSwatchesPerLine)+1;lt++)lt%2!=0?g.addRowDefinition(L,!0):g.addRowDefinition(D,!0);for(lt=0;lt<2*i.numSwatchesPerLine+1;lt++)lt%2!=0?g.addColumnDefinition(L,!0):g.addColumnDefinition(D,!0);ot.addControl(g,1,0)}var ut=new O;ut.name="Picker Panel",ut.height=i.pickerHeight;var ct=parseInt(i.headerHeight)/parseInt(i.pickerHeight),_t=[ct,1-ct];ut.addRowDefinition(_t[0],!1),ut.addRowDefinition(_t[1],!1),ot.addControl(ut,0,0);var dt=new f;dt.name="Dialogue Header Bar",dt.background="#cccccc",dt.thickness=0,ut.addControl(dt,0,0);var ft=b.CreateSimpleButton("closeButton","a");ft.fontFamily="BabylonJSglyphs";var pt=h.Color3.FromHexString(dt.background);o=new h.Color3(1-pt.r,1-pt.g,1-pt.b),ft.color=o.toHexString(),ft.fontSize=Math.floor(.6*parseInt(i.headerHeight)),ft.textBlock.textVerticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,ft.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_RIGHT,ft.height=ft.width=i.headerHeight,ft.background=dt.background,ft.thickness=0,ft.pointerDownAnimation=function(){},ft.pointerUpAnimation=function(){ft.background=dt.background},ft.pointerEnterAnimation=function(){ft.color=dt.background,ft.background="red"},ft.pointerOutAnimation=function(){ft.color=o.toHexString(),ft.background=dt.background},ft.onPointerClickObservable.add(function(){nt(At.background)}),ut.addControl(ft,0,0);var gt=new O;gt.name="Dialogue Body",gt.background=V;var bt=[.4375,.5625];gt.addRowDefinition(1,!1),gt.addColumnDefinition(bt[0],!1),gt.addColumnDefinition(bt[1],!1),ut.addControl(gt,1,0);var mt=new O;mt.name="Picker Grid",mt.addRowDefinition(.85,!1),mt.addRowDefinition(.15,!1),gt.addControl(mt,0,0),(m=new e).name="GUI Color Picker",i.pickerHeight<i.pickerWidth?m.width=.89:m.height=.89,m.value=h.Color3.FromHexString(i.lastColor),m.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,m.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,m.onPointerDownObservable.add(function(){A=m.name,I="",tt(!1)}),m.onValueChangedObservable.add(function(t){A==m.name&&Z(t,m.name)}),mt.addControl(m,0,0);var yt=new O;yt.name="Dialogue Right Half",yt.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT;var vt=[.514,.486];yt.addRowDefinition(vt[0],!1),yt.addRowDefinition(vt[1],!1),gt.addControl(yt,1,1);var Ot=new O;Ot.name="Swatches and Buttons";var Ct=[.417,.583];Ot.addRowDefinition(1,!1),Ot.addColumnDefinition(Ct[0],!1),Ot.addColumnDefinition(Ct[1],!1),yt.addControl(Ot,0,0);var Tt=new O;Tt.name="New and Current Swatches";var wt=[.04,.16,.64,.16];Tt.addRowDefinition(wt[0],!1),Tt.addRowDefinition(wt[1],!1),Tt.addRowDefinition(wt[2],!1),Tt.addRowDefinition(wt[3],!1),Ot.addControl(Tt,0,0);var xt=new O;xt.name="Active Swatches",xt.width=.67,xt.addRowDefinition(.5,!1),xt.addRowDefinition(.5,!1),Tt.addControl(xt,2,0);var Pt=Math.floor(parseInt(i.pickerWidth)*bt[1]*Ct[0]*.11),Mt=Math.floor(parseInt(i.pickerHeight)*_t[1]*vt[0]*wt[1]*.5);if(i.pickerWidth>i.pickerHeight)var kt=Mt;else kt=Pt;var It=new p;It.text="new",It.name="New Color Label",It.color=H,It.fontSize=kt,Tt.addControl(It,1,0),(k=new f).name="New Color Swatch",k.background=i.lastColor,k.thickness=0,xt.addControl(k,0,0);var At=b.CreateSimpleButton("currentSwatch","");At.background=i.lastColor,At.thickness=0,At.onPointerClickObservable.add(function(){Z(h.Color3.FromHexString(At.background),At.name),tt(!1)}),At.pointerDownAnimation=function(){},At.pointerUpAnimation=function(){},At.pointerEnterAnimation=function(){},At.pointerOutAnimation=function(){},xt.addControl(At,1,0);var Et=new f;Et.name="Swatch Outline",Et.width=.67,Et.thickness=2,Et.color="#404040",Et.isHitTestVisible=!1,Tt.addControl(Et,2,0);var St=new p;St.name="Current Color Label",St.text="current",St.color=H,St.fontSize=kt,Tt.addControl(St,3,0);var Dt=new O;Dt.name="Button Grid",Dt.height=.8,Dt.addRowDefinition(1/3,!1),Dt.addRowDefinition(1/3,!1),Dt.addRowDefinition(1/3,!1),Ot.addControl(Dt,0,1),l=Math.floor(parseInt(i.pickerWidth)*bt[1]*Ct[1]*.67).toString()+"px",u=Math.floor(parseInt(i.pickerHeight)*_t[1]*vt[0]*(parseFloat(Dt.height.toString())/100)*(1/3)*.7).toString()+"px",s=parseFloat(l)>parseFloat(u)?Math.floor(.45*parseFloat(u)):Math.floor(.11*parseFloat(l));var Rt=b.CreateSimpleButton("butOK","OK");Rt.width=l,Rt.height=u,Rt.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,Rt.thickness=2,Rt.color=H,Rt.fontSize=s,Rt.background=V,Rt.onPointerEnterObservable.add(function(){Rt.background=F}),Rt.onPointerOutObservable.add(function(){Rt.background=V}),Rt.pointerDownAnimation=function(){Rt.background=j},Rt.pointerUpAnimation=function(){Rt.background=F},Rt.onPointerClickObservable.add(function(){tt(!1),nt(k.background)}),Dt.addControl(Rt,0,0);var Lt=b.CreateSimpleButton("butCancel","Cancel");if(Lt.width=l,Lt.height=u,Lt.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,Lt.thickness=2,Lt.color=H,Lt.fontSize=s,Lt.background=V,Lt.onPointerEnterObservable.add(function(){Lt.background=F}),Lt.onPointerOutObservable.add(function(){Lt.background=V}),Lt.pointerDownAnimation=function(){Lt.background=j},Lt.pointerUpAnimation=function(){Lt.background=F},Lt.onPointerClickObservable.add(function(){tt(!1),nt(At.background)}),Dt.addControl(Lt,1,0),i.savedColors){var Nt=b.CreateSimpleButton("butSave","Save");Nt.width=l,Nt.height=u,Nt.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,Nt.thickness=2,Nt.fontSize=s,i.savedColors.length<i.swatchLimit?(Nt.color=H,Nt.background=V):rt(Nt,!0),Nt.onPointerEnterObservable.add(function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=F)}),Nt.onPointerOutObservable.add(function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=V)}),Nt.pointerDownAnimation=function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=j)},Nt.pointerUpAnimation=function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=F)},Nt.onPointerClickObservable.add(function(){i.savedColors&&(0==i.savedColors.length&&it(!0),i.savedColors.length<i.swatchLimit&&et(k.background,Nt),tt(!1))}),i.savedColors.length>0&&it(!0),Dt.addControl(Nt,2,0)}var Bt=new O;Bt.name="Dialog Lower Right",Bt.addRowDefinition(.02,!1),Bt.addRowDefinition(.63,!1),Bt.addRowDefinition(.21,!1),Bt.addRowDefinition(.14,!1),yt.addControl(Bt,1,0),c=h.Color3.FromHexString(i.lastColor);var Ht=new O;for(Ht.name="RGB Values",Ht.width=.82,Ht.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,Ht.addRowDefinition(1/3,!1),Ht.addRowDefinition(1/3,!1),Ht.addRowDefinition(1/3,!1),Ht.addColumnDefinition(.1,!1),Ht.addColumnDefinition(.2,!1),Ht.addColumnDefinition(.7,!1),Bt.addControl(Ht,1,0),lt=0;lt<K.length;lt++)(Vt=new p).text=K[lt],Vt.color=H,Vt.fontSize=s,Ht.addControl(Vt,lt,0);(y=new v).width=.83,y.height=.72,y.name="rIntField",y.fontSize=s,y.text=(255*c.r).toString(),y.color="#f0f0f0",y.background="#454545",y.onFocusObservable.add(function(){A=y.name,I=y.text,tt(!1)}),y.onBlurObservable.add(function(){""==y.text&&(y.text="0"),J(y,"r"),A==y.name&&(A="")}),y.onTextChangedObservable.add(function(){A==y.name&&J(y,"r")}),Ht.addControl(y,0,1),(C=new v).width=.83,C.height=.72,C.name="gIntField",C.fontSize=s,C.text=(255*c.g).toString(),C.color="#f0f0f0",C.background="#454545",C.onFocusObservable.add(function(){A=C.name,I=C.text,tt(!1)}),C.onBlurObservable.add(function(){""==C.text&&(C.text="0"),J(C,"g"),A==C.name&&(A="")}),C.onTextChangedObservable.add(function(){A==C.name&&J(C,"g")}),Ht.addControl(C,1,1),(T=new v).width=.83,T.height=.72,T.name="bIntField",T.fontSize=s,T.text=(255*c.b).toString(),T.color="#f0f0f0",T.background="#454545",T.onFocusObservable.add(function(){A=T.name,I=T.text,tt(!1)}),T.onBlurObservable.add(function(){""==T.text&&(T.text="0"),J(T,"b"),A==T.name&&(A="")}),T.onTextChangedObservable.add(function(){A==T.name&&J(T,"b")}),Ht.addControl(T,2,1),(w=new v).width=.95,w.height=.72,w.name="rDecField",w.fontSize=s,w.text=c.r.toString(),w.color="#f0f0f0",w.background="#454545",w.onFocusObservable.add(function(){A=w.name,I=w.text,tt(!1)}),w.onBlurObservable.add(function(){0!=parseFloat(w.text)&&""!=w.text||(w.text="0",Q(w,"r")),A==w.name&&(A="")}),w.onTextChangedObservable.add(function(){A==w.name&&Q(w,"r")}),Ht.addControl(w,0,2),(x=new v).width=.95,x.height=.72,x.name="gDecField",x.fontSize=s,x.text=c.g.toString(),x.color="#f0f0f0",x.background="#454545",x.onFocusObservable.add(function(){A=x.name,I=x.text,tt(!1)}),x.onBlurObservable.add(function(){0!=parseFloat(x.text)&&""!=x.text||(x.text="0",Q(x,"g")),A==x.name&&(A="")}),x.onTextChangedObservable.add(function(){A==x.name&&Q(x,"g")}),Ht.addControl(x,1,2),(P=new v).width=.95,P.height=.72,P.name="bDecField",P.fontSize=s,P.text=c.b.toString(),P.color="#f0f0f0",P.background="#454545",P.onFocusObservable.add(function(){A=P.name,I=P.text,tt(!1)}),P.onBlurObservable.add(function(){0!=parseFloat(P.text)&&""!=P.text||(P.text="0",Q(P,"b")),A==P.name&&(A="")}),P.onTextChangedObservable.add(function(){A==P.name&&Q(P,"b")}),Ht.addControl(P,2,2);var Vt,Ft=new O;Ft.name="Hex Value",Ft.width=.82,Ft.addRowDefinition(1,!1),Ft.addColumnDefinition(.1,!1),Ft.addColumnDefinition(.9,!1),Bt.addControl(Ft,2,0),(Vt=new p).text="#",Vt.color=H,Vt.fontSize=s,Ft.addControl(Vt,0,0),(M=new v).width=.96,M.height=.72,M.name="hexField",M.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,M.fontSize=s;var jt=i.lastColor.split("#");M.text=jt[1],M.color="#f0f0f0",M.background="#454545",M.onFocusObservable.add(function(){A=M.name,I=M.text,tt(!1)}),M.onBlurObservable.add(function(){if(3==M.text.length){var t=M.text.split("");M.text=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}""==M.text&&(M.text="000000",Z(h.Color3.FromHexString(M.text),"b")),A==M.name&&(A="")}),M.onTextChangedObservable.add(function(){var t=M.text,e=/[^0-9A-F]/i.test(t);if((M.text.length>6||e)&&A==M.name)M.text=I;else{if(M.text.length<6)for(var i=6-M.text.length,r=0;r<i;r++)t="0"+t;if(3==M.text.length){var n=M.text.split("");t=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]}t="#"+t,A==M.name&&(I=M.text,Z(h.Color3.FromHexString(t),M.name))}}),Ft.addControl(M,0,1),i.savedColors&&i.savedColors.length>0&&et("",Nt)})},e._Epsilon=1e-6,e}(_),T=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thickness=1,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Ellipse"},e.prototype._localDraw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),_.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,t),this._background&&(t.fillStyle=this._background,t.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._thickness&&(this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.stroke()),t.restore()},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},e.prototype._clipForChildren=function(t){_.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,t),t.clip()},e}(d),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._beforeRenderText=function(t){for(var e="",i=0;i<t.length;i++)e+="•";return e},e}(v),x=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._lineWidth=1,i._x1=new a(0),i._y1=new a(0),i._x2=new a(0),i._y2=new a(0),i._dash=new Array,i.isHitTestVisible=!1,i._horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,i}return n(e,t),Object.defineProperty(e.prototype,"dash",{get:function(){return this._dash},set:function(t){this._dash!==t&&(this._dash=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(t){var e=this;this._connectedControl!==t&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),t&&(this._connectedControlDirtyObserver=t.onDirtyObservable.add(function(){return e._markAsDirty()})),this._connectedControl=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(t){this._x1.toString(this._host)!==t&&this._x1.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(t){this._y1.toString(this._host)!==t&&this._y1.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(t){this._x2.toString(this._host)!==t&&this._x2.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(t){this._y2.toString(this._host)!==t&&this._y2.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Line"},e.prototype._draw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath(),t.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.left+this._y1.getValue(this._host)),t.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.left+this._effectiveY2),t.stroke(),t.restore()},e.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},e.prototype._computeAlignment=function(t,e){this._currentMeasure.left=t.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=t.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},e.prototype.moveToVector3=function(t,e,i){if(void 0===i&&(i=!1),this._host&&this.parent===this._host._rootContainer){var r=this._host._getGlobalViewport(e),n=h.Vector3.Project(t,h.Matrix.Identity(),e.getTransformMatrix(),r);this._moveToProjectedPosition(n,i),n.z<0||n.z>1?this.notRenderable=!0:this.notRenderable=!1}else h.Tools.Error("Cannot move a control to a vector3 if the control is not at root level")},e.prototype._moveToProjectedPosition=function(t,e){void 0===e&&(e=!1);var i=t.x+this._linkOffsetX.getValue(this._host)+"px",r=t.y+this._linkOffsetY.getValue(this._host)+"px";e?(this.x2=i,this.y2=r,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=r,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},e}(_),P=function(){function t(t){this._multiLine=t,this._x=new a(0),this._y=new a(0),this._point=new h.Vector2(0,0)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(t){this._x.toString(this._multiLine._host)!==t&&this._x.fromString(t)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(t){this._y.toString(this._multiLine._host)!==t&&this._y.fromString(t)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"control",{get:function(){return this._control},set:function(t){this._control!==t&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=t,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=t,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype.resetLinks=function(){this.control=null,this.mesh=null},t.prototype.translate=function(){return this._point=this._translatePoint(),this._point},t.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPosition(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new h.Vector2(this._control.centerX,this._control.centerY);var t=this._multiLine._host,e=this._x.getValueInPixel(t,Number(t._canvas.width)),i=this._y.getValueInPixel(t,Number(t._canvas.height));return new h.Vector2(e,i)},t.prototype.dispose=function(){this.resetLinks()},t}(),M=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._lineWidth=1,i.onPointUpdate=function(){i._markAsDirty()},i.isHitTestVisible=!1,i._horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,i._dash=[],i._points=[],i}return n(e,t),Object.defineProperty(e.prototype,"dash",{get:function(){return this._dash},set:function(t){this._dash!==t&&(this._dash=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype.getAt=function(t){return this._points[t]||(this._points[t]=new P(this)),this._points[t]},e.prototype.add=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.map(function(e){return t.push(e)})},e.prototype.push=function(t){var e=this.getAt(this._points.length);return null==t?e:(t instanceof h.AbstractMesh?e.mesh=t:t instanceof _?e.control=t:null!=t.x&&null!=t.y&&(e.x=t.x,e.y=t.y),e)},e.prototype.remove=function(t){var e;if(t instanceof P){if(-1===(e=this._points.indexOf(t)))return}else e=t;var i=this._points[e];i&&(i.dispose(),this._points.splice(e,1))},e.prototype.reset=function(){for(;this._points.length>0;)this.remove(this._points.length-1)},e.prototype.resetLinks=function(){this._points.forEach(function(t){null!=t&&t.resetLinks()})},Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"MultiLine"},e.prototype._draw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath();var e=!0;this._points.forEach(function(i){i&&(e?(t.moveTo(i._point.x,i._point.y),e=!1):t.lineTo(i._point.x,i._point.y))}),t.stroke(),t.restore()},e.prototype._additionalProcessing=function(t,e){var i=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach(function(t,e){t&&(t.translate(),(null==i._minX||t._point.x<i._minX)&&(i._minX=t._point.x),(null==i._minY||t._point.y<i._minY)&&(i._minY=t._point.y),(null==i._maxX||t._point.x>i._maxX)&&(i._maxX=t._point.x),(null==i._maxY||t._point.y>i._maxY)&&(i._maxY=t._point.y))}),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},e.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},e.prototype._computeAlignment=function(t,e){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},e.prototype.dispose=function(){this.reset(),t.prototype.dispose.call(this)},e}(_),k=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.group="",i.onIsCheckedChangedObservable=new h.Observable,i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){var e=this;this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t),this._isChecked&&this._host&&this._host.executeOnAllControls(function(t){if(t!==e&&void 0!==t.group){var i=t;i.group===e.group&&(i.isChecked=!1)}}))},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"RadioButton"},e.prototype._draw=function(t){t.save(),this._applyStates(t);var e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),_.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,t),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this.color,t.lineWidth=this._thickness,t.stroke(),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColor;var r=e*this._checkSizeRatio,n=i*this._checkSizeRatio;_.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,r/2-this._thickness/2,n/2-this._thickness/2,t),t.fill()}t.restore()},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this.isChecked||(this.isChecked=!0),!0)},e.AddRadioButtonWithHeader=function(t,i,r,n){var o=new m;o.isVertical=!1,o.height="30px";var s=new e;s.width="20px",s.height="20px",s.isChecked=r,s.color="green",s.group=i,s.onIsCheckedChangedObservable.add(function(t){return n(s,t)}),o.addControl(s);var h=new p;return h.text=t,h.width="180px",h.paddingLeft="5px",h.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,h.color="white",o.addControl(h),o},e}(_),I=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thumbWidth=new a(20,a.UNITMODE_PIXEL,!1),i._minimum=0,i._maximum=100,i._value=50,i._isVertical=!1,i._barOffset=new a(5,a.UNITMODE_PIXEL,!1),i._isThumbClamped=!1,i._displayThumb=!0,i._step=0,i._lastPointerDownID=-1,i._effectiveBarOffset=0,i.onValueChangedObservable=new h.Observable,i._pointerIsDown=!1,i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"step",{get:function(){return this._step},set:function(t){this._step!==t&&(this._step=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(t){this._barOffset.toString(this._host)!==t&&this._barOffset.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(t){this._thumbWidth.toString(this._host)!==t&&this._thumbWidth.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minimum",{get:function(){return this._minimum},set:function(t){this._minimum!==t&&(this._minimum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this._maximum},set:function(t){this._maximum!==t&&(this._maximum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){t=Math.max(Math.min(t,this._maximum),this._minimum),this._value!==t&&(this._value=t,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(t){this._isThumbClamped!==t&&(this._isThumbClamped=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"BaseSlider"},e.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},e.prototype._getThumbThickness=function(t){var e=0;switch(t){case"circle":e=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":e=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return e},e.prototype._prepareRenderingData=function(t){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(t),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},e.prototype._updateValueFromPointer=function(t,e){var i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum);var r=1/this._step|0;this.value=this._step?(i*r|0)/r:i},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this._pointerIsDown=!0,this._updateValueFromPointer(i.x,i.y),this._host._capturingControl[r]=this,this._lastPointerDownID=r,!0)},e.prototype._onPointerMove=function(e,i,r){r==this._lastPointerDownID&&(this._pointerIsDown&&this._updateValueFromPointer(i.x,i.y),t.prototype._onPointerMove.call(this,e,i,r))},e.prototype._onPointerUp=function(e,i,r,n,o){this._pointerIsDown=!1,delete this._host._capturingControl[r],t.prototype._onPointerUp.call(this,e,i,r,n,o)},e}(_),A=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._background="black",i._borderColor="white",i._isThumbCircle=!1,i._displayValueBar=!0,i}return n(e,t),Object.defineProperty(e.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(t){this._displayValueBar!==t&&(this._displayValueBar=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(t){this._isThumbCircle!==t&&(this._isThumbCircle=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Slider"},e.prototype._draw=function(t){t.save(),this._applyStates(t),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var e=this._renderLeft,i=this._renderTop,r=this._renderWidth,n=this._renderHeight,o=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?i+=this._effectiveThumbThickness/2:e+=this._effectiveThumbThickness/2,o=this._backgroundBoxThickness/2):o=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY);var s=this._getThumbPosition();t.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxThickness/2,i,o,Math.PI,2*Math.PI),t.fill(),t.fillRect(e,i,r,n)):t.fillRect(e,i,r,n+this._effectiveThumbThickness):t.fillRect(e,i,r,n):this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxLength,i+this._backgroundBoxThickness/2,o,0,2*Math.PI),t.fill(),t.fillRect(e,i,r,n)):t.fillRect(e,i,r+this._effectiveThumbThickness,n):t.fillRect(e,i,r,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(e+this._backgroundBoxThickness/2,i+this._backgroundBoxLength,o,0,2*Math.PI),t.fill(),t.fillRect(e,i+s,r,n-s)):t.fillRect(e,i+s,r,n-s+this._effectiveThumbThickness):t.fillRect(e,i+s,r,n-s):this.isThumbClamped&&this.isThumbCircle?(t.beginPath(),t.arc(e,i+this._backgroundBoxThickness/2,o,0,2*Math.PI),t.fill(),t.fillRect(e,i,s,n)):t.fillRect(e,i,s,n)),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(t.beginPath(),this.isVertical?t.arc(e+this._backgroundBoxThickness/2,i+s,o,0,2*Math.PI):t.arc(e+s,i+this._backgroundBoxThickness/2,o,0,2*Math.PI),t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,t.stroke()):(this.isVertical?t.fillRect(e-this._effectiveBarOffset,this._currentMeasure.top+s,this._currentMeasure.width,this._effectiveThumbThickness):t.fillRect(this._currentMeasure.left+s,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,this.isVertical?t.strokeRect(e-this._effectiveBarOffset,this._currentMeasure.top+s,this._currentMeasure.width,this._effectiveThumbThickness):t.strokeRect(this._currentMeasure.left+s,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),t.restore()},e}(I),E=function(){function t(t){this.name=t,this._groupPanel=new m,this._selectors=new Array,this._groupPanel.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(t)}return Object.defineProperty(t.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectors",{get:function(){return this._selectors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"header",{get:function(){return this._groupHeader.text},set:function(t){"label"!==this._groupHeader.text&&(this._groupHeader.text=t)},enumerable:!0,configurable:!0}),t.prototype._addGroupHeader=function(t){var e=new p("groupHead",t);return e.width=.9,e.height="30px",e.textWrapping=!0,e.color="black",e.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,e.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,e.left="2px",this._groupPanel.addControl(e),e},t.prototype._getSelector=function(t){if(!(t<0||t>=this._selectors.length))return this._selectors[t]},t.prototype.removeSelector=function(t){t<0||t>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[t]),this._selectors.splice(t,1))},t}(),S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.addCheckbox=function(t,e,i){void 0===e&&(e=function(t){}),void 0===i&&(i=!1),i=i||!1;var r=new y;r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add(function(t){e(t)});var n=_.AddHeader(r,t,"200px",{isHorizontal:!0,controlFirst:!0});n.height="30px",n.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,n.left="4px",this.groupPanel.addControl(n),this.selectors.push(n),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},e.prototype._setSelectorLabel=function(t,e){this.selectors[t].children[1].text=e},e.prototype._setSelectorLabelColor=function(t,e){this.selectors[t].children[1].color=e},e.prototype._setSelectorButtonColor=function(t,e){this.selectors[t].children[0].color=e},e.prototype._setSelectorButtonBackground=function(t,e){this.selectors[t].children[0].background=e},e}(E),D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._selectNb=0,e}return n(e,t),e.prototype.addRadio=function(t,e,i){void 0===e&&(e=function(t){}),void 0===i&&(i=!1);var r=this._selectNb++,n=new k;n.name=t,n.width="20px",n.height="20px",n.color="#364249",n.background="#CCCCCC",n.group=this.name,n.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,n.onIsCheckedChangedObservable.add(function(t){t&&e(r)});var o=_.AddHeader(n,t,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),n.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)},e.prototype._setSelectorLabel=function(t,e){this.selectors[t].children[1].text=e},e.prototype._setSelectorLabelColor=function(t,e){this.selectors[t].children[1].color=e},e.prototype._setSelectorButtonColor=function(t,e){this.selectors[t].children[0].color=e},e.prototype._setSelectorButtonBackground=function(t,e){this.selectors[t].children[0].background=e},e}(E),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.addSlider=function(t,e,i,r,n,o,s){void 0===e&&(e=function(t){}),void 0===i&&(i="Units"),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=function(t){return 0|t});var h=new A;h.name=i,h.value=o,h.minimum=r,h.maximum=n,h.width=.9,h.height="20px",h.color="#364249",h.background="#CCCCCC",h.borderColor="black",h.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,h.left="4px",h.paddingBottom="4px",h.onValueChangedObservable.add(function(t){h.parent.children[0].text=h.parent.children[0].name+": "+s(t)+" "+h.name,e(t)});var a=_.AddHeader(h,t+": "+s(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});a.height="60px",a.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,a.left="4px",a.children[0].name=t,this.groupPanel.addControl(a),this.selectors.push(a),this.groupPanel.parent&&this.groupPanel.parent.parent&&(h.color=this.groupPanel.parent.parent.buttonColor,h.background=this.groupPanel.parent.parent.buttonBackground)},e.prototype._setSelectorLabel=function(t,e){this.selectors[t].children[0].name=e,this.selectors[t].children[0].text=e+": "+this.selectors[t].children[1].value+" "+this.selectors[t].children[1].name},e.prototype._setSelectorLabelColor=function(t,e){this.selectors[t].children[0].color=e},e.prototype._setSelectorButtonColor=function(t,e){this.selectors[t].children[1].color=e},e.prototype._setSelectorButtonBackground=function(t,e){this.selectors[t].children[1].background=e},e}(E),L=function(t){function e(e,i){void 0===i&&(i=[]);var r=t.call(this,e)||this;if(r.name=e,r.groups=i,r._buttonColor="#364249",r._buttonBackground="#CCCCCC",r._headerColor="black",r._barColor="white",r._barHeight="2px",r._spacerHeight="20px",r._bars=new Array,r._groups=i,r.thickness=2,r._panel=new m,r._panel.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,r._panel.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,r._panel.top=5,r._panel.left=5,r._panel.width=.95,i.length>0){for(var n=0;n<i.length-1;n++)r._panel.addControl(i[n].groupPanel),r._addSpacer();r._panel.addControl(i[i.length-1].groupPanel)}return r.addControl(r._panel),r}return n(e,t),e.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(e.prototype,"headerColor",{get:function(){return this._headerColor},set:function(t){this._headerColor!==t&&(this._headerColor=t,this._setHeaderColor())},enumerable:!0,configurable:!0}),e.prototype._setHeaderColor=function(){for(var t=0;t<this._groups.length;t++)this._groups[t].groupPanel.children[0].color=this._headerColor},Object.defineProperty(e.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(t){this._buttonColor!==t&&(this._buttonColor=t,this._setbuttonColor())},enumerable:!0,configurable:!0}),e.prototype._setbuttonColor=function(){for(var t=0;t<this._groups.length;t++)for(var e=0;e<this._groups[t].selectors.length;e++)this._groups[t]._setSelectorButtonColor(e,this._buttonColor)},Object.defineProperty(e.prototype,"labelColor",{get:function(){return this._labelColor},set:function(t){this._labelColor!==t&&(this._labelColor=t,this._setLabelColor())},enumerable:!0,configurable:!0}),e.prototype._setLabelColor=function(){for(var t=0;t<this._groups.length;t++)for(var e=0;e<this._groups[t].selectors.length;e++)this._groups[t]._setSelectorLabelColor(e,this._labelColor)},Object.defineProperty(e.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(t){this._buttonBackground!==t&&(this._buttonBackground=t,this._setButtonBackground())},enumerable:!0,configurable:!0}),e.prototype._setButtonBackground=function(){for(var t=0;t<this._groups.length;t++)for(var e=0;e<this._groups[t].selectors.length;e++)this._groups[t]._setSelectorButtonBackground(e,this._buttonBackground)},Object.defineProperty(e.prototype,"barColor",{get:function(){return this._barColor},set:function(t){this._barColor!==t&&(this._barColor=t,this._setBarColor())},enumerable:!0,configurable:!0}),e.prototype._setBarColor=function(){for(var t=0;t<this._bars.length;t++)this._bars[t].children[0].background=this._barColor},Object.defineProperty(e.prototype,"barHeight",{get:function(){return this._barHeight},set:function(t){this._barHeight!==t&&(this._barHeight=t,this._setBarHeight())},enumerable:!0,configurable:!0}),e.prototype._setBarHeight=function(){for(var t=0;t<this._bars.length;t++)this._bars[t].children[0].height=this._barHeight},Object.defineProperty(e.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(t){this._spacerHeight!==t&&(this._spacerHeight=t,this._setSpacerHeight())},enumerable:!0,configurable:!0}),e.prototype._setSpacerHeight=function(){for(var t=0;t<this._bars.length;t++)this._bars[t].height=this._spacerHeight},e.prototype._addSpacer=function(){var t=new d;t.width=1,t.height=this._spacerHeight,t.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT;var e=new f;e.width=1,e.height=this._barHeight,e.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,e.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,e.background=this._barColor,e.color="transparent",t.addControl(e),this._panel.addControl(t),this._bars.push(t)},e.prototype.addGroup=function(t){this._groups.length>0&&this._addSpacer(),this._panel.addControl(t.groupPanel),this._groups.push(t),t.groupPanel.children[0].color=this._headerColor;for(var e=0;e<t.selectors.length;e++)t._setSelectorButtonColor(e,this._buttonColor),t._setSelectorButtonBackground(e,this._buttonBackground)},e.prototype.removeGroup=function(t){if(!(t<0||t>=this._groups.length)){var e=this._groups[t];this._panel.removeControl(e.groupPanel),this._groups.splice(t,1),t<this._bars.length&&(this._panel.removeControl(this._bars[t]),this._bars.splice(t,1))}},e.prototype.setHeaderName=function(t,e){e<0||e>=this._groups.length||(this._groups[e].groupPanel.children[0].text=t)},e.prototype.relabel=function(t,e,i){if(!(e<0||e>=this._groups.length)){var r=this._groups[e];i<0||i>=r.selectors.length||r._setSelectorLabel(i,t)}},e.prototype.removeFromGroupSelector=function(t,e){if(!(t<0||t>=this._groups.length)){var i=this._groups[t];e<0||e>=i.selectors.length||i.removeSelector(e)}},e.prototype.addToGroupCheckbox=function(t,e,i,r){void 0===i&&(i=function(){}),void 0===r&&(r=!1),t<0||t>=this._groups.length||this._groups[t].addCheckbox(e,i,r)},e.prototype.addToGroupRadio=function(t,e,i,r){void 0===i&&(i=function(){}),void 0===r&&(r=!1),t<0||t>=this._groups.length||this._groups[t].addRadio(e,i,r)},e.prototype.addToGroupSlider=function(t,e,i,r,n,o,s,h){void 0===i&&(i=function(){}),void 0===r&&(r="Units"),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===h&&(h=function(t){return 0|t}),t<0||t>=this._groups.length||this._groups[t].addSlider(e,i,r,n,o,s,h)},e}(f),N=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._getTypeName=function(){return"ScrollViewerWindow"},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=e.width,this._measureForChildren.height=e.height},e.prototype._postMeasure=function(){for(var e=this.parentClientWidth,i=this.parentClientHeight,r=0,n=this.children;r<n.length;r++){var o=n[r];o.isVisible&&!o.notRenderable&&(o.horizontalAlignment===_.HORIZONTAL_ALIGNMENT_CENTER&&o._offsetLeft(this._currentMeasure.left-o._currentMeasure.left),o.verticalAlignment===_.VERTICAL_ALIGNMENT_CENTER&&o._offsetTop(this._currentMeasure.top-o._currentMeasure.top),e=Math.max(e,o._currentMeasure.left-this._currentMeasure.left+o._currentMeasure.width),i=Math.max(i,o._currentMeasure.top-this._currentMeasure.top+o._currentMeasure.height))}this._currentMeasure.width!==e&&(this._width.updateInPlace(e,a.UNITMODE_PIXEL),this._currentMeasure.width=e,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==i&&(this._height.updateInPlace(i,a.UNITMODE_PIXEL),this._currentMeasure.height=i,this._rebuildLayout=!0,this._isDirty=!0),t.prototype._postMeasure.call(this)},e}(d),B=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._background="black",i._borderColor="white",i._thumbMeasure=new l(0,0,0,0),i}return n(e,t),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Scrollbar"},e.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},e.prototype._draw=function(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");var e=this._renderLeft,i=this._getThumbPosition();t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.fillStyle=this.color,this.isVertical?(this._thumbMeasure.left=e-this._effectiveBarOffset,this._thumbMeasure.top=this._currentMeasure.top+i,this._thumbMeasure.width=this._currentMeasure.width,this._thumbMeasure.height=this._effectiveThumbThickness):(this._thumbMeasure.left=this._currentMeasure.left+i,this._thumbMeasure.top=this._currentMeasure.top,this._thumbMeasure.width=this._effectiveThumbThickness,this._thumbMeasure.height=this._currentMeasure.height),t.fillRect(this._thumbMeasure.left,this._thumbMeasure.top,this._thumbMeasure.width,this._thumbMeasure.height),t.restore()},e.prototype._updateValueFromPointer=function(t,e){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._thumbMeasure.left||t>this._thumbMeasure.left+this._thumbMeasure.width||e<this._thumbMeasure.top||e>this._thumbMeasure.top+this._thumbMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-(e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=t,this._originY=e},e.prototype._onPointerDown=function(e,i,r,n){return this._first=!0,t.prototype._onPointerDown.call(this,e,i,r,n)},e}(I),H=function(t){function e(e){var i=t.call(this,e)||this;return i._barSize=20,i._pointerIsOver=!1,i._wheelPrecision=.05,i.onDirtyObservable.add(function(){i._horizontalBarSpace.color=i.color,i._verticalBarSpace.color=i.color,i._dragSpace.color=i.color}),i.onPointerEnterObservable.add(function(){i._pointerIsOver=!0}),i.onPointerOutObservable.add(function(){i._pointerIsOver=!1}),i._grid=new O,i._horizontalBar=new B,i._verticalBar=new B,i._window=new N,i._window.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,i._window.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,i._grid.addColumnDefinition(1),i._grid.addColumnDefinition(0,!0),i._grid.addRowDefinition(1),i._grid.addRowDefinition(0,!0),t.prototype.addControl.call(i,i._grid),i._grid.addControl(i._window,0,0),i._verticalBar.paddingLeft=0,i._verticalBar.width="100%",i._verticalBar.height="100%",i._verticalBar.barOffset=0,i._verticalBar.value=0,i._verticalBar.maximum=1,i._verticalBar.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,i._verticalBar.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,i._verticalBar.isVertical=!0,i._verticalBar.rotation=Math.PI,i._verticalBar.isVisible=!1,i._verticalBarSpace=new f,i._verticalBarSpace.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,i._verticalBarSpace.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,i._verticalBarSpace.thickness=1,i._grid.addControl(i._verticalBarSpace,0,1),i._verticalBarSpace.addControl(i._verticalBar),i._verticalBar.onValueChangedObservable.add(function(t){i._window.top=t*i._endTop+"px"}),i._horizontalBar.paddingLeft=0,i._horizontalBar.width="100%",i._horizontalBar.height="100%",i._horizontalBar.barOffset=0,i._horizontalBar.value=0,i._horizontalBar.maximum=1,i._horizontalBar.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,i._horizontalBar.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,i._horizontalBar.isVisible=!1,i._horizontalBarSpace=new f,i._horizontalBarSpace.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,i._horizontalBarSpace.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,i._horizontalBarSpace.thickness=1,i._grid.addControl(i._horizontalBarSpace,1,0),i._horizontalBarSpace.addControl(i._horizontalBar),i._horizontalBar.onValueChangedObservable.add(function(t){i._window.left=t*i._endLeft+"px"}),i._dragSpace=new f,i._dragSpace.thickness=1,i._grid.addControl(i._dragSpace,1,1),i.barColor="grey",i.barBackground="transparent",i}return n(e,t),Object.defineProperty(e.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),e.prototype.addControl=function(t){return t?(this._window.addControl(t),this):this},e.prototype.removeControl=function(t){return this._window.removeControl(t),this},Object.defineProperty(e.prototype,"children",{get:function(){return this._window.children},enumerable:!0,configurable:!0}),e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t=0,e=this._children;t<e.length;t++)e[t]._markMatrixAsDirty()},e.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},e.prototype._getTypeName=function(){return"ScrollViewer"},e.prototype._buildClientSizes=function(){this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible?this._barSize:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible?this._barSize:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._buildClientSizes()},e.prototype._postMeasure=function(){t.prototype._postMeasure.call(this),this._updateScroller()},Object.defineProperty(e.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(t){this._wheelPrecision!==t&&(t<0&&(t=0),t>1&&(t=1),this._wheelPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barColor",{get:function(){return this._barColor},set:function(t){this._barColor!==t&&(this._barColor=t,this._horizontalBar.color=t,this._verticalBar.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barSize",{get:function(){return this._barSize},set:function(t){this._barSize!==t&&(this._barSize=t,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barBackground",{get:function(){return this._barBackground},set:function(t){this._barBackground!==t&&(this._barBackground=t,this._horizontalBar.background=t,this._verticalBar.background=t,this._dragSpace.background=t)},enumerable:!0,configurable:!0}),e.prototype._updateScroller=function(){var t=this._window._currentMeasure.width,e=this._window._currentMeasure.height;this._horizontalBar.isVisible&&t<=this._clientWidth?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&t>this._clientWidth&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&e<=this._clientHeight?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&e>this._clientHeight&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes(),this._endLeft=this._clientWidth-t,this._endTop=this._clientHeight-e;var i=this._horizontalBar.value*this._endLeft+"px",r=this._verticalBar.value*this._endTop+"px";i!==this._window.left&&(this._window.left=i,this._rebuildLayout=!0),r!==this._window.top&&(this._window.top=r,this._rebuildLayout=!0);var n=this._clientWidth/t,o=this._clientHeight/e;this._horizontalBar.thumbWidth=this._clientWidth*n+"px",this._verticalBar.thumbWidth=this._clientHeight*o+"px"},e.prototype._link=function(e){t.prototype._link.call(this,e),this._attachWheel()},e.prototype._attachWheel=function(){var t=this;if(this._host&&!this._onPointerObserver){var e=this._host.getScene();this._onPointerObserver=e.onPointerObservable.add(function(e,i){t._pointerIsOver&&e.type===h.PointerEventTypes.POINTERWHEEL&&(1==t._verticalBar.isVisible&&(e.event.deltaY<0&&t._verticalBar.value>0?t._verticalBar.value-=t._wheelPrecision:e.event.deltaY>0&&t._verticalBar.value<t._verticalBar.maximum&&(t._verticalBar.value+=t._wheelPrecision)),1==t._horizontalBar.isVisible&&(e.event.deltaX<0&&t._horizontalBar.value<t._horizontalBar.maximum?t._horizontalBar.value+=t._wheelPrecision:e.event.deltaX>0&&t._horizontalBar.value>0&&(t._horizontalBar.value-=t._wheelPrecision)))})}},e.prototype._renderHighlightSpecific=function(e){this.isHighlighted&&(t.prototype._renderHighlightSpecific.call(this,e),this._grid._renderHighlightSpecific(e),e.restore())},e.prototype.dispose=function(){var e=this._host.getScene();e&&this._onPointerObserver&&(e.onPointerObservable.remove(this._onPointerObserver),this._onPointerObserver=null),t.prototype.dispose.call(this)},e}(f),V=function(){return function(){}}(),F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onKeyPressObservable=new h.Observable,e.defaultButtonWidth="40px",e.defaultButtonHeight="40px",e.defaultButtonPaddingLeft="2px",e.defaultButtonPaddingRight="2px",e.defaultButtonPaddingTop="2px",e.defaultButtonPaddingBottom="2px",e.defaultButtonColor="#DDD",e.defaultButtonBackground="#070707",e.shiftButtonColor="#7799FF",e.selectedShiftThickness=1,e.shiftState=0,e._currentlyConnectedInputText=null,e._connectedInputTexts=[],e._onKeyPressObserver=null,e}return n(e,t),e.prototype._getTypeName=function(){return"VirtualKeyboard"},e.prototype._createKey=function(t,e){var i=this,r=b.CreateSimpleButton(t,t);return r.width=e&&e.width?e.width:this.defaultButtonWidth,r.height=e&&e.height?e.height:this.defaultButtonHeight,r.color=e&&e.color?e.color:this.defaultButtonColor,r.background=e&&e.background?e.background:this.defaultButtonBackground,r.paddingLeft=e&&e.paddingLeft?e.paddingLeft:this.defaultButtonPaddingLeft,r.paddingRight=e&&e.paddingRight?e.paddingRight:this.defaultButtonPaddingRight,r.paddingTop=e&&e.paddingTop?e.paddingTop:this.defaultButtonPaddingTop,r.paddingBottom=e&&e.paddingBottom?e.paddingBottom:this.defaultButtonPaddingBottom,r.thickness=0,r.isFocusInvisible=!0,r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY,r.onPointerUpObservable.add(function(){i.onKeyPressObservable.notifyObservers(t)}),r},e.prototype.addKeysRow=function(t,e){var i=new m;i.isVertical=!1,i.isFocusInvisible=!0;for(var r=null,n=0;n<t.length;n++){var o=null;e&&e.length===t.length&&(o=e[n]);var s=this._createKey(t[n],o);(!r||s.heightInPixels>r.heightInPixels)&&(r=s),i.addControl(s)}i.height=r?r.height:this.defaultButtonHeight,this.addControl(i)},e.prototype.applyShiftState=function(t){if(this.children)for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i&&i.children)for(var r=i,n=0;n<r.children.length;n++){var o=r.children[n];if(o&&o.children[0]){var s=o.children[0];"⇧"===s.text&&(o.color=t?this.shiftButtonColor:this.defaultButtonColor,o.thickness=t>1?this.selectedShiftThickness:0),s.text=t>0?s.text.toUpperCase():s.text.toLowerCase()}}}},Object.defineProperty(e.prototype,"connectedInputText",{get:function(){return this._currentlyConnectedInputText},enumerable:!0,configurable:!0}),e.prototype.connect=function(t){var e=this;if(!this._connectedInputTexts.some(function(e){return e.input===t})){null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add(function(t){if(e._currentlyConnectedInputText){switch(e._currentlyConnectedInputText._host.focusedControl=e._currentlyConnectedInputText,t){case"⇧":return e.shiftState++,e.shiftState>2&&(e.shiftState=0),void e.applyShiftState(e.shiftState);case"←":return void e._currentlyConnectedInputText.processKey(8);case"↵":return void e._currentlyConnectedInputText.processKey(13)}e._currentlyConnectedInputText.processKey(-1,e.shiftState?t.toUpperCase():t),1===e.shiftState&&(e.shiftState=0,e.applyShiftState(e.shiftState))}})),this.isVisible=!1,this._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=this;var i=t.onFocusObservable.add(function(){e._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=e,e.isVisible=!0}),r=t.onBlurObservable.add(function(){t._connectedVirtualKeyboard=null,e._currentlyConnectedInputText=null,e.isVisible=!1});this._connectedInputTexts.push({input:t,onBlurObserver:r,onFocusObserver:i})}},e.prototype.disconnect=function(t){var e=this;if(t){var i=this._connectedInputTexts.filter(function(e){return e.input===t});1===i.length&&(this._removeConnectedInputObservables(i[0]),this._connectedInputTexts=this._connectedInputTexts.filter(function(e){return e.input!==t}),this._currentlyConnectedInputText===t&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach(function(t){e._removeConnectedInputObservables(t)}),this._connectedInputTexts=[];0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)},e.prototype._removeConnectedInputObservables=function(t){t.input._connectedVirtualKeyboard=null,t.input.onFocusObservable.remove(t.onFocusObserver),t.input.onBlurObservable.remove(t.onBlurObserver)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.disconnect()},e.CreateDefaultLayout=function(t){var i=new e(t);return i.addKeysRow(["1","2","3","4","5","6","7","8","9","0","←"]),i.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),i.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","↵"]),i.addKeysRow(["⇧","z","x","c","v","b","n","m",",",".","/"]),i.addKeysRow([" "],[{width:"200px"}]),i},e}(m),j=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._cellWidth=20,i._cellHeight=20,i._minorLineTickness=1,i._minorLineColor="DarkGray",i._majorLineTickness=2,i._majorLineColor="White",i._majorLineFrequency=5,i._background="Black",i._displayMajorLines=!0,i._displayMinorLines=!0,i}return n(e,t),Object.defineProperty(e.prototype,"displayMinorLines",{get:function(){return this._displayMinorLines},set:function(t){this._displayMinorLines!==t&&(this._displayMinorLines=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayMajorLines",{get:function(){return this._displayMajorLines},set:function(t){this._displayMajorLines!==t&&(this._displayMajorLines=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(t){this._cellWidth=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(t){this._cellHeight=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minorLineTickness",{get:function(){return this._minorLineTickness},set:function(t){this._minorLineTickness=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minorLineColor",{get:function(){return this._minorLineColor},set:function(t){this._minorLineColor=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"majorLineTickness",{get:function(){return this._majorLineTickness},set:function(t){this._majorLineTickness=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"majorLineColor",{get:function(){return this._majorLineColor},set:function(t){this._majorLineColor=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"majorLineFrequency",{get:function(){return this._majorLineFrequency},set:function(t){this._majorLineFrequency=t,this._markAsDirty()},enumerable:!0,configurable:!0}),e.prototype._draw=function(t){if(t.save(),this._applyStates(t),this._isEnabled){this._background&&(t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));var e=this._currentMeasure.width/this._cellWidth,i=this._currentMeasure.height/this._cellHeight,r=this._currentMeasure.left+this._currentMeasure.width/2,n=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){t.strokeStyle=this._minorLineColor,t.lineWidth=this._minorLineTickness;for(var o=-e/2;o<e/2;o++){var s=r+o*this.cellWidth;t.beginPath(),t.moveTo(s,this._currentMeasure.top),t.lineTo(s,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(var h=-i/2;h<i/2;h++){var a=n+h*this.cellHeight;t.beginPath(),t.moveTo(this._currentMeasure.left,a),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,a),t.stroke()}}if(this._displayMajorLines){for(t.strokeStyle=this._majorLineColor,t.lineWidth=this._majorLineTickness,o=-e/2+this._majorLineFrequency;o<e/2;o+=this._majorLineFrequency)s=r+o*this.cellWidth,t.beginPath(),t.moveTo(s,this._currentMeasure.top),t.lineTo(s,this._currentMeasure.top+this._currentMeasure.height),t.stroke();for(h=-i/2+this._majorLineFrequency;h<i/2;h+=this._majorLineFrequency)a=n+h*this.cellHeight,t.moveTo(this._currentMeasure.left,a),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,a),t.closePath(),t.stroke()}}t.restore()},e.prototype._getTypeName=function(){return"DisplayGrid"},e}(_),W=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._tempMeasure=new l(0,0,0,0),i}return n(e,t),Object.defineProperty(e.prototype,"displayThumb",{get:function(){return this._displayThumb&&null!=this.thumbImage},set:function(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundImage",{get:function(){return this._backgroundImage},set:function(t){var e=this;this._backgroundImage!==t&&(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){return e._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueBarImage",{get:function(){return this._valueBarImage},set:function(t){var e=this;this._valueBarImage!==t&&(this._valueBarImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){return e._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbImage",{get:function(){return this._thumbImage},set:function(t){var e=this;this._thumbImage!==t&&(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce(function(){return e._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"ImageBasedSlider"},e.prototype._draw=function(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");var e=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,n,o),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(t)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,r+e,n,o-e+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(i,r+e,n,o-e):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(i,r,e+this._effectiveThumbThickness/2,o):this._tempMeasure.copyFromFloats(i,r,e,o),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(t)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset,this._currentMeasure.top+e,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+e,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t)),t.restore()},e}(I);_.AddHeader=function(t,e,i,r){var n=new m("panel"),o=!r||r.isHorizontal,s=!r||r.controlFirst;n.isVertical=!o;var h=new p("header");return h.text=e,h.textHorizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,o?h.width=i:h.height=i,s?(n.addControl(t),n.addControl(h),h.paddingLeft="5px"):(n.addControl(h),n.addControl(t),h.paddingRight="5px"),h.shadowBlur=t.shadowBlur,h.shadowColor=t.shadowColor,h.shadowOffsetX=t.shadowOffsetX,h.shadowOffsetY=t.shadowOffsetY,n};var z=function(){function t(t){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new a(18,a.UNITMODE_PIXEL,!1),this.onChangedObservable=new h.Observable,this._host=t}return Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&this.onChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.onChangedObservable.clear()},t}(),G=function(t){function e(e,i,r,n,o,s){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=!1),void 0===s&&(s=h.Texture.NEAREST_SAMPLINGMODE);var a=t.call(this,e,{width:i,height:r},n,o,s,h.Engine.TEXTUREFORMAT_RGBA)||this;return a._isDirty=!1,a._rootContainer=new d("root"),a._lastControlOver={},a._lastControlDown={},a._capturingControl={},a._linkedControls=new Array,a._isFullscreen=!1,a._fullscreenViewport=new h.Viewport(0,0,1,1),a._idealWidth=0,a._idealHeight=0,a._useSmallestIdeal=!1,a._renderAtIdealSize=!1,a._blockNextFocusCheck=!1,a._renderScale=1,a._cursorChanged=!1,a._clipboardData="",a.onClipboardObservable=new h.Observable,a.onControlPickedObservable=new h.Observable,a.onBeginLayoutObservable=new h.Observable,a.onEndLayoutObservable=new h.Observable,a.onBeginRenderObservable=new h.Observable,a.onEndRenderObservable=new h.Observable,a.premulAlpha=!1,a._useInvalidateRectOptimization=!0,a._invalidatedRectangle=null,a._clearMeasure=new l(0,0,0,0),a.onClipboardCopy=function(t){var e=t,i=new h.ClipboardInfo(h.ClipboardEventTypes.COPY,e);a.onClipboardObservable.notifyObservers(i),e.preventDefault()},a.onClipboardCut=function(t){var e=t,i=new h.ClipboardInfo(h.ClipboardEventTypes.CUT,e);a.onClipboardObservable.notifyObservers(i),e.preventDefault()},a.onClipboardPaste=function(t){var e=t,i=new h.ClipboardInfo(h.ClipboardEventTypes.PASTE,e);a.onClipboardObservable.notifyObservers(i),e.preventDefault()},(n=a.getScene())&&a._texture?(a._rootCanvas=n.getEngine().getRenderingCanvas(),a._renderObserver=n.onBeforeCameraRenderObservable.add(function(t){return a._checkUpdate(t)}),a._preKeyboardObserver=n.onPreKeyboardObservable.add(function(t){a._focusedControl&&(t.type===h.KeyboardEventTypes.KEYDOWN&&a._focusedControl.processKeyboard(t.event),t.skipOnPointerObservable=!0)}),a._rootContainer._link(a),a.hasAlpha=!0,i&&r||(a._resizeObserver=n.getEngine().onResizeObservable.add(function(){return a._onResize()}),a._onResize()),a._texture.isReady=!0,a):a}return n(e,t),Object.defineProperty(e.prototype,"renderScale",{get:function(){return this._renderScale},set:function(t){t!==this._renderScale&&(this._renderScale=t,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this.markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(t){this._idealWidth!==t&&(this._idealWidth=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(t){this._idealHeight!==t&&(this._idealHeight=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(t){this._useSmallestIdeal!==t&&(this._useSmallestIdeal=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(t){this._renderAtIdealSize!==t&&(this._renderAtIdealSize=t,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),e.prototype.getChildren=function(){return[this._rootContainer]},e.prototype.getDescendants=function(t,e){return this._rootContainer.getDescendants(t,e)},Object.defineProperty(e.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(t){this._focusedControl!=t&&(this._focusedControl&&this._focusedControl.onBlur(),t&&t.onFocus(),this._focusedControl=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(t){this.layer&&this.layer.isBackground!==!t&&(this.layer.isBackground=!t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(t){this._clipboardData=t},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"AdvancedDynamicTexture"},e.prototype.executeOnAllControls=function(t,e){e||(e=this._rootContainer),t(e);for(var i=0,r=e.children;i<r.length;i++){var n=r[i];n.children?this.executeOnAllControls(t,n):t(n)}},Object.defineProperty(e.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(t){this._useInvalidateRectOptimization=t},enumerable:!0,configurable:!0}),e.prototype.invalidateRect=function(t,e,i,r){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){var n=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,r));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,t)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,e)),this._invalidatedRectangle.width=n-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new l(t,e,i-t+1,r-e+1)},e.prototype.markAsDirty=function(){this._isDirty=!0},e.prototype.createStyle=function(){return new z(this)},e.prototype.addControl=function(t){return this._rootContainer.addControl(t),this},e.prototype.removeControl=function(t){return this._rootContainer.removeControl(t),this},e.prototype.dispose=function(){var e=this.getScene();e&&(this._rootCanvas=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&e.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),t.prototype.dispose.call(this))},e.prototype._onResize=function(){var t=this.getScene();if(t){var e=t.getEngine(),i=this.getSize(),r=e.getRenderWidth()*this._renderScale,n=e.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(n=n*this._idealWidth/r,r=this._idealWidth):this._idealHeight&&(r=r*this._idealHeight/n,n=this._idealHeight)),i.width===r&&i.height===n||(this.scaleTo(r,n),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,i.width-1,i.height-1)}},e.prototype._getGlobalViewport=function(t){var e=t.getEngine();return this._fullscreenViewport.toGlobal(e.getRenderWidth(),e.getRenderHeight())},e.prototype.getProjectedPosition=function(t,e){var i=this.getScene();if(!i)return h.Vector2.Zero();var r=this._getGlobalViewport(i),n=h.Vector3.Project(t,e,i.getTransformMatrix(),r);return n.scaleInPlace(this.renderScale),new h.Vector2(n.x,n.y)},e.prototype._checkUpdate=function(t){if(!this._layerToDispose||0!=(t.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var e=this.getScene();if(!e)return;for(var i=this._getGlobalViewport(e),r=0,n=this._linkedControls;r<n.length;r++){var o=n[r];if(o.isVisible){var s=o._linkedMesh;if(s&&!s.isDisposed()){var a=s.getBoundingInfo?s.getBoundingInfo().boundingSphere.center:s.getAbsolutePosition(),l=h.Vector3.Project(a,s.getWorldMatrix(),e.getTransformMatrix(),i);l.z<0||l.z>1?o.notRenderable=!0:(o.notRenderable=!1,l.scaleInPlace(this.renderScale),o._moveToProjectedPosition(l))}else h.Tools.SetImmediate(function(){o.linkWithMesh(null)})}}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(!0,this.premulAlpha))}},e.prototype._render=function(){var t=this.getSize(),e=t.width,i=t.height,r=this.getContext();r.font="18px Arial",r.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var n=new l(0,0,e,i);this._rootContainer._layout(n,r),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,e,i),r.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(r.save(),r.fillStyle=this._background,r.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),r.restore()),this.onBeginRenderObservable.notifyObservers(this),this._rootContainer._render(r,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},e.prototype._changeCursor=function(t){this._rootCanvas&&(this._rootCanvas.style.cursor=t,this._cursorChanged=!0)},e.prototype._registerLastControlDown=function(t,e){this._lastControlDown[e]=t,this.onControlPickedObservable.notifyObservers(t)},e.prototype._doPicking=function(t,e,i,r,n){var o=this.getScene();if(o){var s=o.getEngine(),a=this.getSize();if(this._isFullscreen){var l=(o.cameraToUseForPointers||o.activeCamera).viewport;t*=a.width/(s.getRenderWidth()*l.width),e*=a.height/(s.getRenderHeight()*l.height)}this._capturingControl[r]?this._capturingControl[r]._processObservables(i,t,e,r,n):(this._cursorChanged=!1,this._rootContainer._processPicking(t,e,i,r,n)||(this._changeCursor(""),i===h.PointerEventTypes.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r]),delete this._lastControlOver[r])),this._cursorChanged||this._changeCursor(""),this._manageFocus())}},e.prototype._cleanControlAfterRemovalFromList=function(t,e){for(var i in t)t.hasOwnProperty(i)&&t[i]===e&&delete t[i]},e.prototype._cleanControlAfterRemoval=function(t){this._cleanControlAfterRemovalFromList(this._lastControlDown,t),this._cleanControlAfterRemovalFromList(this._lastControlOver,t)},e.prototype.attach=function(){var t=this,e=this.getScene();if(e){var i=new h.Viewport(0,0,0,0);this._pointerMoveObserver=e.onPrePointerObservable.add(function(r,n){if(!e.isPointerCaptured(r.event.pointerId)&&(r.type===h.PointerEventTypes.POINTERMOVE||r.type===h.PointerEventTypes.POINTERUP||r.type===h.PointerEventTypes.POINTERDOWN)&&e){var o=e.cameraToUseForPointers||e.activeCamera,s=e.getEngine();o?o.viewport.toGlobalToRef(s.getRenderWidth(),s.getRenderHeight(),i):(i.x=0,i.y=0,i.width=s.getRenderWidth(),i.height=s.getRenderHeight());var a=e.pointerX/s.getHardwareScalingLevel()-i.x,l=e.pointerY/s.getHardwareScalingLevel()-(s.getRenderHeight()-i.y-i.height);t._shouldBlockPointer=!1,t._doPicking(a,l,r.type,r.event.pointerId||0,r.event.button),t._shouldBlockPointer&&(r.skipOnPointerObservable=t._shouldBlockPointer)}}),this._attachToOnPointerOut(e)}},e.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},e.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},e.prototype.attachToMesh=function(t,e){var i=this;void 0===e&&(e=!0);var r=this.getScene();r&&(this._pointerObserver=r.onPointerObservable.add(function(e,r){if(e.type===h.PointerEventTypes.POINTERMOVE||e.type===h.PointerEventTypes.POINTERUP||e.type===h.PointerEventTypes.POINTERDOWN){var n=e.event.pointerId||0;if(e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh===t){var o=e.pickInfo.getTextureCoordinates();if(o){var s=i.getSize();i._doPicking(o.x*s.width,(1-o.y)*s.height,e.type,n,e.event.button)}}else if(e.type===h.PointerEventTypes.POINTERUP){if(i._lastControlDown[n]&&i._lastControlDown[n]._forcePointerUp(n),delete i._lastControlDown[n],i.focusedControl){var a=i.focusedControl.keepsFocusWith(),l=!0;if(a)for(var u=0,c=a;u<c.length;u++){var _=c[u];if(i!==_._host){var d=_._host;if(d._lastControlOver[n]&&d._lastControlOver[n].isAscendant(_)){l=!1;break}}}l&&(i.focusedControl=null)}}else e.type===h.PointerEventTypes.POINTERMOVE&&(i._lastControlOver[n]&&i._lastControlOver[n]._onPointerOut(i._lastControlOver[n],!0),delete i._lastControlOver[n])}}),t.enablePointerMoveEvents=e,this._attachToOnPointerOut(r))},e.prototype.moveFocusToControl=function(t){this.focusedControl=t,this._lastPickedControl=t,this._blockNextFocusCheck=!0},e.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},e.prototype._attachToOnPointerOut=function(t){var e=this;this._canvasPointerOutObserver=t.getEngine().onCanvasPointerOutObservable.add(function(t){e._lastControlOver[t.pointerId]&&e._lastControlOver[t.pointerId]._onPointerOut(e._lastControlOver[t.pointerId]),delete e._lastControlOver[t.pointerId],e._lastControlDown[t.pointerId]&&e._lastControlDown[t.pointerId]!==e._capturingControl[t.pointerId]&&(e._lastControlDown[t.pointerId]._forcePointerUp(),delete e._lastControlDown[t.pointerId])})},e.CreateForMesh=function(t,i,r,n,o){void 0===i&&(i=1024),void 0===r&&(r=1024),void 0===n&&(n=!0),void 0===o&&(o=!1);var s=new e(t.name+" AdvancedDynamicTexture",i,r,t.getScene(),!0,h.Texture.TRILINEAR_SAMPLINGMODE),a=new h.StandardMaterial("AdvancedDynamicTextureMaterial",t.getScene());return a.backFaceCulling=!1,a.diffuseColor=h.Color3.Black(),a.specularColor=h.Color3.Black(),o?(a.diffuseTexture=s,a.emissiveTexture=s,s.hasAlpha=!0):(a.emissiveTexture=s,a.opacityTexture=s),t.material=a,s.attachToMesh(t,n),s},e.CreateFullscreenUI=function(t,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=h.Texture.BILINEAR_SAMPLINGMODE);var o=new e(t,0,0,r,!1,n),s=new h.Layer(t+"_layer",null,r,!i);return s.texture=o,o._layerToDispose=s,o._isFullscreen=!0,o.attach(),o},e}(h.DynamicTexture),X=function(){function t(t){this.texture=t,this._captureRenderTime=!1,this._renderTime=new h.PerfCounter,this._captureLayoutTime=!1,this._layoutTime=new h.PerfCounter,this._onBeginRenderObserver=null,this._onEndRenderObserver=null,this._onBeginLayoutObserver=null,this._onEndLayoutObserver=null}return Object.defineProperty(t.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutTimeCounter",{get:function(){return this._layoutTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var e=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeginRenderObserver=this.texture.onBeginRenderObservable.add(function(){e._renderTime.beginMonitoring()}),this._onEndRenderObserver=this.texture.onEndRenderObservable.add(function(){e._renderTime.endMonitoring(!0)})):(this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureLayoutTime",{get:function(){return this._captureLayoutTime},set:function(t){var e=this;t!==this._captureLayoutTime&&(this._captureLayoutTime=t,t?(this._onBeginLayoutObserver=this.texture.onBeginLayoutObservable.add(function(){e._layoutTime.beginMonitoring()}),this._onEndLayoutObserver=this.texture.onEndLayoutObservable.add(function(){e._layoutTime.endMonitoring(!0)})):(this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null,this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null,this.texture=null},t}(),Y=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this,e.x,e.y,e.z)||this;return r.buttonIndex=i,r}return n(e,t),e}(h.Vector3),U=function(){function t(t){this.name=t,this._downCount=0,this._enterCount=-1,this._downPointerIds={},this._isVisible=!0,this.onPointerMoveObservable=new h.Observable,this.onPointerOutObservable=new h.Observable,this.onPointerDownObservable=new h.Observable,this.onPointerUpObservable=new h.Observable,this.onPointerClickObservable=new h.Observable,this.onPointerEnterObservable=new h.Observable,this._behaviors=new Array}return Object.defineProperty(t.prototype,"position",{get:function(){return this._node?this._node.position:h.Vector3.Zero()},set:function(t){this._node&&(this._node.position=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._node?this._node.scaling:new h.Vector3(1,1,1)},set:function(t){this._node&&(this._node.scaling=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),t.prototype.addBehavior=function(t){var e=this;if(-1!==this._behaviors.indexOf(t))return this;t.init();var i=this._host.scene;return i.isLoading?i.onDataLoadedObservable.addOnce(function(){t.attach(e)}):t.attach(this),this._behaviors.push(t),this},t.prototype.removeBehavior=function(t){var e=this._behaviors.indexOf(t);return-1===e?this:(this._behaviors[e].detach(),this._behaviors.splice(e,1),this)},t.prototype.getBehaviorByName=function(t){for(var e=0,i=this._behaviors;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},set:function(t){if(this._isVisible!==t){this._isVisible=t;var e=this.mesh;e&&e.setEnabled(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return this._getTypeName()},t.prototype._getTypeName=function(){return"Control3D"},Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._node instanceof h.AbstractMesh?this._node:null},enumerable:!0,configurable:!0}),t.prototype.linkToTransformNode=function(t){return this._node&&(this._node.parent=t),this},t.prototype._prepareNode=function(t){if(!this._node){if(this._node=this._createNode(t),!this.node)return;this._node.metadata=this,this._node.position=this.position,this._node.scaling=this.scaling;var e=this.mesh;e&&(e.isPickable=!0,this._affectMaterial(e))}},t.prototype._createNode=function(t){return null},t.prototype._affectMaterial=function(t){t.material=null},t.prototype._onPointerMove=function(t,e){this.onPointerMoveObservable.notifyObservers(e,-1,t,this)},t.prototype._onPointerEnter=function(t){return!(this._enterCount>0||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this),this.pointerEnterAnimation&&this.pointerEnterAnimation(),0))},t.prototype._onPointerOut=function(t){this._enterCount=0,this.onPointerOutObservable.notifyObservers(this,-1,t,this),this.pointerOutAnimation&&this.pointerOutAnimation()},t.prototype._onPointerDown=function(t,e,i,r){return 0!==this._downCount?(this._downCount++,!1):(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new Y(e,r),-1,t,this),this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},t.prototype._onPointerUp=function(t,e,i,r,n){this._downCount--,delete this._downPointerIds[i],this._downCount<0?this._downCount=0:0==this._downCount&&(n&&(this._enterCount>0||-1===this._enterCount)&&this.onPointerClickObservable.notifyObservers(new Y(e,r),-1,t,this),this.onPointerUpObservable.notifyObservers(new Y(e,r),-1,t,this),this.pointerUpAnimation&&this.pointerUpAnimation())},t.prototype.forcePointerUp=function(t){if(void 0===t&&(t=null),null!==t)this._onPointerUp(this,h.Vector3.Zero(),t,0,!0);else{for(var e in this._downPointerIds)this._onPointerUp(this,h.Vector3.Zero(),+e,0,!0);this._downCount>0&&(this._downCount=1,this._onPointerUp(this,h.Vector3.Zero(),0,0,!0))}},t.prototype._processObservables=function(t,e,i,r){if(t===h.PointerEventTypes.POINTERMOVE){this._onPointerMove(this,e);var n=this._host._lastControlOver[i];return n&&n!==this&&n._onPointerOut(this),n!==this&&this._onPointerEnter(this),this._host._lastControlOver[i]=this,!0}return t===h.PointerEventTypes.POINTERDOWN?(this._onPointerDown(this,e,i,r),this._host._lastControlDown[i]=this,this._host._lastPickedControl=this,!0):t===h.PointerEventTypes.POINTERUP&&(this._host._lastControlDown[i]&&this._host._lastControlDown[i]._onPointerUp(this,e,i,r,!0),delete this._host._lastControlDown[i],!0)},t.prototype._disposeNode=function(){this._node&&(this._node.dispose(),this._node=null)},t.prototype.dispose=function(){this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._disposeNode();for(var t=0,e=this._behaviors;t<e.length;t++)e[t].detach()},t}(),K=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._getTypeName=function(){return"AbstractButton3D"},e.prototype._createNode=function(t){return new h.TransformNode("button"+this.name)},e}(U),q=function(t){function e(e){var i=t.call(this,e)||this;return i._contentResolution=512,i._contentScaleRatio=2,i.pointerEnterAnimation=function(){i.mesh&&(i._currentMaterial.emissiveColor=h.Color3.Red())},i.pointerOutAnimation=function(){i._currentMaterial.emissiveColor=h.Color3.Black()},i.pointerDownAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(.95)},i.pointerUpAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(1/.95)},i}return n(e,t),Object.defineProperty(e.prototype,"contentResolution",{get:function(){return this._contentResolution},set:function(t){this._contentResolution!==t&&(this._contentResolution=t,this._resetContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentScaleRatio",{get:function(){return this._contentScaleRatio},set:function(t){this._contentScaleRatio!==t&&(this._contentScaleRatio=t,this._resetContent())},enumerable:!0,configurable:!0}),e.prototype._disposeFacadeTexture=function(){this._facadeTexture&&(this._facadeTexture.dispose(),this._facadeTexture=null)},e.prototype._resetContent=function(){this._disposeFacadeTexture(),this.content=this._content},Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t,this._host&&this._host.utilityLayer&&(this._facadeTexture||(this._facadeTexture=new G("Facade",this._contentResolution,this._contentResolution,this._host.utilityLayer.utilityLayerScene,!0,h.Texture.TRILINEAR_SAMPLINGMODE),this._facadeTexture.rootContainer.scaleX=this._contentScaleRatio,this._facadeTexture.rootContainer.scaleY=this._contentScaleRatio,this._facadeTexture.premulAlpha=!0),this._facadeTexture.addControl(t),this._applyFacade(this._facadeTexture))},enumerable:!0,configurable:!0}),e.prototype._applyFacade=function(t){this._currentMaterial.emissiveTexture=t},e.prototype._getTypeName=function(){return"Button3D"},e.prototype._createNode=function(t){for(var e=new Array(6),i=0;i<6;i++)e[i]=new h.Vector4(0,0,0,0);return e[1]=new h.Vector4(0,0,1,1),h.BoxBuilder.CreateBox(this.name+"_rootMesh",{width:1,height:1,depth:.08,faceUV:e},t)},e.prototype._affectMaterial=function(t){var e=new h.StandardMaterial(this.name+"Material",t.getScene());e.specularColor=h.Color3.Black(),t.material=e,this._currentMaterial=e,this._resetContent()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._disposeFacadeTexture(),this._currentMaterial&&this._currentMaterial.dispose()},e}(K),Z=function(t){function e(e){var i=t.call(this,e)||this;return i._blockLayout=!1,i._children=new Array,i}return n(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockLayout",{get:function(){return this._blockLayout},set:function(t){this._blockLayout!==t&&(this._blockLayout=t,this._blockLayout||this._arrangeChildren())},enumerable:!0,configurable:!0}),e.prototype.updateLayout=function(){return this._arrangeChildren(),this},e.prototype.containsControl=function(t){return-1!==this._children.indexOf(t)},e.prototype.addControl=function(t){return-1!==this._children.indexOf(t)?this:(t.parent=this,t._host=this._host,this._children.push(t),this._host.utilityLayer&&(t._prepareNode(this._host.utilityLayer.utilityLayerScene),t.node&&(t.node.parent=this.node),this.blockLayout||this._arrangeChildren()),this)},e.prototype._arrangeChildren=function(){},e.prototype._createNode=function(t){return new h.TransformNode("ContainerNode",t)},e.prototype.removeControl=function(t){var e=this._children.indexOf(t);return-1!==e&&(this._children.splice(e,1),t.parent=null,t._disposeNode()),this},e.prototype._getTypeName=function(){return"Container3D"},e.prototype.dispose=function(){for(var e=0,i=this._children;e<i.length;e++)i[e].dispose();this._children=[],t.prototype.dispose.call(this)},e.UNSET_ORIENTATION=0,e.FACEORIGIN_ORIENTATION=1,e.FACEORIGINREVERSED_ORIENTATION=2,e.FACEFORWARD_ORIENTATION=3,e.FACEFORWARDREVERSED_ORIENTATION=4,e}(U),J=function(t){function e(){var e=t.call(this)||this;return e._columns=10,e._rows=0,e._rowThenColum=!0,e._orientation=Z.FACEORIGIN_ORIENTATION,e.margin=0,e}return n(e,t),Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation},set:function(t){var e=this;this._orientation!==t&&(this._orientation=t,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},set:function(t){var e=this;this._columns!==t&&(this._columns=t,this._rowThenColum=!0,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},set:function(t){var e=this;this._rows!==t&&(this._rows=t,this._rowThenColum=!1,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),e.prototype._arrangeChildren=function(){this._cellWidth=0,this._cellHeight=0;for(var t=0,e=0,i=0,r=h.Matrix.Invert(this.node.computeWorldMatrix(!0)),n=0,o=this._children;n<o.length;n++)if((m=o[n]).mesh){i++,m.mesh.computeWorldMatrix(!0);var s=m.mesh.getHierarchyBoundingVectors(),a=h.Tmp.Vector3[0],l=h.Tmp.Vector3[1];s.max.subtractToRef(s.min,l),l.scaleInPlace(.5),h.Vector3.TransformNormalToRef(l,r,a),this._cellWidth=Math.max(this._cellWidth,2*a.x),this._cellHeight=Math.max(this._cellHeight,2*a.y)}this._cellWidth+=2*this.margin,this._cellHeight+=2*this.margin,this._rowThenColum?(e=this._columns,t=Math.ceil(i/this._columns)):(t=this._rows,e=Math.ceil(i/this._rows));var u=.5*e*this._cellWidth,c=.5*t*this._cellHeight,_=[],d=0;if(this._rowThenColum)for(var f=0;f<t;f++)for(var p=0;p<e&&(_.push(new h.Vector3(p*this._cellWidth-u+this._cellWidth/2,f*this._cellHeight-c+this._cellHeight/2,0)),!(++d>i));p++);else for(p=0;p<e;p++)for(f=0;f<t&&(_.push(new h.Vector3(p*this._cellWidth-u+this._cellWidth/2,f*this._cellHeight-c+this._cellHeight/2,0)),!(++d>i));f++);d=0;for(var g=0,b=this._children;g<b.length;g++){var m;(m=b[g]).mesh&&(this._mapGridNode(m,_[d]),d++)}this._finalProcessing()},e.prototype._finalProcessing=function(){},e}(Z),Q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=5,e}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){var e=this;this._radius!==t&&(this._radius=t,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),e.prototype._mapGridNode=function(t,e){var i=t.mesh;if(i){var r=this._cylindricalMapping(e);switch(t.position=r,this.orientation){case Z.FACEORIGIN_ORIENTATION:i.lookAt(new h.Vector3(2*r.x,r.y,2*r.z));break;case Z.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new h.Vector3(-r.x,r.y,-r.z));break;case Z.FACEFORWARD_ORIENTATION:break;case Z.FACEFORWARDREVERSED_ORIENTATION:i.rotate(h.Axis.Y,Math.PI,h.Space.LOCAL)}}},e.prototype._cylindricalMapping=function(t){var e=new h.Vector3(0,t.y,this._radius),i=t.x/this._radius;return h.Matrix.RotationYawPitchRollToRef(i,0,0,h.Tmp.Matrix[0]),h.Vector3.TransformNormal(e,h.Tmp.Matrix[0])},e}(J);h.Effect.ShadersStore.fluentVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 world;\nuniform mat4 viewProjection;\nvarying vec2 vUV;\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float borderWidth;\nuniform vec3 scaleFactor;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\n#endif\nvoid main(void) {\nvUV=uv;\n#ifdef BORDER\nvec3 scale=scaleFactor;\nfloat minScale=min(min(scale.x,scale.y),scale.z);\nfloat maxScale=max(max(scale.x,scale.y),scale.z);\nfloat minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);\nfloat areaYZ=scale.y*scale.z;\nfloat areaXZ=scale.x*scale.z;\nfloat areaXY=scale.x*scale.y;\nfloat scaledBorderWidth=borderWidth;\nif (abs(normal.x) == 1.0)\n{\nscale.x=scale.y;\nscale.y=scale.z;\nif (areaYZ>areaXZ && areaYZ>areaXY)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse if (abs(normal.y) == 1.0)\n{\nscale.x=scale.z;\nif (areaXZ>areaXY && areaXZ>areaYZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse\n{\nif (areaXY>areaYZ && areaXY>areaXZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nfloat scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);\nif (scale.x>scale.y)\n{\nscaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);\nscaleInfo.y=1.0-scaledBorderWidth;\n}\nelse\n{\nscaleInfo.x=1.0-scaledBorderWidth;\nscaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);\n}\n#endif\nvec4 worldPos=world*vec4(position,1.0);\n#ifdef HOVERLIGHT\nworldPosition=worldPos.xyz;\n#endif\ngl_Position=viewProjection*worldPos;\n}\n",h.Effect.ShadersStore.fluentPixelShader="precision highp float;\nvarying vec2 vUV;\nuniform vec4 albedoColor;\n#ifdef INNERGLOW\nuniform vec4 innerGlowColor;\n#endif\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float edgeSmoothingValue;\nuniform float borderMinValue;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\nuniform vec3 hoverPosition;\nuniform vec4 hoverColor;\nuniform float hoverRadius;\n#endif\n#ifdef TEXTURE\nuniform sampler2D albedoSampler;\n#endif\nvoid main(void) {\nvec3 albedo=albedoColor.rgb;\nfloat alpha=albedoColor.a;\n#ifdef TEXTURE\nalbedo=texture2D(albedoSampler,vUV).rgb;\n#endif\n#ifdef HOVERLIGHT\nfloat pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;\nalbedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);\n#else\nfloat pointToHover=1.0;\n#endif\n#ifdef BORDER\nfloat borderPower=10.0;\nfloat inverseBorderPower=1.0/borderPower;\nvec3 borderColor=albedo*borderPower;\nvec2 distanceToEdge;\ndistanceToEdge.x=abs(vUV.x-0.5)*2.0;\ndistanceToEdge.y=abs(vUV.y-0.5)*2.0;\nfloat borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),\nsmoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));\nborderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover);\nalbedo+=borderColor;\nalpha=max(alpha,borderValue);\n#endif\n#ifdef INNERGLOW\n\nvec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);\nuvGlow=uvGlow*uvGlow;\nuvGlow=uvGlow*uvGlow;\nalbedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y);\n#endif\ngl_FragColor=vec4(albedo,alpha);\n}";var et=function(t){function e(){var e=t.call(this)||this;return e.INNERGLOW=!1,e.BORDER=!1,e.HOVERLIGHT=!1,e.TEXTURE=!1,e.rebuild(),e}return n(e,t),e}(h.MaterialDefines),it=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.innerGlowColorIntensity=.5,r.innerGlowColor=new h.Color3(1,1,1),r.alpha=1,r.albedoColor=new h.Color3(.3,.35,.4),r.renderBorders=!1,r.borderWidth=.5,r.edgeSmoothingValue=.02,r.borderMinValue=.1,r.renderHoverLight=!1,r.hoverRadius=1,r.hoverColor=new h.Color4(.3,.3,.3,1),r.hoverPosition=h.Vector3.Zero(),r}return n(e,t),e.prototype.needAlphaBlending=function(){return 1!==this.alpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.isReadyForSubMesh=function(t,e,i){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new et);var r=this.getScene(),n=e._materialDefines;if(!this.checkReadyOnEveryCall&&e.effect&&n._renderId===r.getRenderId())return!0;if(n._areTexturesDirty)if(n.INNERGLOW=this.innerGlowColorIntensity>0,n.BORDER=this.renderBorders,n.HOVERLIGHT=this.renderHoverLight,this._albedoTexture){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;n.TEXTURE=!0}else n.TEXTURE=!1;var o=r.getEngine();if(n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=[h.VertexBuffer.PositionKind];s.push(h.VertexBuffer.NormalKind),s.push(h.VertexBuffer.UVKind);var a=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius"],l=["albedoSampler"],u=new Array;h.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:a,uniformBuffersNames:u,samplers:l,defines:n,maxSimultaneousLights:4});var c=n.toString();e.setEffect(r.getEngine().createEffect("fluent",{attributes:s,uniformsNames:a,uniformBuffersNames:u,samplers:l,defines:c,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o))}return!(!e.effect||!e.effect.isReady()||(n._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,0))},e.prototype.bindForSubMesh=function(t,e,i){var r=this.getScene(),n=i._materialDefines;if(n){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._mustRebind(r,o)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),n.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),n.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),e.getBoundingInfo().boundingBox.extendSize.multiplyToRef(e.scaling,h.Tmp.Vector3[0]),this._activeEffect.setVector3("scaleFactor",h.Tmp.Vector3[0])),n.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),n.TEXTURE&&this._activeEffect.setTexture("albedoSampler",this._albedoTexture)),this._afterBind(e,this._activeEffect))}},e.prototype.getActiveTextures=function(){return t.prototype.getActiveTextures.call(this)},e.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)},e.prototype.dispose=function(e){t.prototype.dispose.call(this,e)},e.prototype.clone=function(t){var i=this;return h.SerializationHelper.Clone(function(){return new e(t,i.getScene())},this)},e.prototype.serialize=function(){var t=h.SerializationHelper.Serialize(this);return t.customType="BABYLON.GUI.FluentMaterial",t},e.prototype.getClassName=function(){return"FluentMaterial"},e.Parse=function(t,i,r){return h.SerializationHelper.Parse(function(){return new e(t.name,i)},t,i,r)},o([Object(h.serialize)(),Object(h.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"innerGlowColorIntensity",void 0),o([Object(h.serializeAsColor3)()],e.prototype,"innerGlowColor",void 0),o([Object(h.serialize)()],e.prototype,"alpha",void 0),o([Object(h.serializeAsColor3)()],e.prototype,"albedoColor",void 0),o([Object(h.serialize)(),Object(h.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"renderBorders",void 0),o([Object(h.serialize)()],e.prototype,"borderWidth",void 0),o([Object(h.serialize)()],e.prototype,"edgeSmoothingValue",void 0),o([Object(h.serialize)()],e.prototype,"borderMinValue",void 0),o([Object(h.serialize)(),Object(h.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"renderHoverLight",void 0),o([Object(h.serialize)()],e.prototype,"hoverRadius",void 0),o([Object(h.serializeAsColor4)()],e.prototype,"hoverColor",void 0),o([Object(h.serializeAsVector3)()],e.prototype,"hoverPosition",void 0),o([Object(h.serializeAsTexture)("albedoTexture")],e.prototype,"_albedoTexture",void 0),o([Object(h.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"albedoTexture",void 0),e}(h.PushMaterial);h._TypeStore.RegisteredTypes["BABYLON.GUI.FluentMaterial"]=it;var rt=function(t){function e(e,i){void 0===i&&(i=!0);var r=t.call(this,e)||this;return r._shareMaterials=!0,r._shareMaterials=i,r.pointerEnterAnimation=function(){r.mesh&&r._frontPlate.setEnabled(!0)},r.pointerOutAnimation=function(){r.mesh&&r._frontPlate.setEnabled(!1)},r}return n(e,t),e.prototype._disposeTooltip=function(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)},Object.defineProperty(e.prototype,"tooltipText",{get:function(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null},set:function(t){var e=this;if(t){if(!this._tooltipFade){this._tooltipMesh=h.PlaneBuilder.CreatePlane("",{size:1},this._backPlate._scene);var i=h.PlaneBuilder.CreatePlane("",{size:1,sideOrientation:h.Mesh.DOUBLESIDE},this._backPlate._scene),r=new h.StandardMaterial("",this._backPlate._scene);r.diffuseColor=h.Color3.FromHexString("#212121"),i.material=r,i.isPickable=!1,this._tooltipMesh.addChild(i),i.position.z=.05,this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position.y=.7,this._tooltipMesh.position.z=-.15,this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=G.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new p,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new h.FadeInOutBehavior,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add(function(){e._tooltipFade&&e._tooltipFade.fadeIn(!0)}),this._tooltipOutObserver=this.onPointerOutObservable.add(function(){e._tooltipFade&&e._tooltipFade.fadeIn(!1)})}this._tooltipTextBlock&&(this._tooltipTextBlock.text=t)}else this._disposeTooltip()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._rebuildContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(t){this._imageUrl!==t&&(this._imageUrl=t,this._rebuildContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backMaterial",{get:function(){return this._backMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontMaterial",{get:function(){return this._frontMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plateMaterial",{get:function(){return this._plateMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shareMaterials",{get:function(){return this._shareMaterials},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"HolographicButton"},e.prototype._rebuildContent=function(){this._disposeFacadeTexture();var t=new m;if(t.isVertical=!0,this._imageUrl){var e=new g;e.source=this._imageUrl,e.paddingTop="40px",e.height="180px",e.width="100px",e.paddingBottom="40px",t.addControl(e)}if(this._text){var i=new p;i.text=this._text,i.color="white",i.height="30px",i.fontSize=24,t.addControl(i)}this._frontPlate&&(this.content=t)},e.prototype._createNode=function(e){return this._backPlate=h.BoxBuilder.CreateBox(this.name+"BackMesh",{width:1,height:1,depth:.08},e),this._frontPlate=h.BoxBuilder.CreateBox(this.name+"FrontMesh",{width:1,height:1,depth:.08},e),this._frontPlate.parent=this._backPlate,this._frontPlate.position.z=-.08,this._frontPlate.isPickable=!1,this._frontPlate.setEnabled(!1),this._textPlate=t.prototype._createNode.call(this,e),this._textPlate.parent=this._backPlate,this._textPlate.position.z=-.08,this._textPlate.isPickable=!1,this._backPlate},e.prototype._applyFacade=function(t){this._plateMaterial.emissiveTexture=t,this._plateMaterial.opacityTexture=t},e.prototype._createBackMaterial=function(t){var e=this;this._backMaterial=new it(this.name+"Back Material",t.getScene()),this._backMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add(function(t){t?(e._backMaterial.hoverPosition=t,e._backMaterial.hoverColor.a=1):e._backMaterial.hoverColor.a=0})},e.prototype._createFrontMaterial=function(t){this._frontMaterial=new it(this.name+"Front Material",t.getScene()),this._frontMaterial.innerGlowColorIntensity=0,this._frontMaterial.alpha=.5,this._frontMaterial.renderBorders=!0},e.prototype._createPlateMaterial=function(t){this._plateMaterial=new h.StandardMaterial(this.name+"Plate Material",t.getScene()),this._plateMaterial.specularColor=h.Color3.Black()},e.prototype._affectMaterial=function(t){this._shareMaterials?(this._host._sharedMaterials.backFluentMaterial?this._backMaterial=this._host._sharedMaterials.backFluentMaterial:(this._createBackMaterial(t),this._host._sharedMaterials.backFluentMaterial=this._backMaterial),this._host._sharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._sharedMaterials.frontFluentMaterial:(this._createFrontMaterial(t),this._host._sharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(t),this._createFrontMaterial(t)),this._createPlateMaterial(t),this._backPlate.material=this._backMaterial,this._frontPlate.material=this._frontMaterial,this._textPlate.material=this._plateMaterial,this._rebuildContent()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._disposeTooltip(),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))},e}(q),nt=function(t){function e(e,i){var r=t.call(this,i)||this;return r._currentMesh=e,r.pointerEnterAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(1.1)},r.pointerOutAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(1/1.1)},r.pointerDownAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(.95)},r.pointerUpAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(1/.95)},r}return n(e,t),e.prototype._getTypeName=function(){return"MeshButton3D"},e.prototype._createNode=function(t){var e=this;return this._currentMesh.getChildMeshes().forEach(function(t){t.metadata=e}),this._currentMesh},e.prototype._affectMaterial=function(t){},e}(q),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._mapGridNode=function(t,e){var i=t.mesh;if(i){t.position=e.clone();var r=h.Tmp.Vector3[0];switch(r.copyFrom(e),this.orientation){case Z.FACEORIGIN_ORIENTATION:case Z.FACEFORWARD_ORIENTATION:r.addInPlace(new h.Vector3(0,0,1)),i.lookAt(r);break;case Z.FACEFORWARDREVERSED_ORIENTATION:case Z.FACEORIGINREVERSED_ORIENTATION:r.addInPlace(new h.Vector3(0,0,-1)),i.lookAt(r)}}},e}(J),st=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._iteration=100,e}return n(e,t),Object.defineProperty(e.prototype,"iteration",{get:function(){return this._iteration},set:function(t){var e=this;this._iteration!==t&&(this._iteration=t,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),e.prototype._mapGridNode=function(t,e){var i=t.mesh,r=this._scatterMapping(e);if(i){switch(this.orientation){case Z.FACEORIGIN_ORIENTATION:case Z.FACEFORWARD_ORIENTATION:i.lookAt(new h.Vector3(0,0,1));break;case Z.FACEFORWARDREVERSED_ORIENTATION:case Z.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new h.Vector3(0,0,-1))}t.position=r}},e.prototype._scatterMapping=function(t){return t.x=(1-2*Math.random())*this._cellWidth,t.y=(1-2*Math.random())*this._cellHeight,t},e.prototype._finalProcessing=function(){for(var t=[],e=0,i=this._children;e<i.length;e++){var r=i[e];r.mesh&&t.push(r.mesh)}for(var n=0;n<this._iteration;n++){t.sort(function(t,e){var i=t.position.lengthSquared(),r=e.position.lengthSquared();return i<r?1:i>r?-1:0});for(var o=Math.pow(this.margin,2),s=Math.max(this._cellWidth,this._cellHeight),a=h.Tmp.Vector2[0],l=h.Tmp.Vector3[0],u=0;u<t.length-1;u++)for(var c=u+1;c<t.length;c++)if(u!=c){t[c].position.subtractToRef(t[u].position,l),a.x=l.x,a.y=l.y;var _=s,d=a.lengthSquared()-o;(d-=Math.min(d,o))<Math.pow(_,2)&&(a.normalize(),l.scaleInPlace(.5*(_-Math.sqrt(d))),t[c].position.addInPlace(l),t[u].position.subtractInPlace(l))}}},e}(J),ht=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=5,e}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){var e=this;this._radius!==t&&(this._radius=t,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),e.prototype._mapGridNode=function(t,e){var i=t.mesh;if(i){var r=this._sphericalMapping(e);switch(t.position=r,this.orientation){case Z.FACEORIGIN_ORIENTATION:i.lookAt(new h.Vector3(2*r.x,2*r.y,2*r.z));break;case Z.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new h.Vector3(-r.x,-r.y,-r.z));break;case Z.FACEFORWARD_ORIENTATION:break;case Z.FACEFORWARDREVERSED_ORIENTATION:i.rotate(h.Axis.Y,Math.PI,h.Space.LOCAL)}}},e.prototype._sphericalMapping=function(t){var e=new h.Vector3(0,0,this._radius),i=t.y/this._radius,r=-t.x/this._radius;return h.Matrix.RotationYawPitchRollToRef(r,i,0,h.Tmp.Matrix[0]),h.Vector3.TransformNormal(e,h.Tmp.Matrix[0])},e}(J),at=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i._isVertical=!1,i.margin=.1,i._isVertical=e,i}return n(e,t),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(t){var e=this;this._isVertical!==t&&(this._isVertical=t,h.Tools.SetImmediate(function(){e._arrangeChildren()}))},enumerable:!0,configurable:!0}),e.prototype._arrangeChildren=function(){for(var t,e=0,i=0,r=0,n=[],o=h.Matrix.Invert(this.node.computeWorldMatrix(!0)),s=0,a=this._children;s<a.length;s++)if((f=a[s]).mesh){r++,f.mesh.computeWorldMatrix(!0),f.mesh.getWorldMatrix().multiplyToRef(o,h.Tmp.Matrix[0]);var l=f.mesh.getBoundingInfo().boundingBox,u=h.Vector3.TransformNormal(l.extendSize,h.Tmp.Matrix[0]);n.push(u),this._isVertical?i+=u.y:e+=u.x}this._isVertical?i+=(r-1)*this.margin/2:e+=(r-1)*this.margin/2,t=this._isVertical?-i:-e;for(var c=0,_=0,d=this._children;_<d.length;_++){var f;(f=d[_]).mesh&&(r--,u=n[c++],this._isVertical?(f.position.y=t+u.y,f.position.x=0,t+=2*u.y):(f.position.x=t+u.x,f.position.y=0,t+=2*u.x),t+=r>0?this.margin:0)}},e}(Z),lt=function(){function t(t){var e=this;this._lastControlOver={},this._lastControlDown={},this.onPickedPointChangedObservable=new h.Observable,this._sharedMaterials={},this._scene=t||h.EngineStore.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){e._sceneDisposeObserver=null,e._utilityLayer=null,e.dispose()}),this._utilityLayer=new h.UtilityLayerRenderer(this._scene),this._utilityLayer.onlyCheckPointerDownEvents=!1,this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.mainSceneTrackerPredicate=function(t){return t&&t.metadata&&t.metadata._node},this._rootContainer=new Z("RootContainer"),this._rootContainer._host=this;var i=this._utilityLayer.utilityLayerScene;this._pointerOutObserver=this._utilityLayer.onPointerOutObservable.add(function(t){e._handlePointerOut(t,!0)}),this._pointerObserver=i.onPointerObservable.add(function(t,i){e._doPicking(t)}),this._utilityLayer.utilityLayerScene.autoClear=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,new h.HemisphericLight("hemi",h.Vector3.Up(),this._utilityLayer.utilityLayerScene)}return Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!0,configurable:!0}),t.prototype._handlePointerOut=function(t,e){var i=this._lastControlOver[t];i&&(i._onPointerOut(i),delete this._lastControlOver[t]),e&&this._lastControlDown[t]&&(this._lastControlDown[t].forcePointerUp(),delete this._lastControlDown[t]),this.onPickedPointChangedObservable.notifyObservers(null)},t.prototype._doPicking=function(t){if(!this._utilityLayer||!this._utilityLayer.utilityLayerScene.activeCamera)return!1;var e=t.event,i=e.pointerId||0,r=e.button,n=t.pickInfo;if(!n||!n.hit)return this._handlePointerOut(i,t.type===h.PointerEventTypes.POINTERUP),!1;var o=n.pickedMesh.metadata;return n.pickedPoint&&this.onPickedPointChangedObservable.notifyObservers(n.pickedPoint),o._processObservables(t.type,n.pickedPoint,i,r)||t.type===h.PointerEventTypes.POINTERMOVE&&(this._lastControlOver[i]&&this._lastControlOver[i]._onPointerOut(this._lastControlOver[i]),delete this._lastControlOver[i]),t.type===h.PointerEventTypes.POINTERUP&&(this._lastControlDown[e.pointerId]&&(this._lastControlDown[e.pointerId].forcePointerUp(),delete this._lastControlDown[e.pointerId]),"touch"===e.pointerType&&this._handlePointerOut(i,!1)),!0},Object.defineProperty(t.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),t.prototype.containsControl=function(t){return this._rootContainer.containsControl(t)},t.prototype.addControl=function(t){return this._rootContainer.addControl(t),this},t.prototype.removeControl=function(t){return this._rootContainer.removeControl(t),this},t.prototype.dispose=function(){for(var t in this._rootContainer.dispose(),this._sharedMaterials)this._sharedMaterials.hasOwnProperty(t)&&this._sharedMaterials[t].dispose();this._sharedMaterials={},this._pointerOutObserver&&this._utilityLayer&&(this._utilityLayer.onPointerOutObservable.remove(this._pointerOutObserver),this._pointerOutObserver=null),this.onPickedPointChangedObservable.clear();var e=this._utilityLayer?this._utilityLayer.utilityLayerScene:null;e&&this._pointerObserver&&(e.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=null),this._scene&&this._sceneDisposeObserver&&(this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null),this._utilityLayer&&this._utilityLayer.dispose()},t}();i.d(e,"AdvancedDynamicTexture",function(){return G}),i.d(e,"AdvancedDynamicTextureInstrumentation",function(){return X}),i.d(e,"Vector2WithInfo",function(){return u}),i.d(e,"Matrix2D",function(){return c}),i.d(e,"Measure",function(){return l}),i.d(e,"MultiLinePoint",function(){return P}),i.d(e,"Style",function(){return z}),i.d(e,"ValueAndUnit",function(){return a}),i.d(e,"Button",function(){return b}),i.d(e,"Checkbox",function(){return y}),i.d(e,"ColorPicker",function(){return C}),i.d(e,"Container",function(){return d}),i.d(e,"Control",function(){return _}),i.d(e,"Ellipse",function(){return T}),i.d(e,"Grid",function(){return O}),i.d(e,"Image",function(){return g}),i.d(e,"InputText",function(){return v}),i.d(e,"InputPassword",function(){return w}),i.d(e,"Line",function(){return x}),i.d(e,"MultiLine",function(){return M}),i.d(e,"RadioButton",function(){return k}),i.d(e,"StackPanel",function(){return m}),i.d(e,"SelectorGroup",function(){return E}),i.d(e,"CheckboxGroup",function(){return S}),i.d(e,"RadioGroup",function(){return D}),i.d(e,"SliderGroup",function(){return R}),i.d(e,"SelectionPanel",function(){return L}),i.d(e,"ScrollViewer",function(){return H}),i.d(e,"TextWrapping",function(){return s}),i.d(e,"TextBlock",function(){return p}),i.d(e,"KeyPropertySet",function(){return V}),i.d(e,"VirtualKeyboard",function(){return F}),i.d(e,"Rectangle",function(){return f}),i.d(e,"DisplayGrid",function(){return j}),i.d(e,"BaseSlider",function(){return I}),i.d(e,"Slider",function(){return A}),i.d(e,"ImageBasedSlider",function(){return W}),i.d(e,"ScrollBar",function(){return B}),i.d(e,"name",function(){return"Statics"}),i.d(e,"GUI3DManager",function(){return lt}),i.d(e,"Vector3WithInfo",function(){return Y}),i.d(e,"AbstractButton3D",function(){return K}),i.d(e,"Button3D",function(){return q}),i.d(e,"Container3D",function(){return Z}),i.d(e,"Control3D",function(){return U}),i.d(e,"CylinderPanel",function(){return Q}),i.d(e,"HolographicButton",function(){return rt}),i.d(e,"MeshButton3D",function(){return nt}),i.d(e,"PlanePanel",function(){return ot}),i.d(e,"ScatterPanel",function(){return st}),i.d(e,"SpherePanel",function(){return ht}),i.d(e,"StackPanel3D",function(){return at}),i.d(e,"VolumeBasedPanel",function(){return J}),i.d(e,"FluentMaterialDefines",function(){return et}),i.d(e,"FluentMaterial",function(){return it})},function(t,e,i){"use strict";i.r(e),function(t){var r=i(1);i.d(e,"AdvancedDynamicTexture",function(){return r.AdvancedDynamicTexture}),i.d(e,"AdvancedDynamicTextureInstrumentation",function(){return r.AdvancedDynamicTextureInstrumentation}),i.d(e,"Vector2WithInfo",function(){return r.Vector2WithInfo}),i.d(e,"Matrix2D",function(){return r.Matrix2D}),i.d(e,"Measure",function(){return r.Measure}),i.d(e,"MultiLinePoint",function(){return r.MultiLinePoint}),i.d(e,"Style",function(){return r.Style}),i.d(e,"ValueAndUnit",function(){return r.ValueAndUnit}),i.d(e,"GUI3DManager",function(){return r.GUI3DManager}),i.d(e,"Vector3WithInfo",function(){return r.Vector3WithInfo}),i.d(e,"Button",function(){return r.Button}),i.d(e,"Checkbox",function(){return r.Checkbox}),i.d(e,"ColorPicker",function(){return r.ColorPicker}),i.d(e,"Container",function(){return r.Container}),i.d(e,"Control",function(){return r.Control}),i.d(e,"Ellipse",function(){return r.Ellipse}),i.d(e,"Grid",function(){return r.Grid}),i.d(e,"Image",function(){return r.Image}),i.d(e,"InputText",function(){return r.InputText}),i.d(e,"InputPassword",function(){return r.InputPassword}),i.d(e,"Line",function(){return r.Line}),i.d(e,"MultiLine",function(){return r.MultiLine}),i.d(e,"RadioButton",function(){return r.RadioButton}),i.d(e,"StackPanel",function(){return r.StackPanel}),i.d(e,"SelectorGroup",function(){return r.SelectorGroup}),i.d(e,"CheckboxGroup",function(){return r.CheckboxGroup}),i.d(e,"RadioGroup",function(){return r.RadioGroup}),i.d(e,"SliderGroup",function(){return r.SliderGroup}),i.d(e,"SelectionPanel",function(){return r.SelectionPanel}),i.d(e,"ScrollViewer",function(){return r.ScrollViewer}),i.d(e,"TextWrapping",function(){return r.TextWrapping}),i.d(e,"TextBlock",function(){return r.TextBlock}),i.d(e,"KeyPropertySet",function(){return r.KeyPropertySet}),i.d(e,"VirtualKeyboard",function(){return r.VirtualKeyboard}),i.d(e,"Rectangle",function(){return r.Rectangle}),i.d(e,"DisplayGrid",function(){return r.DisplayGrid}),i.d(e,"BaseSlider",function(){return r.BaseSlider}),i.d(e,"Slider",function(){return r.Slider}),i.d(e,"ImageBasedSlider",function(){return r.ImageBasedSlider}),i.d(e,"ScrollBar",function(){return r.ScrollBar}),i.d(e,"name",function(){return r.name}),i.d(e,"AbstractButton3D",function(){return r.AbstractButton3D}),i.d(e,"Button3D",function(){return r.Button3D}),i.d(e,"Container3D",function(){return r.Container3D}),i.d(e,"Control3D",function(){return r.Control3D}),i.d(e,"CylinderPanel",function(){return r.CylinderPanel}),i.d(e,"HolographicButton",function(){return r.HolographicButton}),i.d(e,"MeshButton3D",function(){return r.MeshButton3D}),i.d(e,"PlanePanel",function(){return r.PlanePanel}),i.d(e,"ScatterPanel",function(){return r.ScatterPanel}),i.d(e,"SpherePanel",function(){return r.SpherePanel}),i.d(e,"StackPanel3D",function(){return r.StackPanel3D}),i.d(e,"VolumeBasedPanel",function(){return r.VolumeBasedPanel}),i.d(e,"FluentMaterialDefines",function(){return r.FluentMaterialDefines}),i.d(e,"FluentMaterial",function(){return r.FluentMaterial});var n=void 0!==t?t:"undefined"!=typeof window?window:void 0;void 0!==n&&(n.BABYLON=n.BABYLON||{},n.BABYLON.GUI=r)}.call(this,i(3))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i}])}),$__System.registerDynamic("2c",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var TokenType;!function(TokenType){TokenType[TokenType.IDENTIFIER=0]="IDENTIFIER",TokenType[TokenType.PARENTHESIS=1]="PARENTHESIS",TokenType[TokenType.COMMA=2]="COMMA",TokenType[TokenType.UNKNOWN=3]="UNKNOWN",TokenType[TokenType.END_OF_INPUT=4]="END_OF_INPUT"}(TokenType=exports.TokenType||(exports.TokenType={}));var Tokenizer=function(){function Tokenizer(toParse){this.identifier="",this.token=TokenType.UNKNOWN,this._pos=0,this._isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this.toParse=toParse,this._maxPos=toParse.length,this.getNextToken()}return Tokenizer.prototype.read=function(){return this.toParse[this._pos++]},Tokenizer.prototype.peek=function(){return this.toParse[this._pos]},Tokenizer.prototype.forward=function(){this._pos++},Tokenizer.prototype.isEnd=function(){return this._pos>=this._maxPos},Tokenizer.prototype.match=function(token){return this.token===token&&(this.getNextToken(),!0)},Tokenizer.prototype.matchIdentifier=function(expected){return this.identifier===expected&&(this.getNextToken(),!0)},Tokenizer.prototype.getNextToken=function(){if(this.isEnd())return this.token=TokenType.END_OF_INPUT;for(var c=" ";" "===(c=this.read())||"\t"===c;)if(this.isEnd())return this.token=TokenType.END_OF_INPUT;switch(c){case"(":case")":return this.token=TokenType.PARENTHESIS;case",":return this.token=TokenType.COMMA;default:if("_"===c||this._isLetterOrDigitPattern.test(c)){for(this.token=TokenType.IDENTIFIER,this.identifier=c;!this.isEnd()&&(this._isLetterOrDigitPattern.test(c=this.peek())||"_"===c||"."===c);)this.identifier+=c,this.forward();return this.token=TokenType.IDENTIFIER}}return this.token=TokenType.UNKNOWN},Tokenizer}();exports.default=Tokenizer}),$__System.registerDynamic("25",["c","d"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),extensions_1=$__require("d"),Tools=function(){function Tools(){}return Tools.prototype.getCustomMaterial=function(name){var ext=extensions_1.default.Instances.MaterialCreatorExtension;return ext?ext.instances[name]:null},Tools.prototype.getCustomScript=function(object,name){var ext=extensions_1.default.Instances.BehaviorExtension;return ext?"string"===(typeof object).toLowerCase()?ext.instances[object+name]:object instanceof babylonjs_1.Scene?ext.instances["scene"+name]:object instanceof babylonjs_1.ParticleSystem?ext.instances[object.id+name]:ext.instances[object.name+name]:null},Tools.prototype.getConstructor=function(name){var ext=extensions_1.default.Instances.BehaviorExtension;return ext?ext.scriptsConstructors[name]:null},Tools.prototype.getCustomPostProcess=function(name){var ext=extensions_1.default.Instances.PostProcessCreatorExtension;return ext?ext.instances[name]:null},Tools.prototype.getFileByName=function(name){return babylonjs_1.FilesInputStore.FilesToLoad[name]},Tools.prototype.getFileUrl=function(filename,oneTimeOnly){return void 0===oneTimeOnly&&(oneTimeOnly=!0),extensions_1.default.RoolUrl&&"file:"!==extensions_1.default.RoolUrl?extensions_1.default.RoolUrl+filename:URL.createObjectURL(this.getFileByName(filename))},Tools.prototype.getPathFinder=function(name){var ext=extensions_1.default.Instances.PathFinderExtension;return ext?ext.instances[name]:null},Tools.prototype.instantiatePrefab=function(name){return extensions_1.default.Instances.AssetsExtension.instantiatePrefab(name)},Tools.prototype.instantiateParticleSystemSet=function(name,position){return extensions_1.default.Instances.AssetsExtension.instantiateParticleSystemsSet(name,position)},Tools.prototype.sendMessage=function(object,methodName){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var ext=extensions_1.default.Instances.BehaviorExtension;if(!ext)return null;var scripts=ext.objectsInstances[object instanceof babylonjs_1.Scene?"Scene":object.id];scripts&&scripts.forEach(function(s){return s[methodName]&&s[methodName].apply(s,params)})},Tools}();exports.default=Tools;var exportScriptBodyString="\n    if (!params) {\n        returnValue = value;\n    } else {\n        returnValue = {\n            ctor: value\n        };\n\n        var keys = Object.keys(params);\n        for (var i = 0; i < keys.length; i++) {\n            returnValue[keys[i]] = params[keys[i]];\n        }\n    }\n".replace(/\n/g,"").replace(/\t/g,"").replace(/  /g,""),exportScriptReturnString="\nif (returnValue) {return returnValue;}\nif (exports) {return exports;}\n".replace(/\n/g,"").replace(/\t/g,"").replace(/  /g,"");exports.exportScriptString="\nfunction exportScript (value, params) {"+exportScriptBodyString+"};\n"+exportScriptReturnString+"\n"}),$__System.registerDynamic("2d",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Mobile=function(){function Mobile(){}return Mobile.prototype.vibrate=function(pattern){return navigator.vibrate&&navigator.vibrate(pattern)},Mobile}();exports.default=Mobile}),$__System.registerDynamic("d",["25","2d"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var tools_1=$__require("25"),mobile_1=$__require("2d"),Extensions=function(){function Extensions(){}return Extensions.Register=function(name,extension){return!this.Extensions[name]&&(this.Extensions[name]=extension,this.OrderedExtensions.push(name),!0)},Extensions.RequestExtension=function(scene,name){if(this.Instances[name])return this.Instances[name];if(!this.Extensions[name])return null;var instance=new this.Extensions[name](scene);return this.Instances[name]=instance,instance},Extensions.ApplyExtensions=function(scene,metadatas){for(var _i=0,_a=this.OrderedExtensions;_i<_a.length;_i++){var name_1=_a[_i],extension=new this.Extensions[name_1](scene);this.Instances[name_1]=extension,(extension.alwaysApply||metadatas[name_1])&&extension.onApply(metadatas[name_1],this.RoolUrl)}},Extensions.ClearExtensions=function(){this.Instances={}},Extensions.Extensions={},Extensions.Instances={},Extensions.OrderedExtensions=[],Extensions.Tools=new tools_1.default,Extensions.Mobile=new mobile_1.default,Extensions.RoolUrl=null,Extensions}();exports.default=Extensions}),$__System.registerDynamic("e",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("2e",["c","2c","25","2f","d","e"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var EDITOR,babylonjs_1=$__require("c"),tokenizer_1=$__require("2c"),tools_1=$__require("25"),require_1=$__require("2f"),extensions_1=$__require("d"),extension_1=$__require("e"),template="\nEDITOR.BehaviorCode.Constructors['{{name}}'] = function (scene, {{node}}, tools, mobile, require) {\nvar returnValue = null;\nvar exports = { };\n\n{{code}}\n"+tools_1.exportScriptString+"\n}\n";!function(EDITOR){var BehaviorCode=function(){function BehaviorCode(){}return BehaviorCode.Constructors={},BehaviorCode}();EDITOR.BehaviorCode=BehaviorCode}(EDITOR=exports.EDITOR||(exports.EDITOR={})),window.EDITOR=window.EDITOR||{},window.EDITOR.BehaviorCode=EDITOR.BehaviorCode;var CodeExtension=function(_super){function CodeExtension(scene){var _this=_super.call(this,scene)||this;return _this.id="behavior-editor",_this.assetsCaption="Scripts",_this.instances={},_this.scriptsConstructors={},_this.objectsInstances={},_this.datas=null,CodeExtension.Instance=_this,_this}return __extends(CodeExtension,_super),CodeExtension.prototype.onCreateAsset=function(name){return __awaiter(this,void 0,void 0,function(){var code,asset;return __generator(this,function(_a){switch(_a.label){case 0:return[4,new Promise(function(resolve){babylonjs_1.Tools.LoadFile("assets/templates/code/custom-code-typescript.ts",function(data){return resolve(data)})})];case 1:return code=_a.sent(),asset={name:name,data:{code:code.replace(/{{name}}/g,(name[0].toUpperCase()+name.substr(1,name.length)).replace(/ /g,"")),id:babylonjs_1.Tools.RandomId(),name:name}},this.scene.metadata=this.scene.metadata||{},this.scene.metadata.behaviorScripts=this.scene.metadata.behaviorScripts||[],this.scene.metadata.behaviorScripts.push(asset.data),[2,asset]}})})},CodeExtension.prototype.onRenameAsset=function(asset,name){asset.data.name=name},CodeExtension.prototype.onGetAssets=function(){var data=this.onSerialize(),attached=[],unAttached=[];return data.scripts.forEach(function(s){if(data.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.codeId===s.id})}))return attached.push({name:s.name,data:s});unAttached.push({name:s.name,data:s})}),[{separator:"Attached"}].concat(attached).concat([{separator:"Unattached"}]).concat(unAttached)},CodeExtension.prototype.onDragAndDropAsset=function(targetMesh,asset){targetMesh.metadata=targetMesh.metadata||{},targetMesh.metadata.behavior||(targetMesh.metadata.behavior={node:targetMesh.name,metadatas:[]}),targetMesh.metadata.behavior.metadatas.push({codeId:asset.data.id,active:!0})},CodeExtension.prototype.onRemoveAsset=function(asset){var data=asset.data,remove=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behavior)for(var codes=o.metadata.behavior,links=codes.metadatas,i=0;i<links.length;i++)links[i].codeId===data.id&&(links.splice(i,1),i--)})};remove(this.scene.meshes),remove(this.scene.lights),remove(this.scene.cameras),remove([this.scene]),remove(this.scene.particleSystems);var index=this.scene.metadata.behaviorScripts.indexOf(data);-1!==index&&this.scene.metadata.behaviorScripts.splice(index,1)},CodeExtension.prototype.onAddAsset=function(asset){this.scene.metadata.behaviorScripts.push(asset.data)},CodeExtension.prototype.onApply=function(data){var _this=this;this.datas=data,this.datas.scripts.forEach(function(s){if(!EDITOR.BehaviorCode.Constructors[s.name.replace(/ /g,"")]){if(!_this.datas.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.codeId===s.id})})){var ctor=_this.getConstructor(s,null);_this.scriptsConstructors[s.name]=ctor}}}),this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node||_this.scene.particleSystems.forEach(function(ps){return ps.name===d.node&&(node=ps)}),node||(node=_this.scene.getParticleSystemByID(d.nodeId)),node&&d.metadatas.forEach(function(m){if(m.active){var code=_this.datas.scripts.find(function(s){return s.id===m.codeId}),ctor=_this.getConstructor(code,node);if(!ctor.ctor&&"function"!=typeof ctor){var nodeName=node instanceof babylonjs_1.Scene?"Scene":node.name;return babylonjs_1.Tools.Warn('Script named "'+code.name+'" has been ignored on object "'+nodeName+'" as there is no exported script. Please use "exportScript(ctor);"')}var instance=new(ctor.ctor||ctor)(node,_this.scene);m.params&&_this.setCustomParams(m,instance),_this.instances[(node instanceof babylonjs_1.Scene?"scene":node.name)+code.name]=instance;var id=node instanceof babylonjs_1.Scene?"Scene":node.id;_this.objectsInstances[id]||(_this.objectsInstances[id]=[]),_this.objectsInstances[id].push(instance);var scope=_this;instance.start&&_this.scene.registerBeforeRender(function(){instance.start(),scope.scene.unregisterBeforeRender(this.callback)}),instance.update&&_this.scene.registerBeforeRender(function(){instance.update()}),instance.dispose&&node.onDisposeObservable&&node.onDisposeObservable.add(function(){instance.dispose()})}})})},CodeExtension.prototype.onSerialize=function(){var result={scripts:this.scene.metadata?this.scene.metadata.behaviorScripts||[]:[],nodes:[]},add=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behavior){var behavior=o.metadata.behavior;behavior.node=o instanceof babylonjs_1.Scene?"Scene":o instanceof babylonjs_1.Node?o.name:o.id,behavior.nodeId=o instanceof babylonjs_1.Scene?"Scene":o.id,result.nodes.push(behavior)}})};return add(this.scene.meshes),add(this.scene.lights),add(this.scene.cameras),add([this.scene]),add(this.scene.particleSystems),result},CodeExtension.prototype.onLoad=function(data){var _this=this;if(!data.scripts){var oldData=data;data={scripts:[],nodes:[]},oldData.forEach(function(od){var node={node:od.node,nodeId:od.node,metadatas:[]};od.metadatas.forEach(function(m){var id=babylonjs_1.Tools.RandomId();m.link||(data.scripts.push({name:m.name,id:id,code:m.code,compiledCode:m.compiledCode}),node.metadatas.push({codeId:id,active:m.active,params:m.params}))}),data.nodes.push(node)})}this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.behaviorScripts=this.datas.scripts,this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node||(node=_this.scene.getParticleSystemByID(d.node)),node&&(d.metadatas.forEach(function(m){}),node.metadata=node.metadata||{},node.metadata.behavior=d)})},CodeExtension.prototype.setCustomParams=function(m,instance){for(var p in m.params){var param=m.params[p];void 0!==param.w?instance[p]=new babylonjs_1.Vector4(param.x,param.y,param.z,param.w):void 0!==param.z?instance[p]=new babylonjs_1.Vector3(param.x,param.y,param.z):void 0!==param.y?instance[p]=new babylonjs_1.Vector2(param.x,param.y):void 0!==param.a?instance[p]=new babylonjs_1.Color4(param.r,param.g,param.b,param.a):void 0!==param.b?instance[p]=new babylonjs_1.Color3(param.r,param.g,param.b):instance[p]=m.params[p]}},CodeExtension.prototype.getConstructor=function(code,node,evaluate){var url=window.location.href;url=url.replace(babylonjs_1.Tools.GetFilename(url),"")+"behaviors/",url+=node?(node instanceof babylonjs_1.Scene?"scene/":node.name.replace(/ /g,"")+"/")+code.name.replace(/ /g,"")+".js":code.name+".js";var fnName=node?(node instanceof babylonjs_1.Scene?"scene":node.name.replace(/ /g,""))+code.name.replace(/ /g,""):code.name.replace(/ /g,""),effectiveCode=template.replace(/{{name}}/g,fnName).replace(/{{class}}/g,node?node.constructor.name:"").replace(/{{node}}/g,this._getEffectiveConstructorName(node)).replace(/{{code}}/g,code.compiledCode||code.code);return evaluate?new Function(effectiveCode)():extension_1.default.AddScript(effectiveCode,url),EDITOR.BehaviorCode.Constructors[fnName](this.scene,node,extensions_1.default.Tools,extensions_1.default.Mobile,require_1.editorRequire)},CodeExtension.prototype.getConstructorName=function(obj){var tokenizer=new tokenizer_1.default(obj.toString());return tokenizer.matchIdentifier("function")||tokenizer.token===tokenizer_1.TokenType.IDENTIFIER?tokenizer.identifier:"Unknown Constructor Name"},CodeExtension.prototype.getFinalTypeScriptCode=function(code,node){var fnName=(node instanceof babylonjs_1.Scene?"scene":node.name.replace(/ /g,""))+code.name.replace(/ /g,"");return template.replace("{{name}}",fnName).replace("{{node}}",this._getEffectiveConstructorName(node)).replace("{{code}}",code.code)},CodeExtension.prototype._getEffectiveConstructorName=function(obj){if(obj instanceof babylonjs_1.DirectionalLight)return"dirlight";if(obj instanceof babylonjs_1.HemisphericLight)return"hemlight";if(obj instanceof babylonjs_1.GroundMesh||obj instanceof babylonjs_1.InstancedMesh)return"mesh";var ctrName=obj&&obj.constructor?obj.constructor.name:"";return""===ctrName&&(ctrName=typeof obj),ctrName.toLowerCase()},CodeExtension.prototype._getFunctionParameters=function(fn){var tokenizer=new tokenizer_1.default(fn.toString()),result=[];if(!tokenizer.matchIdentifier("function")||!tokenizer.match(tokenizer_1.TokenType.IDENTIFIER)||!tokenizer.match(tokenizer_1.TokenType.PARENTHESIS))return[];for(;!tokenizer.match(tokenizer_1.TokenType.PARENTHESIS)&&(result.push(tokenizer.identifier),tokenizer.getNextToken(),tokenizer.match(tokenizer_1.TokenType.COMMA)););return result},CodeExtension.Instance=null,CodeExtension.CurrentDatas=null,CodeExtension}(extension_1.default);exports.default=CodeExtension,extensions_1.default.Register("BehaviorExtension",CodeExtension)}),$__System.registerDynamic("2f",["c","2a","2b","30","31","2e"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var BABYLON=$__require("c"),POSTPROCESS=$__require("2a"),GUI=$__require("2b"),CANNON=$__require("30"),EARCUT=$__require("31"),code_1=$__require("2e");exports.defineRequire=function(){window.require||(window.require=function(name){return exports.editorRequire(name)})},exports.editorRequire=function(moduleName){switch(moduleName){case"babylonjs":case"babylonjs-procedural-textures":case"babylonjs-loaders":case"babylonjs-materials":return BABYLON;case"babylonjs-post-process":return POSTPROCESS;case"babylonjs-gui":return GUI;case"cannon":return CANNON;case"earcut":return EARCUT;default:var ctor=EDITOR.BehaviorCode.Constructors[moduleName];if(ctor){for(var args=new Array(ctor.length),i=0;i<args.length;i++)args[i]=exports.editorRequire;return ctor.apply(ctor,args)}if(ctor=EDITOR.BehaviorCode.Constructors[moduleName.replace(/ /g,"")])return ctor.apply(new Array(ctor.length).map(function(_){return exports.editorRequire}));var code=code_1.default.Instance.datas.scripts.find(function(s){return s.name===moduleName});if(!code)throw new Error('Cannot find custom module named "'+moduleName+'"');return ctor=code_1.default.Instance.getConstructor(code,null),ctor.default=ctor,ctor}}}),$__System.registerDynamic("a",["d","e","b","2e","1f","22","24","27","28","29","2f"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var extensions_1=$__require("d");exports.Extensions=extensions_1.default;var extension_1=$__require("e");exports.Extension=extension_1.default;var assets_1=$__require("b");exports.AssetsExtension=assets_1.default;var code_1=$__require("2e");exports.CodeExtension=code_1.default;var graph_1=$__require("1f");exports.GraphExtension=graph_1.default,exports.LGraph=graph_1.LGraph,exports.LGraphCanvas=graph_1.LGraphCanvas,exports.LiteGraph=graph_1.LiteGraph,exports.LiteGraphNode=graph_1.LiteGraphNode,exports.LGraphGroup=graph_1.LGraphGroup;var index_1=$__require("22");exports.PathFinderExtension=index_1.default;var post_process_editor_1=$__require("24");exports.PostProcessEditorExtension=post_process_editor_1.default;var material_editor_1=$__require("27");exports.MaterialEditorExtension=material_editor_1.default;var post_processes_1=$__require("28");exports.PostProcessExtension=post_processes_1.default;var metadatas_1=$__require("29");exports.CustomMetadatasExtension=metadatas_1.default,$__require("2f").defineRequire()})})(function(factory){module.exports=factory(require("babylonjs"),require("cannon"),require("earcut"))});