!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6))),{}):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return i(t,r),a(t,r,[]),t.module}function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function s(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module,"__useDefault"in u?u.__useDefault:u}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=s(r.deps,r.depLoads,n);if(!r.executingRequire)for(var i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}var f=t.module=new o(r.moduleObj);if(!r.setters)for(var i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a],{}));i(s);var v=u(e[0]);if(e.length>1)for(var a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["c","e","20","d"],!0,function($__System){this.require,this.exports,this.module;$__System.registerDynamic("b",["c","e","d","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),babylonjs_editor_1=$__require("e"),litegraph_js_1=$__require("d"),typings_1=$__require("f"),GraphNodeTool=function(_super){function GraphNodeTool(){var _this=_super.call(this)||this;return _this.divId="BEHAVIOR-GRAPH-NODE-TOOL",_this.tabName="Graph Node",_this._mode="",_this}return __extends(GraphNodeTool,_super),GraphNodeTool.prototype.isSupported=function(object){return object instanceof typings_1.LiteGraphNode||object.graph&&object.graph instanceof litegraph_js_1.LGraph},GraphNodeTool.prototype.update=function(node){var _this=this;if(_super.prototype.update.call(this,node),node instanceof litegraph_js_1.LGraphGroup)return this._setupGroup(node);var ctor=babylonjs_editor_1.Tools.GetConstructorName(node);for(var key in litegraph_js_1.LiteGraph.registered_node_types)if(litegraph_js_1.LiteGraph.registered_node_types[key].name===ctor){var desc=litegraph_js_1.LiteGraph.registered_node_types[key].desc||litegraph_js_1.LiteGraph.registered_node_types[key].Desc;this.tool.addFolder(desc);break}var common=this.tool.addFolder("Common");common.open(),common.add(node,"title").name("Title");var modes=["ALWAYS","ON_EVENT","NEVER","ON_TRIGGER"];if(this._mode=modes[node.mode],common.add(this,"_mode",modes).name("Mode").onChange(function(r){node.mode=litegraph_js_1.LiteGraph[r],typings_1.LiteGraphNode.SetColor(node)}),0===Object.keys(node.properties).length)return void this.tool.addFolder("No properties");var properties=this.tool.addFolder("Properties");properties.open(),Object.keys(node.properties).forEach(function(k){if("nodePath"===k){var scene=node.graph.scriptScene,result_1=["self"];return scene.meshes.forEach(function(m){return result_1.push(m.name)}),scene.lights.forEach(function(l){return result_1.push(l.name)}),scene.cameras.forEach(function(c){return result_1.push(c.name)}),babylonjs_editor_1.Tools.SortAlphabetically(result_1),properties.add(node.properties,k,result_1).name("Target Node").onChange(function(){return _this.update(node)})}if("propertyPath"===k){if(node.hasProperty("nodePath")){var path=node.properties.nodePath;if("self"===path)return properties.add(node.properties,k,_this._getPropertiesPaths(node)).name(k);var scene=_this.editor.core.scene,target="Scene"===path?scene:scene.getNodeByName(path);return properties.add(node.properties,k,_this._getPropertiesPaths(node,"",target)).name(k)}return properties.add(node.properties,k,_this._getPropertiesPaths(node)).name(k)}switch(typeof node.properties[k]){case"number":properties.add(node.properties,k).step(.001).name(k);break;case"string":case"boolean":properties.add(node.properties,k).name(k)}})},GraphNodeTool.prototype._getPropertiesPaths=function(node,path,root,rootProperties){void 0===path&&(path="");var result=rootProperties||["Scene"],object=root||node.graph.scriptObject;for(var k in object){var key=""===path?k:path+"."+k;if("_"!==k[0])if(object[k]instanceof babylonjs_1.Material)this._getPropertiesPaths(node,key,object[k],result);else{var ctor=babylonjs_editor_1.Tools.GetConstructorName(object[k]).toLowerCase();switch(ctor){case"boolean":case"string":case"number":result.push(key);break;case"vector2":result.push(key+".x"),result.push(key+".y");break;case"vector3":result.push(key+".x"),result.push(key+".y"),result.push(key+".z");break;case"color3":result.push(key+".r"),result.push(key+".g"),result.push(key+".b");break;case"color4":result.push(key+".r"),result.push(key+".g"),result.push(key+".b"),result.push(key+".a")}}}return babylonjs_editor_1.Tools.SortAlphabetically(result),result},GraphNodeTool.prototype._setupGroup=function(node){this.tool.add(node,"title").name("Title").onChange(function(_){return node.graph.setDirtyCanvas(!0,!0)}),this.tool.addHexColor(node,"color").onChange(function(_){return node.graph.setDirtyCanvas(!0,!0)})},GraphNodeTool}(babylonjs_editor_1.AbstractEditionTool);exports.default=GraphNodeTool}),$__System.registerDynamic("10",["d","e"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("d"),babylonjs_editor_1=$__require("e"),GraphNodeCreator=function(){function GraphNodeCreator(){}return GraphNodeCreator.Show=function(){var _this=this;this._Search.value="",this._SearchStr="",setTimeout(function(){return _this._Search.focus()},1),this.Hide(),this.Reset(),this._Root.style.width=this.Width+"px",this._Root.style.height=this.Height+"px",this._Root.style.left=.5*innerWidth-.5*this.Width+"px",this._Root.style.top=.5*innerHeight-.5*this.Height+"px",this._Root.style.visibility="",this._ReturnEvent=function(ev){13===ev.keyCode&&_this.OnConfirmSelection(_this._Graph.getSelected().id)},window.addEventListener("keyup",this._ReturnEvent),document.body.appendChild(this._Root)},GraphNodeCreator.Hide=function(){this._Root.style.visibility="hidden",this._ReturnEvent&&(window.removeEventListener("keyup",this._ReturnEvent),this._ReturnEvent=null)},GraphNodeCreator.Reset=function(){var _this=this,nodes=litegraph_js_1.LiteGraph.registered_node_types;for(var n in nodes)this._Graph.element.hide(n);var toShow=[],effectiveSearch=this._SearchStr.replace(/ /g,""),_loop_1=function(s){var value=this_1._Sorted[s],visible=value.filter(function(v){var ctor=litegraph_js_1.LiteGraph.registered_node_types[s+"/"+v];return!!ctor&&-1!==(ctor.title||ctor.Title||v).toLowerCase().indexOf(effectiveSearch.toLowerCase())});0===visible.length?this_1._Graph.element.hide(s):this_1._Graph.element.show(s),visible.forEach(function(v){return toShow.push(s+"/"+v)})},this_1=this;for(var s in this._Sorted)_loop_1(s);toShow.forEach(function(ts){return _this._Graph.element.show(ts)}),this._Graph.element.refresh(),setTimeout(function(){_this._Graph.element.refresh(),toShow.length>0&&(_this._Graph.setSelected(toShow[0]),_this._Empty.style.visibility="hidden"),_this._Empty.style.visibility=""},1)},GraphNodeCreator.Init=function(){var _this=this;this._Root.appendChild(this._Title),this._Title.textContent="Create new node",this._Root.appendChild(this._Search),this._Search.setAttribute("placeHolder","Search..."),this._Search.addEventListener("keyup",function(){_this._SearchTimeout&&clearTimeout(_this._SearchTimeout),_this._SearchTimeout=setTimeout(function(){_this._SearchStr=_this._Search.value,_this.Reset(),_this._SearchTimeout=null},100)}),this._Root.appendChild(this._GraphDiv),this._Graph=new babylonjs_editor_1.Graph(this._GraphDiv.id),this._Graph.build(this._GraphDiv),this._Graph.onDbleClick=function(id,data){return _this.OnConfirmSelection(id)},this._GraphDiv.appendChild(this._Empty),this._Empty.textContent="Empty",document.addEventListener("click",function(ev){babylonjs_editor_1.Tools.IsElementChildOf(ev.target,_this._Root)||_this.Hide()})},GraphNodeCreator.InitItems=function(){var _this=this;this._Graph.clear(),this._Sorted={};var nodes=litegraph_js_1.LiteGraph.registered_node_types;for(var n in nodes){var split=n.split("/");(this._Sorted[split[0]]||(this._Sorted[split[0]]=[])).push(split[1])}this._Graph.add({id:"group",text:"Group",img:"icon-folder"});var _loop_2=function(s){var value=this_2._Sorted[s];this_2._Graph.add({id:s,text:s,group:!0}),value.forEach(function(v){var id=s+"/"+v,ctor=litegraph_js_1.LiteGraph.registered_node_types[id],title=ctor.Title||ctor.title||v,desc=ctor.desc||ctor.Desc,description=desc?desc.length>30?desc.substr(0,30)+"...":desc:"";_this._Graph.add({id:id,text:title,data:v,img:"icon-help",count:description})})},this_2=this;for(var s in this._Sorted)_loop_2(s)},GraphNodeCreator.Width=400,GraphNodeCreator.Height=400,GraphNodeCreator._Root=babylonjs_editor_1.Tools.CreateElement("div","GRAPH-CANVAS-NODE-CREATOR",{position:"absolute",overflow:"hidden",visibility:"hidden",opacity:"0.99","background-color":"rgb(64, 64, 64)","box-shadow":"1px 2px 4px rgba(0, 0, 0, .5)","border-radius":"2px"}),GraphNodeCreator._Title=babylonjs_editor_1.Tools.CreateElement("h3","GRAPH-CANVAS-NODE-CREATOR-TITLE",{width:"100%",height:"25px",position:"relative",top:"-18px","background-color":"rgb(16, 16, 16)","text-align":"center",color:"grey"}),GraphNodeCreator._Search=babylonjs_editor_1.Tools.CreateElement("input","GRAPH-CANVAS-NODE-CREATOR-SEARCH",{width:"100%",height:"25px",position:"relative",top:"-40px"}),GraphNodeCreator._GraphDiv=babylonjs_editor_1.Tools.CreateElement("div","GRAPH-CANVAS-NODE-CREATOR-SIDEBAR",{width:"100%",height:"calc(100% - 55px)",position:"relative",top:"-40px"}),GraphNodeCreator._Empty=babylonjs_editor_1.Tools.CreateElement("h1","GRAPH-CANVAS-NODE-CREATOR-EMPTY",{float:"left",left:"50%",top:"50%",transform:"translate(-50%, -50%)",overflow:"hidden",position:"relative","font-family":"Roboto,sans-serif !important",opacity:"0.5"}),GraphNodeCreator._Graph=null,GraphNodeCreator._SearchTimeout=null,GraphNodeCreator._SearchStr="",GraphNodeCreator._Sorted={},GraphNodeCreator}();exports.default=GraphNodeCreator}),$__System.registerDynamic("11",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("12",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),GetPosition=function(_super){function GetPosition(){var _this=_super.call(this)||this;return _this.title="Get Position",_this.addOutput("vec3","vec3"),_this.addOutput("x","number"),_this.addOutput("y","number"),_this.addOutput("z","number"),_this._data=new Float32Array(3),_this}return __extends(GetPosition,_super),GetPosition.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject;data[0]=node.position.x,data[1]=node.position.y,data[2]=node.position.z,this.setOutputData(0,data),this.setOutputData(1,data[0]),this.setOutputData(2,data[1]),this.setOutputData(3,data[2])},GetPosition.Desc="Get Object Position by Vec3",GetPosition.Title="Get Position",GetPosition}(typings_1.LiteGraphNode);exports.GetPosition=GetPosition;var SetPosition=function(_super){function SetPosition(){var _this=_super.call(this,!0)||this;return _this.title="Set Position",_this.addInput("vec3","vec3"),_this.addInput("x","number"),_this.addInput("y","number"),_this.addInput("z","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetPosition,_super),SetPosition.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject,vec3=this.getInputData(1);vec3?(node.position.x=data[0]=vec3[0],node.position.y=data[1]=vec3[1],node.position.z=data[2]=vec3[2]):(node.position.x=data[0]=this.getInputData(2),node.position.y=data[1]=this.getInputData(3),node.position.z=data[2]=this.getInputData(4)),this.setOutputData(0,data)},SetPosition.Desc="Set Object Position by Vec3",SetPosition.Title="Set Position",SetPosition}(typings_1.LiteGraphNode);exports.SetPosition=SetPosition}),$__System.registerDynamic("13",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),GetRotation=function(_super){function GetRotation(){var _this=_super.call(this)||this;return _this.title="Get Rotation",_this.addOutput("vec3","vec3"),_this.addOutput("x","number"),_this.addOutput("y","number"),_this.addOutput("z","number"),_this._data=new Float32Array(3),_this}return __extends(GetRotation,_super),GetRotation.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject;data[0]=node.rotation.x,data[1]=node.rotation.y,data[2]=node.rotation.z,this.setOutputData(0,data),this.setOutputData(1,data[0]),this.setOutputData(2,data[1]),this.setOutputData(3,data[2])},GetRotation.Desc="Get Object Rotation by Vec3",GetRotation.Title="Get Rotation",GetRotation}(typings_1.LiteGraphNode);exports.GetRotation=GetRotation;var SetRotation=function(_super){function SetRotation(){var _this=_super.call(this,!0)||this;return _this.title="Set Rotation",_this.addInput("vec3","vec3"),_this.addInput("x","number"),_this.addInput("y","number"),_this.addInput("z","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetRotation,_super),SetRotation.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject,vec3=this.getInputData(1);vec3?(node.rotation.x=data[0]=vec3[0],node.rotation.y=data[1]=vec3[1],node.rotation.z=data[2]=vec3[2]):(node.rotation.x=data[0]=this.getInputData(2),node.rotation.y=data[1]=this.getInputData(3),node.rotation.z=data[2]=this.getInputData(4)),this.setOutputData(0,data)},SetRotation.Desc="Set Object Rotation by Vec3",SetRotation.Title="Set Rotation",SetRotation}(typings_1.LiteGraphNode);exports.SetRotation=SetRotation}),$__System.registerDynamic("14",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),GetScale=function(_super){function GetScale(){var _this=_super.call(this)||this;return _this.title="Get Scale",_this.addOutput("vec3","vec3"),_this.addOutput("x","number"),_this.addOutput("y","number"),_this.addOutput("z","number"),_this._data=new Float32Array(3),_this}return __extends(GetScale,_super),GetScale.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject;data[0]=node.scaling.x,data[1]=node.scaling.y,data[2]=node.scaling.z,this.setOutputData(0,data),this.setOutputData(1,data[0]),this.setOutputData(2,data[1]),this.setOutputData(3,data[2])},GetScale.Desc="Get Object Scale by Vec3",GetScale.Title="Get Scale",GetScale}(typings_1.LiteGraphNode);exports.GetScale=GetScale;var SetScale=function(_super){function SetScale(){var _this=_super.call(this,!0)||this;return _this.title="Set Scale",_this.addInput("vec3","vec3"),_this.addInput("x","number"),_this.addInput("y","number"),_this.addInput("z","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetScale,_super),SetScale.prototype.onExecute=function(){var data=this._data,node=this.graph.scriptObject,vec3=this.getInputData(1);vec3?(node.scaling.x=data[0]=vec3[0],node.scaling.y=data[1]=vec3[1],node.scaling.z=data[2]=vec3[2]):(node.scaling.x=data[0]=this.getInputData(2),node.scaling.y=data[1]=this.getInputData(3),node.scaling.z=data[2]=this.getInputData(4)),this.setOutputData(0,data)},SetScale.Desc="Set Object Scale by Vec3",SetScale.Title="Set Scale",SetScale}(typings_1.LiteGraphNode);exports.SetScale=SetScale}),$__System.registerDynamic("15",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),GetAmbientColor=function(_super){function GetAmbientColor(){var _this=_super.call(this)||this;return _this.title="Get Ambient Color",_this.addOutput("color","vec3"),_this.addOutput("r","number"),_this.addOutput("g","number"),_this.addOutput("b","number"),_this._data=new Float32Array(3),_this}return __extends(GetAmbientColor,_super),GetAmbientColor.prototype.onExecute=function(){var node=this.graph.scriptObject;this._data[0]=node.ambientColor.r,this._data[1]=node.ambientColor.g,this._data[2]=node.ambientColor.b,this.setOutputData(0,this._data),this.setOutputData(1,this._data[0]),this.setOutputData(2,this._data[1]),this.setOutputData(3,this._data[2])},GetAmbientColor.Desc="Get Object Ambient Color",GetAmbientColor.Title="Get Ambient Color",GetAmbientColor}(typings_1.LiteGraphNode);exports.GetAmbientColor=GetAmbientColor;var SetAmbientColor=function(_super){function SetAmbientColor(){var _this=_super.call(this,!0)||this;return _this.title="Set Ambient Color",_this.addInput("color","vec3"),_this.addInput("r","number"),_this.addInput("g","number"),_this.addInput("b","number"),_this.addOutput("vec3","vec3"),_this._data=new Float32Array(3),_this}return __extends(SetAmbientColor,_super),SetAmbientColor.prototype.onExecute=function(){var node=this.graph.scriptObject,color=this.getInputData(1);color?(node.ambientColor.r=this._data[0]=color[0],node.ambientColor.g=this._data[1]=color[1],node.ambientColor.b=this._data[2]=color[2]):(node.ambientColor.r=this._data[0]=this.getInputData(2),node.ambientColor.g=this._data[1]=this.getInputData(3),node.ambientColor.b=this._data[2]=this.getInputData(4)),this.setOutputData(0,this._data)},SetAmbientColor.Desc="Set Object Ambient Color",SetAmbientColor.Title="Set Ambient Color",SetAmbientColor}(typings_1.LiteGraphNode);exports.SetAmbientColor=SetAmbientColor}),$__System.registerDynamic("16",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),GetClearColor=function(_super){function GetClearColor(){var _this=_super.call(this)||this;return _this.title="Get Clear Color",_this.addOutput("color","vec4"),_this.addOutput("r","number"),_this.addOutput("g","number"),_this.addOutput("b","number"),_this.addOutput("a","number"),_this._data=new Float32Array(4),_this}return __extends(GetClearColor,_super),GetClearColor.prototype.onExecute=function(){var node=this.graph.scriptObject;this._data[0]=node.clearColor.r,this._data[1]=node.clearColor.g,this._data[2]=node.clearColor.b,this._data[3]=node.clearColor.a,this.setOutputData(0,this._data),this.setOutputData(1,this._data[0]),this.setOutputData(2,this._data[1]),this.setOutputData(3,this._data[2]),this.setOutputData(4,this._data[3])},GetClearColor.Desc="Get Object Clear Color",GetClearColor}(typings_1.LiteGraphNode);exports.GetClearColor=GetClearColor;var SetClearColor=function(_super){function SetClearColor(){var _this=_super.call(this,!0)||this;return _this.title="Set Clear Color",_this.addInput("color","vec4"),_this.addInput("r","number"),_this.addInput("g","number"),_this.addInput("b","number"),_this.addInput("a","number"),_this.addOutput("color","vec4"),_this._data=new Float32Array(4),_this}return __extends(SetClearColor,_super),SetClearColor.prototype.onExecute=function(){var node=this.graph.scriptObject,color=this.getInputData(1);color?(node.clearColor.r=this._data[0]=color[0],node.clearColor.g=this._data[1]=color[1],node.clearColor.b=this._data[2]=color[2],node.clearColor.a=this._data[3]=color[3]):(node.clearColor.r=this._data[0]=this.getInputData(2),node.clearColor.g=this._data[1]=this.getInputData(3),node.clearColor.b=this._data[2]=this.getInputData(4),node.clearColor.a=this._data[3]=this.getInputData(5)),this.setOutputData(0,this._data)},SetClearColor.Desc="Set Object Clear Color",SetClearColor}(typings_1.LiteGraphNode);exports.SetClearColor=SetClearColor}),$__System.registerDynamic("17",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),GetProperty=function(_super){function GetProperty(){var _this=_super.call(this)||this;return _this._propertyValue=null,_this.title="Get Property",_this.addProperty("propertyPath","material.name"),_this.addProperty("nodePath","self"),_this.addOutput("Output","string,number,boolean"),_this}return __extends(GetProperty,_super),GetProperty.prototype.onDrawBackground=function(ctx,graph,canvas,text){this.title="Get "+this.properties.propertyPath,null!==this._propertyValue&&void 0!==this._propertyValue&&(_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this._propertyValue.toString()),this.graph.setDirtyCanvas(!0,!0))},GetProperty.prototype.onExecute=function(){for(var propertyPath=this.properties.propertyPath,nodePath=this.properties.nodePath,node=this.getTargetNode(nodePath),split=propertyPath.split("."),effectiveProperty=node[split[0]],i=1;i<split.length;i++)effectiveProperty=effectiveProperty[split[i]];this._propertyValue=effectiveProperty,this.setOutputData(0,effectiveProperty)},GetProperty.Desc="Gets the value of the given property",GetProperty.Title="Get Property",GetProperty}(typings_1.LiteGraphNode);exports.GetProperty=GetProperty;var SetProperty=function(_super){function SetProperty(){var _this=_super.call(this,!0)||this;return _this._propertyValue="",_this.title="Set Property",_this.addProperty("propertyPath","material.name"),_this.addProperty("nodePath","self"),_this.addProperty("propertyValue",""),_this.addInput("Output","number,string,boolean"),_this.addOutput("Input","string,number,boolean"),_this}return __extends(SetProperty,_super),SetProperty.prototype.onDrawBackground=function(ctx){this.title="Set "+this.properties.propertyPath},SetProperty.prototype.onExecute=function(){var propertyPath=this.properties.propertyPath,nodePath=this.properties.nodePath,node=this.getTargetNode(nodePath),split=propertyPath.split("."),length=split.length;if(1===length)this.setOutputData(0,this._setProperty(node,propertyPath));else{for(var effectiveProperty=node[split[0]],i=1;i<length-1;i++)effectiveProperty=effectiveProperty[split[i]];this.setOutputData(0,this._setProperty(effectiveProperty,split[length-1]))}},SetProperty.prototype._setProperty=function(object,path){var type=typeof object[path],value=this.properties.propertyValue;if(value){switch(type.toLowerCase()){case"boolean":object[path]="true"===value.toLowerCase();break;case"number":object[path]=parseFloat(value);break;case"string":object[path]=value}return value}return object[path]=this.getInputData(1)},SetProperty.Desc="Sets the value of the given property",SetProperty.Title="Set Property",SetProperty}(typings_1.LiteGraphNode);exports.SetProperty=SetProperty}),$__System.registerDynamic("18",["d","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("d"),typings_1=$__require("f"),Condition=function(_super){function Condition(){var _this=_super.call(this,!0)||this;return _this.title="Condition between A and B",_this.mode=litegraph_js_1.LiteGraph.ALWAYS,_this.addInput("A","number,string,boolean"),_this.addInput("B","number,string,boolean"),_this.addOutput("A == B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A != B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A > B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A < B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A <= B",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("A >= B",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(Condition,_super),Condition.prototype.onExecute=function(){var a=this.getInputData(1),b=this.getInputData(2);a===b&&this.triggerSlot(0),a!==b&&this.triggerSlot(1),a>b&&this.triggerSlot(2),a<b&&this.triggerSlot(3),a<=b&&this.triggerSlot(4),function(a){return b}&&this.triggerSlot(5)},Condition.Desc='If the condition result is "true", then the Execute output will be triggered',Condition.Title="Condition",Condition}(typings_1.LiteGraphNode);exports.Condition=Condition}),$__System.registerDynamic("19",["c","d","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),litegraph_js_1=$__require("d"),typings_1=$__require("f"),AbstractPointer=function(_super){function AbstractPointer(title,pointerEventType,resetState){var _this=_super.call(this)||this;return _this.isSuccess=!1,_this._observer=null,_this.title=title,_this._pointerEventType=pointerEventType,_this._resetState=resetState,_this.addOutput("Execute",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(AbstractPointer,_super),AbstractPointer.prototype.onExecute=function(){var _this=this,mesh=this.graph.scriptObject,scene=mesh.getScene();this._observer||(this._observer=scene.onPointerObservable.add(function(p){if(p.type===_this._pointerEventType){var pick=scene.pick(scene.pointerX,scene.pointerY);_this.isSuccess=_this.customCheck?_this.customCheck(mesh,pick.pickedMesh):pick.pickedMesh===mesh}})),this.isSuccess&&(this._resetState&&(this.isSuccess=!1),this.triggerSlot(0))},AbstractPointer}(typings_1.LiteGraphNode);exports.AbstractPointer=AbstractPointer;var PointerOver=function(_super){function PointerOver(){return _super.call(this,"Pointer Over",babylonjs_1.PointerEventTypes.POINTERMOVE,!1)||this}return __extends(PointerOver,_super),PointerOver.Desc="Triggers and action on the pointer is over the mesh (only meshes are supported)",PointerOver.Title="On Pointer Over",PointerOver}(AbstractPointer);exports.PointerOver=PointerOver;var PointerDown=function(_super){function PointerDown(){return _super.call(this,"Pointer Down",babylonjs_1.PointerEventTypes.POINTERDOWN,!0)||this}return __extends(PointerDown,_super),PointerDown.Desc="Triggers and action on the pointer is down on the mesh (only meshes are supported)",PointerDown.Title="On Pointer Down",PointerDown}(AbstractPointer);exports.PointerDown=PointerDown;var PointerOut=function(_super){function PointerOut(){var _this=_super.call(this,"Pointer Out",babylonjs_1.PointerEventTypes.POINTERMOVE,!0)||this;return _this._wasOver=!1,_this}return __extends(PointerOut,_super),PointerOut.prototype.customCheck=function(mesh,pickedMesh){return this._wasOver&&mesh!==pickedMesh?(this._wasOver=!1,!0):(this._wasOver=mesh===pickedMesh,!1)},PointerOut.Desc="Triggers and action on the pointer is out on the mesh (only meshes are supported)",PointerOut.Title="On Pointer Out",PointerOut}(AbstractPointer);exports.PointerOut=PointerOut}),$__System.registerDynamic("1a",["d","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("d"),typings_1=$__require("f"),SetTimeout=function(_super){function SetTimeout(){var _this=_super.call(this,!0)||this;return _this.timeoutId=null,_this.addOutput("Execute",litegraph_js_1.LiteGraph.EVENT),_this.addOutput("Timeout Id","number"),_this.addProperty("ms",1e3),_this}return __extends(SetTimeout,_super),SetTimeout.prototype.onExecute=function(){var _this=this,id=setTimeout(function(){_this.triggerSlot(0)},this.properties.ms);this.setOutputData(1,id)},SetTimeout.Desc="Triggers output once the current time is out of the provided time (in ms)",SetTimeout.Title="Set Timeout",SetTimeout}(typings_1.LiteGraphNode);exports.SetTimeout=SetTimeout;var ClearTimeout=function(_super){function ClearTimeout(){var _this=_super.call(this,!0)||this;return _this.addInput("Timeout Id","number"),_this}return __extends(ClearTimeout,_super),ClearTimeout.prototype.onExecute=function(){var id=this.getInputData(1);clearTimeout(id)},ClearTimeout.Desc="Clears the given timeout id",ClearTimeout.Title="Clear Timeout",ClearTimeout}(typings_1.LiteGraphNode);exports.ClearTimeout=ClearTimeout}),$__System.registerDynamic("1b",["d","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("d"),typings_1=$__require("f"),PlayAnimations=function(_super){function PlayAnimations(){var _this=_super.call(this,!0)||this;return _this.title="Play Animations",_this.addOutput("On End",litegraph_js_1.LiteGraph.EVENT),_this.addProperty("from",0),_this.addProperty("to",60),_this.addProperty("loop",!1),_this.addProperty("speed",1),_this}return __extends(PlayAnimations,_super),PlayAnimations.prototype.onExecute=function(){var _this=this,node=this.graph.scriptObject;node.getScene().beginAnimation(node,this.properties.from,this.properties.to,this.properties.loop,this.properties.speed,function(){return _this.triggerSlot(0)})},PlayAnimations.Desc="Plays animations of the attached node",PlayAnimations.Title="Play Animations",PlayAnimations}(typings_1.LiteGraphNode);exports.PlayAnimations=PlayAnimations;var StopAnimations=function(_super){function StopAnimations(){var _this=_super.call(this,!0)||this;return _this.title="Stop Animations",_this.addOutput("On Stopped",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(StopAnimations,_super),StopAnimations.prototype.onExecute=function(){var node=this.graph.scriptObject;node.getScene().stopAnimation(node),this.triggerSlot(0)},StopAnimations.Desc="Stops animations of the attached node",StopAnimations.Title="Stop Animations",StopAnimations}(typings_1.LiteGraphNode);exports.StopAnimations=StopAnimations}),$__System.registerDynamic("1c",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),Number=function(_super){function Number(){var _this=_super.call(this)||this;return _this.title="Number",_this.addOutput("value","number"),_this.addProperty("value",1),_this}return __extends(Number,_super),Number.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.properties.value.toString()),this.graph.setDirtyCanvas(!0,!0)},Number.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},Number.Desc="Represents a constant number",Number}(typings_1.LiteGraphNode);exports.Number=Number;var String=function(_super){function String(){var _this=_super.call(this)||this;return _this.title="String",_this.addOutput("value","string"),_this.addProperty("value","New String"),_this}return __extends(String,_super),String.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.properties.value.toString()),this.graph.setDirtyCanvas(!0,!0)},String.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},String.Desc="Represents a constant string",String}(typings_1.LiteGraphNode);exports.String=String;var Boolean=function(_super){function Boolean(){var _this=_super.call(this)||this;return _this.title="Boolean",_this.addOutput("value","boolean"),_this.addProperty("value",!0),_this}return __extends(Boolean,_super),Boolean.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,this.properties.value.toString()),this.graph.setDirtyCanvas(!0,!0)},Boolean.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},Boolean.Desc="Represents a constant boolean",Boolean}(typings_1.LiteGraphNode);exports.Boolean=Boolean}),$__System.registerDynamic("1d",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),Color=function(_super){function Color(){var _this=_super.call(this)||this;return _this.title="Color",_this.addOutput("color3","vec3,vec4"),_this.addOutput("r","number"),_this.addOutput("g","number"),_this.addOutput("b","number"),_this.addProperty("r",1),_this.addProperty("g",1),_this.addProperty("b",1),_this.addProperty("a",1),_this._data=new Float32Array(4),_this}return __extends(Color,_super),Color.prototype.onExecute=function(){this._data[0]=this.properties.r,this._data[1]=this.properties.g,this._data[2]=this.properties.b,this._data[3]=this.properties.a,this.setOutputData(0,this._data),this.setOutputData(1,this.properties.r),this.setOutputData(2,this.properties.g),this.setOutputData(3,this.properties.b)},Color.Desc="Represents a constant color",Color}(typings_1.LiteGraphNode);exports.Color=Color}),$__System.registerDynamic("1e",["f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var typings_1=$__require("f"),Time=function(_super){function Time(){var _this=_super.call(this)||this;return _this.title="Time",_this.addOutput("in ms","number"),_this.addOutput("in sec","number"),_this}return __extends(Time,_super),Time.prototype.onDrawBackground=function(ctx,graph,canvas,text){_super.prototype.onDrawBackground.call(this,ctx,graph,canvas,(this.graph.globaltime>>0).toString()),this.graph.setDirtyCanvas(!0,!0)},Time.prototype.onExecute=function(){this.setOutputData(0,1e3*this.graph.globaltime),this.setOutputData(1,this.graph.globaltime)},Time.Desc="Outputs the current time in ms or seconds",Time}(typings_1.LiteGraphNode);exports.Time=Time}),$__System.registerDynamic("1f",["c","d","20","11","12","13","14","15","16","21","17","18","19","1a","1b","1c","1d","1e","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),litegraph_js_1=$__require("d");exports.LGraph=litegraph_js_1.LGraph,exports.LGraphCanvas=litegraph_js_1.LGraphCanvas,exports.LiteGraph=litegraph_js_1.LiteGraph,exports.LGraphGroup=litegraph_js_1.LGraphGroup;var extensions_1=$__require("20"),extension_1=$__require("11"),position_1=$__require("12"),rotation_1=$__require("13"),scale_1=$__require("14"),ambient_color_1=$__require("15"),clear_color_1=$__require("16"),engine_1=$__require("21"),property_1=$__require("17"),condition_1=$__require("18"),pointer_1=$__require("19"),timeout_1=$__require("1a"),animation_1=$__require("1b"),const_1=$__require("1c"),color_1=$__require("1d"),time_1=$__require("1e"),typings_1=$__require("f");exports.LiteGraphNode=typings_1.LiteGraphNode;var GraphExtension=function(_super){function GraphExtension(scene){var _this=_super.call(this,scene)||this;return _this.id="graph-editor",_this.assetsCaption="Graphs",_this.datas=null,_this}return __extends(GraphExtension,_super),GraphExtension.prototype.onGetAssets=function(){var data=this.onSerialize(),attached=[],unAttached=[];return data.graphs.forEach(function(s){if(data.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.graphId===s.id})}))return attached.push({name:s.name,data:s});unAttached.push({name:s.name,data:s})}),[{separator:"Attached"}].concat(attached).concat([{separator:"Unattached"}]).concat(unAttached)},GraphExtension.prototype.onRemoveAsset=function(asset){var data=asset.data,remove=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behaviorGraph)for(var graphs=o.metadata.behaviorGraph,links=graphs.metadatas,i=0;i<links.length;i++)links[i].graphId===data.id&&(links.splice(i,1),i--)})};remove([this.scene]),remove(this.scene.meshes),remove(this.scene.lights),remove(this.scene.cameras);var index=this.scene.metadata.behaviorGraphs.indexOf(data);-1!==index&&this.scene.metadata.behaviorGraphs.splice(index,1)},GraphExtension.prototype.onAddAsset=function(asset){this.scene.metadata.behaviorGraphs.push(asset.data)},GraphExtension.prototype.onDragAndDropAsset=function(targetMesh,asset){targetMesh.metadata=targetMesh.metadata||{},targetMesh.metadata.behaviorGraph||(targetMesh.metadata.behaviorGraph={node:targetMesh.name,metadatas:[]}),targetMesh.metadata.behaviorGraph.metadatas.push({graphId:asset.data.id,active:!0})},GraphExtension.prototype.onApply=function(data){var _this=this;this.datas=data,GraphExtension.RegisterNodes(),this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node&&d.metadatas.forEach(function(m){if(m.active){var graph=new litegraph_js_1.LGraph;graph.scriptObject=node,graph.scriptScene=_this.scene,typings_1.LiteGraphNode.Loaded=!1,graph.configure(_this.datas.graphs.find(function(s){return s.id===m.graphId}).graph),typings_1.LiteGraphNode.Loaded=!0,_this.scene.onReadyObservable.addOnce(function(){graph.start()});graph._nodes.forEach(function(n){n instanceof engine_1.RenderLoop?_this.scene.onAfterRenderObservable.add(function(){return n.onExecute()}):n instanceof engine_1.RenderStart&&_this.scene.onAfterRenderObservable.addOnce(function(){return n.onExecute()})})}})})},GraphExtension.prototype.onSerialize=function(){var result={graphs:this.scene.metadata?this.scene.metadata.behaviorGraphs||[]:[],nodes:[]},add=function(objects){objects.forEach(function(o){if(o.metadata&&o.metadata.behaviorGraph){var behavior=o.metadata.behaviorGraph;behavior.node=o instanceof babylonjs_1.Scene?"Scene":o instanceof Node?o.name:o.id,behavior.nodeId=o instanceof babylonjs_1.Scene?"Scene":o.id,result.nodes.push(behavior)}})};return add([this.scene]),add(this.scene.meshes),add(this.scene.lights),add(this.scene.cameras),result},GraphExtension.prototype.onLoad=function(data){var _this=this;if(!data.graphs){var oldData=data;data={graphs:[],nodes:[]},oldData.forEach(function(od){var node={node:od.node,nodeId:od.node,metadatas:[]};od.metadatas.forEach(function(m){var id=babylonjs_1.Tools.RandomId();data.graphs.push({name:m.name,id:id,graph:m.graph}),node.metadatas.push({graphId:id,active:m.active})}),data.nodes.push(node)})}this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.behaviorGraphs=this.datas.graphs,this.datas.nodes.forEach(function(d){var node="Scene"===d.node?_this.scene:_this.scene.getNodeByID(d.nodeId)||_this.scene.getNodeByName(d.node);node&&(node.metadata=node.metadata||{},node.metadata.behaviorGraph=d)})},GraphExtension.ClearNodes=function(){var available=["node","scene","core","logic","basic/script","basic/const","math/compare","math/condition","math/formula","math/converter","math/range"];Object.keys(litegraph_js_1.LiteGraph.registered_node_types).forEach(function(k){var split=k.split("/");-1===available.indexOf(split[0])&&-1===available.indexOf(k)||delete litegraph_js_1.LiteGraph.registered_node_types[k]})},GraphExtension.RegisterNodes=function(object){var available=["node","scene","math","math3d","basic","logic"];Object.keys(litegraph_js_1.LiteGraph.registered_node_types).forEach(function(k){var split=k.split("/");-1===available.indexOf(split[0])&&-1===available.indexOf(k)&&delete litegraph_js_1.LiteGraph.registered_node_types[k]}),const_1.Number.Register("basic/number",const_1.Number),const_1.String.Register("basic/string",const_1.String),const_1.Boolean.Register("basic/boolean",const_1.Boolean),color_1.Color.Register("basic/color",color_1.Color),time_1.Time.Register("basic/time",time_1.Time),engine_1.RenderStart.Register("render/renderstarts",engine_1.RenderStart),engine_1.RenderLoop.Register("render/renderloop",engine_1.RenderLoop),condition_1.Condition.Register("logic/condition",condition_1.Condition),(!object||object instanceof babylonjs_1.AbstractMesh)&&(pointer_1.PointerOver.Register("event/pointerover",pointer_1.PointerOver),pointer_1.PointerDown.Register("event/pointerdown",pointer_1.PointerDown),pointer_1.PointerOut.Register("event/pointerout",pointer_1.PointerOut)),timeout_1.SetTimeout.Register("event/settimeout",timeout_1.SetTimeout),timeout_1.ClearTimeout.Register("event/cleartimeout",timeout_1.ClearTimeout),animation_1.PlayAnimations.Register("action/playanimations",animation_1.PlayAnimations),animation_1.StopAnimations.Register("action/stopanimations",animation_1.StopAnimations),property_1.GetProperty.Register("property/get",property_1.GetProperty),property_1.SetProperty.Register("property/set",property_1.SetProperty),(!object||object instanceof babylonjs_1.Scene)&&(clear_color_1.GetClearColor.Register("scene/getclearcolor",clear_color_1.GetClearColor),clear_color_1.SetClearColor.Register("scene/setclearcolor",clear_color_1.SetClearColor),ambient_color_1.GetAmbientColor.Register("scene/getambientcolor",ambient_color_1.GetAmbientColor),ambient_color_1.SetAmbientColor.Register("scene/setambientcolor",ambient_color_1.SetAmbientColor)),(!object||object.position&&object.position instanceof babylonjs_1.Vector3)&&(position_1.GetPosition.Register("node/getposition",position_1.GetPosition),position_1.SetPosition.Register("node/setposition",position_1.SetPosition)),(!object||object.rotation&&object.rotation instanceof babylonjs_1.Vector3)&&(rotation_1.GetRotation.Register("node/getrotation",rotation_1.GetRotation),rotation_1.SetRotation.Register("node/setrotation",rotation_1.SetRotation)),(!object||object.scaling&&object.scaling instanceof babylonjs_1.Vector3)&&(scale_1.GetScale.Register("node/getscale",scale_1.GetScale),scale_1.SetScale.Register("node/setscale",scale_1.SetScale))},GraphExtension}(extension_1.default);exports.default=GraphExtension,extensions_1.default.Register("BehaviorGraphExtension",GraphExtension)}),$__System.registerDynamic("f",["d"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("d"),LiteGraphNode=function(){function LiteGraphNode(addExecute){this.size=[60,20],this.shape="round",addExecute&&this.addInput("Execute",litegraph_js_1.LiteGraph.EVENT)}return LiteGraphNode.prototype.onConnectionsChange=function(type,slot,added){LiteGraphNode.Loaded&&this.mode!==litegraph_js_1.LiteGraph.NEVER&&(type===litegraph_js_1.LiteGraph.INPUT&&0===slot&&(this.mode=added?litegraph_js_1.LiteGraph.ON_TRIGGER:litegraph_js_1.LiteGraph.ALWAYS),LiteGraphNode.SetColor(this))},LiteGraphNode.prototype.hasProperty=function(name){return void 0!==this.properties[name]},LiteGraphNode.prototype.onDrawBackground=function(ctx,graph,canvas,text){!this.flags.collapsed&&text&&(ctx.font="14px Arial",ctx.fillStyle="grey",ctx.textAlign="center",ctx.fillText(text,.5*this.size[0],.5*this.size[1]+7),ctx.textAlign="left")},LiteGraphNode.prototype.getTargetNode=function(name){return"self"===name?this.graph.scriptObject:"Scene"===name?this.graph.scriptScene:this.graph.scriptScene.getNodeByName(name)},LiteGraphNode.Register=function(location,ctor){if(!this.LastCtor)return this.LastCtor=ctor,void litegraph_js_1.LiteGraph.registerNodeType(location,ctor);litegraph_js_1.LiteGraph.registered_node_types[location]=this.LastCtor},LiteGraphNode.SetColor=function(node){switch(node.mode){case litegraph_js_1.LiteGraph.ALWAYS:node.color="#333",node.bgColor="#AAA";break;case litegraph_js_1.LiteGraph.ON_EVENT:node.color="#55A",node.bgColor="#44A";break;case litegraph_js_1.LiteGraph.ON_TRIGGER:node.color="#5A5",node.bgColor="#4A4";break;case litegraph_js_1.LiteGraph.NEVER:node.color="#A55",node.bgColor="#A44"}},LiteGraphNode.LastCtor=null,LiteGraphNode.Loaded=!1,LiteGraphNode}();exports.LiteGraphNode=LiteGraphNode}),$__System.registerDynamic("21",["d","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var litegraph_js_1=$__require("d"),typings_1=$__require("f"),RenderLoop=function(_super){function RenderLoop(){var _this=_super.call(this)||this;return _this.title="Render Loop",_this.mode=litegraph_js_1.LiteGraph.NEVER,_this.addOutput("Render",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(RenderLoop,_super),RenderLoop.prototype.onExecute=function(){this.triggerSlot(0)},RenderLoop.Desc="On Render Loop",RenderLoop.Title="On Render Loop",RenderLoop}(typings_1.LiteGraphNode);exports.RenderLoop=RenderLoop;var RenderStart=function(_super){function RenderStart(){var _this=_super.call(this)||this;return _this.started=!1,_this.title="Render Starts",_this.mode=litegraph_js_1.LiteGraph.NEVER,_this.addOutput("Render",litegraph_js_1.LiteGraph.EVENT),_this}return __extends(RenderStart,_super),RenderStart.prototype.onExecute=function(){this.started||(this.started=!0,this.triggerSlot(0))},RenderStart.Desc="On rendering starts (called once)",RenderStart.Title="On Render Starts",RenderStart}(typings_1.LiteGraphNode);exports.RenderStart=RenderStart}),$__System.registerDynamic("a",["c","d","e","b","10","20","1f","f","21"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("c"),litegraph_js_1=$__require("d"),babylonjs_editor_1=$__require("e"),graph_tool_1=$__require("b"),graph_node_creator_1=$__require("10"),extensions_1=$__require("20"),graph_1=$__require("1f");$__require("1f");var typings_1=$__require("f"),engine_1=$__require("21"),BehaviorGraphEditor=function(_super){function BehaviorGraphEditor(editor){var _this=_super.call(this,"Graph Editor")||this;return _this.editor=editor,_this.layout=null,_this.toolbar=null,_this.grid=null,_this.graphData=null,_this.graph=null,_this.extension=null,_this.node=null,_this.data=null,_this.datas=null,_this.selectedObjectObserver=null,_this.selectedAssetObserver=null,_this._savedState={},_this._mouseMoveEvent=null,_this}return __extends(BehaviorGraphEditor,_super),BehaviorGraphEditor.OnLoaded=function(editor){editor.inspector.addTool(new graph_tool_1.default),graph_node_creator_1.default.Init()},BehaviorGraphEditor.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return document.removeEventListener("mousemove",this._mouseMoveEvent),this.playStop(!0),this.layout.element.destroy(),this.toolbar.element.destroy(),this.grid.element.destroy(),this.editor.core.onSelectObject.remove(this.selectedObjectObserver),this.editor.core.onSelectAsset.remove(this.selectedAssetObserver),this.node&&this.editor.inspector.setObject(this.node),[4,_super.prototype.close.call(this)];case 1:return _a.sent(),[2]}})})},BehaviorGraphEditor.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return this.layout=new babylonjs_editor_1.Layout(this.divElement.id),this.layout.panels=[{type:"top",resizable:!1,size:30,content:'<div id="GRAPH-EDITOR-TOOLBAR" style="width: 100%; height: 100%"></div>'},{type:"left",content:'<div id="GRAPH-EDITOR-LIST" style="width: 100%; height: 100%;"></div>',size:250,overflow:"auto",resizable:!0},{type:"main",content:'<canvas id="GRAPH-EDITOR-EDITOR" class="graphcanvas" style="width: 100%; height: 100%; position: absolute; top: 0;"></canvas>',resizable:!0}],this.layout.build(this.divElement.id),this.toolbar=new babylonjs_editor_1.Toolbar("GRAPH-EDITOR-TOOLBAR"),this.toolbar.items=[{id:"add-new",text:"Add New Graph",caption:"Add New Graph",img:"icon-add"},{type:"break"},{id:"paste",text:"Paste",caption:"Paste",img:"icon-export"},{type:"break"},{id:"play-stop",text:"Start / Stop",caption:"Start / Stop",img:"icon-play-game"},{type:"break"},{id:"import",text:"Import from...",caption:"Import from...",img:"icon-add"}],this.toolbar.onClick=function(id){return _this.toolbarClicked(id)},this.toolbar.right="No object selected",this.toolbar.build("GRAPH-EDITOR-TOOLBAR"),this.grid=new babylonjs_editor_1.Grid("GRAPH-EDITOR-LIST",{toolbarReload:!1,toolbarSearch:!1,toolbarEdit:!1}),this.grid.columns=[{field:"name",caption:"Name",size:"80%",editable:{type:"string"}},{field:"active",caption:"Active",size:"20%",editable:{type:"checkbox"}}],this.grid.contextMenuItems=[{id:1,text:"Copy",icon:"icon-export"},{id:2,text:"Clone",icon:"icon-export"}],this.grid.onAdd=function(){return _this._importFrom([_this._getSerializedMetadatasFile()])},this.grid.onClick=function(ids){return _this.selectGraph(ids[0])},this.grid.onDelete=function(ids){return _this.delete(ids)},this.grid.onChange=function(id,value){return _this.change(id,value)},this.grid.onContextMenu=function(id,recid){return _this.gridContextMenuClicked(id,recid)},this.grid.build("GRAPH-EDITOR-LIST"),System.import("./node_modules/litegraph.js/css/litegraph.css"),this.graphData=new litegraph_js_1.LGraph,this.graphData.onStopEvent=function(){_this.graphData._nodes.forEach(function(n){return n instanceof engine_1.RenderStart&&(n.started=!1)})},this.graphData.onNodeAdded=function(node){node.shape="round",typings_1.LiteGraphNode.SetColor(node)},this.graph=new litegraph_js_1.LGraphCanvas("#GRAPH-EDITOR-EDITOR",this.graphData),this.graph.canvas.classList.add("ctxmenu"),document.addEventListener("mousemove",this._mouseMoveEvent=function(ev){_this.data&&(_this.data.graph=JSON.parse(JSON.stringify(_this.graphData.serialize())),babylonjs_editor_1.VSCodeSocket.RefreshBehaviorGraph(_this.data))}),this.graph.canvas.addEventListener("click",function(){var canvasPos=_this.graph.convertEventToCanvas(event);if(!_this.graphData.getNodeOnPos(canvasPos[0],canvasPos[1])){var group=_this.graphData.getGroupOnPos(canvasPos[0],canvasPos[1]);group&&_this.editor.inspector.setObject(group)}}),this.graph.render_canvas_border=!1,this.graph.render_execution_order=!0,this.graph.onNodeSelected=function(node){return _this.editor.inspector.setObject(node)},this.graph.showSearchBox=function(){},this.graph.processContextMenu=function(node,event){if(!node){var group_1=_this.graphData.getGroupOnPos(event.canvasX,event.canvasY);return group_1?babylonjs_editor_1.ContextMenu.Show(event,{remove:{name:"Remove",callback:function(){!1!==group_1.removable&&_this.graphData.remove(group_1)}}}):(graph_node_creator_1.default.OnConfirmSelection=function(id){var node="group"===id?new litegraph_js_1.LGraphGroup:litegraph_js_1.LiteGraph.createNode(id);node&&(node.pos=_this.graph.convertEventToCanvas(event),node.size[0]<100&&(node.size[0]=100),_this.graphData.add(node),graph_node_creator_1.default.Hide())},graph_node_creator_1.default.Show())}babylonjs_editor_1.ContextMenu.Show(event,{clone:{name:"Clone",callback:function(){var clone=litegraph_js_1.LiteGraph.createNode(node.type);clone.pos=[node.pos[0]+10,node.pos[1]+10],Object.assign(clone.properties,node.properties),_this.graphData.add(clone)}},remove:{name:"Remove",callback:function(){!1!==node.removable&&_this.graphData.remove(node)}}})},graph_1.default.ClearNodes(),graph_1.default.RegisterNodes(),graph_node_creator_1.default.InitItems(),this.editor.core.scene.metadata=this.editor.core.scene.metadata||{},this.editor.core.scene.metadata.behaviorGraphs=this.editor.core.scene.metadata.behaviorGraphs||[],this.selectedObjectObserver=this.editor.core.onSelectObject.add(function(data){return _this.objectSelected(data)}),this.selectedAssetObserver=this.editor.core.onSelectAsset.add(function(data){return _this.assetSelected(data)}),this.objectSelected(this.editor.core.currentSelectedObject),this.extension=extensions_1.default.RequestExtension(this.editor.core.scene,"BehaviorGraphExtension"),this.editor.assets.addTab(this.extension),babylonjs_editor_1.VSCodeSocket.OnUpdateBehaviorGraph=function(d){return __awaiter(_this,void 0,void 0,function(){var graphs,effective,scale,offset;return __generator(this,function(_a){return graphs=this.editor.core.scene.metadata.behaviorGraphs,(effective=graphs.find(function(g){return g.id===d.id}))?(effective.graph=d.graph,this.data&&this.data.id===d.id&&(scale=this.graph.scale,offset=this.graph.offset.slice(),typings_1.LiteGraphNode.Loaded=!1,this.graphData.configure(this.data.graph),typings_1.LiteGraphNode.Loaded=!0,this.graph.offset=offset,this.graph.scale=scale,this.graph.dirty_canvas=!0,this.graph.dirty_bgcanvas=!0),[2]):(babylonjs_editor_1.VSCodeSocket.RefreshBehaviorGraph(graphs),[2])})})},[2]})})},BehaviorGraphEditor.prototype.onShow=function(){this.onResize()},BehaviorGraphEditor.prototype.onResize=function(){this.layout.element.resize();var size=this.layout.getPanelSize("main");this.graph.resize(size.width,size.height)},BehaviorGraphEditor.prototype.toolbarClicked=function(id){switch(id){case"add-new":this.add();break;case"paste":if(BehaviorGraphEditor._CopiedGraph){var graphs=this.editor.core.scene.metadata.behaviorGraphs,clonedGraph=Object.assign({},graphs.find(function(g){return g.id===BehaviorGraphEditor._CopiedGraph.graphId}));clonedGraph.id=babylonjs_1.Tools.RandomId(),graphs.push(clonedGraph);var clone=Object.assign({},BehaviorGraphEditor._CopiedGraph);clone.graphId=clonedGraph.id,this.datas.metadatas.push(clone),this.editor.assets.refresh(this.extension.id),this.objectSelected(this.node)}break;case"play-stop":this.playStop();break;case"import":this._importFrom()}},BehaviorGraphEditor.prototype.gridContextMenuClicked=function(id,recid){switch(id){case 1:BehaviorGraphEditor._CopiedGraph=this.datas.metadatas[recid];break;case 2:var graphs=this.editor.core.scene.metadata.behaviorGraphs,metadata_1=this.datas.metadatas[recid],clonedGraph=Object.assign({},graphs.find(function(g){return g.id===metadata_1.graphId}));clonedGraph.id=babylonjs_1.Tools.RandomId(),clonedGraph.name+=" Cloned",graphs.push(clonedGraph);var clone=Object.assign({},this.datas.metadatas[recid]);clone.graphId=clonedGraph.id,this.datas.metadatas.push(clone),this.editor.assets.refresh(this.extension.id),this.objectSelected(this.node)}},BehaviorGraphEditor.prototype.assetSelected=function(asset){if(this.node=null,!asset)return this.objectSelected(null);asset.graph&&(this.layout.hidePanel("left"),this.toolbar.updateItem("paste",{hidden:!0}),this.toolbar.updateItem("play-stop",{hidden:!0}),this.onResize(),this.datas={node:"Unknown",nodeId:"Unknown",metadatas:[{active:!0,graphId:asset.id}]},this.selectGraph(0),this.layout.unlockPanel("left"),this.layout.unlockPanel("main"))},BehaviorGraphEditor.prototype.objectSelected=function(node){var _this=this;if(!(node&&(node instanceof babylonjs_1.Node||node instanceof babylonjs_1.Scene)))return this.layout.lockPanel("left"),this.layout.lockPanel("main","No Node Selected"),this.toolbar.updateItem("paste",{hidden:!0}),void this.toolbar.updateItem("play-stop",{hidden:!0});this.playStop(!0),this.node=node,node.metadata=node.metadata||{},this.datas=node.metadata.behaviorGraph,this.datas||(this.datas=node.metadata.behaviorGraph={node:node instanceof babylonjs_1.Scene?"Scene":node.name,nodeId:node instanceof babylonjs_1.Scene?"Scene":node.id,metadatas:[]}),this.data=null,this.grid.element.clear(),this.graphData.clear(),this.graphData.scriptObject=node,this.graphData.scriptScene=this.editor.core.scene;var graphs=this.editor.core.scene.metadata.behaviorGraphs;this.datas.metadatas.forEach(function(d,index){var graph=graphs.find(function(s){return s.id===d.graphId});_this.grid.addRecord({recid:index,name:graph.name,active:d.active})}),this.grid.element.refresh(),this.datas.metadatas.length>0&&(this.selectGraph(0),this.grid.select([0])),this.layout.showPanel("left"),this.onResize(),this._updateToolbarText(),this.layout.unlockPanel("left"),0===this.datas.metadatas.length?this.layout.lockPanel("main","No Graph Selected"):this.layout.unlockPanel("main"),this.toolbar.updateItem("paste",{hidden:!1}),this.toolbar.updateItem("play-stop",{hidden:!1})},BehaviorGraphEditor.prototype.selectGraph=function(index){var _this=this,graphs=this.editor.core.scene.metadata.behaviorGraphs;this.data=graphs.find(function(s){return s.id===_this.datas.metadatas[index].graphId}),this.playStop(!0),graph_1.default.ClearNodes(),graph_1.default.RegisterNodes(this.node),this.graphData.clear(),typings_1.LiteGraphNode.Loaded=!1,this.graphData.configure(JSON.parse(JSON.stringify(this.data.graph))),typings_1.LiteGraphNode.Loaded=!0,this._updateToolbarText()},BehaviorGraphEditor.prototype.add=function(){return __awaiter(this,void 0,void 0,function(){var name,data;return __generator(this,function(_a){switch(_a.label){case 0:return graph_1.default.ClearNodes(),graph_1.default.RegisterNodes(this.node),[4,babylonjs_editor_1.Dialog.CreateWithTextInput("Graph Name")];case 1:return name=_a.sent(),data={name:name,id:babylonjs_1.Tools.RandomId(),graph:JSON.parse(JSON.stringify((new litegraph_js_1.LGraph).serialize()))},this.editor.core.scene.metadata.behaviorGraphs.push(data),this.node?(this.datas.metadatas.push({active:!0,graphId:data.id}),this.grid.addRow({recid:this.datas.metadatas.length-1,name:data.name,active:!0}),this.grid.selectNone(),this.grid.select([this.datas.metadatas.length-1]),this.selectGraph(this.datas.metadatas.length-1),this.editor.graph.configure()):this.assetSelected(data),this.layout.unlockPanel("main"),this.editor.assets.refresh(this.extension.id),[2]}})})},BehaviorGraphEditor.prototype.delete=function(ids){var _this=this;this.playStop(!0);var offset=0;ids.forEach(function(id){_this.datas.metadatas.splice(id-offset,1),offset++}),this.objectSelected(this.node),this.editor.assets.refresh(this.extension.id),this.editor.graph.configure()},BehaviorGraphEditor.prototype.change=function(id,value){var _this=this;if("string"==typeof value){this.editor.core.scene.metadata.behaviorGraphs.find(function(s){return s.id===_this.datas.metadatas[id].graphId}).name=value,this._updateToolbarText(),this.editor.assets.refresh(this.extension.id)}else this.datas.metadatas[id].active=value},BehaviorGraphEditor.prototype.playStop=function(stop){var _this=this;if(void 0===stop&&(stop=!1),stop||this.graphData.status===litegraph_js_1.LGraph.STATUS_RUNNING){if(this.node){this.editor.core.scene.stopAnimation(this.node),this._savedState.material&&(babylonjs_1.SerializationHelper.Parse(function(){return _this.node.material},this._savedState.material,this.editor.core.scene,"file:"),delete this._savedState.material);for(var obj in this._savedState)this.node[obj]=this._savedState[obj]}this._savedState={},this.graphData.stop(),this.toolbar.updateItem("play-stop",{img:"icon-play-game",checked:!1}),this.editor.core.disableObjectSelection=!1}else{this.node.position&&(this._savedState.position=this.node.position.clone()),this.node.rotation&&(this._savedState.rotation=this.node.rotation.clone()),this.node.scaling&&(this._savedState.scaling=this.node.scaling.clone()),this.node.rotationQuaternion&&(this._savedState.rotationQuaternion=this.node.rotationQuaternion.clone()),this.node.material&&(this._savedState.material=this.node.material.serialize());Object.keys(this.node).forEach(function(k){if("_"!==k[0]){var type=typeof _this.node[k];if("number"===type||"string"===type||"boolean"===type)return void(_this._savedState[k]=_this.node[k]);var ctor=babylonjs_editor_1.Tools.GetConstructorName(_this.node[k]);return"Vector3"===ctor||"Vector3"===ctor||"Vector4"===ctor?void(_this._savedState[k]=_this.node[k].clone()):"Color3"===ctor||"Color4"===ctor?void(_this._savedState[k]=_this.node[k].clone()):void 0}});this.graphData._nodes.forEach(function(n){return n instanceof engine_1.RenderStart?_this.editor.core.scene.onAfterRenderObservable.addOnce(function(){return n.onExecute()}):n instanceof engine_1.RenderLoop?_this.editor.core.scene.onAfterRenderObservable.addOnce(function(){return n.onExecute()}):void 0}),this.graphData.start(),this.toolbar.updateItem("play-stop",{img:"icon-error",checked:!0}),this.editor.core.disableObjectSelection=!0}},BehaviorGraphEditor.prototype._updateToolbarText=function(){this.toolbar.element.right="<h2>"+(this.data?this.data.name:"")+'</h2> Attached to "'+(this.node instanceof babylonjs_1.Scene?"Scene":this.node?this.node.name:"")+'"',this.toolbar.element.render()},BehaviorGraphEditor.prototype._getSerializedMetadatasFile=function(){var result={customMetadatas:{BehaviorGraphExtension:this.extension.onSerialize()}};return babylonjs_editor_1.Tools.CreateFile(babylonjs_editor_1.Tools.ConvertStringToUInt8Array(JSON.stringify(result)),"editorproject")},BehaviorGraphEditor.prototype._importFrom=function(files){return __awaiter(this,void 0,void 0,function(){var importFromFile,_loop_1,this_1,_i,files_1,f,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return importFromFile=!1,files?[3,2]:(importFromFile=!0,[4,babylonjs_editor_1.Tools.OpenFileDialog()]);case 1:files=_a.sent(),_a.label=2;case 2:_loop_1=function(f){var content,project,metadatas,graphs,picker;return __generator(this,function(_a){switch(_a.label){case 0:return"editorproject"!==babylonjs_editor_1.Tools.GetFileExtension(f.name)?[2,"continue"]:[4,babylonjs_editor_1.Tools.ReadFileAsText(f)];case 1:return content=_a.sent(),(project=JSON.parse(content),project.customMetadatas&&project.customMetadatas.BehaviorGraphExtension)?(metadatas=project.customMetadatas.BehaviorGraphExtension,graphs=this_1.editor.core.scene.metadata.behaviorGraphs,picker=new babylonjs_editor_1.Picker("Import Scripts From "+f.name+"..."),picker.search=!0,picker.addItems(metadatas.graphs),picker.open(function(items){items.forEach(function(i){var graph=importFromFile?metadatas.graphs[i.id]:graphs[i.id],id=importFromFile?babylonjs_1.Tools.RandomId():graph.id;importFromFile&&(graph.id=id,graphs.push(graph)),_this.datas&&_this.datas.metadatas.push({active:!0,graphId:id})}),_this.editor.assets.refresh(_this.extension.id),_this.editor.graph.configure(),_this.objectSelected(_this.node)}),[2]):[2,"continue"]}})},this_1=this,_i=0,files_1=files,_a.label=3;case 3:return _i<files_1.length?(f=files_1[_i],[5,_loop_1(f)]):[3,6];case 4:_a.sent(),_a.label=5;case 5:return _i++,[3,3];case 6:return[2]}})})},BehaviorGraphEditor._CopiedGraph=null,BehaviorGraphEditor}(babylonjs_editor_1.EditorPlugin);exports.default=BehaviorGraphEditor})})(function(factory){module.exports=factory(require("babylonjs"),require("babylonjs-editor"),require("extensions/extensions.js"),require("litegraph.js"))});