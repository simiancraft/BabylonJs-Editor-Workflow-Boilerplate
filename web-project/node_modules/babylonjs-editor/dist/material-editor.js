!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6))),{}):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return i(t,r),a(t,r,[]),t.module}function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function s(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module,"__useDefault"in u?u.__useDefault:u}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=s(r.deps,r.depLoads,n);if(!r.executingRequire)for(var i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}var f=t.module=new o(r.moduleObj);if(!r.setters)for(var i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a],{}));i(s);var v=u(e[0]);if(e.length>1)for(var a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["d","12","e"],!0,function($__System){this.require,this.exports,this.module;$__System.registerDynamic("b",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("c",["d","e"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),extensions_1=$__require("e"),Tools=function(){function Tools(){}return Tools.prototype.getCustomMaterial=function(name){var ext=extensions_1.default.Instances.MaterialCreatorExtension;return ext?ext.instances[name]:null},Tools.prototype.getCustomScript=function(object,name){var ext=extensions_1.default.Instances.BehaviorExtension;return ext?"string"===(typeof object).toLowerCase()?ext.instances[object+name]:object instanceof babylonjs_1.Scene?ext.instances["scene"+name]:object instanceof babylonjs_1.ParticleSystem?ext.instances[object.id+name]:ext.instances[object.name+name]:null},Tools.prototype.getConstructor=function(name){var ext=extensions_1.default.Instances.BehaviorExtension;return ext?ext.scriptsConstructors[name]:null},Tools.prototype.getCustomPostProcess=function(name){var ext=extensions_1.default.Instances.PostProcessCreatorExtension;return ext?ext.instances[name]:null},Tools.prototype.getFileByName=function(name){return babylonjs_1.FilesInputStore.FilesToLoad[name]},Tools.prototype.getFileUrl=function(filename,oneTimeOnly){return void 0===oneTimeOnly&&(oneTimeOnly=!0),extensions_1.default.RoolUrl&&"file:"!==extensions_1.default.RoolUrl?extensions_1.default.RoolUrl+filename:URL.createObjectURL(this.getFileByName(filename))},Tools.prototype.getPathFinder=function(name){var ext=extensions_1.default.Instances.PathFinderExtension;return ext?ext.instances[name]:null},Tools.prototype.instantiatePrefab=function(name){return extensions_1.default.Instances.AssetsExtension.instantiatePrefab(name)},Tools.prototype.instantiateParticleSystemSet=function(name,position){return extensions_1.default.Instances.AssetsExtension.instantiateParticleSystemsSet(name,position)},Tools.prototype.sendMessage=function(object,methodName){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var ext=extensions_1.default.Instances.BehaviorExtension;if(!ext)return null;var scripts=ext.objectsInstances[object instanceof babylonjs_1.Scene?"Scene":object.id];scripts&&scripts.forEach(function(s){return s[methodName]&&s[methodName].apply(s,params)})},Tools}();exports.default=Tools;var exportScriptBodyString="\n    if (!params) {\n        returnValue = value;\n    } else {\n        returnValue = {\n            ctor: value\n        };\n\n        var keys = Object.keys(params);\n        for (var i = 0; i < keys.length; i++) {\n            returnValue[keys[i]] = params[keys[i]];\n        }\n    }\n".replace(/\n/g,"").replace(/\t/g,"").replace(/  /g,""),exportScriptReturnString="\nif (returnValue) {return returnValue;}\nif (exports) {return exports;}\n".replace(/\n/g,"").replace(/\t/g,"").replace(/  /g,"");exports.exportScriptString="\nfunction exportScript (value, params) {"+exportScriptBodyString+"};\n"+exportScriptReturnString+"\n"}),$__System.registerDynamic("f",["d"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__decorate=exports&&exports.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),CustomMaterialDefines=function(_super){function CustomMaterialDefines(){var _this=_super.call(this)||this;return _this.TEXTURE=!1,_this.CLIPPLANE=!1,_this.ALPHATEST=!1,_this.DEPTHPREPASS=!1,_this.POINTSIZE=!1,_this.FOG=!1,_this.NORMAL=!1,_this.UV1=!1,_this.UV2=!1,_this.VERTEXCOLOR=!1,_this.VERTEXALPHA=!1,_this.NUM_BONE_INFLUENCERS=0,_this.BonesPerMesh=0,_this.INSTANCES=!1,_this.rebuild(),_this}return __extends(CustomMaterialDefines,_super),CustomMaterialDefines}(babylonjs_1.MaterialDefines);exports.CustomMaterialDefines=CustomMaterialDefines;var CustomEditorMaterial=function(_super){function CustomEditorMaterial(name,scene,shaderName,customCode,config){var _this=_super.call(this,name,scene)||this;return _this.baseColor=new babylonjs_1.Color3(1,1,1),_this._disableLighting=!1,_this._maxSimultaneousLights=4,_this.userConfig={},_this._buildId=0,_this._lastBuildId=0,_this._shaderName=shaderName,_this.customCode=customCode,_this.customCode&&_this.customCode.init(),_this.config=config,_this}return __extends(CustomEditorMaterial,_super),CustomEditorMaterial.prototype.setCustomCode=function(customCode){this.customCode=customCode,this.customCode&&this.customCode.init()},CustomEditorMaterial.prototype.needAlphaBlending=function(){return this.alpha<1},CustomEditorMaterial.prototype.needAlphaTesting=function(){return!1},CustomEditorMaterial.prototype.getAlphaTestTexture=function(){return null},CustomEditorMaterial.prototype.isReadyForSubMesh=function(mesh,subMesh,useInstances){if(void 0===this.customCode)return!1;if(this.isFrozen&&this._wasPreviouslyReady&&subMesh.effect)return!0;subMesh._materialDefines||(subMesh._materialDefines=new CustomMaterialDefines);var defines=subMesh._materialDefines,scene=this.getScene();if(!this.checkReadyOnEveryCall&&subMesh.effect&&this._renderId===scene.getRenderId())return!0;var engine=scene.getEngine();if(defines._areTexturesDirty&&(defines._needUVs=!1,scene.texturesEnabled&&this.config)){for(var atLeastOneTexture=!1,_i=0,_a=this.config.textures;_i<_a.length;_i++){var t=_a[_i];if(this.userConfig[t.name]){if(!this.userConfig[t.name].isReady())return!1;atLeastOneTexture=!0}}atLeastOneTexture&&(defines._needUVs=!0,defines.TEXTURE=!0)}if(babylonjs_1.MaterialHelper.PrepareDefinesForMisc(mesh,scene,!1,this.pointsCloud,this.fogEnabled,!1,defines),defines._needNormals=babylonjs_1.MaterialHelper.PrepareDefinesForLights(scene,mesh,defines,!1,this._maxSimultaneousLights,this._disableLighting),babylonjs_1.MaterialHelper.PrepareDefinesForFrameBoundValues(scene,engine,defines,!!useInstances),babylonjs_1.MaterialHelper.PrepareDefinesForAttributes(mesh,defines,!0,!0),!this.customCode){for(var i=0;i<this._buildId;i++)delete defines["BUILD_"+i];defines["BUILD_"+this._buildId]=!0,defines.rebuild(),this._lastBuildId!==this._buildId&&subMesh.effect&&(this._lastBuildId=this._buildId,scene.getEngine()._releaseEffect(subMesh.effect))}if(defines.isDirty){defines.markAsProcessed(),scene.resetCachedMaterial();var fallbacks=new babylonjs_1.EffectFallbacks;defines.FOG&&fallbacks.addFallback(1,"FOG"),babylonjs_1.MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this.maxSimultaneousLights),defines.NUM_BONE_INFLUENCERS>0&&fallbacks.addCPUSkinningFallback(0,mesh);var attribs=[babylonjs_1.VertexBuffer.PositionKind];defines.NORMAL&&attribs.push(babylonjs_1.VertexBuffer.NormalKind),defines.UV1&&attribs.push(babylonjs_1.VertexBuffer.UVKind),defines.UV2&&attribs.push(babylonjs_1.VertexBuffer.UV2Kind),defines.VERTEXCOLOR&&attribs.push(babylonjs_1.VertexBuffer.ColorKind),babylonjs_1.MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks),babylonjs_1.MaterialHelper.PrepareAttributesForInstances(attribs,defines);var shaderName=this._shaderName,join=defines.toString(),uniformBuffers=new Array,samplers=this.config?this.config.textures.map(function(t){return t.name}):[],uniforms_1=["world","view","viewProjection","vEyePosition","vLightsType","vBaseColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane"];if(this.config&&(uniforms_1=uniforms_1.concat(this.config.floats).concat(this.config.vectors2).concat(this.config.vectors3),this.config.textures.forEach(function(t){uniforms_1.push(t.name+"Infos"),uniforms_1.push(t.name+"Matrix")})),this.customCode&&this.customCode.setUniforms(uniforms_1,samplers),this.customCode&&!this.customCode.isReadyForSubMesh(mesh,subMesh,defines))return!1;babylonjs_1.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms_1,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this.maxSimultaneousLights}),subMesh.setEffect(scene.getEngine().createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms_1,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},engine),defines)}return!(!subMesh.effect||!subMesh.effect.isReady())&&(this._renderId=scene.getRenderId(),this._wasPreviouslyReady=!0,!0)},CustomEditorMaterial.prototype.bindForSubMesh=function(world,mesh,subMesh){var _this=this,scene=this.getScene(),defines=subMesh._materialDefines;if(defines){var effect=subMesh.effect;effect&&(this._activeEffect=effect,this.bindOnlyWorldMatrix(world),this._activeEffect.setMatrix("viewProjection",scene.getTransformMatrix()),babylonjs_1.MaterialHelper.BindBonesParameters(mesh,this._activeEffect),this._mustRebind(scene,effect)&&(this.config&&this.config.textures.forEach(function(t){var texture=_this.userConfig[t.name];texture&&(_this._activeEffect.setTexture(t.name,texture),_this._activeEffect.setFloat2(t.name+"Infos",texture.coordinatesIndex,texture.level),_this._activeEffect.setMatrix(t.name+"Matrix",texture.getTextureMatrix()))}),babylonjs_1.MaterialHelper.BindClipPlane(this._activeEffect,scene),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),babylonjs_1.MaterialHelper.BindEyePosition(effect,scene)),this._activeEffect.setColor4("vBaseColor",this.baseColor,this.alpha*mesh.visibility),scene.lightsEnabled&&!this.disableLighting&&babylonjs_1.MaterialHelper.BindLights(scene,mesh,this._activeEffect,defines,this.maxSimultaneousLights),scene.fogEnabled&&mesh.applyFog&&scene.fogMode!==babylonjs_1.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",scene.getViewMatrix()),babylonjs_1.MaterialHelper.BindFogParameters(scene,mesh,this._activeEffect),this.customCode&&this.customCode.bindForSubMesh(world,mesh,subMesh,this._activeEffect),this.config&&(this.config.floats.forEach(function(f){return void 0!==_this.userConfig[f]&&_this._activeEffect.setFloat(f,_this.userConfig[f]||0)}),this.config.vectors2.forEach(function(v){return void 0!==_this.userConfig[v]&&_this._activeEffect.setVector2(v,_this.userConfig[v])}),this.config.vectors3.forEach(function(v){return void 0!==_this.userConfig[v]&&_this._activeEffect.setVector3(v,_this.userConfig[v])})),this._afterBind(mesh,this._activeEffect))}},CustomEditorMaterial.prototype.getAnimatables=function(){var _this=this,results=[];return this.config.textures.forEach(function(t){var texture=_this.userConfig[t.name];texture&&texture.animations&&texture.animations.length>0&&results.push(texture)}),results},CustomEditorMaterial.prototype.getActiveTextures=function(){var _this=this,activeTextures=_super.prototype.getActiveTextures.call(this);return this.config.textures.forEach(function(t){var texture=_this.userConfig[t.name];texture&&activeTextures.push(texture)}),activeTextures},CustomEditorMaterial.prototype.hasTexture=function(texture){if(_super.prototype.hasTexture.call(this,texture))return!0;if(this.config)for(var _i=0,_a=this.config.textures;_i<_a.length;_i++){var t=_a[_i];if(this.userConfig[t.name]===texture)return!0}return!1},CustomEditorMaterial.prototype.dispose=function(forceDisposeEffect){this.customCode&&this.customCode.dispose(),_super.prototype.dispose.call(this,forceDisposeEffect)},CustomEditorMaterial.prototype.clone=function(name){var _this=this;return babylonjs_1.SerializationHelper.Clone(function(){return new CustomEditorMaterial(name,_this.getScene(),_this._shaderName,_this.customCode,_this.config)},this)},CustomEditorMaterial.prototype.serialize=function(){var _this=this,serializationObject=babylonjs_1.SerializationHelper.Serialize(this);return serializationObject.customType="BABYLON.CustomEditorMaterial",serializationObject.textures={},serializationObject.floats={},serializationObject.vectors2={},serializationObject.vectors3={},this.config&&(this.config.textures.forEach(function(t){return void 0!==_this.userConfig[t.name]&&(serializationObject.textures[t.name]=_this.userConfig[t.name].serialize())}),this.config.floats.forEach(function(f){return void 0!==_this.userConfig[f]&&(serializationObject.floats[f]=_this.userConfig[f])}),this.config.vectors2.forEach(function(v){return void 0!==_this.userConfig[v]&&(serializationObject.vectors2[v]=_this.userConfig[v].asArray())}),this.config.vectors3.forEach(function(v){return void 0!==_this.userConfig[v]&&(serializationObject.vectors3[v]=_this.userConfig[v].asArray())})),serializationObject},CustomEditorMaterial.prototype.getClassName=function(){return"CustomMaterial"},CustomEditorMaterial.Parse=function(source,scene,rootUrl){var material=babylonjs_1.SerializationHelper.Parse(function(){return new CustomEditorMaterial(source.name,scene,source._shaderName,source._customCode,source.config)},source,scene,rootUrl);for(var thing in source.textures)material.userConfig[thing]=babylonjs_1.Texture.Parse(source.textures[thing],scene,rootUrl);for(var thing in source.floats)material.userConfig[thing]=source.floats[thing];for(var thing in source.vectors2)material.userConfig[thing]=babylonjs_1.Vector2.FromArray(source.vectors2[thing]);for(var thing in source.vectors3)material.userConfig[thing]=babylonjs_1.Vector3.FromArray(source.vectors3[thing]);return material},__decorate([babylonjs_1.serializeAsColor3("baseColor")],CustomEditorMaterial.prototype,"baseColor",void 0),__decorate([babylonjs_1.serialize("disableLighting")],CustomEditorMaterial.prototype,"_disableLighting",void 0),__decorate([babylonjs_1.expandToProperty("_markAllSubMeshesAsLightsDirty")],CustomEditorMaterial.prototype,"disableLighting",void 0),__decorate([babylonjs_1.serialize("maxSimultaneousLights")],CustomEditorMaterial.prototype,"_maxSimultaneousLights",void 0),__decorate([babylonjs_1.expandToProperty("_markAllSubMeshesAsLightsDirty")],CustomEditorMaterial.prototype,"maxSimultaneousLights",void 0),__decorate([babylonjs_1.serialize()],CustomEditorMaterial.prototype,"_shaderName",void 0),CustomEditorMaterial}(babylonjs_1.PushMaterial);exports.default=CustomEditorMaterial,BABYLON.CustomEditorMaterial=CustomEditorMaterial}),$__System.registerDynamic("10",["d","e","b","c","f"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var EDITOR,babylonjs_1=$__require("d"),extensions_1=$__require("e"),extension_1=$__require("b"),tools_1=$__require("c"),material_1=$__require("f"),template="\nEDITOR.MaterialCreator.Constructors['{{name}}'] = function () {\nvar returnValue = null;\nvar exports = { };\n\n{{code}}\n"+tools_1.exportScriptString+"\n}\n";!function(EDITOR){var MaterialCreator=function(){function MaterialCreator(){}return MaterialCreator.Constructors={},MaterialCreator}();EDITOR.MaterialCreator=MaterialCreator}(EDITOR=exports.EDITOR||(exports.EDITOR={})),window.EDITOR=window.EDITOR||{},window.EDITOR.MaterialCreator=EDITOR.MaterialCreator;var MaterialEditorExtension=function(_super){function MaterialEditorExtension(scene){var _this=_super.call(this,scene)||this;return _this.instances={},_this.datas=[],MaterialEditorExtension.Instance=_this,_this}return __extends(MaterialEditorExtension,_super),MaterialEditorExtension.prototype.createMaterial=function(data,rootUrl){var _this=this,id=data.name+babylonjs_1.Tools.RandomId();babylonjs_1.Effect.ShadersStore[id+"VertexShader"]=data.vertex,babylonjs_1.Effect.ShadersStore[id+"PixelShader"]=data.pixel;var code=null;if(data.code){var url=window.location.href;url=url.replace(babylonjs_1.Tools.GetFilename(url),"")+"materials/"+data.name.replace(/ /g,"")+".js",extension_1.default.AddScript(template.replace("{{name}}",id).replace("{{code}}",data.compiledCode||data.code),url);code=new(EDITOR.MaterialCreator.Constructors[id]())}var config=null;try{config=JSON.parse(data.config)}catch(e){}var material=this.scene.getMaterialByName(data.name);return material?(material.config=config,material._shaderName=id,material.setCustomCode(code)):material=new material_1.default(data.name,this.scene,id,code,config),data.code&&(data.userConfig.textures.forEach(function(t){return material.userConfig[t.name]=babylonjs_1.Texture.Parse(t.value,_this.scene,rootUrl||"file:")}),data.userConfig.floats.forEach(function(f){return material.userConfig[f.name]=f.value}),data.userConfig.vectors2.forEach(function(v){return material.userConfig[v.name]=babylonjs_1.Vector2.FromArray(v.value)}),data.userConfig.vectors3.forEach(function(v){return material.userConfig[v.name]=babylonjs_1.Vector3.FromArray(v.value)})),this.instances[data.name]={code:code,material:material},material},MaterialEditorExtension.prototype.onApply=function(data,rootUrl){var _this=this;this.datas=data,this.datas.forEach(function(d){return _this.createMaterial(d,rootUrl)})},MaterialEditorExtension.prototype.onSerialize=function(){var _this=this;if(!this.scene.metadata||!this.scene.metadata.MaterialCreator)return null;var data=this.scene.metadata.MaterialCreator;return data.forEach(function(d){_this.scene.materials.forEach(function(m){m instanceof material_1.default&&m.config&&m.name===d.name&&(d.userConfig.textures=[],m.config.textures.forEach(function(t){return m.userConfig[t.name]&&d.userConfig.textures.push({value:m.userConfig[t.name].serialize(),name:t.name})}),d.userConfig.floats=[],m.config.floats.forEach(function(f){return d.userConfig.floats.push({value:m.userConfig[f],name:f})}),d.userConfig.vectors2=[],m.config.vectors2.forEach(function(v){return d.userConfig.vectors2.push({value:m.userConfig[v].asArray(),name:v})}),d.userConfig.vectors3=[],m.config.vectors3.forEach(function(v){return d.userConfig.vectors3.push({value:m.userConfig[v].asArray(),name:v})}))})}),data},MaterialEditorExtension.prototype.onLoad=function(data){var _this=this;this.datas=data,this.scene.metadata=this.scene.metadata||{},this.scene.metadata.MaterialCreator=[],this.datas.forEach(function(d){d.id=d.id||babylonjs_1.Tools.RandomId(),_this.scene.metadata.MaterialCreator.push(d)})},MaterialEditorExtension.Instance=null,MaterialEditorExtension}(extension_1.default);exports.default=MaterialEditorExtension,extensions_1.default.Register("MaterialCreatorExtension",MaterialEditorExtension)}),$__System.registerDynamic("11",["d","12","e"],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),babylonjs_editor_1=$__require("12"),extensions_1=$__require("e"),Helpers=function(){function Helpers(){}return Helpers.UpdateMonacoTypings=function(editor,editedData,onlyNonAttached){void 0===editedData&&(editedData=null),void 0===onlyNonAttached&&(onlyNonAttached=!1);var scripts=editor.core.scene.metadata.behaviorScripts,extension=extensions_1.default.RequestExtension(editor.core.scene,"BehaviorExtension");if(scripts&&extension){var datas_1=extension.onSerialize();for(var k in babylonjs_editor_1.CodeEditor.CustomLibs){babylonjs_editor_1.CodeEditor.CustomLibs[k].dispose()}babylonjs_editor_1.CodeEditor.CustomLibs={},scripts.forEach(function(s){if(s!==editedData){if(onlyNonAttached){if(datas_1.nodes.find(function(n){return void 0!==n.metadatas.find(function(m){return m.codeId===s.id})}))return}var code='declare module "'+s.name+'" {'+s.code+"}";babylonjs_editor_1.CodeEditor.CustomLibs[s.name]=window.monaco.languages.typescript.typescriptDefaults.addExtraLib(code,s.name)}})}},Helpers.GetSceneMetadatas=function(scene){return scene.metadata=scene.metadata||{},scene.metadata},Helpers.CreatePreview=function(canvas){var engine=new babylonjs_1.Engine(canvas),scene=new babylonjs_1.Scene(engine),camera=new babylonjs_1.ArcRotateCamera("PreviewCamera",0,0,10,babylonjs_1.Vector3.Zero(),scene,!0);return camera.attachControl(canvas,!0,!1),{engine:engine,scene:scene,camera:camera}},Helpers}();exports.default=Helpers}),$__System.registerDynamic("a",["d","12","e","10","11"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),babylonjs_editor_1=$__require("12"),extensions_1=$__require("e");$__require("10");var helpers_1=$__require("11"),MaterialEditor=function(_super){function MaterialEditor(editor){var _this=_super.call(this,"Material Editor")||this;return _this.editor=editor,_this.layout=null,_this.toolbar=null,_this.grid=null,_this.currentTab="MATERIAL-CREATOR-EDITOR-CODE",_this.code=null,_this.vertex=null,_this.pixel=null,_this.config=null,_this.datas=[],_this.data=null,_this.extension=null,_this}return __extends(MaterialEditor,_super),MaterialEditor.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return this.layout.element.destroy(),this.toolbar.element.destroy(),this.grid.element.destroy(),this.code.dispose(),this.vertex.dispose(),this.pixel.dispose(),this.config.dispose(),[4,_super.prototype.close.call(this)];case 1:return _a.sent(),[2]}})})},MaterialEditor.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){var _a,_b,_c,_d,_e,_f,_g,_h,material,_this=this;return __generator(this,function(_j){switch(_j.label){case 0:return(_a=!MaterialEditor.DefaultCode)?(_b=MaterialEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/material-creator/class.ts")]):[3,2];case 1:_a=_b.DefaultCode=_j.sent(),_j.label=2;case 2:return(_c=!MaterialEditor.DefaultVertex)?(_d=MaterialEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/material-creator/vertex.fx")]):[3,4];case 3:_c=_d.DefaultVertex=_j.sent(),_j.label=4;case 4:return(_e=!MaterialEditor.DefaultPixel)?(_f=MaterialEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/material-creator/pixel.fx")]):[3,6];case 5:_e=_f.DefaultPixel=_j.sent(),_j.label=6;case 6:return(_g=!MaterialEditor.DefaultConfig)?(_h=MaterialEditor,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/material-creator/config.json")]):[3,8];case 7:_g=_h.DefaultConfig=_j.sent(),_j.label=8;case 8:return this.extension=extensions_1.default.RequestExtension(this.editor.core.scene,"MaterialCreatorExtension"),this.editor.core.scene.metadata=this.editor.core.scene.metadata||{},this.editor.core.scene.metadata.MaterialCreator||(this.datas=this.editor.core.scene.metadata.MaterialCreator=[{name:"Custom material",id:babylonjs_1.Tools.RandomId(),code:MaterialEditor.DefaultCode,vertex:MaterialEditor.DefaultVertex,pixel:MaterialEditor.DefaultPixel,config:MaterialEditor.DefaultConfig,userConfig:{}}],this.data=this.datas[0],material=this.extension.createMaterial({name:this.data.name,code:null,vertex:this.data.vertex,pixel:this.data.pixel,config:this.data.config,userConfig:{}}),this.editor.core.onAddObject.notifyObservers(material)),this.datas=this.editor.core.scene.metadata.MaterialCreator,this.data=this.datas[0],this.layout=new babylonjs_editor_1.Layout("MaterialCreatorCode"),this.layout.panels=[{type:"top",content:'<div id="MATERIAL-CREATOR-TOOLBAR" style="width: 100%; height: 100%;"></div>',size:32,overflow:"auto",resizable:!0},{type:"left",content:'<div id="MATERIAL-CREATOR-LIST" style="width: 100%; height: 100%;"></div>',size:250,overflow:"auto",resizable:!0},{type:"main",content:'\n                    <div id="MATERIAL-CREATOR-EDITOR-CODE" style="width: 100%; height: 100%; overflow: hidden;"></div>\n                    <div id="MATERIAL-CREATOR-EDITOR-VERTEX" style="width: 100%; height: 100%; overflow: hidden; display: none;"></div>\n                    <div id="MATERIAL-CREATOR-EDITOR-PIXEL" style="width: 100%; height: 100%; overflow: hidden; display: none;"></div>\n                    <div id="MATERIAL-CREATOR-EDITOR-CONFIG" style="width: 100%; height: 100%; overflow: hidden; display: none;"></div>\n                ',resizable:!0,tabs:[{id:"code",caption:"Code"},{id:"vertex",caption:"Vertex"},{id:"pixel",caption:"Pixel"},{id:"config",caption:"Config"}]}],this.layout.build(this.divElement.id),this.toolbar=new babylonjs_editor_1.Toolbar("MaterialEditorToolbar"),this.toolbar.items=[{id:"open-code-editor",text:"Open Code Editor",caption:"Open Code Editor",img:"icon-edit"}],this.toolbar.onClick=function(id){return _this.onToolbarClick(id)},this.toolbar.build("MATERIAL-CREATOR-TOOLBAR"),this.grid=new babylonjs_editor_1.Grid("MaterialCreatorGrid",{toolbarReload:!1,toolbarEdit:!1,toolbarSearch:!1}),this.grid.columns=[{field:"name",caption:"Name",size:"100%",editable:{type:"string"}}],this.grid.build("MATERIAL-CREATOR-LIST"),this.grid.onAdd=function(){return _this.addMaterial()},this.grid.onClick=function(selected){return _this.selectMaterial(selected[0])},this.grid.onDelete=function(selected){return _this.removeMaterial(selected[0])},this.grid.onChange=function(id,value){return _this.changeMaterial(id,value)},this.datas.forEach(function(d,index){return _this.grid.addRecord({name:d.name,recid:index})}),this.grid.element.refresh(),this.grid.select([0]),[4,this.createEditors()];case 9:return _j.sent(),setTimeout(function(){return _this.selectMaterial(0)},500),babylonjs_editor_1.VSCodeSocket.OnUpdateMaterialCode=function(d){return __awaiter(_this,void 0,void 0,function(){var effective,compiledCode,_a;return __generator(this,function(_b){switch(_b.label){case 0:return effective=this.datas.find(function(s){return s.id===d.id}),d.code?[4,babylonjs_editor_1.CodeEditor.TranspileTypeScript(d.code,d.name.replace(/ /,""),{module:"cjs",target:"es5",experimentalDecorators:!0})]:[3,2];case 1:return _a=_b.sent(),[3,3];case 2:_a=null,_b.label=3;case 3:return compiledCode=_a,effective?(d.code&&(effective.code=d.code),d.pixel&&(effective.pixel=d.pixel),d.vertex&&(effective.vertex=d.vertex),d.config&&(effective.config=d.config),compiledCode&&(effective.compiledCode=compiledCode),this.data&&this.data.id===d.id&&this.selectMaterial(this.datas.indexOf(this.data)),[2]):(babylonjs_editor_1.VSCodeSocket.RefreshMaterial(this.datas),[2])}})})},[2]}})})},MaterialEditor.prototype.onShow=function(){this.grid.element.resize()},MaterialEditor.prototype.onResize=function(){this.layout.element.resize()},MaterialEditor.prototype.onToolbarClick=function(id){switch(id){case"open-code-editor":this.editCode()}},MaterialEditor.prototype.addMaterial=function(){return __awaiter(this,void 0,void 0,function(){var name,data,material;return __generator(this,function(_a){switch(_a.label){case 0:return[4,babylonjs_editor_1.Dialog.CreateWithTextInput("Material Name")];case 1:return name=_a.sent(),data={name:name,id:babylonjs_1.Tools.RandomId(),code:MaterialEditor.DefaultCode,vertex:MaterialEditor.DefaultVertex,pixel:MaterialEditor.DefaultPixel,config:MaterialEditor.DefaultConfig,userConfig:{}},material=this.extension.createMaterial({name:data.name,code:null,vertex:data.vertex,pixel:data.pixel,config:data.config,userConfig:data.userConfig}),this.datas.push(data),this.grid.addRow({name:material.name,recid:this.grid.element.records.length-1}),this.editor.core.onAddObject.notifyObservers(material),babylonjs_editor_1.VSCodeSocket.RefreshMaterial(data),[2]}})})},MaterialEditor.prototype.changeMaterial=function(id,value){var data=this.datas[id],material=this.editor.core.scene.getMaterialByName(data.name);material&&(material.name=value),data.name=value,babylonjs_editor_1.VSCodeSocket.RefreshMaterial(this.datas)},MaterialEditor.prototype.selectMaterial=function(id){if(this.data=this.datas[id],!this.data)return this.code.setValue(""),this.vertex.setValue(""),this.pixel.setValue(""),this.config.setValue(""),this.layout.lockPanel("main","No Material Selected");this.code.setValue(this.data.code),this.vertex.setValue(this.data.vertex),this.pixel.setValue(this.data.pixel),this.config.setValue(this.data.config),helpers_1.default.UpdateMonacoTypings(this.editor,this.data),this.layout.unlockPanel("main")},MaterialEditor.prototype.removeMaterial=function(id){var material=this.editor.core.scene.getMaterialByName(this.datas[id].name);material&&material.dispose(!0),this.datas.splice(id,1),babylonjs_editor_1.VSCodeSocket.RefreshMaterial(this.datas),this.selectMaterial(0)},MaterialEditor.prototype.updateShaders=function(){var material=this.editor.core.scene.getMaterialByName(this.data.name);material&&(babylonjs_1.Effect.ShadersStore[material._shaderName+"VertexShader"]=this.data.vertex,babylonjs_1.Effect.ShadersStore[material._shaderName+"PixelShader"]=this.data.pixel,material._buildId++,material.markAsDirty(babylonjs_1.Material.MiscDirtyFlag))},MaterialEditor.prototype.createEditors=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this.code=new babylonjs_editor_1.CodeEditor("typescript",""),[4,this.code.build("MATERIAL-CREATOR-EDITOR-CODE")];case 1:return _a.sent(),this.vertex=new babylonjs_editor_1.CodeEditor("cpp",""),[4,this.vertex.build("MATERIAL-CREATOR-EDITOR-VERTEX")];case 2:return _a.sent(),this.pixel=new babylonjs_editor_1.CodeEditor("cpp",""),[4,this.pixel.build("MATERIAL-CREATOR-EDITOR-PIXEL")];case 3:return _a.sent(),this.config=new babylonjs_editor_1.CodeEditor("json",""),[4,this.config.build("MATERIAL-CREATOR-EDITOR-CONFIG")];case 4:return _a.sent(),this.layout.getPanelFromType("main").tabs.on("click",function(ev){$("#"+_this.currentTab).hide(),_this.currentTab="MATERIAL-CREATOR-EDITOR-"+ev.target.toUpperCase(),$("#"+_this.currentTab).show()}),this.code.onChange=function(value){_this.data&&(_this.data.code=value,_this.data.compiledCode=_this.code.transpileTypeScript(value,_this.data.name.replace(/ /,"")),babylonjs_editor_1.VSCodeSocket.RefreshMaterial(_this.data))},this.vertex.onChange=function(value){_this.data&&(_this.data.vertex=value,_this.updateShaders(),babylonjs_editor_1.VSCodeSocket.RefreshMaterial(_this.data))},this.pixel.onChange=function(value){_this.data&&(_this.data.pixel=value,_this.updateShaders(),babylonjs_editor_1.VSCodeSocket.RefreshMaterial(_this.data))},this.config.onChange=function(value){if(_this.data){_this.data.config=value;var material=_this.editor.core.scene.getMaterialByName(_this.data.name);if(material)try{var config=JSON.parse(_this.data.config);material.config=config,_this.editor.core.onSelectObject.notifyObservers(material),_this.updateShaders()}catch(e){}babylonjs_editor_1.VSCodeSocket.RefreshMaterial(_this.data)}},[2]}})})},MaterialEditor.prototype.editCode=function(){return __awaiter(this,void 0,void 0,function(){var editor,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return MaterialEditor.CodeProjectEditor?[2]:[4,babylonjs_editor_1.CodeProjectEditorFactory.Create(this.editor,{name:"Code Editor - Materials",scripts:this.editor.core.scene.metadata.MaterialCreator,onOpened:function(){_this.layout.lockPanel("main")},onClose:function(){MaterialEditor.CodeProjectEditor=null,_this.data&&_this.layout.unlockPanel("main")}})];case 1:return editor=_a.sent(),MaterialEditor.CodeProjectEditor=editor,[2]}})})},MaterialEditor.DefaultCode="",MaterialEditor.DefaultVertex="",MaterialEditor.DefaultPixel="",MaterialEditor.DefaultConfig="",MaterialEditor.CodeProjectEditor=null,MaterialEditor}(babylonjs_editor_1.EditorPlugin);exports.default=MaterialEditor})})(function(factory){module.exports=factory(require("babylonjs"),require("babylonjs-editor"),require("extensions/extensions.js"))});